DeepPicker : a Deep Learning Approach for Fully Automated Particle Picking in Cryo - EM Feng Wang 3 , † , Huichao Gong 2 , † , Gaochao Liu 1 , 4 , † , Meijing Li 1 , 4 , Chuangye Yan 1 , 5 , Tian Xia 3 , ∗ , Xueming Li 1 , 4 , 5 , ∗ , Jianyang Zeng 2 , ∗ May 9 , 2016 Abstract Particle picking is a time - consuming step in single - particle analysis and often requires sig - niﬁcant interventions from users , which has become a bottleneck for future automated electron cryo - microscopy ( cryo - EM ) . Here we report a deep learning framework , called DeepPicker , to address this problem and ﬁll the current gaps toward a fully automated cryo - EM pipeline . DeepPicker employs a novel cross - molecule training strategy to capture common features of particles from previously - analyzed micrographs , and thus does not require any human inter - vention during particle picking . Tests on the recently - published cryo - EM data of three com - plexes have demonstrated that our deep learning based scheme can successfully accomplish the human - level particle picking process and identify a sufﬁcient number of particles that are comparable to those manually by human experts . These results indicate that DeepPicker can provide a practically useful tool to signiﬁcantly reduce the time and manual effort spent in single - particle analysis and thus greatly facilitate high - resolution cryo - EM structure determi - nation . 1 Introduction Recent advance of the single - particle electron cryo - microscopy ( cryo - EM ) technique has been revolutionizing the structural biology ﬁeld [ 1 , 2 , 3 ] , and enabled protein complex structure de - termination at near - atomic resolution [ 4 , 5 , 6 , 7 ] . However , the high - resolution cryo - EM studies 1 School of Life Sciences , Tsinghua University , Beijing , 100084 , China 2 Institute for Interdisciplinary Information Sciences , Tsinghua University , Beijing , 100084 , China 3 School of Electronic Information and Communications , Huazhong University of Science and Technology , Wuhan 430074 , China 4 Beijing Advanced Innovation Center for Structure Biology , Tsinghua University , Beijing , 100084 , China 5 Tsinghua - Peking Joint Center for Life Sciences , Tsinghua University , Beijing , 100084 , China † These authors contributed equally to this work . ∗ Corresponding author : Jianyang Zeng , zengjy321 @ tsinghua . edu . cn ; Xueming Li , lixueming @ mail . tsinghua . edu . cn ; Tian Xia , isutian @ gmail . com . 1 a r X i v : 1605 . 01838v1 [ q - b i o . Q M ] 6 M a y 2016 of molecular complexes generally require the selection of a tremendous number of ( e . g . , hun - dreds of thousands of ) high - quality particles from micrographs . This particle picking step is a labor - intensive step in single - particle data analysis and is a major obstacle for automated cryo - EM pipeline . In the past , particles from cryo - EM micrographs are often selected manually . Such a manual picking process is usually a laborious , tedious and time - consuming task which inevitably requires a considerable amount of human effort to obtain a sufﬁcient number of good - quality parti - cles to ensure high - resolution 3D reconstruction . In addition , manual particle selection is normally subjective and can easily introduce bias and inconsistency due to change in human judgement over time . To relieve the bottleneck in single - particle data analysis , numerous computational approaches have been proposed to facilitate the particle picking process [ 8 , 9 , 10 , 11 , 12 , 13 , 14 , 15 , 16 , 17 , 18 , 19 ] . These methods can be basically divided into three categories , including genera - tive [ 11 , 12 , 13 ] , unsupervised [ 14 , 15 ] and discriminative approaches [ 10 , 16 , 17 ] . The gen - erative approaches [ 11 , 12 , 13 ] usually measure the similarity to a reference to identify particle candidates from micrographs . A typical generative method employs a template - matching tech - nique [ 12 , 13 ] with a cross - correlation similarity measure to accomplish particle selection . The unsupervised approaches distinguish the images of particle - like objects from background noise in micrographs via an unsupervised learning manner ( i . e . , without any labeled training data ) [ 14 , 15 ] . The discriminative methods ﬁrst train a classiﬁer based on a labeled dataset of positive and nega - tive examples , and then apply this trained classiﬁer to detect and recognize particle images from micrographs [ 10 , 16 , 17 ] . Although these computational approaches have greatly reduced time and effort spent on single - particle data analysis , there still remain gaps to achieve a fully auto - mated pipeline for efﬁcient particle picking . For instance , most of the generative methods require the user to prepare an initial set of high - quality reference particles used as templates to search for similar particle candidates from micrographs , while the discriminative approaches usually demand the user to manually pick a number of positive and negative samples to train the classiﬁer . Thus , these approaches generally depend upon a certain level of human intervention to provide a portion of manually - picked particles to initialize the particle selection process . Although the unsupervised approaches do not heavily rely on hand - labeled data , they rarely fully exploit the intrinsic and unique characters of particles to facilitate automated particle picking . Therefore , the unsupervised approaches are often combined with the template - matching or classiﬁcation based approaches to achieve decent picking results [ 18 , 19 ] . In recent years , deep learning has become an increasing popular tool in the machine learn - ing ﬁeld probably due to the availability of large - scale training data , the advance of powerful computing platforms and the development of efﬁcient learning algorithms [ 20 , 21 , 22 ] . Tests on several well - known benchmark datasets have demonstrated that deep learning can achieve better performance especially in large - scale data analysis than traditional machine learning ap - proaches [ 20 , 21 , 23 , 24 ] . So far deep learning has been successfully applied to a wide range of data science ﬁelds , such as computer vision [ 23 , 25 , 26 , 27 ] , natural language processing [ 21 , 28 , 29 ] and computational biology [ 30 , 31 ] . More recently , the Google team has shown that the deep learn - ing framework is capable of achieving an impressive and amazing level of artiﬁcial intelligence that can closely mimic the problem solving skills of human experts [ 32 , 33 ] . Despite these successful 2 stories in a variety of applications , it still remains unknown whether the deep learning technique can also be effectively used to address the current problems in particle picking and achieve a fully automated particle selection procedure in single - particle cryo - EM data analysis . Here , we aim to answer this question and propose a deep learning framework , called DeepPicker , to ﬁll the afore - mentioned gaps in automated particle selection and liberate structural biologists from the dreary manual picking process to focus on more interesting work . Although our deep learning model can be trained with a semi - automated manner as the con - ventional classiﬁcation based approaches , it can be equipped with a new training scheme , which fully exploits the known particles of other molecular complexes that are different from the target one and whose structures have been previously determined by cryo - EM . This new training strategy does not require any manual effort in particle picking for the current target molecular complex and thus is considered fully automated . Our deep learning model with such a new cross - molecule train - ing scheme is innovative and can effectively capture the common abstract representation of latent features from the known particles of the previously - determined molecular structures . It can closely mimic human intelligence and effectively use the extracted cross - molecule features to initialize the particle picking process of the current target complex . To our knowledge , our approach is the ﬁrst successful attempt to fully exploit the cross - molecule data to achieve full automation in particle picking without any human interference . We have implemented our deep learning method for particle picking and tested it on the real cryo - EM data of three molecules that have been published in the past three years , including TRPV1 [ 4 ] ( from EMPIAR ( https : / / www . ebi . ac . uk / pdbe / emdb / empiar / ) ) , human γ - secretase [ 34 ] and yeast spliceosome [ 5 ] . Our tests have demonstrated that the proposed deep learning framework with either semi - automated or fully automated training scheme can accurately detect and select a sufﬁcient number of particles that are comparable to those picked manually by human experts . Our new automated picking approach can signiﬁcantly reduce time and la - bor spent in single - particle data analysis and thus greatly relieve a bottleneck in the automated cryo - EM structure determination pipeline . 2 Results 2 . 1 A deep learning framework for fully automated particle picking We implemented a deep learning framework for automated particle picking in single - particle cryo - EM structure determination ( Fig . 1 ) . The automated particle picking pipeline consists of two modules , i . e , model training and particle picking ( Fig . 1 ) . In the model training module , a set of labeled positive and negative samples is used to train a convolutional neural network ( CNN ) model ( see Sections 4 . 2 and 4 . 3 ) , while in the particle picking module , the trained CNN classiﬁer is then used to select particle images from input micrographs . The particle picking module is further divided into ﬁve steps : scoring , cleaning , ﬁltering , sorting and iteration . In the scoring step , a sliding window ( i . e . , a square box ) of a ﬁxed size is used to scan each micrograph from the top left corner to the bottom right corner with a constant step size . The box size of the sliding window is chosen to be slightly larger than the particle size , which can be easily estimated and deﬁned as a parameter . During the above scanning process , each patch within the sliding window 3 is extracted and fed to the trained CNN classiﬁer as input data . The prediction score between 0 and 1 output by the CNN model , which represents the probability of being a particle at the current position , is then assigned to the center of the corresponding window . After that , we obtain a “scored map” , which describes the distribution of the likelihood scores of particles over the whole micrograph . As ice noise can easily introduce false positives during the picking process , we also employ a cleaning step to discard these false particles from the candidate list . In this cleaning step , we ﬁrst connect any two neighboring pixels if their prediction scores are both above a threshold , and then examine the size of each connected domain ( i . e . , the portion of all connected pixels ) . If the size of a connected domain is larger than a cutoff value , it is regarded as a potential false positive probably due to ice noise , and thus removed from the candidate list . In the ﬁltering step , we aim to reﬁne the current set of particle candidates and also identify the center coordinates of the ﬁnal remaining particles from the scored map . We ﬁrst introduce a concept of peak window , the size of which is related to the minimum distance between centers of two possible particles . Then the position with the maximum prediction score in each peak window is chosen and output as the center of a particle . We also remove bad particle candidates in which the number of extreme pixels is more than three standard deviations away from the mean . In the sorting step , we sort the remaining particle candidates according to their prediction scores . In the iteration step , we use the particles picked by the previous CNN classiﬁer which was trained over the known particles of other molecules to further reﬁne the CNN model . After a certain number of iterations , the algorithm outputs the top list of the highest - rated particles . The detailed setting of the parameters described for the above operations is provided in Section 4 . 5 . In general , the particles of different molecular complexes display distinct sizes and shapes . Thus , how to effectively exploit the cross - molecule features to pick particles from micrographs of the current complex is a major challenge in our work . As described above , this problem has been tackled in our framework mainly using two strategies . First , the known particles from multiple types of other molecular complexes are combined together to train the deep learning classiﬁer and enable it to capture common features of particles . Second , the particles of the target molecule identiﬁed from the deep learning classiﬁer trained by a cross - molecule manner in the ﬁrst iteration are further used to reﬁne the model to better describe the features of the current target complex . In our automated particle picking scheme , the user is not required to manually pick any particle from micrographs of the current target molecule . Thus , it is considered a fully automated procedure without requiring any manual intervention during the particle selection process . 2 . 2 Performance evaluation on fully automated particle picking 2 . 2 . 1 Accuracy of particle picking We have tested and evaluated the performance of our fully automated particle picking approach on the published datasets of γ - secretase , spliceosome and TRPV1 ( see Section 4 . 1 for details of data preprocessing ) , in which the known particles of the other two molecules that were different from the target complex were used as training data ( Fig . 2 ) . In addition , another two datasets , including β - galactosidase [ 35 ] and NSF ( N - ethylmaleimide Sensitive Factor ) fusion complex ( 20S particle ) [ 36 ] , were incorporated into training data . We compared the fully automated picking 4 results with the coordinates of the reference particles identiﬁed manually by human experts and measured both precision and recall scores ( see Section 4 . 4 ) . As in the current single - particle anal - ysis pipeline , the fraction of true particles that have been picked is generally more important for 3D model reconstruction [ 37 ] , we focused more on the recall metric . A typical example of the fully automated picking results is shown in Fig . 2 ( a ) , which has demonstrated that most of the particles picked by our fully automated approach from a micrograph were reasonable . All different tests ( Fig . 2 ( b ) ) show that our fully automated picking method can achieve high recall scores ( above 0 . 81 ) , which implies that most of the reference particles manually picked by human experts can also be identiﬁed by our deep learning framework with a cross - molecule training strategy . In addition , when the number of the top scoring particles picked by our fully automated approach was close to that of the reference particles , both recall and precision scores were relatively high ( Fig . 2 ( c ) , ( d ) and ( e ) ) . These results imply that a major fraction of the particles identiﬁed by our fully automated scheme were consistent with those manually picked by human experts . The comparisons among results by using different training datasets ( see Section 4 . 3 ) show that our CNN classiﬁer trained by multiple datasets achieved more robust performance than that using only a single dataset as training data ( Fig . 2 ( c ) , ( d ) and ( e ) ) . Such a result was expected , as the hidden features derived from multiple datasets were supposed to be more general . In practice , we can include as many known datasets as possible into training data to boost the classiﬁcation performance of our deep learning model . All the above results indicate that , despite different contrast levels of micrographs , different shapes and sizes of the known particles from other molecules used as training data , our fully au - tomated approach can effectively identiﬁed accurate particles that were comparable to the manual picking results and thus achieve a near human level of particle selection . Therefore , our fully auto - mated particle picking method can be practically useful for cryo - EM structure determination . As it does not require any human intervention , in practice , it can help the user save a huge amount of time and effort in single - particle data analysis . 2 . 2 . 2 The 2D clustering and class averaging results The 2D clustering and class averaging operations are commonly used right after the particle picking step in the single - particle data analysis pipeline to further remove false positives and reﬁne the list of the selected particles for 3D map reconstruction [ 38 , 39 ] . Thus , an additional effective method for evaluating the practicability of an automated particle picking approach is to further examine the 2D clustering and class averaging results of the identiﬁed particles . We have performed such an investigation and reﬁned the original list of the picked particles by ﬁltering those obviously bad - quality particles ( see Section 4 . 4 ) during the 2D clustering and averaging operations as in a standard single - particle data analysis pipeline . The comparison results have demonstrated that the 2D clustering and class averaging results of our fully automated picking method were comparable to those of the reference particles manually selected by human experts ( Fig . 3 ) . For example , the side - view particles of γ - secretase that were identiﬁed and used in the original paper [ 34 ] to reconstruct the near - atomic resolution 3D map were almost all present in our automated results ( Fig . 3 ( a ) and ( b ) ) . This implies that the particles automatically picked by our approach can represent a majority of good - quality 2D images that were practically useful for downstream data 5 analysis in cryo - EM structure determination . Thus , our fully automated particle picking approach can provide a good starting point for 3D map reconstruction in cryo - EM . 2 . 2 . 3 Identiﬁcation of particle centers Identifying the accurate centers of particles is crucial for downstream single - particle data analysis , such as 2D clustering and 3D map reconstruction . In the previous 2D clustering and averaging results , we have shown that most of the particles picked by our fully automated approach were well centralized : almost all the averaging particle images selected by our program were fully covered by the mask circle ( Fig . 3 ) . To further investigate the accuracy of our fully automated approach in identifying the centers of particles , we also measured the average distance with respect to the box size of sliding window between the particles picked fully automatically by our CNN classiﬁer and manually by human experts ( Fig . 4 ) . We observed that the particles picked by our fully automated scheme deviated less than 10 % of the box size from the reference images . These results imply that our fully automated approach can accurately detect the centers of particles that were quite close to those manually identiﬁed by human experts . 2 . 3 Semi - automated particle picking with an alternative training strategy In our fully automated picking scheme , the known particles from other molecular complexes that are different from the current target molecule are used to train the deep learning classiﬁer . An alternative training scheme is to let the user manually select a small number of particles as positive samples to train the CNN model and initialize the particle selection process ( Fig . 5 ( a ) ) . Such a scheme requires a certain level of human intervention and thus is considered semi - automated . As in the previous evaluation of fully automated particle picking , we also performed the similar tests for the semi - automated picking scheme on the same datasets of γ - secretase , spliceosome and TRPV1 . Overall , various tests on these three datasets have demonstrated that the semi - automated pick - ing method resulting from the alternative training scheme can detect and identify a high percentage of correct particles that were consistent with the manual picking results by human experts ( Fig . 5 ( b ) ) . These results were similar to those in the previous tests of fully automated picking ( Fig . 2 ( b ) ) . The semi - automated picking results with 10 , 000 particles as training data were only slightly better than the fully automated picking results ( Fig . 5 ( c ) , ( d ) and ( e ) ) . We also observed similar trends of precision and recall curves with respect to the number of picked particles for both fully automated and semi - automated schemes ( Fig . 5 ( b ) , ( c ) , ( d ) and ( e ) ) . From the other perspective , our fully automated picking scheme can achieve performance close to that of semi - automated picking , and both schemes can yield outcomes that were comparable to those manual picking results by human experts . Another noticeable observation in the test results of semi - automated particle picking is that , when the number of manually picked particles used in training data varied from 400 to 10000 , the performance of our semi - automated picking method did not signiﬁcantly change ( Fig . 5 ( b ) , ( c ) , ( d ) and ( e ) ) . This result indicates that in practice the user only needs to select a small number ( e . g . , 400 ) of particles , which is sufﬁcient enough to train our deep learning model for accurately 6 picking new particles from the remaining micrographs . Thus , it can only demand a minimum of human intervention and can also provide a practically useful tool for the current cryo - EM structure determination pipeline . 3 Discussion The difﬁculty of picking particles from a micrograph is generally associated with the contrast level of the image , which is generally related to its defocus level . To examine the inﬂuence of the contrast levels on the automated particle selection results , we further examined the recall scores of our fully automated scheme at different defocus levels ( Fig . 6 ) . The tests on the micrographs of γ - secretase , spliceosome and TRPV1 with defocus ranging from 1 µ m to 3 . 5 µ m have shown that the performance of our fully automated particle picking method was relatively robust at different defocus levels ( Fig . 6 ( a ) , ( b ) and ( c ) ) . This implies that our automated method can identify a sufﬁcient number of correct particles at various conditions of data collection and thus may have a wide range of applications in single - particle cryo - EM data analysis . Recently , it has been pointed out that the template - based particle picking methods might fall into a potentially dangerous pitfall [ 40 , 41 , 42 ] , termed “Einstein - from - noise” [ 43 ] , in which a pho - tograph of Einstein was used as a template and pure noise images were aligned to this reference to reconstruct the Einstein image . Although our deep learning approach is essentially different from the template - based methods , it would be interesting to know whether our approach also suffers from this general problem , when using the cross - molecule particles as training data and picking particles from random noise . To investigate this issue , we tested our CNN model , which was trained by a mixture of 5000 γ - secretase and 5000 spliceosome particles , on 26 pure background micrographs which were measured from an empty cryo - EM instrument without putting any sample inside . In this additional test on background images with random noise , we found that it was dif - ﬁcult to pick particles with the normal threshold value as used in the previous tests of γ - secretase , spliceosome or TRPV1 ( see Section 2 ) . We then set the threshold to zero and investigated the distribution of the prediction scores of the selected particles . We found that for background with random noise , almost all the picked particles were associated with a low prediction score ( less than 0 . 05 ) ( Fig . 6 ( d ) ) , which were greatly different from our previous results , e . g . , the test of TRPV1 ( Fig . 6 ( e ) ) . This result indicates that very unlikely our automated picking process with the cross - molecule training scheme would fall into the previously - mentioned pitfall . In addition to its own virtue in full automation , our deep learning framework with the cross - molecule training strategy has several additional advantages . First , unlike the subjective manual picking , the picking results of our deep learning classiﬁer are objective and mainly determined by the in - house “computational” experts learned from training data . Second , as we apply a cross - molecule training method , in principle , we can incorporate as many available known particles from previously - solved complex structures as possible into training data , which will thus increase the robustness of the training process and further improve the automated picking results . Third , in our fully automated picking scheme under the deep learning framework , the cross - molecule training process can be ﬁnished before collecting micrograph data of the current target molecule . Such an ofﬂine training manner is much more efﬁcient than the online training methods ( i . e . , the classiﬁers are trained after data collection ) in most of existing classiﬁcation based frameworks . Moreover , 7 the deep learning framework can take full advantage of current available powerful computing plat - forms , e . g . , graphics processing unit ( GPU ) , to speed up the learning process . Thus , our fully automated picking approach can be generally much more efﬁcient and more robust than previous semi - automated methods . In summary , we have proposed a deep learning framework for automated particle picking . The powerful deep learning model can be applied to pick particles either in a semi - automated manner or through a fully automated fashion . In the fully automated particle picking strategy , we innova - tively use the known particles of the previously solved structures to train the deep learning model , which can accurately describe the common and cross - molecule features of particles . Both our fully automated and semi - automated particle picking schemes have been tested on the published cryo - EM datasets of several molecules , including γ - secretase , spliceosome and TRPV1 . The com - parisons between the particles picked by either our fully automated or semi - automated method and those manually identiﬁed by human experts have demonstrated that our deep learning framework can achieve near human - level performance in particle picking . Thus , our fully automated or semi - automated particle picking approach can provide a reliable and practically useful tool to liberate structural biologists from the time - consuming and laborious task of manual particle picking in cryo - EM data analysis . 4 Materials and methods 4 . 1 Datasets and data preprocessing The data used in this paper were divided into two non - overlapping parts : a training dataset and test dataset . The training data consisted of 100 , 400 , 100 , 84 and 400 micrographs of γ - secretase [ 34 ] , spliceosome [ 5 ] , TRPV1 [ 4 ] , β - galactosidase [ 35 ] and N - ethylmaleimide sensitive factor com - plex [ 36 ] , respectively , while the test data contained a separate set of micrographs from γ - secretase , spliceosome and TRPV1 , each having 100 micrographs . All the results described in the paper are referred to those on the test datasets . The defocus value of each micrograph was calculated using CTFFIND4 [ 44 ] . For each micrograph , we ﬁrst used a Gaussian ﬁlter as a low pass ﬁlter to remove white noise with high frequency components . Then the binning strategy [ 45 ] was used to convert each original micrograph to an image ranging between 1 , 000 and 2 , 000 pixels . All the coordinates of reference particles were identiﬁed manually by human experts ( see also Section 4 . 4 ) except for β - galactosidase , in which the coordinates of reference particles were obtained from EMPIAR ( entry ID : EMPIAR - 10017 ) . The γ - secretase and spliceosome datasets were obtained from Dr . Yigong Shi’s lab at Tsinghua University , which were acquired by an FEI Titan Krios electron microscope operating at 300 kV with a magniﬁcation of 22 , 500x . These micrographs were ﬁrst taken by a Gatan K2 Summit using a super - resolution mode at 0 . 66 ˚A / pixel , and then binned to a ﬁnal pixel size of 1 . 32 ˚A . The TRPV1 dataset was downloaded from EMPIAR ( entry ID : EMPIAR - 10005 ) , in which the micrographs were recorded by a Gatan K2 Summit equipped with a FEI POLARA 300 operating at 300 kV in a super - resolution counting mode , with a ﬁnal calibrated super resolution pixel size of 1 . 2156 ˚A . The β - galactosidase dataset was downloaded from EMPIAR ( entry ID : EMPIAR - 10017 ) , which was recorded by a FEI Falcon - II camera . More detailed information of the β - galactosidase data 8 collection can be found in [ 35 ] . The NSF ( N - ethylmaleimide Sensitive Factor ) fusion complex ( 20S particle ) dataset was kindly offered by Dr . Minglei Zhao from Dr . Axel T . Brunger’s Lab , and more details about its data collection can be found in the original paper [ 36 ] . 4 . 2 The convolutional neural network model Our deep learning framework employs a convolutional neural network ( CNN ) as the classiﬁer to discriminate correct particles ( i . e . , positive samples ) from random noise images ( i . e . , negative samples ) . Here , we brieﬂy describe the concept of a CNN . The reader is referred to [ 46 , 47 , 20 , 23 , 25 ] for more details of this deep learning model . A convolutional neural network is a speciﬁc type of deep learning [ 23 , 47 , 48 ] with a multi - layer structure , which consists of an input layer , an output layer and several hidden layers ( between input and output layers ) . Each layer is comprised of a number of units , also called artiﬁcial neurons . In a CNN , the output layer is a softmax layer [ 49 ] in which the number of artiﬁcial neurons is equivalent to that of the classiﬁcation classes , and the value of each unit represents the chance of being the corresponding class . In a softmax layer , the output of a CNN is ensured to be a probability value between 0 and 1 . More speciﬁcally , a softmax function is deﬁned as P ( Y i ) = e W i X + b i (cid:80) j e W j x + b j where Y i represents the output , i and j stand for the indexes of the artiﬁcial neurons in the last layer ( which also represent the indexes of the output classes ) , X represents the input to the softmax layer , W i represents the corresponding weight parameter , and b i stands for the bias of the i th unit in the output layer . The hidden layers mainly include convolutional , pooling and fully - connected layers . The con - volutional and fully - connected layers are also called the learning layers , since their weights are optimized during the training procedure . The dimension of the weight parameters in a convolu - tional layer is N × M × K × K , where N stands for the number of kernels in the convolutional layer , M stands for the number of square matrices in the kernel ( e . g . , a color image has three square matrices ) , and K represents the dimension of a square matrix which is typically less than 10 . The convolutional layer takes the convolution operation between the input X and the weights W and then feeds the output into a nonlinear function . In particular , the convolutional operation is deﬁned as convolution ( X ) ijn = F nonlinear (cid:32) M − 1 (cid:88) m = 0 K − 1 (cid:88) k = 0 K − 1 (cid:88) l = 0 W nmkl X m , k + i − 1 , l + j − 1 (cid:33) where i and j denote the location indexes of the output , n is the index of the output kernel , m is the index of the input matrix , k and l stand for the location indexes of the kernel , and F nonlinear stands for a nonlinear function , e . g . , tanh ( x ) , sigmoid ( x ) = 1 1 + e − x and the rectiﬁed linear func - tion ( ReLU ) ReLU ( x ) = max ( 0 , x ) . The ReLU function has been popularly used in a CNN architecture , as it can signiﬁcantly speed up the training process [ 23 , 50 ] . The pooling layer ﬁrst divides the input image into non - overlapping windows , and then takes a max or mean operation over each window . The pooling operation can reduce the number of 9 parameters and thus the complexity of the learning model . In addition , it can effectively relieve the over - ﬁtting problem [ 51 , 52 ] . The architecture of our CNN model consists of four convolutional layers , each of which uses an ReLU function and is followed by a max pooling layer . Then these convolutional and max pooling layers are stacked with two fully - connected layers . The input data of our CNN framework is a patch image within sliding window ( see Section 2 . 1 ) , and the results of the last fully - connected layer are fed into a softmax layer with two units , which represent the positive and negative labels , respectively . The “dropout” technique [ 53 ] , in which the unit states in a layer are set to zero with probability p ( a typical value is 0 . 5 ) , is applied in the ﬁrst fully - connected layer to address the overﬁtting problem [ 23 , 53 ] . 4 . 3 Training The stochastic gradient descent algorithm [ 54 ] is used to train our deep learning model . The training data to our deep learning classiﬁer include a set of positive samples and an equivalent number of negative samples , which are selected from those regions at least 0 . 6 times the size of sliding window away from positive samples . The positive samples are either from the known particles of other molecules whose structures have been previously determined via cryo - EM ( i . e . , in a fully automated manner ) or the manually picked particles of the target molecule ( i . e . , in a semi - automated manner ) . As particles may have different sizes , we normalize both positive and negative samples into images of 64 pixels × 64 pixels . This normalization scheme is particularly useful when we use cross - molecule data to train our deep learning model , as the particles of distinct molecular complexes generally have different sizes . During the training process , we also use a separate validation dataset , which is independent from training data and test data , to determine some super - parameters of our deep learning model , e . g . , the number of iterations to reach the convergence . The size of such a validation dataset is chosen to be around 1 / 9 of the training dataset . In our fully automated picking scheme , we ﬁrst use a mixture of 10 , 000 known particles of other molecules as training data that were different from the target complex , each contributing to a roughly equivalent number of training examples . Then in the iteration step ( Fig . 1 ) , the top 10 , 000 particles predicted by the previously trained deep learning classiﬁer are used as new training data to further reﬁne the deep learning model . For all the test results shown in Section 2 . 2 , we only ran one iteration of the training process . We did not observe signiﬁcant change when conducting more training iterations . In the cross - molecule training strategy , we also tested different combinations of the known particles from other molecules as training data . In particular , we looked into the test results on the deep learning classiﬁer trained by the known particles of one , two , three and four types of molecules . Our paper only shows the typical results of each case ( Fig . 2 ) . More details about different combinations of training data are provided in Table . 1 . The tests of other combinations show similar results for individual cases . 10 4 . 4 Performance evaluation We evaluated the performance of our particle picking approach mainly by comparing the auto - mated picking results to the corresponding reference particles picked manually by human experts . These reference particles were ﬁrst picked by one cryo - EM expert and then further veriﬁed by two additional experts . The coordinates of all manually - picked particles were further aligned using FREALIGN [ 55 ] . An automatically - picked particle was said to agree with a manually picked par - ticle , if the distance between their centers was less than a threshold , which was set to be 0 . 2 times the size of sliding window . We mainly used recall and precision to evaluate the accuracy of the particles selected by our automated approach . Let T P denote the number of particles that were picked by our deep learning approach and also agreed with reference particles picked by human experts . Let F P denote the number of particles that were picked by our approach but did not agree with any reference particle . Let F N denote the number of the reference particles that were picked by human experts but not by our automated approach . Then recall and precision are deﬁned as recall = T P / ( F N + T P ) , and precision = T P / ( F P + T P ) , respectively . In addition to recall and precision , we also measured the deviations of the centers of the par - ticles picked by our automated approach from those of the reference particles selected by human experts . In particular , we assessed their average distances , normalized by the size of sliding win - dow . We also compared the 2D clustering and class averaging results of the particles picked by our approach to those from the manually picked images in the reference set . The 2D clustering and class averaging operations were performed using the corresponding commands in RELION 1 . 3 . Such a 2D analysis process was conducted in 2 - 3 iterations . In each iteration , those obvious image artifacts , invalid particles or empty objects from the 2D averaging results were removed from the candidate list . The same data analysis procedure was done for both manually and automatically picked particles . 4 . 5 Parameter setting In this section , we explain the parameter setting of our deep learning model for automated particle picking . In the data preprocessing stage , the standard deviation of a gaussian ﬁlter was set to 0 . 1 . In the model training stage , the learning rate was set to 0 . 01 . In the scoring step of the particle picking stage , the size of sliding window was set to be 180 pixels for TRPV1 and γ - secretase , and 320 pixels for spliceosome , and the step size was set to be 4 pixels . In the cleaning step , two neighboring pixels with prediction scores above 0 . 5 were connected . In addition , we removed those connected domains in which the size was four times larger than the average size . In the ﬁltering step , the size of peak window was set to be 0 . 8 times the size of sliding window , in other words , the minimum distance between centers of two potential particles was set to be 0 . 4 times the size of sliding window . When removing the bad particles , the extreme pixels are deﬁned as those with three standard deviations away from the mean pixel value . In the iteration step , we chose 10 , 000 samples from the top sorted particles picked by the previously - trained classiﬁer to further reﬁne the model . 11 4 . 6 Implementation DeepPicker was implemented based on Torch7 ( http : / / torch . ch ) , an open source deep learning library and the Lua programming language . It can be run either with or without graphic processing units ( GPUs ) . In our tests , a NVIDIA Quadro K4000 GPU was used for training the model and picking the particles from micrographs . The time required for training the model with 10 , 000 samples was less than an hour , and picking the particles from a micrograph of size 3710 pixels × 3838 pixels took about 1 . 5 minutes . DeepPicker will be available and distributed as an open - source program . 5 Acknowledgements We thank Prof . Yigong Shi , Prof . Nieng Yan , Dr . Minglei Zhao and Mr . Jianping Wu for gener - ously sharing their cryo - EM data for testing our particle picking approach . We are grateful to Prof . Hongwei Wang , Prof . Jian Peng and Mr . Jinglin Yang for their insightful discussions about our work . We are also grateful to Ms . Rudan Chen for her help on our draft preparation . Part of the test data are from EMPIAR ( https : / / www . ebi . ac . uk / pdbe / emdb / empiar / ) . 6 Additional information 6 . 1 Funding This work was supported by the National Basic Research Program of China ( Grant 2011CBA00300 , 2011CBA00301 to JZ ) , the National Natural Science Foundation of China ( Grant 61033001 , 613611 36003 and 61472205 to JZ , 31570730 to XL , and 61571202 to TX ) , China Youth 1000 - Talent Pro - gram by the State Council of China ( to JZ , XL and TX ) , Beijing Advanced Innovation Center for Structural Biology ( to JZ and XL ) , and Tsinghua - Peking Joint Center for Life Sciences ( to XL ) . We acknowledge the China National Center for Protein Sciences Beijing for providing the facility support and the support of NVIDIA Corporation with the donation of the Titan X GPU used for this research . 6 . 2 Author contributions XL and JZ initiated the project . JZ and XL designed the functions of the program . JZ , TX , FW and HG designed the deep learning algorithm . FW and HG implemented the program . FW , HG , GL and ML performed the testing experiment and analysis . CY acquired part of the data and provided corresponding reference images . JZ , HG and FW drafted the manuscript . JZ , XL and TX revised the manuscript . 12 References [ 1 ] Xiaochen Bai , Greg McMullan , and Sjors H . W Scheres . How cryo - EM is revolutionizing structural biology . Trends in Biochemical Sciences , 40 ( 1 ) : 49 – 57 , 2015 . [ 2 ] Yifan Cheng . Single - particle cryo - EM at crystallographic resolution . Cell , 161 ( 3 ) : 450 – 457 , 2015 . [ 3 ] Yifan Cheng , Nikolaus Grigorieff , Pawel A . Penczek , and Thomas Walz . A primer to single - particle cryo - electron microscopy . Cell , 161 ( 3 ) : 438 – 449 , 2015 . [ 4 ] Maofu Liao , Erhu Cao , David Julius , and Yifan Cheng . Structure of the TRPV1 ion channel determined by electron cryo - microscopy . Nature , 504 ( 7478 ) : 107 ł 112 , 2013 . [ 5 ] Chuangye Yan , Jing Hang , Ruixue Wan , Min Huang , Catherine C . L . Wong , and Yigong Shi . Structure of a yeast spliceosome at 3 . 6 - angstrom resolution . Science , 349 ( 6253 ) : 1182 – 1191 , 2015 . [ 6 ] Jianhua Zhao , Samir Benlekbir , and John L . Rubinstein . Electron cryomicroscopy observa - tion of rotational states in a eukaryotic V - ATPase . Nature , 521 ( 5 ) : 241 – 5 , 2015 . [ 7 ] Jianping Wu , Zhen Yan , Zhangqiang Li , Chuangye Yan , Shan Lu , Mengqiu Dong , and Nieng Yan . Structure of the voltage - gated calcium channel Cav1 . 1 complex . Science , 350 ( 5 ) : aad2395 , 2015 . [ 8 ] William V . Nicholson and Robert M . Glaeser . Review : Automatic particle detection in elec - tron microscopy . Journal of Structural Biology , 133 ( 2C3 ) : 90 – 101 , 2001 . [ 9 ] Yuanxin Zhu , Bridget Carragher , Robert M Glaeser , Denis Fellmann , Chandrajit Bajaj , Mar - shall Bern , Fabrice Mouche , Felix de Haas , Richard J Hall , David J Kriegman , Steven J Ludtke , Satya P Mallick , Pawel A Penczek , Alan M Roseman , Fred J Sigworth , Niels Volk - mann , and Clinton S Potter . Automatic particle selection : results of a comparative study . Journal of Structural Biology , 145 ( 1C2 ) : 3 – 14 , 2004 . [ 10 ] Robert Langlois , Jesper Pallesen , and Joachim Frank . Reference - free particle selection en - hanced with semi - supervised machine learning for cryo - electron microscopy . Journal of Structural Biology , 175 ( 3 ) : 353 – 361 , 2011 . [ 11 ] James Z . Chen and Nikolaus Grigorieff . SIGNATURE : A single - particle selection system for molecular electron microscopy . Journal of Structural Biology , 157 ( 1 ) : 168 – 173 , 2007 . [ 12 ] Richard J Hall and Ardan Patwardhan . A two step approach for semi - automated parti - cle selection from low contrast cryo - electron micrographs . Journal of Structural Biology , 145 ( 1C2 ) : 19 – 28 , 2004 . [ 13 ] Zhong Huang and Pawel A . Penczek . Application of template matching technique to particle detection in electron micrographs . Journal of Structural Biology , 145 ( 1C2 ) : 29 – 40 , 2004 . 13 [ 14 ] P . S Umesh Adiga , Ravi Malladi , William Baxter , and Robert M Glaeser . A binary segmenta - tion approach for boxing ribosome particles in cryo EM micrographs . Journal of Structural Biology , 145 ( 1C2 ) : 142 – 151 , 2004 . [ 15 ] N . R . Voss , C . K . Yoshioka , M . Radermacher , C . S . Potter , and B . Carragher . DoG Picker and TiltPicker : Software tools to facilitate particle selection in single particle electron mi - croscopy . Journal of Structural Biology , 166 ( 2 ) : 205 – 213 , 2009 . [ 16 ] C . O . S . Sorzano , E . Recarte , M . Alcorlo , J . R . Bilbao - Castro , C . San - Martłn , R . Marabini , and J . M . Carazo . Automatic particle selection from electron micrographs using machine learning techniques . Journal of Structural Biology , 167 ( 3 ) : 252 – 260 , 2009 . [ 17 ] Pablo Arbelez , Bong - Gyoon Han , Dieter Typke , Joseph Lim , Robert M . Glaeser , and Jiten - dra Malik . Experimental evaluation of support vector machine - based and correlation - based approaches to automatic particle selection . Journal of Structural Biology , 175 ( 3 ) : 319 – 328 , 2011 . [ 18 ] Jianhua Zhao , Marcus A . Brubaker , and John L . Rubinstein . TMaCS : A hybrid template matching and classiﬁcation system for partially - automated particle selection . Journal of Structural Biology , 181 ( 3 ) : 234 – 242 , 2013 . [ 19 ] Ramin Norousi , Stephan Wickles , Christoph Leidig , Thomas Becker , Volker J . Schmid , Roland Beckmann , and Achim Tresch . Automatic post - picking using MAPPOS im - proves particle image detection from cryo - EM micrographs . Journal of Structural Biology , 182 ( 2 ) : 59 – 66 , 2013 . [ 20 ] Yann LeCun , Yoshua Bengio , and Geoffrey Hinton . Deep learning . Nature , 521 : 436 – 444 , 2015 . [ 21 ] Geoffrey Hinton , Li Deng , Dong Yu , George E . Dahl , Abdel - rahman Mohamed , Navdeep Jaitly , Andrew Senior , Vincent Vanhoucke , Patrick Nguyen , Tara N . Sainath , and Brian Kingsbury . Deep neural networks for acoustic modeling in speech recognition : The shared views of four research groups . Signal Processing Magazine , IEEE , 29 ( 6 ) : 82 – 97 , 2012 . [ 22 ] Ilya Sutskever , Oriol Vinyals , and Quoc V . Le . Sequence to sequence learning with neural networks . CoRR , abs / 1409 . 3215 , 2014 . [ 23 ] Alex Krizhevsky , Ilya Sutskever , and Geoffrey E . Hinton . ImageNet classiﬁcation with deep convolutional neural networks . In F . Pereira , C . J . C . Burges , L . Bottou , and K . Q . Weinberger , editors , Advances in Neural Information Processing Systems 25 , pages 1097 – 1105 . Curran Associates , Inc . , 2012 . [ 24 ] Yoav Goldberg . A primer on neural network models for natural language processing . CoRR , abs / 1510 . 00726 , 2015 . 14 [ 25 ] Steve Lawrence , C . Lee Giles , Ah Chung Tsoi , and Andrew D . Back . Face Recognition : A convolutional neural network approach . IEEE Transactions on Neural Networks , 8 : 98 – 113 , 1997 . [ 26 ] Clement Farabet , Camille Couprie , Laurent Najman , and Yann LeCun . Learning hierarchical features for scene labeling . IEEE Transactions on Pattern Analysis and Machine Intelligence , 35 ( 8 ) : 1915 – 1929 , 2013 . [ 27 ] Jonathan J . Tompson , Arjun Jain , Yann Lecun , and Christoph Bregler . Joint training of a convolutional network and a graphical model for human pose estimation . In Z . Ghahramani , M . Welling , C . Cortes , N . d . Lawrence , and K . q . Weinberger , editors , Advances in Neural Information Processing Systems 27 , pages 1799 – 1807 . Curran Associates , Inc . , 2014 . [ 28 ] Tomas Mikolov , Anoop Deoras , Daniel Povey , Luks Burget , and Jan Cernocky . Strategies for training large scale neural network language models . In David Nahamoo and Michael Picheny , editors , ASRU , pages 196 – 201 . IEEE , 2011 . [ 29 ] Kelvin Xu , Jimmy Ba , Ryan Kiros , Kyunghyun Cho , Aaron Courville , Ruslan Salakhudinov , Rich Zemel , and Yoshua Bengio . Show , Attend and Tell : Neural image caption generation with visual attention . In David Blei and Francis Bach , editors , Proceedings of the 32nd Inter - national Conference on Machine Learning ( ICML - 15 ) , pages 2048 – 2057 . JMLR Workshop and Conference Proceedings , 2015 . [ 30 ] Jian Zhou and Olga G Troyanskaya . Predicting effects of noncoding variants with deep learning - based sequence model . Nature methods , 12 ( 10 ) : 931ł934 , 2015 . [ 31 ] Junshui Ma , Robert P . Sheridan , Andy Liaw , George E . Dahl , and Vladimir Svetnik . Deep neural nets as a method for quantitative structureCactivity relationships . Journal of Chemical Information and Modeling , 55 ( 2 ) : 263 – 274 , 2015 . [ 32 ] David Silver , Aja Huang , Chris J . Maddison , Arthur Guez , Laurent Sifre , George van den Driessche , Julian Schrittwieser , Ioannis Antonoglou , Veda Panneershelvam , Marc Lanctot , Sander Dieleman , Dominik Grewe , John Nham , Nal Kalchbrenner , Ilya Sutskever , Timothy Lillicrap , Madeleine Leach , Koray Kavukcuoglu , Thore Graepel , and Demis Hassabis . Mas - tering the game of Go with deep neural networks and tree search . Nature , 529 ( 7587 ) : 484 – 489 , 2016 . [ 33 ] Volodymyr Mnih , Koray Kavukcuoglu , David Silver , Andrei A . Rusu , Joel Veness , Marc G . Bellemare , Alex Graves , Martin Riedmiller , Andreas K . Fidjeland , Georg Ostrovski , Stig Pe - tersen , Charles Beattie , Amir Sadik , Ioannis Antonoglou , Helen King , Dharshan Kumaran , Daan Wierstra , Shane Legg , and Demis Hassabis . Human - level control through deep rein - forcement learning . Nature , 518 ( 7540 ) : 529 – 533 , 2015 . [ 34 ] Linfeng Sun , Lingyun Zhao , Guanghui Yang , Chuangye Yan , Rui Zhou , Xiaoyuan Zhou , Tian Xie , Yanyu Zhao , Shenjie Wu , Xueming Li , and Yigong Shi . Structural basis of human 15 γ - secretase assembly . Proceedings of the National Academy of Sciences of the United States of America , 112 ( 19 ) : 6003ł6008 , 2015 . [ 35 ] Alberto Bartesaghi , Doreen Matthies , Soojay Banerjee , Alan Merk , and Sriram Subrama - niam . Structure of β - galactosidase at 3 . 2 - ˚A resolution obtained by cryo - electron microscopy . Proceedings of the National Academy of Sciences , 111 ( 32 ) : 11709 – 11714 , 2014 . [ 36 ] Minglei Zhao , Shenping Wu , Qiangjun Zhou , Sandro Vivona , Daniel J Cipriano , Yifan Cheng , and Axel T Brunger . Mechanistic insights into the recycling machine of the SNARE complex . Nature , 518 ( 7537 ) : 61ł67 , 2015 . [ 37 ] Robert Langlois , Jesper Pallesen , Jordan T . Ash , Danny Nam Ho , John L . Rubinstein , and Joachim Frank . Automated particle picking for low - contrast macromolecules in cryo - electron microscopy . Journal of Structural Biology , 186 ( 1 ) : 1 – 7 , 2014 . [ 38 ] Eva Nogales and Sjors H . W . Scheres . Cryo - EM : A unique tool for the visualization of macro - molecular complexity . Molecular Cell , 58 ( 4 ) : 677 – 689 , 2015 . [ 39 ] Sjors H . W . Scheres . RELION : Implementation of a bayesian approach to cryo - EM structure determination . Journal of Structural Biology , 180 ( 3 ) : 519 – 530 , 2012 . [ 40 ] Richard Henderson . Avoiding the pitfalls of single particle cryo - electron microscopy : Ein - stein from noise . Proceedings of the National Academy of Sciences , 110 ( 45 ) : 18037 – 18041 , 2013 . [ 41 ] Marin van Heel . Finding trimeric HIV - 1 envelope glycoproteins in random noise . Proceed - ings of the National Academy of Sciences of the United States of America , 110 ( 45 ) : E4175 – E4177 , 2013 . [ 42 ] Sriram Subramaniam . Structure of trimeric HIV - 1 envelope glycoproteins . Proceedings of the National Academy of Sciences , 110 ( 45 ) : E4172 – E4174 , 2013 . [ 43 ] Maxim Shatsky , Richard J Hall , Steven E Brenner , and Robert M Glaeser . A method for the alignment of heterogeneous macromolecules from electron microscopy . Journal of structural biology , 166 ( 1 ) : 67 – 78 , 2009 . [ 44 ] Alexis Rohou and Nikolaus Grigorieff . CTFFIND4 : Fast and accurate defocus estimation from electron micrographs . Journal of Structural Biology , 192 ( 2 ) : 216 – 221 , 2015 . [ 45 ] Xueming Li , Paul Mooney , Shawn Zheng , Christopher R . Booth , Michael B . Braun - feld , Sander Gubbens , David A . Agard , and Yifan Cheng . Electron counting and beam - induced motion correction enable near - atomic - resolution single - particle cryo - EM . Nat Meth , 10 ( 6 ) : 584 – 590 , 2013 . [ 46 ] Y . Le Cun , B . Boser , J . S . Denker , R . E . Howard , W . Habbard , L . D . Jackel , and D . Henderson . Advances in neural information processing systems 2 . chapter Handwritten Digit Recognition with a Back - propagation Network , pages 396 – 404 . Morgan Kaufmann Publishers Inc . , San Francisco , CA , USA , 1990 . 16 [ 47 ] Yann Lecun , Lon Bottou , Yoshua Bengio , and Patrick Haffner . Gradient - based learning ap - plied to document recognition . In Proceedings of the IEEE , pages 2278 – 2324 , 1998 . [ 48 ] Matthew D . Zeiler and Rob Fergus . Visualizing and understanding convolutional networks . CoRR , abs / 1311 . 2901 , 2013 . [ 49 ] Christopher M . Bishop . Pattern Recognition and Machine Learning ( Information Science and Statistics ) . Springer - Verlag New York , Inc . , Secaucus , NJ , USA , 2006 . [ 50 ] Vinod Nair and Geoffrey E . Hinton . Rectiﬁed linear units improve restricted boltzmann machines . In Johannes Frnkranz and Thorsten Joachims , editors , ICML , pages 807 – 814 . Omnipress , 2010 . [ 51 ] Kevin Jarrett , Koray Kavukcuoglu , Marc’Aurelio Ranzato , and Yann LeCun . What is the best multi - stage architecture for object recognition ? Proceedings of the IEEE International Conference on Computer Vision , pages 2146 – 2153 , 2009 . [ 52 ] Dominik Scherer , Andreas M ¨ uller , and Sven Behnke . Evaluation of pooling operations in convolutional architectures for object recognition . Lecture Notes in Computer Science ( in - cluding subseries Lecture Notes in Artiﬁcial Intelligence and Lecture Notes in Bioinformat - ics ) , 6354 LNCS ( PART 3 ) : 92 – 101 , 2010 . [ 53 ] Nitish Srivastava , Geoffrey Hinton , Alex Krizhevsky , Ilya Sutskever , and Ruslan Salakhutdi - nov . Dropout : A simple way to prevent neural networks from overﬁtting . J . Mach . Learn . Res . , 15 ( 1 ) : 1929 – 1958 , 2014 . [ 54 ] L ´ eon Bottou . Large - scale machine learning with stochastic gradient descent . In Yves Lechevallier and Gilbert Saporta , editors , Proceedings of COMPSTAT’2010 , pages 177 – 186 . Physica - Verlag HD , 2010 . [ 55 ] Nikolaus Grigorieff . FREALIGN : High - resolution reﬁnement of single particle structures . Journal of Structural Biology , 157 ( 1 ) : 117 – 125 , 2007 . 17 Convolu ti onal Neural Network Training data : Positive samples Negative samples Input : Micrographs ( 1 ) Training ( 2 ) Scoring Input ( 3 ) Cleaning ( 4 ) Filtering Scored map Model training Particle picking ( 5 ) Sorting ( 6 ) Iteration Mixture of known particles from other molecules Output > N iteration ? Yes No Figure 1 : Schematic overview of our automated particle picking pipeline . The particle selection procedure consists of six steps : ( 1 ) training , ( 2 ) scoring , ( 3 ) cleaning , ( 4 ) ﬁltering , ( 5 ) sorting and ( 6 ) iteration . In our fully automated picking pipeline , the initial training data are obtained from the known particles of other molecular complexes whose structures have been previously solved via cryo - EM . 18 ( a ) ( b ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Fully automated particle picking for - secretase Number of the top sorted particles / Number of the reference particles Recall ( 1 type ) Precision ( 1 type ) Recall ( 2 types ) Precision ( 2 types ) Recall ( 3 types ) Precision ( 3 types ) Recall ( 4 types ) Precision ( 4 types ) ( c ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Fully automated particle picking for spliceosome Number of the top sorted particles / Number of the reference particles Recall ( 1 type ) Precision ( 1 type ) Recall ( 2 types ) Precision ( 2 types ) Recall ( 3 types ) Precision ( 3 types ) Recall ( 4 types ) Precision ( 4 types ) ( d ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Number of the top sorted particles / Number of the manually picked particles Fully automated particle picking for TRPV1 Recall ( 1 type ) Precision ( 1 type ) Recall ( 2 types ) Precision ( 2 types ) Recall ( 3 types ) Precision ( 3 types ) Recall ( 4 types ) Precision ( 4 types ) ( e ) Figure 2 : Results on fully automated particle picking . ( a ) An example of our fully automated particle picking results for spliceosome , using a mixture of 5000 TRPV1 and 5000 γ - secretase particles picked manually by human experts as training data . ( b ) The summary of recall scores for γ - secretase , TRPV1 and spliceosome using different combinations of training data . The recall scores were computed on those picked particles with prediction scores above 0 . 5 . ( c ) , ( d ) and ( e ) The trends of precision and recall vs . the number of picked particles for γ - secretase , spliceosome and TRPV1 , respectively . The horizontal axis represents the ratio of the number of the top sorted particles picked by our fully automated method vs . the number of manually picked particles in the reference set . The blue , green , red and black lines represent the results of using 10000 manually picked particles as training data contributed roughly equally by one , two , three and four types of other molecules ( which were different from the target molecule ) , respectively . The real and dashed lines represent the recall and precision scores , respectively . More details about different combinations of known particles from different molecules in training data can be found in Section 4 . 3 . 19 ( a ) ( b ) ( c ) ( d ) ( e ) ( f ) Figure 3 : The comparisons between the 2D clustering and class averaging results derived from the particles picked manually by human experts and fully automatically by our deep learning frame - work . ( a ) , ( c ) and ( e ) The 2D clustering and class averaging results of the reference particles picked manually by human experts for γ - secretase , spliceosome and TRPV1 , respectively . ( b ) , ( d ) and ( f ) The 2D clustering and class averaging results of the particles picked fully automati - cally by our CNN classiﬁer for γ - secretase , spliceosome and TRPV1 , respectively . A mixture of 10000 known particles of the other two molecules ( each contributing to 5000 particles ) among γ - secretase , spliceosome and TRPV1 , which were different from the target molecule , were used as training data . All 30 classes are shown . 20 Semi 1 type 2 types 3 types 4 types 0 . 00 0 . 02 0 . 04 0 . 06 0 . 08 0 . 10 A v e r age d i s t an c e / B o x s i z e Fully automated particle picking for - secretase ( a ) Semi 1 type 2 types 3 types 4 types 0 . 00 0 . 02 0 . 04 0 . 06 0 . 08 0 . 10 A v e r age d i s t an c e / B o x s i z e Fully automated particle picking for spliceosome ( b ) Semi 1 type 2 types 3 types 4 types 0 . 00 0 . 02 0 . 04 0 . 06 0 . 08 0 . 10 A v e r age d i s t an c e / B o x s i z e Fully automated particle picking for TRPV1 ( c ) ( d ) Figure 4 : Results on the identifying the centers of particles . ( a ) , ( b ) and ( c ) The average distance between our automatically picked particles and their manually picked counterparts in the refer - ence set , normalized by the box size of sliding window for γ - secretase , spliceosome and TRPV1 , respectively . The orange bars represent the results of the CNN classiﬁer trained by 10000 parti - cles of the same molecule ( such a scheme is also called semi - automated picking , see also Section 2 . 3 ) . The blue , green , red and black bars represent the results of the CNN classiﬁer trained by a mixture of 10000 known particles roughly equally contributed by one , two , three and four types of other molecules that were different from the target complex , respectively . ( d ) An example of the comparison between the spliceosome particles picked manually by human experts and fully automatically by our CNN classiﬁer , which was trained by a mixture of 5000 γ - secretase and 5000 TRPV1 particles . The red and blue circles represent the particles selected by human experts and by our fully automated approach , respectively . 21 Training data : Molecule A Moedeltraining CNN model Input data : Molecule A Par ! cles Training data : Molecule B Par ! cle picking Semi automa ! on Full automa ! on Input S w i t c h ( a ) ( b ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Number of the top sorted particles / Number of the reference particles Recall ( 400 ) Precision ( 400 ) Recall ( 1000 ) Precision ( 1000 ) Recall ( 10000 ) Precision ( 10000 ) Recall ( 4 types ) Precision ( 4 types ) Fully automated and semi - automated particle picking for - secretase ( c ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Fully automated and semi - automated particle picking for spliceosome Recall ( 400 ) Precision ( 400 ) Recall ( 1000 ) Precision ( 1000 ) Recall ( 10000 ) Precision ( 10000 ) Recall ( 4 types ) Precision ( 4 types ) Number of the top sorted particles / Number of the reference particles ( d ) 0 1 2 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 Fully automated and semi - automated particle picking for TRPV1 Number of the top sorted particles / Number of the reference particles Recall ( 400 ) Precision ( 400 ) Recall ( 1000 ) Precision ( 1000 ) Recall ( 10000 ) Precision ( 10000 ) Recall ( 4 types ) Precision ( 4 types ) ( e ) Figure 5 : Results on semi - automated particle picking of our deep learning framework with an alter - native training scheme . ( a ) A simple illustration on the alternative choice between fully automated and semi - automated training schemes . ( b ) The summary of recall scores with prediction scores above 0 . 5 for the semi - automated particle picking scheme under our deep learning framework for three different datasets with various sizes of training data . ( c ) , ( d ) and ( e ) The trends of precision and recall vs . the number of the picked particles for γ - secretase , spliceosome and TRPV1 , re - spectively . The horizontal axis represents the ratio between the number of the top sorted particles picked by both semi - automated and fully automated schemes vs . the number of manually picked particles in the reference set . The red , blue and green lines represent the semi - automated results of the CNN classiﬁer trained by 400 , 1000 and 10000 particles ( which were manually picked from micrographs of the target molecule ) , respectively . The black lines represent the fully automated results in which a mixture of the manually picked particles of four other molecules that were dif - ferent from the target molecule were used as training data , each contributing to 2500 particles . The real and dashed lines represent the recall and precision scores , respectively . 22 ( a ) ( b ) ( c ) 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 0 1000 2000 3000 4000 N u m be r o f pa r t i c l e s Prediction score Fully automated particle picking on background micrographs ( d ) 0 . 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 0 1000 2000 3000 N u m be r o f pa r t i c l e s Prediction score Fully automated particle picking on TRPV1 micrographs ( e ) Figure 6 : The results of fully automated particle picking from micrographs at different defocus levels and from random noise . ( a ) , ( b ) and ( c ) The recall results of automated picking at different defocus levels for γ - secretase , spliceosome and TRPV1 , respectively . The CNN classiﬁer was trained by a mixture of 10000 particles of other four molecules that were different from the target one , each contributing to 2500 particles . The inlet panels in each subﬁgure show typical image examples at the minimum and maximum defocus levels , respectively . ( d ) and ( e ) The distributions of the prediction scores in our fully automated particle picking approach on pure background ( i . e . , without adding any sample ) and TRPV1 micrographs , respectively . 23 For γ - secretase : 1 type TRPV1 2 types TRPV1 and spliceosome 3 types TRPV1 , spliceosome and NSF fusion complex 4 types TRPV1 , spliceosome , NSF fusion complex and β - galactosidase For spliceosome : 1 type γ - secretase 2 types γ - secretase and TRPV1 3 types γ - secretase , TRPV1 and NSF fusion complex 4 types γ - secretase , TRPV1 , NSF fusion complex and β - galactosidase For TRPV1 : 1 type spliceosome 2 types spliceosome and γ - secretase 3 types spliceosome , γ - secretase and NSF fusion complex 4 types spliceosome , γ - secretase , NSF fusion complex and β - galactosidase Table 1 : Different combinations of training data for the test results shown in Fig . 2 . 24