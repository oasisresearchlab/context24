Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised learning of hyperspectral demosaicking : Application to surgical imaging Peichao Li 1 * , Muhammad Asad 1 , Conor Horgan 1 , Oscar MacCormac 1 , 2 , Jonathan Shapey 1 , 2 and Tom Vercauteren 1 1 School of Biomedical Engineering & Imaging Sciences , King’s College London , London , UK . 2 Department of Neurosurgery , King’s College Hospital NHS Foundation Trust , London , UK . * Corresponding author ( s ) . E - mail ( s ) : peichao . 2 . li @ kcl . ac . uk ; Abstract Purpose : Hyperspectral imaging has the potential to improve intraoper - ative decision making if tissue characterisation is performed in real - time and with high - resolution . Hyperspectral snapshot mosaic sensors oﬀer a promising approach due to their fast acquisition speed and compact size . However , a demosaicking algorithm is required to fully recover the spatial and spectral information of the snapshot images . Most state - of - the - art demosaicking algorithms require ground - truth training data with paired snapshot and high - resolution hyperspectral images , but such imagery pairs with the exact same scene are physically impossible to acquire in intraoperative settings . In this work , we present a fully unsuper - vised hyperspectral image demosaicking algorithm which only requires exemplar snapshot images for training purposes . Methods : We regard hyperspectral demosaicking as an ill - posed linear inverse problem which we solve using a deep neural network . We take advantage of the spectral correlation occurring in natural scenes to design a novel inter spectral band regularisation term based on spatial gradient consistency . By combining our proposed term with standard regularisa - tion techniques and exploiting a standard data ﬁdelity term , we obtain an unsupervised loss function for training deep neural networks , which allows us to achieve real - time hyperspectral image demosaicking . 1 a r X i v : 2302 . 10927v1 [ ee ss . I V ] 21 F e b 2023 Springer Nature 2021 L A TEX template 2 Spatial gradient consistency for unsupervised demosaicking Results : Quantitative results on hyperspetral image datasets show that our unsupervised demosaicking approach can achieve similar perfor - mance to its supervised counter - part , and signiﬁcantly outperform linear demosaicking . A qualitative user study on real snapshot hyperspectral surgical images conﬁrms the results from the quantitative analysis . Conclusion : Our results suggest that the proposed unsupervised algo - rithm can achieve promising hyperspectral demosaicking in real - time thus advancing the suitability of the modality for intraoperative use . Keywords : hyperspectral imaging , demosaicking , unsupervised learning , surgical imaging 1 Introduction Hyperspectral Imaging ( HSI ) is a technique that captures and processes spec - tral data distributed across a large number of wavelengths . It provides a non - contact , non - ionising and non - invasive solution suitable for many medical applications [ 1 – 3 ] . HSI can provide information beyond what human vision can observe , such as tissue perfusion , oxygen saturation , and other diagnostic measurements [ 4 ] . Hence , it facilitates important medical tasks such as tis - sue diﬀerentiation and characterisation . Depending on the number of bands , hyperspectral imaging may also be called multispectral imaging , but in this work we will refer to hyperspectral imaging for consistency . Snapshot hyperspectral imaging is a promising technique which can cap - ture hyperspectral images in real - time . Snapshot mosaic cameras are a common type of snapshot hyperspectral camera which employ multi - spectral ﬁlter array ( MSFA ) to acquire multi - spectral data in a single exposure . In MSFA cam - eras the n × n sensor arrays are arranged in a repeating pattern similar to the 2 × 2 Bayer ﬁlter arrays on RGB cameras ( Fig . 1 , left ) and are thus capable of obtaining a maximum of n 2 bands instantly . However , it achieves real - time multi - spectral data acquisition at the cost of reducing both spatial and spectral resolution . Eﬃcient hyperspectral demosaicking algorithms are thus required to fully restore the spatial and spectral resolution from the snap - shot images . More details on hyperspectral imaging techniques and snapshot mosaic imaging can be found in [ 5 ] . Traditionally , demosaicking algorithms were developed using interpolation - based methods or statistics - based techniques [ 6 , 7 ] , but these methods may still suﬀer from colour artifacts and blurriness . Recent deep - learning based algo - rithms have been developed for eﬃcient and accurate image super - resolution and demosaicking tasks . Deep neural networks such as SRCNN [ 8 ] , EDSR [ 9 ] and RNAN [ 10 ] have demonstrated their performances on RGB image super - resolution tasks , and thus similar methods have been extended to process hyperspectral images [ 11 , 12 ] . [ 13 ] introduced several state - of - the - art learning - based hyperspectral demosaicking algorithms of natural scenes in NTIRE 2022 Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 3 Band 1 Band 16 B a nd 1 B a nd 16 Fig . 1 ( Left ) 4 × 4 MSFA for an IMEC snapshot camera , the colour of each pixel correlates to the perceived colour of a human observer . ( Middle ) Spectral responses of all 16 sensors on the MSFA of an IMEC snapshot camera . ( Right ) Wasserstein metric heatmap measuring distances between diﬀerent spectral responses of the sensors on an IMEC snapshot camera . Spectral Demosaicking Challenge . The leading contestants include Enhanced HAN [ 14 ] , NLRAN [ 13 ] and Res2 - Unet based methods [ 15 ] . Our previous work [ 5 ] also demonstrated the use of a synthetic surgical HSI dataset and deep - learning models for developing hyperspectral demosaicking algorithms suitable for intraoperative surgical guidance tasks . However , most deep - learning based demosaicking algorithms rely on a large number of high - resolution HSI data as the ground truth for model training . Publicly available medical hyperspectral datasets such as HELICoiD [ 16 ] and ODSI [ 17 ] involve large line - scan or spectral - scan HSI systems to obtain high - resolution hyperspectral data , and the acquisition speed is slow . Consequently , these imaging systems are not ideal for intraoperative use . Fortunately , [ 18 ] demonstrated that the acquisition of intraoperative snapshot mosaic images is less challenging as its compact imaging system can be seamlessly integrated into a standard surgical workﬂow . This paper presents an unsupervised - learning - based HSI demosaicking algorithm which uses only snapshot mosaic images and does not require cor - responding high - resolution images for training . A demosaicking loss function is proposed based on a novel spatial gradient consistency regularisation tech - nique combined with traditional regularisation methods including Tikhonov regularisation and total variation . The proposed algorithm has been tested with 3 diﬀerent deep neural networks on 3 diﬀerent datasets . Quantitative measures have been performed to compare the unsupervised algorithm against linear demosaicking and supervised training , and a qualitative user study was conducted to validate the proposed algorithm on a medical HSI dataset . 2 Materials and methods 2 . 1 Demosaicking as an ill - posed linear inverse problem Problem formulation . Hyperspectral image demosaicking involves recover - ing the fully sampled hyperspectral image I ∈ R X × Y × C from a snapshot image I s ∈ R X × Y , where X and Y are the spatial dimensions and C is the number of spectral bands . The relationship between I and I s can be expressed through Springer Nature 2021 L A TEX template 4 Spatial gradient consistency for unsupervised demosaicking a linear degradation operator D : I s = D ( I ) ( 1 ) For a typical MSFA arrangement as shown in Fig . 1 ( left ) , D can be simply expressed as a selection matrix containing only 0 and 1 , thereby mapping the pixel values of I s from I . In other words , for each spatial location ( x , y ) , there is a single corresponding spectral band c x , y such that I s ( x , y ) = I ( x , y , c x , y ) The inverse problem corresponding to ( 1 ) is ill - posed because of the highly ill - conditioned selection operator D . Therefore , appropriate regularisation is required . A classical inverse problem approach would aim at solving for ˆ I = arg min I (cid:2) L ( I s , D ( I ) ) + λ R ( I ) (cid:3) ( 2 ) where L ( I s , D ( I ) ) is the data ﬁdelity term that measures the diﬀerences between the the known snapshot image I s and the subsampling of the unknown fully - sampled hyperspectral image I . R represents the regularisation terms . λ is the regularisation factor that determines the trade - oﬀ between the data ﬁdelity and regularisation . Translating this into an unsupervised machine learning setting , we now seek to optimise for the parameters θ of a deep neural network f θ mapping a snapshot mosaic input I s to a fully - sampled hyperspectral image f θ ( I s ) : ˆ θ = arg min θ E I s (cid:2) L ( I s , D ( f θ ( I s ) ) ) + λ R ( f θ ( I s ) ) (cid:3) ( 3 ) where the expectation E I s is to be considered as being taken over an empirical distribution deﬁned by a training set of snapshot mosaic images ( with no need for ground truth ) . Spatial gradient consistency regularisation . Regularisation terms in ( 3 ) aim at incorporating prior information about the problem being solved . In our case , all spectral bands are imaging the same physical scene . We also observe that the spectrum of natural objects and biological tissues present with speciﬁc characteristics such as continuity and smoothness . Additionally , the response functions corresponding to the diﬀerent spectral bands as shown in Fig . 1 ( middle ) shares signiﬁcant spectral overlap . It is thus expected that our spectral bands will exhibit substantial correlation . Inter - spectral band correla - tion was notably demonstrated empirically for RGB images in [ 19 ] . However , while correlation is expected , assuming a simple linear relationship would make for too crude an approximation . Here , inspired by image similarity metrics that exploit image gradients for multimodal image registration where non - trivial correlation across the imaging modalities is expected [ 20 ] , we propose to promote correlation between the spatial gradients of the individual spectral bands in our reconstructions . Let c 1 and c 2 be the indices of two spectral bands of interest , with I c = I ( · , · , c ) , and c ∈ ( c 1 , c 2 ) the corresponding spectral band images . For simplicity , we make Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 5 use of forward diﬀerences to compute spatial gradients : ∇ x I c ( x , y ) = I c ( x + 1 , y ) − I c ( x , y ) and ∇ y I c ( x , y ) = I c ( x , y + 1 ) − I c ( x , y ) . We propose to consider the correlation coeﬃcient between the spatial gradients as a regularisation : R c 1 , c 2 ρ ( I ) = − ρ ( ∇ x I c 1 , ∇ x I c 2 ) − ρ ( ∇ y I c 1 , ∇ y I c 2 ) ( 4 ) Given C spectral bands , C 2 pairwise comparisons are possible . However , the strength of the correlation is not expected to be the same for all pairs of bands . Indeed , two bands with close spectral peaks should lead to higher correlation than two bands with further peaks . Given the complex structure of the spectral response functions shown in Fig . 1 ( middle ) , we propose to weight the contribution of each pair of spectral band according to the Wasserstein distance W c 1 , c 2 between the spectral response functions of the two bands : R ρ ( I ) = (cid:88) c 1 (cid:54) = c 2 e − Wc 1 , c 2 τ R c 1 , c 2 ρ ( I ) ( 5 ) where the negative exponential mapping with temperature scaling τ allows to control the relative importance of each pair . The exponential Wasserstein distance gives an indication of how closely the spectral responses of the two bands might be correlated , as shown in the heatmap in Fig . 1 ( right ) , where lighter colour means the two spectral bands are closer . By strengthening the correlation between the spatial gradient maps of diﬀerent spectral bands we expect to enhance the sharp edges and contours . Other regularisation terms . Tikhonov regularisation is a common method for ill - conditioned problems . It can be characterised as : R Tik ( I ) = (cid:107) Γ · I (cid:107) 22 ( 6 ) Here , we choose to use the Laplacian matrix as the Tikhonov matrix Γ to deal with potential high - frequency artifacts introduced during the super - resolution process . While Tikhonov regularisation can eﬀectively eliminate undesirable outliers and led to smooth images , it also has the potential risk of applying too much smoothness and erasing all sharp edges and contours , which is harmful for recovering details in the images . Total variation is another term which is able to preserve edges while regularising solutions of the inverse problem : R TV ( I ) = (cid:107)∇ x I (cid:107) 1 + (cid:107)∇ y I (cid:107) 1 ( 7 ) By combining our proposed spatial gradient consistency term with Tikhonov and total variation regularisation , we obtain the regularisation term R in ( 2 ) using λ Tik , λ TV and λ ρ as weighting factors for individual terms : R ( I ) = λ Tik R Tik ( I ) + λ TV R TV ( I ) + λ ρ R ρ ( I ) ( 8 ) Springer Nature 2021 L A TEX template 6 Spatial gradient consistency for unsupervised demosaicking Interpolated Input I i : X × Y × C Network Output HSCube I : X × Y × C Linear Demosaicking OverrideOperator Input Snapshot I s : X × Y SR Loss Tikhonov Total Variation Grad Consistency Data Fidelity Fig . 2 The pipeline of the proposed unsupervised demosaicking algorithm . 2 . 2 Image demosaicking pipeline Fig . 2 depicts the general pipeline of our proposed algorithm using deep neu - ral networks for hyperspectral image demosaicking problems . It starts from the input snapshot mosaic images where bilinear interpolation based demo - saicking can be applied to recover the spatial and spectral dimension of the images . The linearly interpolated images serve as the input of the network to generate reﬁned demosaicking results . Most deep neural networks for image super - resolution or demosaicking can be integrated into this pipeline , such as U - Net [ 21 ] , EDSR [ 9 ] and Res2 - Unet [ 15 ] . Aside from the network , given that the measured pixels in the original snapshot I s should be equal to the corresponding pixels in the demosaicked hypercube I , we propose to include an overriding operator which applies the pixel values from I s to their corresponding position in I . This forces the data ﬁdelity term L in ( 2 ) to be always 0 irrespective of the metric we choose . Based on the output images from the network with the overridden snapshot pixels , the Tikhonov regularisation , total variation and the spatial gradient consistency regularisation terms are calculated and minimised using gradient descent , and the parameters in the networks are updated . 2 . 3 Source datasets To experiment the proposed demosaicking algorithm , three hyperspectral imaging datasets are used in this work , which will be presented in this section . HELICoiD . [ 16 ] presented a publicly available in - vivo hyperspectral human brain image dataset within the European project HELICoiD ( HypEr - spectraL Imaging Cancer Detection ) . The hyperspectral images in this dataset were acquired using a line - scan hyperspectral camera system capable of cap - turing high spectral - resolution hypercubes during neurosurgical operations . The dataset contains 36 images in the Visual and Near Infrared ( VNIR ) range from 400nm to 1000nm . We applied the same method described in [ 5 ] to per - form white balancing , and then simulated snapshot mosaic images and their corresponding high - resolution demosaicked hypercubes using spectral response functions of a real hyperspectral snapshot camera . ARAD 1K . With the NTIRE 2022 Spectral Demosaicking Challenge , [ 13 ] provided 1000 hyperspectral images of natural scenes with 16 spectral bands ranging from 400nm to 1000nm . The snapshot images were simulated following a 4 × 4 MSFA pattern . There were 950 hyperspectral images for training , where the simulated snapshot images and their corresponding ground truth images Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 7 were both provided . The other 50 images were for testing , but the ground truth was not publicly available , so we separated 50 images out from the 950 training set for testing . NeuroHSI . NeuroHSI is an actively running , NIHR funded , single centre prospective observational study assessing the intra - operative capabilities of a 4 × 4 , 16 band visible range snapshot mosaic camera ( IMEC CMV2K - SSM4X4 - VIS ) to diﬀerentiate between pathological tissue and healthy brain tissue , as well as to evaluate custom made algorithms capable of correlating information from speciﬁc bands to tissue oxygenation measurements . Phase one of this study has now been completed and video hyperspectral data from two brain metastases , two gliomas ( WHO grades 2 - 4 ) , one meningiomas , one vestibular schwannoma , one cerebral aneurysm and one cerebral arteriovenous malfor - mation has been collected . 150 snapshot images with minor motion blur or out - of - focus blur were manually selected from the video data of the 8 patients , where 90 images from 4 patients are reserved for training , 30 images from 2 patients reserved for validation and 30 from the remaining 2 patients for testing . 2 . 4 Implementation details Our proposed algorithm was implemented with PyTorch and tested on all three datasets described in Section 2 . 3 . For the HELICoiD dataset , synthetic snapshot images and their corresponding high - resolution hypercubes were simulated using sensor information from the snapshot camera IMEC CMV2K - SSM4X4 - VIS . The dataset was divided into 3 groups : 24 images acquired from 15 diﬀerent patients as the training set , 6 images from 4 patients as the val - idation set , and the remaining 6 images from 3 patients as the test set . For the ARAD 1K dataset , the original raw snapshot data were simulated with an unknown exposure setting . Recovering such an unknown exposure is not the primary focus for our experiment . Therefore , new snapshot images were simu - lated using the ground truth hypercubes and the MSFA simulation algorithm provided by the organiser . The dataset was also divided into 3 groups : 720 images for training , 180 for validation and 50 for testing . As both the HELICoiD and ARAD 1K datasets have high - resolution hyper - cubes as ground truths , the U - Net , EDSR and Res2 - Unet models were trained in both a supervised and an unsupervised manner . For supervised training , the models were all trained using the Mean Relative Absolute Error ( MRAE ) Loss as described in [ 15 ] . For unsupervised training , the regularisation terms described in ( 8 ) were used as the loss function , and the models were trained with only the simulated snapshot images as inputs . The regularisation factors in ( 8 ) were set to λ Tik = 1 , λ TV = 10 − 3 and λ ρ = 1 respectively , and the temperature scaling τ in ( 5 ) was set to 0 . 1 . Details on the parameter selection and the ablation study can be found in the supplementary material . Random ﬂipping and rotation were not performed because they can disrupt the MSFA pattern of the snapshot images . Therefore , random divisible spatial cropping were performed where the position and size of the crop were all divisible by Springer Nature 2021 L A TEX template 8 Spatial gradient consistency for unsupervised demosaicking Table 1 Comparison of demosaicking accuracy between linear demosaicking and diﬀerent networks with supervised and unsupervised training setup on HELICoiD and ARAD 1K datasets . Dataset Method Network SSIM PSNR SAM HELICoiD Linear - 0 . 969 ± 0 . 011 32 . 5 ± 2 . 48 0 . 123 ± 0 . 051 Supervised UNet 0 . 991 ± 0 . 005 38 . 7 ± 3 . 06 0 . 057 ± 0 . 025 EDSR 0 . 994 ± 0 . 004 42 . 3 ± 3 . 70 0 . 035 ± 0 . 013 Res2 - Unet 0 . 995 ± 0 . 004 42 . 9 ± 3 . 99 0 . 032 ± 0 . 012 Unsupervised UNet 0 . 991 ± 0 . 004 38 . 6 ± 3 . 43 0 . 057 ± 0 . 024 EDSR 0 . 993 ± 0 . 004 39 . 9 ± 3 . 70 0 . 046 ± 0 . 019 Res2 - Unet 0 . 992 ± 0 . 005 39 . 7 ± 3 . 66 0 . 051 ± 0 . 019 ARAD 1K Linear - 0 . 956 ± 0 . 039 33 . 4 ± 4 . 16 0 . 055 ± 0 . 022 Supervised UNet 0 . 978 ± 0 . 022 38 . 4 ± 3 . 91 0 . 041 ± 0 . 016 EDSR 0 . 993 ± 0 . 007 43 . 1 ± 3 . 74 0 . 025 ± 0 . 009 Res2 - Unet 0 . 998 ± 0 . 002 48 . 7 ± 3 . 88 0 . 015 ± 0 . 006 Unsupervised UNet 0 . 977 ± 0 . 020 38 . 1 ± 3 . 62 0 . 041 ± 0 . 015 EDSR 0 . 989 ± 0 . 013 41 . 0 ± 4 . 07 0 . 031 ± 0 . 013 Res2 - Unet 0 . 988 ± 0 . 017 41 . 3 ± 4 . 42 0 . 031 ± 0 . 012 the size of the mosaic . The network models were trained using the Adam opti - miser with β 1 = 0 . 5 and β 2 = 0 . 99 and a batch size of 4 . The initial learning rate was set to 1 × 10 − 4 . Results were quantitatively evaluated based on 3 metrics , including Structural Similarity ( SSIM ) , Peak Signal - to - Noise Ratio ( PSNR ) and Spectral Angle Mapper ( SAM ) [ 22 ] . The 150 image frames selected from the NeuroHSI video dataset were all acquired from an IMEC CMV2K - SSM4X4 - VIS camera , and there are no ground truth high - resolution hypercubes , so the experiment only involves unsupervised training . 90 snapshot image frames from 4 patients were used for training , and 30 images from 2 patients for both validation and testing . Res2 - Unet was adopted for the proposed algorithm , and the parameters used for training on NeuroHSI dataset remains the same as the HELICoiD and ARAD 1K dataset . The results were evaluated qualitatively by a user study which will be described in Section 3 . 2 . 3 Results 3 . 1 Quantitative evaluation The quantitative results of the demosaicked hypercubes on both HELICoiD and ARAD 1K datasets are shown in Table 1 . Paired T - test was performed to compare against the performance of two demosaicking methods . For both datasets , the supervised training of Res2 - Unet achieved the highest demosaick - ing accuracy . The supervised EDSR results did not show statistical diﬀerences compared to Res2 - Unet at a signiﬁcant level of 0 . 05 on the HELICoiD dataset , Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 9 Linear Supervised Unsupervised Fig . 3 Comparison between diﬀerent demosaicking methods on an example NeuroHSI test image . The reconstructed sRGB images are converted from the demosaicked hyperspectral data following the method described in [ 5 ] . with p - values of 0 . 35 , 0 . 34 and 0 . 30 for SSIM , PSNR and SAM respectively . However , on the ARAD 1K dataset the p - values of < 10 − 5 for all 3 metrics indicates that Res2 - Unet outperforms EDSR signiﬁcantly . The demosaicking results of the proposed unsupervised method on Res2 - Unet are signiﬁcantly lower than the supervised method with p - values of 0 . 040 , 0 . 016 , 0 . 007 on the 3 metrics on HELICoiD dataset , and p - values of close to 0 on ARAD 1K dataset , showing that our proposed method cannot match state - of - the - art supervised demosaicking methods when ground truths are pro - vided . However , when comparing supervised and unsupervised EDSR results , the p - values of 0 . 17 , 0 . 06 and 0 . 07 on the HELICoiD dataset indicates that our proposed method can still reach similar performance as a supervised method . On the ARAD 1K dataset , although the unsupervised EDSR performs signif - icantly lower than supervised EDSR with p - values of 0 . 02 , 0 . 0001 and 0 . 0005 , it still outperforms the supervised U - Net signiﬁcantly with p - values of < 10 − 5 for all 3 metrics . In both datasets , all supervised and unsupervised results signiﬁcantly outperform linear demosaicking with p - values close to 0 . The speed of our proposed demosaicking algorithm depends on the choice of network . For a single image of size 512 × 480 from the ARAD 1K dataset , the inference times for UNet , EDSR and Res2 - Unet are around 0 . 009s , 0 . 006s and 0 . 010s respectively with NVIDIA RTX 3080 Ti . This demonstrates that when combining a suitable neural network and computing hardware , our proposed algorithm can achieve high quality hyperspectral demosaicking in real - time . 3 . 2 Qualitative evaluation and user study As there is no ground truth data for the NeuroHSI dataset , a qualitative user study was conducted to evaluate the demosaicked results of the NeuroHSI dataset . The user study was conducted using forced - choice pairwise compar - ison [ 23 ] . Fig . 3 illustrates the pseudo - sRGB reconstructions of an example NeuroHSI patient image tested using three methods : linear demosaicking ( L ) , supervised Res2 - Unet model trained from HELICoiD dataset ( SL ) and the unsupervised Res2 - Unet model trained from NeuroHSI training set ( UL ) . 30 Springer Nature 2021 L A TEX template 10 Spatial gradient consistency for unsupervised demosaicking Table 2 Number of votes received for each demosaicking method in all pairwise comparisons in the image quality assessment survey . Linear Supervised Linear Unsupervised Supervised Unsupervised 13 107 10 110 57 63 test images were included in the user study , each tested with the three methods ( L , SL , UL ) . There are thus 90 questions in total , each containing two images of the same scene with 2 diﬀerent demosaicking methods . These questions were divided into 3 separate surveys , each containing 30 questions . Partici - pants were randomly assigned to answer one of 3 surveys and asked to choose the image with better quality for each question ( pair of images ) without any knowledge of which demosaicking method was used . The participants of this survey were all neurosurgical experts with 2 to 15 years of experience . We received 12 responses in total that are summarised in Table 2 . We applied the Bradley - Terry model [ 24 ] to rank the demosaicking methods , which gives the estimated preference scale of π = ( 0 . 050 , 0 . 445 , 0 . 505 ) for L , SL and UL respec - tively . This indicates that the experts considered the images recovered from our proposed demosaicking method to have similar quality as the images from a supervised model , with the baseline linear demosaicking the least favourable method . More details can be found in the supplementary material . 4 Conclusion In this work , we have presented a novel unsupervised approach for medical hyperspectral image demosaicking . The proposed algorithm does not rely on high - resolution medical hyperspectral data which are hard to acquire in a surgical environment , but instead only snapshot mosaic images are required , which are much easier to capture . The combination of Tikhonov regularisation , total variation and spectral correlation regularisation has been adopted for unsupervised network training , and the results were tested both quantitatively and qualitatively , showing convincing results over basic linear demosaicking , and comparable results against supervised demosaicking methods , thus proving its capability for real - time intraoperative surgical application . Supplementary information . For more information regarding details of the ablation study , quantitative metrics , qualitative results and the user study , please refer to the supplementary document alongside this article . Declarations • Funding : This study / project is funded by the NIHR [ NIHR202114 ] . The views expressed are those of the author ( s ) and not necessarily those of the NIHR or the Department of Health and Social Care . This work was sup - ported by core funding from the Wellcome / EPSRC [ WT203148 / Z / 16 / Z ; Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 11 NS / A000049 / 1 ] . This project has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agree - ment No 101016985 ( FAROS project ) . TV is supported by a Medtronic / RAEng Research Chair [ RCSRF1819 \ 7 \ 34 ] . PL is funded by China Schol - arship Council . CH is supported by an InnovateUK Secondment Scholars Grant ( Project Number 75124 ) . For the purpose of open access , the authors have applied a CC BY public copyright license to any Author Accepted Manuscript version arising from this submission . • Conﬂict of interest : TV and JS are co - founders and shareholders of Hypervision Surgical . • Ethics approval : All procedures within this study involving human subjects were in accordance with both the institutional and regional ethical commit - tee ( REC reference 22 / LO / 0046 , IRAS 284230 ) and with the 1964 Helsinki declaration and its later amendments . • Informed consent : Informed consent was obtained from all individual participants involved in the study . • Consent for publication : The authors aﬃrm that human research partici - pants provided informed consent for publication of the images in Fig . 3 . References [ 1 ] Lu , G . , Fei , B . : Medical hyperspectral imaging : a review . Journal of Biomedical Optics 19 ( 1 ) , 010901 ( 2014 ) [ 2 ] Shapey , J . , Xie , Y . , Nabavi , E . , Bradford , R . , Saeed , S . R . , Ourselin , S . , Vercauteren , T . : Intraoperative multispectral and hyperspectral label - free imaging : A systematic review of in vivo clinical studies . Journal of Biophotonics 12 ( 9 ) , 201800455 ( 2019 ) [ 3 ] Clancy , N . T . , Jones , G . , Maier - Hein , L . , Elson , D . S . , Stoyanov , D . : Surgical spectral imaging . Medical image analysis 63 , 101699 ( 2020 ) [ 4 ] Holmer , A . , Marotz , J . , Wahl , P . , Dau , M . , K¨ammerer , P . W . : Hyperspec - tral imaging in perfusion and wound diagnostics – methods and algorithms for the determination of tissue parameters . Biomedical Engineering / Biomedizinische Technik 63 ( 5 ) , 547 – 556 ( 2018 ) . https : / / doi . org / 10 . 1515 / bmt - 2017 - 0155 [ 5 ] Li , P . , Ebner , M . , Noonan , P . , Horgan , C . , Bahl , A . , Ourselin , S . , Shapey , J . , Vercauteren , T . : Deep learning approach for hyperspectral image demosaicking , spectral correction and high - resolution RGB reconstruc - tion . Computer Methods in Biomechanics and Biomedical Engineering : Imaging & Visualization 10 ( 4 ) , 409 – 417 ( 2022 ) . https : / / doi . org / 10 . 1080 / 21681163 . 2021 . 1997646 Springer Nature 2021 L A TEX template 12 Spatial gradient consistency for unsupervised demosaicking [ 6 ] Yu , W . : Colour demosaicking method using adaptive cubic convolu - tion interpolation with sequential averaging . Vision , Image and Signal Processing 153 , 666 – 676 ( 2006 ) . https : / / doi . org / 10 . 1049 / ip - vis : 20050281 [ 7 ] Eismann , M . T . , Hardie , R . C . : Application of the stochastic mixing model to hyperspectral resolution enhancement . IEEE Transactions on Geo - science and Remote Sensing 42 ( 9 ) , 1924 – 1933 ( 2004 ) . https : / / doi . org / 10 . 1109 / TGRS . 2004 . 830644 [ 8 ] Dong , C . , Loy , C . C . , He , K . , Tang , X . : Learning a deep convolutional network for image super - resolution . In : Fleet , D . , Pajdla , T . , Schiele , B . , Tuytelaars , T . ( eds . ) ECCV 2014 , pp . 184 – 199 . Springer , Cham ( 2014 ) [ 9 ] Lim , B . , Son , S . , Kim , H . , Nah , S . , Lee , K . M . : Enhanced deep residual networks for single image super - resolution . In : CVPR Workshops 2017 , pp . 1132 – 1140 ( 2017 ) . https : / / doi . org / 10 . 1109 / CVPRW . 2017 . 151 [ 10 ] Zhang , Y . , Li , K . , Li , K . , Zhong , B . , Fu , Y . : Residual non - local attention networks for image restoration . In : ICLR 2019 . OpenReview , ? ? ? ( 2019 ) [ 11 ] Mei , S . , Yuan , X . , Ji , J . , Zhang , Y . , Wan , S . , Du , Q . : Hyperspectral image spatial super - resolution via 3d full convolutional neural network . Remote Sensing 9 ( 11 ) ( 2017 ) . https : / / doi . org / 10 . 3390 / rs9111139 [ 12 ] Dijkstra , K . , van de Loosdrecht , J . , Schomaker , L . , Wiering , M . A . : Hyperspectral demosaicking and crosstalk correction using deep learning . Machine Vision and Applications 30 ( 1 ) , 1 – 21 ( 2019 ) [ 13 ] Arad , B . , Timofte , R . , Yahel , R . , Morag , N . , Bernat , A . , Wu , Y . , Wu , X . , Fan , Z . , Xia , C . , Zhang , F . , Liu , S . , Li , Y . , Feng , C . , Lei , L . , Zhang , M . , Feng , K . , Zhang , X . , Yao , J . , Zhao , Y . , Ma , S . , He , F . , Dong , Y . , Yu , S . , Qiu , D . , Liu , J . , Bi , M . , Song , B . , Sun , W . , Zheng , J . , Zhao , B . , Cao , Y . , Yang , J . , Cao , Y . , Kong , X . , Yu , J . , Xue , Y . , Xie , Z . : NTIRE 2022 spectral demosaicing challenge and data set . In : 2022 IEEE / CVF CVPR Workshops , pp . 881 – 895 ( 2022 ) . https : / / doi . org / 10 . 1109 / CVPRW56347 . 2022 . 00103 [ 14 ] Niu , B . , Wen , W . , Ren , W . , Zhang , X . , Yang , L . , Wang , S . , Zhang , K . , Cao , X . , Shen , H . : Single image super - resolution via a holistic attention network . In : Vedaldi , A . , Bischof , H . , Brox , T . , Frahm , J . - M . ( eds . ) ECCV 2020 , pp . 191 – 207 . Springer , Cham ( 2020 ) [ 15 ] Song , B . , Ma , S . , He , F . , Sun , W . : Hyperspectral reconstruction from RGB images based on Res2 - Unet deep learning network . Optics and Precision Engineering 30 ( 13 ) , 1606 ( 2022 ) [ 16 ] Fabelo , H . , Ortega , S . , Szolna , A . , Bulters , D . , Pi˜neiro , J . F . , Kabwama , Springer Nature 2021 L A TEX template Spatial gradient consistency for unsupervised demosaicking 13 S . , J - O’Shanahan , A . , Bulstrode , H . , Bisshopp , S . , Kiran , B . R . , Ravi , D . , Lazcano , R . , Madro˜nal , D . , Sosa , C . , Espino , C . , Marquez , M . , De La Luz Plaza , M . , Camacho , R . , Carrera , D . , Hern´andez , M . , Callic´o , G . M . , Morera Molina , J . , Stanciulescu , B . , Yang , G . - Z . , Salvador , R . , Ju´arez , E . , Sanz , C . , Sarmiento , R . : In - vivo hyperspectral human brain image database for brain cancer detection . IEEE Access 7 , 39098 – 39116 ( 2019 ) . https : / / doi . org / 10 . 1109 / ACCESS . 2019 . 2904788 [ 17 ] Hyttinen , J . , F¨alt , P . , J¨asberg , H . , Kullaa , A . , Hauta - Kasari , M . : Oral and dental spectral image database—odsi - db . Applied Sciences 10 ( 20 ) ( 2020 ) . https : / / doi . org / 10 . 3390 / app10207246 [ 18 ] Ebner , M . , Nabavi , E . , Shapey , J . , Xie , Y . , Liebmann , F . , Spirig , J . M . , Hoch , A . , Farshad , M . , Saeed , S . R . , Bradford , R . , Yardley , I . , Ourselin , S . , Edwards , A . D . , F¨uhrnstahl , P . , Vercauteren , T . : Intraoperative hyper - spectral label - free imaging : from system design to ﬁrst - in - patient trans - lation . Journal of Physics D : Applied Physics 54 ( 29 ) , 294003 ( 2021 ) . https : / / doi . org / 10 . 1088 / 1361 - 6463 / abfbf6 [ 19 ] Gunturk , B . K . , Altunbasak , Y . , Mersereau , R . M . : Color plane inter - polation using alternating projections . IEEE Transactions on Image Processing 11 ( 9 ) , 997 – 1013 ( 2002 ) . https : / / doi . org / 10 . 1109 / TIP . 2002 . 801121 [ 20 ] Haber , E . , Modersitzki , J . : Intensity gradient based registration and fusion of multi - modal images . In : Larsen , R . , Nielsen , M . , Sporring , J . ( eds . ) Medical Image Computing and Computer - Assisted Intervention – MICCAI 2006 , pp . 726 – 733 . Springer , Berlin , Heidelberg ( 2006 ) [ 21 ] Ronneberger , O . , Fischer , P . , Brox , T . : U - Net : Convolutional networks for biomedical image segmentation . In : MICCAI 2015 , pp . 234 – 241 ( 2015 ) . Springer [ 22 ] Kruse , F . A . , Lefkoﬀ , A . B . , Boardman , J . W . , Heidebrecht , K . B . , Shapiro , A . , Barloon , P . J . , Goetz , A . F . H . : The spectral image processing system ( sips ) interactive visualization and analysis of imaging spectrometer data . Remote Sensing of Environment 44 , 145 – 163 ( 1993 ) [ 23 ] Mantiuk , R . K . , Tomaszewska , A . , Mantiuk , R . : Comparison of four subjective methods for image quality assessment . Computer Graph - ics Forum 31 ( 8 ) , 2478 – 2491 ( 2012 ) . https : / / doi . org / 10 . 1111 / j . 1467 - 8659 . 2012 . 03188 . x [ 24 ] Bradley , R . A . , Terry , M . E . : Rank analysis of incomplete block designs : I . the method of paired comparisons . Biometrika 39 ( 3 / 4 ) , 324 – 345 ( 1952 ) Springer Nature 2021 L A TEX template Supplementary material Spatial gradient consistency for unsupervised learning of hyperspectral demosaicking : application to surgical imaging Peichao Li 1 * , Muhammad Asad 1 , Conor Horgan 1 , Oscar MacCormac 1 , 2 , Jonathan Shapey 1 , 2 and Tom Vercauteren 1 1 School of Biomedical Engineering & Imaging Sciences , King’s College London , London , UK . 2 Department of Neurosurgery , King’s College Hospital NHS Foundation Trust , London , UK . * Corresponding author ( s ) . E - mail ( s ) : peichao . 2 . li @ kcl . ac . uk ; 1 Evaluation Metrics The evaluation metrics used in our quantitative analysis of the demosaick - ing results include Structural Similarity index ( SSIM ) , Peak Signal - to - Noise Ratio ( PSNR ) and Spectral Angle Mapper ( SAM ) [ 1 ] . Given the ground truth hyperspectral image I ∈ R X × Y × C and the demosaicked hyperspectral image ˆ I ∈ R X × Y × C , the SSIM can be calculated based on the luminance term l ( I , ˆ I ) , the contrast term c ( I , ˆ I ) and the structural term s ( I , ˆ I ) : l ( I , ˆ I ) = 2 µ I µ ˆ I + C 1 µ 2 I + µ 2ˆ I + C 1 ( 1 ) c ( I , ˆ I ) = 2 σ I σ ˆ I + C 2 σ 2 I + σ 2ˆ I + C 2 ( 2 ) s ( I , ˆ I ) = σ I ˆ I + C 3 σ I σ ˆ I + C 3 ( 3 ) where µ I , µ ˆ I , σ I , σ ˆ I and σ I ˆ I represent the means , standard deviations and the cross covariance of the hyperspectral images I and ˆ I . C 1 , C 2 and C 3 are 1 Springer Nature 2021 L A TEX template 2 Supplementary Material Linear Tikhonov and TV only ( λ ρ = 0 ) Proposed ( λ ρ = 0 . 1 ) Ground Truth Fig . 1 The effect of the proposed gradient consistency regularisation term on the demosaicked image . constants to ensure stability when the denominator becomes 0 . SSIM is then given by : SSIM ( I , ˆ I ) = [ l ( I , ˆ I ) ] α · [ c ( I , ˆ I ) ] β · [ s ( I , ˆ I ) ] γ ( 4 ) To simplify the expression , by default α = β = γ = 1 , and C 3 = 0 . 5 C 2 . Hence , SSIM can be simplified as : SSIM ( I , ˆ I ) = ( 2 µ I µ ˆ I + C 1 ) ( 2 σ I ˆ I + C 2 ) ( µ 2 I + µ 2ˆ I + C 1 ) ( σ 2 I + σ 2ˆ I + C 2 ) ( 5 ) PSNR is defined as : PSNR = 10 log 10 ( MAX 2 I MSE ) ( 6 ) where MAX 2 I is the maximum pixel value in I , and MSE is the mean - squared error which is defined as : MSE = 1 XY C X X x = 1 Y X y = 1 C X c = 1 ( I ( x , y , c ) − ˆ I ( x , y , c ) ) 2 ( 7 ) Finally , SAM can be calculated by : SAM = 1 XY X X x = 1 Y X y = 1 arccos ( P Cc = 1 I ( x , y , c ) · ˆ I ( x , y , c ) qP Cc = 1 I ( x , y , c ) 2 q P Cc = 1 ˆ I ( x , y , c ) 2 ) ( 8 ) 2 Ablation Study Figure 1 shows an example test image from HELICoiD [ 2 ] dataset illustrating the effect of the proposed gradient consistency regularisation term . For easy visualisation , the hyperspectral images presented in this document have all been converted into sRGB images . This can be achieved using the method described in [ 3 ] , which involves first converting the spectral data to the CIE Springer Nature 2021 L A TEX template Supplementary Material 3 Table 1 PSNR results of the demosaicked images using different weighting factors for each regularisation term . λ ρ = 0 λ ρ = 0 . 01 λ ρ = 0 . 1 λ ρ = 1 λ ρ = 10 λ TV = 0 λ Tik = 0 - 36 . 33 36 . 33 36 . 33 36 . 33 λ TV = 0 λ Tik = 0 . 1 32 . 54 39 . 82 40 . 32 38 . 67 36 . 78 λ TV = 0 λ Tik = 1 32 . 54 36 . 23 39 . 93 40 . 35 38 . 67 λ TV = 0 λ Tik = 10 32 . 54 33 . 66 36 . 23 39 . 92 40 . 35 λ TV = 1e − 4 λ Tik = 0 31 . 64 40 . 46 39 . 12 36 . 89 36 . 38 λ TV = 1e − 4 λ Tik = 0 . 1 32 . 15 39 . 71 41 . 47 38 . 84 36 . 83 λ TV = 1e − 4 λ Tik = 1 32 . 53 36 . 21 39 . 92 41 . 37 38 . 69 λ TV = 1e − 4 λ Tik = 10 32 . 54 33 . 66 36 . 23 39 . 92 41 . 35 λ TV = 1e − 3 λ Tik = 0 31 . 64 35 . 16 38 . 71 37 . 80 36 . 73 λ TV = 1e − 3 λ Tik = 0 . 1 30 . 48 37 . 41 41 . 25 39 . 50 37 . 14 λ TV = 1e − 3 λ Tik = 1 32 . 29 35 . 90 39 . 81 41 . 50 38 . 84 λ TV = 1e − 3 λ Tik = 10 32 . 53 33 . 65 36 . 21 39 . 92 41 . 37 λ TV = 1e − 2 λ Tik = 0 31 . 60 33 . 21 34 . 80 37 . 12 37 . 67 λ TV = 1e − 2 λ Tik = 0 . 1 25 . 15 29 . 36 34 . 39 39 . 07 38 . 05 λ TV = 1e − 2 λ Tik = 1 29 . 83 33 . 03 37 . 42 41 . 26 39 . 51 λ TV = 1e − 2 λ Tik = 10 32 . 29 33 . 33 35 . 90 39 . 81 41 . 50 XYZ colour space , and then transforming the XYZ images to linear RGB images . Finally , gamma correction is applied to obtain the sRGB images . It can be seen from Figure 1 that when the weighting factor of the proposed regularisation term λ ρ is set to 0 , the result from using only traditional regu - larisation techniques is similar to a linearly demosaicked image . The proposed regularisation term strengthens the correlation between the spatial gradient maps of different spectral bands , which results in enhanced image sharpness . A quick way to test the performance of our proposed regularisation term without training a neural network is to solve the direct inverse problem . This can be achieved by directly finding a hyperspectral image such that the sum of all regularisation terms are minimised , as expressed in Eq . ( 2 ) in the main paper . The minimisation can be achieved by common iterative methods such as Broyden – Fletcher – Goldfarb – Shanno [ 4 ] algorithm and Adam optimisation . The values of the weighting factors for all regularisation terms , including λ Tik , λ TV and λ ρ , were determined by solving the direct inverse problem using one of the images from the HELICoiD dataset , and then calculating the PSNR of the results . Adam optimisation with initial learning rate of 0 . 01 , β 1 = 0 . 5 and β 2 = 0 . 99 was used during the experiment for fast minimisation , and it took 500 iterations to obtain the demosaicking results . These results are shown in Table 1 , where it can be seen that the highest PSNR can be achieved when λ Tik = 1 , λ TV = 1e − 3 and λ ρ = 1 or when λ Tik = 10 , λ TV = 1e − 2 and λ ρ = 10 , which is just multiples of the former set of weights . Therefore , we chose λ Tik = 1 , λ TV = 1e − 3 and λ ρ = 1 for all unsupervised network training . Springer Nature 2021 L A TEX template 4 Supplementary Material Linear Supervised ( Res2 - Unet ) Unsupervised ( Res2 - Unet ) Ground Truth HELICoiD ARAD _ 1K NeuroHSI No Ground Truth Fig . 2 Example demosaicking results from each dataset ( HELICoiD , ARAD 1K , Neu - roHSI ) . 3 Additional Examples from the Results Figure 2 shows some additional example results of linear demosaicking , super - vised and unsupervised trained Res2 - Unet model , as well as the ground truths respectively on HELICoiD [ 2 ] , ARAD 1K [ 5 ] and NeuroHSI datasets . Since there are no high - resolution images as ground truth for the NeuroHSI dataset , training a supervised network model on this dataset is not possible . There - fore , the supervised Res2 - Unet results for NeuroHSI dataset were inferred by directly using the supervised Res2 - Unet model trained from HELICoiD dataset . The reason to choose the HELICoiD - trained model rather than the ARAD 1K model is that both HELICoiD and NeuroHSI are neurosurgical Springer Nature 2021 L A TEX template Supplementary Material 5 Fig . 3 The user interface of the survey . Zoom option is provided to help the participants with observing the images in more details . image datasets , so there is less domain gap compared to ARAD 1K which are all natural scene images . Adapting ARAD 1K - trained networks on NeuroHSI images for better results may involve methods such as transfer learning , which is not the primary focus of this work . 4 Additional Information on the User Study The aim of the user study was to rank the three demosaicking methods based on the demosaicked NeuroHSI images : linear demosaicking ( L ) , supervised training from the HELICoiD dataset ( SL ) and unsupervised training from the NeuroHSI dataset ( UL ) . We chose Res2 - Unet as the network to generate both supervised and unsupervised results , because from the quantitative analysis of the results on both HELICoiD and ARAD 1K datasets , supervised Res2 - Unet achieved the highest demosaicking accuracy . [ 6 ] argues that forced - choice pairwise comparison is the fastest and the most accurate type of user study for image quality assessment . Therefore , we designed a two - alternative forced - choice ( 2AFC ) image quality survey , where observers needed to compare two images at a time and choose one with bet - ter quality without giving any rating scales . Hence , the three methods were compared by directly inferred pairwise comparison : L vs SL , L vs UL , and SL vs UL . There are 30 test images in the NeuroHSI dataset , thus the 90 demo - saicked results from all three methods can form 90 pairwise comparisons as the Springer Nature 2021 L A TEX template 6 Supplementary Material Table 2 Results of the image quality assessment survey summarising the preferences for each pairwise comparison . The number refers to the number of votes that the demosaicking method in the row is preferred over the method in the column . L SL UL L - 13 10 SL 107 - 57 UL 110 63 - survey questions . It was not practical to ask each participant to make judge - ments on all 90 image pairs , so we divided them into 3 separate surveys , each containing 30 image pairs . The participants of this survey were all neurosurgical experts with 2 to 15 years of experience . Each participant was randomly assigned with one of the three surveys on a website . The introductory page provided some instruc - tions about the recommended screen size , browsers as well as the information about the survey tools . Then the two images to compare were presented to the participants , as shown in Figure 3 . We received 4 responses for each of the 3 surveys , so there are 12 responses in total . The results are summarised in Table 2 , where it can be seen that when compared with linear demosaicking , the supervised demosaicking received 89 . 2 % of the votes , and our proposed unsupervised demosaicking received 91 . 7 % of the votes . When directly comparing the unsupervised demosaicking images against supervised demosaicking , our proposed method still received 52 . 5 % of the votes . Bradley - Terry model was applied to map probability of preference to scales to describe which demosaicking methods are more preferred by the experts , as suggested by [ 7 ] for image quality assessment . In the Bradley - Terry model , consider K number of methods to be compared . For method i and j , denote the probability that method i wins over method j as : p ij = P ( i > j ) = π i π i + π j ( 9 ) where π i is the scale value indicating the preference of the method i . Let w ij be the number of votes that method i is preferred over method j . Assume the vote from each pairwise comparison is independent , Bradley - Terry model describes the log - likelihood of the scale parameter π = [ π 1 , . . . , π k ] , k ∈ [ 1 , K ] as L ( π ) = K X i K X j [ w ij log π i − w ij log ( π i + π j ) ] ( 10 ) Springer Nature 2021 L A TEX template Supplementary Material 7 [ 8 ] proposed to use MM - algorithm to find a maximum likelihood estimation of π by performing an iterative update until convergence : π ( n + 1 ) i = P Kj = 1 w ij P Kj = 1 w ij + w ji π ( n ) i + π ( n ) j ( 11 ) Fitting a Bradley - Terry model with the results of the user study in Table 2 using ( 11 ) , we can get an estimated preference scale of π = ( 0 . 050 , 0 . 445 , 0 . 505 ) for L , SL and UL respectively . This result shows that the experts consider the images recovered from our proposed demosaicking method to have sim - ilar quality as the images from a supervised model , and the baseline linear demosaicking is the least favourable method . References [ 1 ] Kruse , F . A . , Lefkoff , A . B . , Boardman , J . W . , Heidebrecht , K . B . , Shapiro , A . , Barloon , P . J . , Goetz , A . F . H . : The spectral image processing system ( sips ) interactive visualization and analysis of imaging spectrometer data . Remote Sensing of Environment 44 , 145 – 163 ( 1993 ) [ 2 ] Fabelo , H . , Ortega , S . , Szolna , A . , Bulters , D . , Pi˜neiro , J . F . , Kabwama , S . , J - O’Shanahan , A . , Bulstrode , H . , Bisshopp , S . , Kiran , B . R . , Ravi , D . , Lazcano , R . , Madro˜nal , D . , Sosa , C . , Espino , C . , Marquez , M . , De La Luz Plaza , M . , Camacho , R . , Carrera , D . , Hern´andez , M . , Callic´o , G . M . , Morera Molina , J . , Stanciulescu , B . , Yang , G . - Z . , Salvador , R . , Ju´arez , E . , Sanz , C . , Sarmiento , R . : In - vivo hyperspectral human brain image database for brain cancer detection . IEEE Access 7 , 39098 – 39116 ( 2019 ) . https : / / doi . org / 10 . 1109 / ACCESS . 2019 . 2904788 [ 3 ] Li , P . , Ebner , M . , Noonan , P . , Horgan , C . , Bahl , A . , Ourselin , S . , Shapey , J . , Vercauteren , T . : Deep learning approach for hyperspectral image demosaicking , spectral correction and high - resolution RGB reconstruction . Computer Methods in Biomechanics and Biomedical Engineering : Imaging & Visualization 10 ( 4 ) , 409 – 417 ( 2022 ) . https : / / doi . org / 10 . 1080 / 21681163 . 2021 . 1997646 [ 4 ] Fletcher , R . : Practical Methods of Optimization , pp . 44 – 79 . John Wiley & Sons , Ltd , New York , NY , USA ( 2000 ) . Chap . 3 . https : / / doi . org / 10 . 1002 / 9781118723203 . ch3 [ 5 ] Arad , B . , Timofte , R . , Yahel , R . , Morag , N . , Bernat , A . , Wu , Y . , Wu , X . , Fan , Z . , Xia , C . , Zhang , F . , Liu , S . , Li , Y . , Feng , C . , Lei , L . , Zhang , M . , Feng , K . , Zhang , X . , Yao , J . , Zhao , Y . , Ma , S . , He , F . , Dong , Y . , Yu , S . , Qiu , D . , Liu , J . , Bi , M . , Song , B . , Sun , W . , Zheng , J . , Zhao , B . , Cao , Y . , Yang , J . , Cao , Y . , Kong , X . , Yu , J . , Xue , Y . , Xie , Z . : NTIRE 2022 Springer Nature 2021 L A TEX template 8 Supplementary Material spectral demosaicing challenge and data set . In : 2022 IEEE / CVF CVPR Workshops , pp . 881 – 895 ( 2022 ) . https : / / doi . org / 10 . 1109 / CVPRW56347 . 2022 . 00103 [ 6 ] Mantiuk , R . K . , Tomaszewska , A . , Mantiuk , R . : Comparison of four sub - jective methods for image quality assessment . Computer Graphics Forum 31 ( 8 ) , 2478 – 2491 ( 2012 ) . https : / / doi . org / 10 . 1111 / j . 1467 - 8659 . 2012 . 03188 . x [ 7 ] Handley , J . C . : Comparative analysis of Bradley - Terry and Thurstone - Mosteller paired comparison models for image quality assessment . In : PICS , vol . 1 , pp . 108 – 112 ( 2001 ) [ 8 ] Hunter , D . R . : MM algorithms for generalized Bradley - Terry models . The Annals of Statistics 32 ( 1 ) , 384 – 406 ( 2004 ) . https : / / doi . org / 10 . 1214 / aos / 1079120141