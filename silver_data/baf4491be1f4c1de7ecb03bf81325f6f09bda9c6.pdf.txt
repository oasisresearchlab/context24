W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i ng t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . Numerical Recipes in C The Art of Scientific Computing Second Edition WilliamH . Press Harvard - SmithsonianCenterforAstrophysics SaulA . Teukolsky DepartmentofPhysics , CornellUniversity WilliamT . Vetterling PolaroidCorporation BrianP . Flannery EXXONResearchandEngineeringCompany CAMBRIDGE UNIVERSITY PRESS Cambridge NewYork PortChester Melbourne Sydney W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i ng t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . Published by the Press Syndicate of the University of Cambridge The Pitt Building , Trumpington Street , Cambridge CB2 1RP 40 West 20th Street , New York , NY 10011 - 4211 , USA 10 Stamford Road , Oakleigh , Victoria 3166 , Australia Copyright c (cid:13) Cambridge University Press 1988 , 1992 except for x 13 . 10 and Appendix B , which are placed into the public domain , and except for all other computer programs and procedures , which are Copyright c (cid:13) Numerical Recipes Software 1987 , 1988 , 1992 All Rights Reserved . Some sections of this book were originally published , in different form , in Computers in Physics magazine , Copyright c (cid:13) American Institute of Physics , 1988 – 1992 . First Edition originally published 1988 ; Second Edition originally published 1992 . Reprinted with corrections , 1995 . This reprinting is corrected to software version 2 . 06 Printed in the United States of America Typeset in TEX The computer programsin this book are available , in C , in several machine - readable formats . There are also versions of this book and its software available in the Pascal , FORTRAN , and BASIC programming languages . To purchase diskettes in IBM PC or Apple Macintosh formats , use the order form at the back of the book or write to Cambridge University Press , 110 Midland Avenue , Port Chester , NY 10573 . Also available from Cambridge University Press are the Numerical Recipes Example Books and coordinated diskettes in C , FORTRAN , Pascal , and BASIC . These provide demonstration programs that illustrate the use of each subroutine and procedurein this book . They too may be ordered in the abovemanner . Unlicensed transfer of Numerical Recipes programs from the abovementionedIBM PCorAppleMacintoshdiskettestoanyotherformat , ortoanycomputerexceptasingleIBM PC or Apple Macintosh or compatible for each diskette purchased , is strictly prohibited . Licenses for authorized transfers to other computersare available from Numerical Recipes Software , P . O . Box 243 , Cambridge , MA 02238 ( fax 617 863 - 1739 , email info @ nr . com , or http : / / world . std . com / (cid:24)nr ) . Technical questions , corrections , and requests for information on other available formats should also be directed to this address . Library of Congress Cataloging in Publication Data Numerical recipes in C : the art of scientiﬁc computing / William H . Press : : : [ et al . ] . – 2nd ed . Includes bibliographical references ( p . ) and index . ISBN 0 - 521 - 43108 - 5 1 . Numerical analysis – Computerprograms . 2 . Science – Mathematics – Computerprograms . 3 . C ( Computer program language ) I . Press , William H . QA297 . N866 1992 519 . 4’0285’53 – dc20 92 - 8876 A catalog record for this book is available from the British Library . ISBN 0 521 43108 5 Book ISBN 0 521 43720 2 Example book in C ISBN 0 521 43714 8 C diskette ( IBM 5 . 25” , 1 . 2M ) ISBN 0 521 43724 5 C diskette ( IBM 3 . 5” , 1 . 44M ) ISBN 0 521 43715 6 C diskette ( Mac 3 . 5” , 800K ) iv W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i ng t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . Contents PrefacetotheSecondEdition xi PrefacetotheFirstEdition xiv LegalMatters xvi ComputerProgramsbyChapterandSection xix 1 Preliminaries 1 1 . 0 Introduction 1 1 . 1 Program Organization and Control Structures 5 1 . 2 Some C Conventions for Scientiﬁc Computing 15 1 . 3 Error , Accuracy , and Stability 28 2 SolutionofLinearAlgebraicEquations 32 2 . 0 Introduction 32 2 . 1 Gauss - Jordan Elimination 36 2 . 2 Gaussian Elimination with Backsubstitution 41 2 . 3 LU Decomposition and Its Applications 43 2 . 4 Tridiagonal and Band Diagonal Systems of Equations 50 2 . 5 Iterative Improvement of a Solution to Linear Equations 55 2 . 6 Singular Value Decomposition 59 2 . 7 Sparse Linear Systems 71 2 . 8 Vandermonde Matrices and Toeplitz Matrices 90 2 . 9 Cholesky Decomposition 96 2 . 10 QR Decomposition 98 2 . 11 Is Matrix Inversion an N 3 Process ? 102 3 InterpolationandExtrapolation 105 3 . 0 Introduction 105 3 . 1 Polynomial Interpolation and Extrapolation 108 3 . 2 Rational Function Interpolation and Extrapolation 111 3 . 3 Cubic Spline Interpolation 113 3 . 4 How to Search an Ordered Table 117 3 . 5 Coefﬁcients of the Interpolating Polynomial 120 3 . 6 Interpolation in Two or More Dimensions 123 v vi Contents W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . 4 IntegrationofFunctions 129 4 . 0 Introduction 129 4 . 1 Classical Formulas for Equally Spaced Abscissas 130 4 . 2 Elementary Algorithms 136 4 . 3 Romberg Integration 140 4 . 4 Improper Integrals 141 4 . 5 Gaussian Quadratures and Orthogonal Polynomials 147 4 . 6 Multidimensional Integrals 161 5 EvaluationofFunctions 165 5 . 0 Introduction 165 5 . 1 Series and Their Convergence 165 5 . 2 Evaluation of Continued Fractions 169 5 . 3 Polynomials and Rational Functions 173 5 . 4 Complex Arithmetic 176 5 . 5 Recurrence Relations and Clenshaw’s Recurrence Formula 178 5 . 6 Quadratic and Cubic Equations 183 5 . 7 Numerical Derivatives 186 5 . 8 Chebyshev Approximation 190 5 . 9 Derivatives or Integrals of a Chebyshev - approximated Function 195 5 . 10 Polynomial Approximation from Chebyshev Coefﬁcients 197 5 . 11 Economization of Power Series 198 5 . 12 Pad´e Approximants 200 5 . 13 Rational Chebyshev Approximation 204 5 . 14 Evaluation of Functions by Path Integration 208 6 SpecialFunctions 212 6 . 0 Introduction 212 6 . 1 Gamma Function , Beta Function , Factorials , Binomial Coefﬁcients 213 6 . 2 Incomplete Gamma Function , Error Function , Chi - Square Probability Function , Cumulative Poisson Function 216 6 . 3 Exponential Integrals 222 6 . 4 Incomplete Beta Function , Student’s Distribution , F - Distribution , Cumulative Binomial Distribution 226 6 . 5 Bessel Functions of Integer Order 230 6 . 6 Modiﬁed Bessel Functions of Integer Order 236 6 . 7 Bessel Functions of Fractional Order , Airy Functions , Spherical Bessel Functions 240 6 . 8 Spherical Harmonics 252 6 . 9 Fresnel Integrals , Cosine and Sine Integrals 255 6 . 10 Dawson’s Integral 259 6 . 11 Elliptic Integrals and Jacobian Elliptic Functions 261 6 . 12 Hypergeometric Functions 271 7 RandomNumbers 274 7 . 0 Introduction 274 7 . 1 Uniform Deviates 275 Contents vii W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . 7 . 2 Transformation Method : Exponential and Normal Deviates 287 7 . 3 Rejection Method : Gamma , Poisson , Binomial Deviates 290 7 . 4 Generation of Random Bits 296 7 . 5 Random Sequences Based on Data Encryption 300 7 . 6 Simple Monte Carlo Integration 304 7 . 7 Quasi - ( that is , Sub - ) Random Sequences 309 7 . 8 Adaptive and Recursive Monte Carlo Methods 316 8 Sorting 329 8 . 0 Introduction 329 8 . 1 Straight Insertion and Shell’s Method 330 8 . 2 Quicksort 332 8 . 3 Heapsort 336 8 . 4 Indexing and Ranking 338 8 . 5 Selecting the M th Largest 341 8 . 6 Determination of Equivalence Classes 345 9 RootFindingandNonlinearSetsofEquations 347 9 . 0 Introduction 347 9 . 1 Bracketing and Bisection 350 9 . 2 Secant Method , False Position Method , and Ridders’ Method 354 9 . 3 Van Wijngaarden – Dekker – Brent Method 359 9 . 4 Newton - Raphson Method Using Derivative 362 9 . 5 Roots of Polynomials 369 9 . 6 Newton - Raphson Method for Nonlinear Systems of Equations 379 9 . 7 Globally Convergent Methods for Nonlinear Systems of Equations 383 10 MinimizationorMaximizationofFunctions 394 10 . 0 Introduction 394 10 . 1 Golden Section Search in One Dimension 397 10 . 2 Parabolic Interpolation and Brent’s Method in One Dimension 402 10 . 3 One - Dimensional Search with First Derivatives 405 10 . 4 Downhill Simplex Method in Multidimensions 408 10 . 5 Direction Set ( Powell’s ) Methods in Multidimensions 412 10 . 6 Conjugate Gradient Methods in Multidimensions 420 10 . 7 Variable Metric Methods in Multidimensions 425 10 . 8 Linear Programming and the Simplex Method 430 10 . 9 Simulated Annealing Methods 444 11 Eigensystems 456 11 . 0 Introduction 456 11 . 1 Jacobi Transformations of a Symmetric Matrix 463 11 . 2 Reduction of a Symmetric Matrix to Tridiagonal Form : Givens and Householder Reductions 469 11 . 3 Eigenvalues and Eigenvectors of a Tridiagonal Matrix 475 11 . 4 Hermitian Matrices 481 11 . 5 Reduction of a General Matrix to Hessenberg Form 482 viii Contents W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . 11 . 6 The QR Algorithm for Real Hessenberg Matrices 486 11 . 7 Improving Eigenvalues and / or Finding Eigenvectors by Inverse Iteration 493 12 FastFourierTransform 496 12 . 0 Introduction 496 12 . 1 Fourier Transform of Discretely Sampled Data 500 12 . 2 Fast Fourier Transform ( FFT ) 504 12 . 3 FFT of Real Functions , Sine and Cosine Transforms 510 12 . 4 FFT in Two or More Dimensions 521 12 . 5 Fourier Transforms of Real Data in Two and Three Dimensions 525 12 . 6 External Storage or Memory - Local FFTs 532 13 FourierandSpectralApplications 537 13 . 0 Introduction 537 13 . 1 Convolution and Deconvolution Using the FFT 538 13 . 2 Correlation and Autocorrelation Using the FFT 545 13 . 3 Optimal ( Wiener ) Filtering with the FFT 547 13 . 4 Power Spectrum Estimation Using the FFT 549 13 . 5 Digital Filtering in the Time Domain 558 13 . 6 Linear Prediction and Linear Predictive Coding 564 13 . 7 Power Spectrum Estimation by the Maximum Entropy ( All Poles ) Method 572 13 . 8 Spectral Analysis of Unevenly Sampled Data 575 13 . 9 Computing Fourier Integrals Using the FFT 584 13 . 10 Wavelet Transforms 591 13 . 11 Numerical Use of the Sampling Theorem 606 14 StatisticalDescriptionofData 609 14 . 0 Introduction 609 14 . 1 Moments of a Distribution : Mean , Variance , Skewness , and So Forth 610 14 . 2 Do Two Distributions Have the Same Means or Variances ? 615 14 . 3 Are Two Distributions Different ? 620 14 . 4 Contingency Table Analysis of Two Distributions 628 14 . 5 Linear Correlation 636 14 . 6 Nonparametric or Rank Correlation 639 14 . 7 Do Two - Dimensional Distributions Differ ? 645 14 . 8 Savitzky - Golay Smoothing Filters 650 15 ModelingofData 656 15 . 0 Introduction 656 15 . 1 Least Squares as a Maximum Likelihood Estimator 657 15 . 2 Fitting Data to a Straight Line 661 15 . 3 Straight - Line Data with Errors in Both Coordinates 666 15 . 4 General Linear Least Squares 671 15 . 5 Nonlinear Models 681 Contents ix W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . 15 . 6 Conﬁdence Limits on Estimated Model Parameters 689 15 . 7 Robust Estimation 699 16 IntegrationofOrdinaryDifferentialEquations 707 16 . 0 Introduction 707 16 . 1 Runge - Kutta Method 710 16 . 2 Adaptive Stepsize Control for Runge - Kutta 714 16 . 3 Modiﬁed Midpoint Method 722 16 . 4 Richardson Extrapolation and the Bulirsch - Stoer Method 724 16 . 5 Second - Order Conservative Equations 732 16 . 6 Stiff Sets of Equations 734 16 . 7 Multistep , Multivalue , and Predictor - Corrector Methods 747 17 TwoPointBoundaryValueProblems 753 17 . 0 Introduction 753 17 . 1 The Shooting Method 757 17 . 2 Shooting to a Fitting Point 760 17 . 3 Relaxation Methods 762 17 . 4 A Worked Example : Spheroidal Harmonics 772 17 . 5 Automated Allocation of Mesh Points 783 17 . 6 Handling Internal Boundary Conditions or Singular Points 784 18 IntegralEquationsandInverseTheory 788 18 . 0 Introduction 788 18 . 1 Fredholm Equations of the Second Kind 791 18 . 2 Volterra Equations 794 18 . 3 Integral Equations with Singular Kernels 797 18 . 4 Inverse Problems and the Use of A Priori Information 804 18 . 5 Linear Regularization Methods 808 18 . 6 Backus - Gilbert Method 815 18 . 7 Maximum Entropy Image Restoration 818 19 PartialDifferentialEquations 827 19 . 0 Introduction 827 19 . 1 Flux - Conservative Initial Value Problems 834 19 . 2 Diffusive Initial Value Problems 847 19 . 3 Initial Value Problems in Multidimensions 853 19 . 4 Fourier and Cyclic Reduction Methods for Boundary Value Problems 857 19 . 5 Relaxation Methods for Boundary Value Problems 863 19 . 6 Multigrid Methods for Boundary Value Problems 871 20 Less - NumericalAlgorithms 889 20 . 0 Introduction 889 20 . 1 Diagnosing Machine Parameters 889 20 . 2 Gray Codes 894 x Contents W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . 20 . 3 Cyclic Redundancy and Other Checksums 896 20 . 4 Huffman Coding and Compression of Data 903 20 . 5 Arithmetic Coding 910 20 . 6 Arithmetic at Arbitrary Precision 915 References 926 AppendixA : TableofPrototypeDeclarations 930 AppendixB : UtilityRoutines 940 AppendixC : ComplexArithmetic 948 IndexofProgramsandDependencies 951 GeneralIndex 965 W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i ng t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . Preface to the Second Edition Our aim in writing the original edition of Numerical Recipes was to provide a book that combined general discussion , analytical mathematics , algorithmics , and actual working programs . The success of the ﬁrst edition puts us now in a difﬁcult , though hardly unenviable , position . We wanted , then and now , to write a book that is informal , fearlessly editorial , unesoteric , and above all useful . There is a danger that , if we are not careful , we might produce a second edition that is weighty , balanced , scholarly , and boring . It is a mixed blessing that we know more now than we did six years ago . Then , we were making educated guesses , based on existing literature and our own research , about whichnumerical techniqueswere the most important and robust . Now , we have the beneﬁt of direct feedback from a large reader community . Letters to our alter - ego enterprise , Numerical Recipes Software , are in the thousands per year . ( Please , don’t telephone us . ) Our post ofﬁce box has become a magnet for letters pointing out that we have omitted some particular technique , well known to be important in a particular ﬁeld of science or engineering . We value such letters , and digest them carefully , especially when they point us to speciﬁc references in the literature . The inevitable result of this input is that this Second Edition of Numerical Recipes is substantially larger than its predecessor , in fact about 50 % larger both in words and number of included programs ( the latter now numbering well over 300 ) . “Don’t let the book grow in size , ” is the advice that we received from several wise colleagues . We have tried to follow the intended spirit of that advice , even as we violate the letter of it . We have not lengthened , or increased in difﬁculty , the book’s principal discussions of mainstream topics . Many new topics are presented at this same accessible level . Some topics , both from the earlier edition and new to this one , are now set in smaller type that labels them as being “advanced . ” The reader who ignores such advanced sections completely will not , we think , ﬁnd any lack of continuity in the shorter volume that results . Here are some highlights of the new material in this Second Edition : (cid:15) a new chapter on integral equations and inverse methods (cid:15) a detailed treatment of multigrid methods for solving elliptic partial differential equations (cid:15) routines for band diagonal linear systems (cid:15) improved routines for linear algebra on sparse matrices (cid:15) Cholesky and QR decomposition (cid:15) orthogonal polynomials and Gaussian quadratures for arbitrary weight functions (cid:15) methods for calculating numerical derivatives (cid:15) Pad´e approximants , and rational Chebyshev approximation (cid:15) Bessel functions , and modiﬁed Bessel functions , of fractional order ; and several other new special functions (cid:15) improved random number routines (cid:15) quasi - random sequences (cid:15) routines for adaptive and recursive Monte Carlo integration in high - dimensional spaces (cid:15) globally convergent methods for sets of nonlinear equations xi xii PrefacetotheSecondEdition W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . (cid:15) simulated annealing minimization for continuous control spaces (cid:15) fast Fourier transform ( FFT ) for real data in two and three dimensions (cid:15) fast Fourier transform ( FFT ) using external storage (cid:15) improved fast cosine transform routines (cid:15) wavelet transforms (cid:15) Fourier integrals with upper and lower limits (cid:15) spectral analysis on unevenly sampled data (cid:15) Savitzky - Golay smoothing ﬁlters (cid:15) ﬁtting straight line data with errors in both coordinates (cid:15) a two - dimensional Kolmogorov - Smirnoff test (cid:15) the statistical bootstrap method (cid:15) embedded Runge - Kutta - Fehlberg methods for differential equations (cid:15) high - order methods for stiff differential equations (cid:15) a new chapter on “less - numerical” algorithms , including Huffman and arithmetic coding , arbitrary precision arithmetic , and several other topics . Consult the Preface to the First Edition , following , or the Table of Contents , for a list of the more “basic” subjects treated . Acknowledgments It is not possible for us to list by name here all the readers who have made useful suggestions ; we are grateful for these . In the text , we attempt to give speciﬁc attribution for ideas that appear to be original , and not known in the literature . We apologize in advance for any omissions . Some readers and colleagues have been particularly generous in providing us with ideas , comments , suggestions , and programs for this Second Edition . We especially want to thank George Rybicki , Philip Pinto , Peter Lepage , Robert Lupton , Douglas Eardley , Ramesh Narayan , David Spergel , Alan Oppenheim , Sallie Baliunas , Scott Tremaine , Glennys Farrar , Steven Block , John Peacock , Thomas Loredo , Matthew Choptuik , Gregory Cook , L . Samuel Finn , P . Deuﬂhard , Harold Lewis , Peter Weinberger , David Syer , Richard Ferch , Steven Ebstein , Bradley Keister , and William Gould . We have been helped by Nancy Lee Snyder’s mastery of a complicated TEX manuscript . We express appreciation to our editors Lauren Cowles and Alan Harvey at Cambridge University Press , and to our production editor Russell Hahn . We remain , of course , grateful to the individuals acknowledged in the Preface to the First Edition . Special acknowledgment is due to programming consultant Seth Finkelstein , who wrote , rewrote , or inﬂuenced many of the routines in this book , as well as in its FORTRAN - language twin and the companion Example books . Our project has beneﬁted enormously from Seth’s talent for detecting , and followingthe trail of , even very slight anomalies ( often compiler bugs , but occasionally our errors ) , and from his good programming sense . To the extent that this edition of Numerical Recipes in C has a more graceful and “C - like” programming style than its predecessor , most of the credit goes to Seth . ( Of course , we accept the blame for the FORTRANish lapses that still remain . ) We prepared this book for publication on DEC and Sun workstations run - ning the UNIX operating system , and on a 486 / 33 PC compatible running MS - DOS 5 . 0 / Windows 3 . 0 . ( See x 1 . 0 for a list of additional computers used in PrefacetotheSecondEdition xiii W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . program tests . ) We enthusiastically recommend the principal software used : GNU Emacs , TEX , Perl , Adobe Illustrator , and PostScript . Also used were a variety of C compilers – too numerous ( and sometimes too buggy ) for individual acknowledg - ment . It is a sobering fact that our standard test suite ( exercising all the routines in this book ) has uncovered compiler bugs in many of the compilers tried . When possible , we work with developers to see that such bugs get ﬁxed ; we encourage interested compiler developers to contact us about such arrangements . WHP and SAT acknowledge the continued support of the U . S . National Science Foundation for their research on computational methods . D . A . R . P . A . support is acknowledged for x 13 . 10 on wavelets . June , 1992 William H . Press Saul A . Teukolsky William T . Vetterling Brian P . Flannery W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i ng t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . Preface to the First Edition We call this book Numerical Recipes for several reasons . In one sense , this book is indeed a “cookbook” on numerical computation . However there is an important distinction between a cookbook and a restaurant menu . The latter presents choices among complete dishes in each of which the individual ﬂavors are blended and disguised . The former — and this book — reveals the individual ingredients and explains how they are prepared and combined . Another purpose of the title is to connote an eclectic mixture of presentational techniques . This book is unique , we think , in offering , for each topic considered , a certain amount of general discussion , a certain amount of analytical mathematics , a certain amount of discussion of algorithmics , and ( most important ) actual imple - mentations of these ideas in the form of working computer routines . Our task has been to ﬁnd the right balance among these ingredients for each topic . You will ﬁnd that for some topics we have tilted quite far to the analytic side ; this where we have felt there to be gaps in the “standard” mathematical training . For other topics , where the mathematical prerequisites are universally held , we have tilted towards more in - depth discussion of the nature of the computational algorithms , or towards practical questions of implementation . We admit , therefore , to some unevenness in the “level” of this book . About half of it is suitable for an advanced undergraduate course on numerical computation for science or engineering majors . The other half ranges from the level of a graduate course to that of a professional reference . Most cookbooks have , after all , recipes at varying levels of complexity . An attractive feature of this approach , we think , is that the reader can use the book at increasing levels of sophisticationas his / her experience grows . Even inexperienced readers should be able to use our most advanced routines as black boxes . Having done so , we hope that these readers will subsequently go back and learn what secrets are inside . If there is a single dominant theme in this book , it is that practical methods of numerical computation can be simultaneously efﬁcient , clever , and — important — clear . The alternative viewpoint , that efﬁcient computational methods must necessarily be so arcane and complex as to be useful only in “black box” form , we ﬁrmly reject . Our purpose in this book is thus to open up a large number of computational black boxes to your scrutiny . We want to teach you to take apart these black boxes and to put them back together again , modifying them to suit your speciﬁc needs . We assume that you are mathematically literate , i . e . , that you have the normal mathematical preparation associated with an undergraduate degree in a physical science , or engineering , or economics , or a quantitative social science . We assume that you know how to program a computer . We do not assume that you have any prior formal knowledge of numerical analysis or numerical methods . The scope of Numerical Recipes is supposed to be “everything up to , but not including , partial differential equations . ” We honor this in the breach : First , we do have one introductory chapter on methods for partial differential equations ( Chapter 19 ) . Second , we obviouslycannot include everything else . All the so - called “standard” topics of a numerical analysis course have been included in this book : xiv PrefacetotheFirstEdition xv W o r l d W i de W eb s a m p l e page f r o m NU M E R I C A L R E C I PES I N C : T H E A R T O F S C I E N T I F I C C O M P U T I N G ( I SB N 0 - 521 - 43108 - 5 ) C op y r i gh t ( C ) 1988 - 1992 b y C a m b r i dge U n i v e r s i t y P r e ss . (cid:10) P r og r a m s C op y r i gh t ( C ) 1988 - 1992 b y N u m e r i c a l R e c i pe s S o ft w a r e . P e r m i ss i on i s g r an t ed f o r u s e r s o f t he W o r l d W i de W eb t o m a k e one pape r c op y f o r t he i r o w n pe r s ona l u s e . F u r t he r r ep r odu c t i on , o r an y c op y i ng o f m a c h i ne - r eadab l e f il e s ( i n c l ud i n g t h i s one ) t o an y (cid:10) s e r v e r c o m pu t e r , i s s t r i c t l y p r oh i b i t ed . T o o r de r N u m e r i c a l R e c i pe s (cid:10) boo ks and d i sk e tt e s , go t o h tt p : / / w o r l d . s t d . c o m / ~ n r o r c a ll 1 - 800 - 872 - 7423 ( N o r t h A m e r i c a on l y ) , (cid:10) o r s end e m a il t o t r ade @ c up . c a m . a c . u k ( ou t s i de N o r t h A m e r i c a ) . linear equations ( Chapter 2 ) , interpolation and extrapolation ( Chaper 3 ) , integration ( Chaper 4 ) , nonlinear root - ﬁnding ( Chapter 9 ) , eigensystems ( Chapter 11 ) , and ordinary differential equations ( Chapter 16 ) . Most of these topics have been taken beyond their standard treatments into some advanced material which we have felt to be particularly important or useful . Some other subjects that we cover in detail are not usually found in the standard numerical analysis texts . These include the evaluation of functions and of particular special functions of higher mathematics ( Chapters 5 and 6 ) ; random numbers and Monte Carlo methods ( Chapter 7 ) ; sorting ( Chapter 8 ) ; optimization , including multidimensional methods ( Chapter 10 ) ; Fourier transform methods , including FFT methods and other spectral methods ( Chapters 12 and 13 ) ; two chapters on the statistical description and modeling of data ( Chapters 14 and 15 ) ; and two - point boundary value problems , both shooting and relaxation methods ( Chapter 17 ) . The programs in this book are included in ANSI - standard C . Versions of the book in FORTRAN , Pascal , and BASIC are available separately . We have more to say about the C language , and the computational environment assumed by our routines , in x 1 . 1 ( Introduction ) . Acknowledgments Many colleagues have been generous in giving us the beneﬁt of their numerical and computational experience , in providing us with programs , in commenting on the manuscript , or in general encouragement . We particularly wish to thank George Rybicki , Douglas Eardley , Philip Marcus , Stuart Shapiro , Paul Horowitz , Bruce Musicus , Irwin Shapiro , Stephen Wolfram , Henry Abarbanel , Larry Smarr , Richard Muller , John Bahcall , and A . G . W . Cameron . We also wish to acknowledge two individuals whom we have never met : Forman Acton , whose 1970 textbook Numerical Methods that Work ( New York : Harper and Row ) has surely left its stylistic mark on us ; and Donald Knuth , both for his series of books on The Art of Computer Programming ( Reading , MA : Addison - Wesley ) , and for TEX , the computer typesetting language which immensely aided production of this book . Research by the authors on computational methods was supported in part by the U . S . National Science Foundation . October , 1985 William H . Press Brian P . Flannery Saul A . Teukolsky William T . Vetterling