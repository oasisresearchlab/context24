Probabilistic principal component analysis with expectation maximization ( PPCA - EM ) facilitates volume classiﬁcation and estimates the missing data Lingbo Yu a , b , Robert R . Snapp b , Teresa Ruiz a , Michael Radermacher a , b , * a University of Vermont , Department of Molecular Physiology and Biophysics , Burlington , VT 05405 , USA b University of Vermont , Department of Computer Science , Burlington , VT 05405 , USA a r t i c l e i n f o Article history : Received 3 December 2009 Received in revised form 2 April 2010 Accepted 6 April 2010 Available online 10 April 2010 Keywords : Image processing Electron microscopy Single particle reconstruction Missing cone / missing wedge Multivariate statistical analysis Principal component analysis Expectation maximization a b s t r a c t We have developed a new method for classifying 3D reconstructions with missing data obtained by elec - tron microscopy techniques . The method is based on principal component analysis ( PCA ) combined with expectation maximization . The missing data , together with the principal components , are treated as hid - den variables that are estimated by maximizing a likelihood function . PCA in 3D is similar to PCA for 2D image analysis . A lower dimensional subspace of signiﬁcant features is selected , into which the data are projected , and if desired , subsequently classiﬁed . In addition , our new algorithm estimates the missing data for each individual volume within the lower dimensional subspace . Application to both a large model data set and cryo - electron microscopy experimental data demonstrates the good performance of the algorithm and illustrates its potential for studying macromolecular assemblies with continuous conformational variations . (cid:2) 2010 Elsevier Inc . All rights reserved . 1 . Introduction Electron tomography can be used to determine the 3D struc - tures of individual subcellular components and to reconstruct complete specimen areas containing many macromolecules ( Hop - pe et al . , 1968 , 1976a , b , c ) . While the technique is ideally suited for the analysis of heterogeneous samples , the low signal - to - noise ra - tio found in electron tomographic reconstructions of individual ob - jects limits its efﬁcacy . Averaging techniques have been extensively used for more than four decades to increase the signal - to - noise ratio for 2D image analysis ( Markham et al . , 1963 , 1964 ; Saxton and Frank , 1977 ; Frank et al . , 1978 ) . Major progress was achieved through the intro - duction of correspondence analysis with associated classiﬁcation tools ( Bretaudiere et al . , 1981 ; van Heel and Frank , 1981 ; Frank and van Heel , 1982 ; Bretaudiere and Frank , 1986 ) . This enabled the objective classiﬁcation of the data into sets of images showing identical particles before averaging , which results in average images with substantially higher resolution and increased signal - to - noise ratio . Several single particle 3D reconstruction methods incorporate some form of 2D averaging techniques in their algorithms , which results implicitly in 3D averaging . The ﬁrst method developed was the random conical reconstruction technique , in which one micrograph at high specimen tilt , showing many single particles , is recorded , followed by a second micrograph of the same speci - men area without tilt ( Radermacher et al . , 1986 , 1987 ; Radermach - er , 1988 ) . The images extracted from the 0 (cid:3) - micrograph are used for alignment and classiﬁcation of the particles , and reconstruc - tions are calculated from the corresponding tilt images . The orthogonal tilt reconstruction technique is based on a similar prin - ciple . Images are collected at ±45 (cid:3) and one of the tilts is used for alignment and classiﬁcation , and the other for computing the 3D reconstructions ( Leschziner and Nogales , 2006 ) . An alternative method used for single particle reconstruction is angular reconsti - tution ( van Heel , 1987 ) where the reconstruction is calculated en - tirely from micrographs without tilt and the orientation of the particles is calculated by common line methods ( Crowther et al . , 1970 ) . Most 3D averaging methods , with either explicit or implicit averaging , work reliably when applied to sets of identical aligned particles . If multiple copies of identical objects are present in a tomogram , averaging of subtomograms can increase the signal - to - noise ratio of the ﬁnal 3D structures ( Knauer et al . , 1983 ; Oettl et al . , 1983 ; Grünewald et al . , 2003 ; Förster and Hegerl , 2007 ) . When data are heterogeneous , a classiﬁcation step is necessary 1047 - 8477 / $ - see front matter (cid:2) 2010 Elsevier Inc . All rights reserved . doi : 10 . 1016 / j . jsb . 2010 . 04 . 002 * Corresponding author at : University of Vermont , Department of Molecular Physiology and Biophysics , HSRF120 / 149 Beaumont Ave . , Burlington , VT 05405 , USA . Fax : + 1 802 656 0747 . E - mail addresses : mraderma @ uvm . edu , Michael . Radermacher @ uvm . edu ( M . Radermacher ) . Journal of Structural Biology 171 ( 2010 ) 18 – 30 Contents lists available at ScienceDirect Journal of Structural Biology journal homepage : www . elsevier . com / locate / yjsbi before averaging . For tomographic data , the classiﬁcation can only be applied to 3D volumes or subvolumes . On the other hand , the random conical reconstruction technique allows for a classiﬁcation into sets of particles with identical conformation and orientation by applying one of the many methods developed for 2D classiﬁca - tion and averaging to the 0 (cid:3) - images . The classiﬁcation results are imposed onto the tilt images , and then reconstructions are calcu - lated separately for each class . While heterogeneous particles are separated in the resulting 3D reconstructions , identical particles in different orientations are also separated into different classes . Identical 3D structures ( originally in different orientations ) can be aligned and averaged . However , even after 3D alignment of vol - umes calculated using any 3D electron microscopy technique , vi - sual classiﬁcation can be inaccurate . Missing data can result in structural distortions that might lead to misclassiﬁcations ( Fig . 1 ) . Thus , mathematical methods that can classify volumes irrespective of missing data need to be employed . 3D classiﬁcation of volumes with missing data has been used for more than a decade ( Walz et al . , 1997 ; Winkler and Taylor , 1999 ; Winkler , 2007 ) . Only recently have these methods been ex - tended to classify volumes with missing data in different orienta - tions ( Bartesaghi et al . , 2008 ; Förster et al . , 2008 ; Scheres et al . , 2009 ) . The core of the classiﬁcation scheme in Bartesaghi et al . ( 2008 ) is a hierarchical ascendant classiﬁcation based on pairwise distances between volumes . The calculation of the distances is re - stricted to the Fourier areas common to each pair of volumes , which minimizes the inﬂuence of the missing data . An algorithm based on principal component analysis , presented later , elimi - nates the inﬂuence of the missing data by excluding it from the calculation of the cross - correlation matrix ( Förster et al . , 2008 ) . Here , the correlation coefﬁcients are renormalized depending on the amount of overlapping data in each pair of volumes . Both algorithms allow for the recovery of missing data by calculating 3D class averages provided that the data exist in at least one class member . We present here a robust feature extraction method for the application to 3D reconstructions with missing data , PPCA - EM , based on Probabilistic Principal Component Analysis using Expec - tation Maximization ( Roweis , 1998 ; Tipping and Bishop , 1999 ; Yu et al . , 2008 ) . The algorithm extracts the main features of the structure independently of the existence and speciﬁc geometry of the missing data as it estimates the latter for each individual vol - ume . In the end , the algorithm represents the data set in a lower dimensional subspace . Once the dimensionality has been reduced , the data can be classiﬁed by any standard algorithm , including Di - day’s method of moving centers ( Diday , 1971 ) , k - means ( Mac - Queen , 1967 ) , fuzzy c - means ( Dunn , 1973 ; Bezdek , 1981 ; Carazo et al . , 1990 ) and hierarchical ascendant classiﬁcation ( Johnson , 1967 ) . PPCA - EM has two major advantages over earlier approaches . First , the algorithm ﬁnds an approximate principal subspace and the approximate principal component projections regardless of the missing data . Second , the algorithm estimates the missing data for each individual volume . Therefore , the missing data can be esti - mated even if a data set exhibits only continuous variations with - out relying on class averages . Fig . 1 . Reconstructions from complete and incomplete sets of noise - free projections of complex I from Y . lipolytica forming a single - axis tilt series around the y - axis ; volume size 64 (cid:2) 64 (cid:2) 64 voxels ; voxel size 9 Å ; low - pass ﬁltered to 36 Å . ( a ) Reconstruction from a complete set . ( b – e ) Reconstructions with 30 % missing data using four different subsets of projections . ( f – j ) Power spectra of the central slices of the Fourier transforms of ( a – e ) , respectively . ( k ) Five consecutive x – z slices around the center of the complete reconstructionin ( a ) . ( l ) Five consecutive x – z slices around thecenter of thereconstruction withmissing data in ( b ) . Clearlyvisible are theartifacts caused bythe missingdata . Scale bar 100 Å . L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 19 2 . Background Principal component analysis ( PCA ) is a multivariate statistical technique that reduces the dimensionality of the data while main - taining the maximum variance . Let the observation vector t 2 R d represent a 2D image or a 3D volume , rearranged as a one - dimen - sional vector so that each component in t corresponds to a pixel or voxel , with d being the number of pixels or voxels . In a set of well aligned images , the components of t vary when the represented structures vary or when noise corrupts the data . A set of n observation vectors , f t i ; i ¼ 1 ; 2 ; . . . ; n g , forms a scat - tered cloud in a d - dimensional space . PCA searches for the direc - tions with the highest variance , ( e . g . , Lebart , 1984 ) . The classical method to derive the principal components is eigendecomposition ( Pearson , 1901 ) or singular value decomposition ( Golub and van Loan , 1996 ) of the covariance matrix of the data . The covariance matrix is deﬁned as R ¼ E ½ð t (cid:3) l Þð t (cid:3) l Þ T (cid:4) 2 R d (cid:2) d , where E denotes the expectation with respect to the proba - bility distribution of t ; the superscript ‘‘T” , the transpose operator ; and l ¼ E ½ t (cid:4) 2 R d , the mean of t . In practice , the covariance ma - trix is estimated using the scatter matrix , S ¼ P ni ¼ 1 ð t i (cid:3) ^ l Þð t i (cid:3) ^ l Þ T = n , where the sample mean , ^ l ¼ P ni ¼ 1 t i = n is an estimation of the true mean . By deﬁnition , the eigenvectors x j 2 R d and the eigenvalues k j 2 R of the scatter matrix satisfy S x j ¼ k j x j ; j ¼ 1 ; 2 ; . . . ; q 0 ; where q 0 is the rank of S and q 0 6 min ð d ; n Þ . The values of k j describe the variance of the observations in the direction of the correspond - ing eigenvectors x j and are arranged in descending order , k 1 P k 2 P . . . k q 0 P 0 . Thus the corresponding eigenvectors , x 1 ; x 2 ; . . . ; x q 0 , are sorted in descending order of signiﬁcance . Each eigenvector is normalized so that x T i x j ¼ d ij , where d ij is the Kronecker delta ( which is 1 for i = j and 0 otherwise ) . The original observations t i can be projected into the subspace deﬁned by the q most signiﬁcant eigenvectors x j ; j ¼ 1 ; 2 ; . . . ; q ( where q 6 q 0 ) : x i ¼ ð x 1 ; x 2 ; . . . ; x q Þ T ð t i (cid:3) l Þ 2 R q The x i approximately represent the t i in a q - dimensional space while retaining the variance of the data set as much as possible . The relationships between x i and t i can be formulated in a linear form , t i ¼ Wx i þ l þ e i ; ð 1 Þ where W ¼ ð x 1 ; x 2 ; . . . ; x q Þ and the e i are the residuals : the dif - ference between the approximation and the observed data . Tipping and Bishop ( 1999 ) proposed a probabilistic model for the variables in Eq . ( 1 ) . In their model , the latent variables x i , are assumed to have a normal distribution , x i (cid:5) N ð 0 ; I Þ ; ð 2 Þ where I denotes the identity matrix . The residuals , e i , are assumed to be independent and normally distributed with a mean of zero and an isotropic variance of r 2 , e i (cid:5) N ð 0 ; r 2 I Þ : ð 3 Þ These probabilistic assumptions are consistent with other eigende - composition methods : PCA is a special case in the limit when r 2 ! 0 ( Roweis , 1998 ) . The introduction of a probabilistic model facilitates the use of the expectation maximization ( EM ) algorithm ( Dempster et al . , 1977 ) to estimate the latent variables . We ﬁrst present the PPCA - EM algorithm for complete data sets . This framework was estab - lished by Tipping and Bishop ( 1999 ) using an iterated , two - step process . In the expectation ( E ) step , the hidden ( unknown ) variables are estimated from the observations and the current values of the parameters . Statistical moments of the latent variables , h x i i and h x i x T i i , are estimated using p ð x i j t i ; W ; r 2 Þ , the conditional proba - bility density of x i given the observations t i and the current values of W and r 2 , ( Little and Rubin , 1987 ) . Following the probability assumptions made in Eqs . ( 2 ) and ( 3 ) , one obtains , h x i i ¼ ð W T W þ r 2 I Þ (cid:3) 1 W T ð t i (cid:3) l Þ ; ð 4 Þ h x i x T i i ¼ r 2 ð W T W þ r 2 I Þ (cid:3) 1 þ h x i ih x i i T ; where the superscript ‘‘ (cid:3) 1” denotes matrix inversion . Eq . ( 4 ) is used to update the value of the x i . In the maximization ( M ) step , new estimates of the parameters , W and r 2 , are computed by maximizing the conditional expecta - tion of the log - likelihood , h ‘ i , with respect to the conditional prob - ability density of the unknown variables x i given the known variables t i ; p ð x i j t i ; W ; r 2 Þ . The log - likelihood is deﬁned in terms of the joint probability of the observed variables and the latent variables , ‘ ¼ X n i ¼ 1 ln p ð t i ; x i Þ ; ð 5 Þ where the joint probability density p ð t i ; x i Þ ¼ ð 2 pr 2 Þ (cid:3) d = 2 exp (cid:3)k t i (cid:3) Wx i (cid:3) l k 2 2 r 2 ( ) ð 2 p Þ (cid:3) q = 2 (cid:2) exp (cid:3)k x i k 2 2 ( ) can be computed from Eq . ( 1 ) combined with the probabilistic assumptions in Eqs . ( 2 ) and ( 3 ) . The conditional expectation of the log - likelihood ( Eq . ( 5 ) ) then becomes h ‘ i ¼ (cid:3) X n i ¼ 1 d 2 ln r 2 þ 1 2tr h x i x T i i (cid:2) (cid:3) þ 1 2 r 2 k t i (cid:3) l k 2 (cid:4) (cid:3) 1 r 2 h x i i T W T ð t i (cid:3) l Þ þ 1 2 r 2 tr W T W h x i x T i i (cid:5) (cid:6)(cid:7) : ð 6 Þ Maximizing the conditional expectation deﬁned in Eq . ( 6 ) with re - spect to W and r 2 yields a new estimate for W , W ¼ X n i ¼ 1 ð t i (cid:3) l Þh x i i T " # X n i ¼ 1 h x i x T i i " # (cid:3) 1 ð 7 Þ and using the above quantity , for r 2 , r 2 ¼ 1 nd X n i ¼ 1 k t i (cid:3) l k 2 (cid:3) 2 h x i i T W T ð t i (cid:3) l Þ þ tr ðh x i x T i i W T W Þ n o : ð 8 Þ In Eq . ( 7 ) , we assume min ð n ; d Þ P q so that the matrix inversion can be carried out . The E - step and M - step are iterated using the most recent esti - mates of h x i i and h x i x T i i ð for i ¼ 1 ; 2 ; . . . ; n Þ , and of W and r 2 until no major change occurs in the estimation . It has been shown ana - lytically that this procedure converges to the maximum - likelihood estimation ( Dempster et al . , 1977 ) . The limiting values of Eqs . ( 4 ) , ( 7 ) , and ( 8 ) correspond to the ﬁnal estimates of the latent variables x i which are the estimates of the q principal components of t i ; the matrix W which spans the estimated eigenspace ; and r 2 , the var - iance of the residuals . 20 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 3 . Methods 3 . 1 . PPCA - EM algorithm Probabilistic principal component analysis using expectation maximization ( PPCA - EM ) is readily adapted to observations with missing data ( Tipping and Bishop , 1999 ; Roweis , 1998 ) . We have extended the technique to encompass 3D reconstructions from electron micrographs with missing data , either originating from tomographic tilt series ( single - axis , dual - axis or conical ) , random conical tilting , or any other technique with incomplete angular coverage ( Yu et al . , 2008 ) . Different tilting schemes result in differ - ent geometries of missing data : single - axis tilting has a missing wedge ; dual - axis tilting has a missing pyramid ; while conical and random conical tilting have a missing cone that after angular reﬁnement may assume an irregular shape ( Radermacher , 1980 ; Radermacher and Hoppe , 1980 ) . However , the presence of the coef - ﬁcients in the Fourier transform of 3D reconstructions can be traced based on the projection - slice - theorem , which states that the 2D Fourier transform of a projection is a central section through the 3D Fourier transform of the object . This is most straightforward in a polar coordinate system , since each radial line is either completely determined or completely missing . Each radial line can easily be indexed , and therefore no special geometrical restrictions to the shape of the missing data need to be considered . Our 3D reconstruction algorithm using Radon transforms main - tains a counter of the actual number of radial lines averaged in each direction ( Radermacher , 1994 , 1997 ) . This counter is cur - rently used to properly calculate the average of each radial line in the reconstruction . We have further extended the PPCA - EM algorithm to complex space to facilitate the application to 3D reconstructions in different forms . Hence t i 2 C d , for all i ¼ 1 ; 2 ; . . . ; n . In addition , for each t i we can store the counter from the reconstruction algorithm in a vector q i 2 R d , where either q i ; j P 1 if t i , j is present ; or q i ; j ¼ 0 if t i , j is missing . These vectors can be used as an index for every com - ponent of t i , indicating the presence or absence of the component . In addition to its use as a Boolean indicator , in PPCA - EM , the value can be used for a more accurate calculation of the weighted mean in Eq . ( 11 ) . The PPCA - EM algorithm can be extended to incomplete data sets with the above information . The relationship between the observations t i and the latent variables x i in Eq . ( 1 ) then becomes t ð p Þ i t ð m Þ i ! ¼ W ð p Þ i W ð m Þ i ! x i þ l ð p Þ i l ð m Þ i ! þ e i ; ð 9 Þ where the indices of t i have been permutated so that t ð p Þ i 2 C d ð p Þ i de - notes the present data in the i th observation , and t ð m Þ i 2 C d ð m Þ i , the missing data , with d ð p Þ i þ d ð m Þ i ¼ d for all i ¼ 1 ; 2 ; . . . ; n . The super - script indicates either present ( p ) or missing ( m ) data . In general , each volume has different subsets of present and missing data , and consequently requires a different permutation of its indices . The j th component of t i is in t ð p Þ i if and only if q i ; j P 1 , otherwise it is in t ð m Þ i . Likewise , the transform matrix W separates by rows into two parts W ð p Þ i and W ð m Þ i , and the means l i into l ð p Þ i and l ð m Þ i for each volume , for i ¼ 1 ; 2 ; . . . ; n , in accordance with the above permutation . The model ( Eq . ( 9 ) ) is simpliﬁed by introducing the centered variable y i ¼ t i (cid:3) l , y ð p Þ i y ð m Þ i ! ¼ W ð p Þ i W ð m Þ i ! x i þ e i : ð 10 Þ Here , l is estimated using the sample mean ^ l properly weighted to account for the missing data . Each component ^ l j is calculated as ^ l j ¼ P ni ¼ 1 t i ; j q i ; j P ni ¼ 1 q i ; j : ð 11 Þ The missing components have 0 weights and do not contribute to the mean . Based on the probabilistic assumptions ( Eqs . ( 2 ) and ( 3 ) ) and the linearity of the Gaussian distribution , the model ( Eq . ( 10 ) ) yields the conditional probability density y i j x i (cid:5) N ð Wx i ; r 2 I Þ and the marginal probability density y i (cid:5) N ð 0 ; WW H þ r 2 I Þ . Here the superscript ‘‘H” denotes the Hermitian conjugate , which is the transpose of the complex conjugate , since the algorithm is valid for either real or complex data . The expectation maximization algorithm can be used to esti - mate the latent variables x i , the model parameter W and r 2 , and the missing data y ð m Þ i , which are treated as additional hidden vari - ables . Speciﬁcally , for each i ¼ 1 ; 2 ; . . . ; n , the values of x i and y ð m Þ i can be estimated by their statistical mean , h x i i and h y ð m Þ i i , taken with respect to the conditional probability density p x i ; y ð m Þ i j y ð p Þ i ; W ; r 2 (cid:5) (cid:6) . In this context , the iterative , two - step pro - cess described in Section 2 can be extended as follows . In the E - step , the ﬁrst - and second - order statistical moments of x i and y ð m Þ i are directly evaluated using p x i ; y ð m Þ i j y ð p Þ i ; W ; r 2 (cid:5) (cid:6) . Whence , for i ¼ 1 ; 2 ; . . . ; n , h x i i ¼ ð W ð p Þ H i W ð p Þ i þ r 2 I Þ (cid:3) 1 W ð p Þ H i y ð p Þ i ; ð 12 Þ h y ð m Þ i i ¼ W ð m Þ i ð W ð p Þ H i W ð p Þ i þ r 2 I Þ (cid:3) 1 W ð p Þ H i y ð p Þ i ¼ W ð m Þ i h x i i ; ð 13 Þ h x i x H i i ¼ r 2 ð W ð p Þ H i W ð p Þ i þ r 2 I Þ (cid:3) 1 þ h x i ih x i i H ; h y ð m Þ i y ð m Þ H i i ¼ r 2 ð I þ W ð m Þ i ð W ð p Þ H i W ð p Þ i þ r 2 I Þ (cid:3) 1 W ð m Þ H i Þ þ h y ð m Þ i ih y ð m Þ i i H ; h y ð m Þ i x H i i ¼ (cid:3) r 2 W ð m Þ i ð W ð p Þ H i W ð p Þ i þ r 2 I Þ (cid:3) 1 þ h y ð m Þ i ih x i i H : Note that these moments depend explicitly only upon the current values of W ð p Þ i ; W ð m Þ i ; r 2 and the present data y ð p Þ i . Instead of the en - tire volumes , only the present data y ð p Þ i are used to estimate the la - tent variables x i , which eliminates any artifacts caused by the missing data ( Eq . ( 12 ) ) . The missing data y ð m Þ i are estimated at the same time from the model given the value of the latent variables x i and the corresponding rows in the transform matrix W ð m Þ i ( Eq . ( 13 ) ) . In the M - step , the log - likelihood is again deﬁned by Eq . ( 5 ) , and the conditional expectation of the log - likelihood with respect to p ð x i ; y ð m Þ i j y ð p Þ i ; W ; r 2 Þ is h ‘ i ¼ (cid:3) X n i ¼ 1 d 2 ln r 2 þ 1 2tr h x i x H i i (cid:2) (cid:3) þ 1 2 r 2 y ð p Þ H i y ð p Þ i (cid:4) (cid:3) 1 r 2 h x i i H W ð p Þ H i y ð p Þ i (cid:3) 1 r 2 tr W ð m Þ H i h y ð m Þ i x H i i (cid:5) (cid:6) þ 1 2 r 2 tr W H W h x i x H i i (cid:5) (cid:6) þ 1 2 r 2 tr h y ð m Þ i y ð m Þ H i i (cid:5) (cid:6)(cid:7) : Maximizing h ‘ i with respect to each element w jk of W yields two different solutions depending if w jk belongs to W ð p Þ i or W ð m Þ i , which usually differs for each i ¼ 1 ; 2 ; . . . ; n . We create a set of composite matrices , G i 2 C d (cid:2) q for each i ¼ 1 ; 2 ; . . . ; n . Each ele - ment g i ; jk of G i is either an element of y ð p Þ i h x i i H 2 C d ð p Þ i (cid:2) q if the j th component of the i th observation is present , or an element of h y ð m Þ i x H i i 2 C d ð m Þ i (cid:2) q if the j th component of the i th observation is missing . Hence , g i ; jk ¼ y ð p Þ i ; j 0 h x i i C k ; if q i ; j P 1 ; h y ð m Þ i x H i i j 00 k ; if q i ; j ¼ 0 ; 8 < : ð 14 Þ where the superscript ‘‘C” denotes the complex conjugate . Here , j 0 is the index in y ð p Þ i that corresponds to the j th component of y i and j 00 is the index in y ð m Þ i that corresponds to the j th component of y i . The indices j 0 and j 00 can be obtained using the same permutations as L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 21 in Eq . ( 9 ) . Introducing G i enables a concise formulation for the new estimate of W , W ¼ X n i ¼ 1 G i " # X n i ¼ 1 h x i x H i i " # (cid:3) 1 : ð 15 Þ Under the assumption that r 2 ! 0 , Eqs . ( 12 ) and ( 13 ) in the E - step simplify to h x i i ¼ ð W ð p Þ H i W ð p Þ i Þ (cid:3) 1 W ð p Þ H i y ð p Þ i ; ð 16 Þ h y ð m Þ i i ¼ W ð m Þ i ð W ð p Þ H i W ð p Þ i Þ (cid:3) 1 W ð p Þ H i y ð p Þ i ¼ W ð m Þ i h x i i : ð 17 Þ Likewise , the new estimate of W ( Eq . ( 15 ) ) in the M - step simpliﬁes to W ¼ X n i ¼ 1 h y i ih x i i H " # X n i ¼ 1 h x i ih x i i H " # (cid:3) 1 ; ð 18 Þ where h y i i is constructed similarly as G i ( Eq . ( 14 ) ) , h y i i j ¼ y ð p Þ i ; j 0 ; if q i ; j P 1 ; h y ð m Þ i i j 00 ; if q i ; j ¼ 0 ; 8 < : ð 19 Þ where j 0 and j 00 are the same as in Eq . ( 14 ) . Note that during the E - step , the most recent estimates of W are entered into the right - hand sides of Eqs . ( 16 ) and ( 17 ) . Likewise , during the M - step , the most re - cent estimates of h x i i and h y ð m Þ i i are entered into the right - hand side of Eq . ( 18 ) . Eqs . ( 16 ) – ( 18 ) are iterated until a predeﬁned convergence crite - rion is met or a maximum number of iterations is reached . As a convergence criterion we used the condition that the normalized change of the square error falls below a critical value . We deﬁned the square error in the k th iteration as e k ¼ P ni ¼ 1 kh y i i (cid:3) W h x i ik 2 , and the normalized change of the square error as D k ¼ ð e k (cid:3) 1 (cid:3) e k Þ = e k : ð 20 Þ The current version of the PPCA - EM algorithm was imple - mented in Python 2 . 5 , using the numpy package , a Python interface for the LAPACK subroutine library ( Numpy , 2009 ) . 3 . 2 . Performance measure Three statistical tests were carried out to investigate the perfor - mance of the PPCA - EM algorithm : First , Fisher’s Least Signiﬁcant Difference ( LSD ) test to measure the separation between known classes ; second , k - means to demonstrate how our algorithm facil - itates clustering or classiﬁcation ; and ﬁnally , discrepancy compar - isons to evaluate the estimation of the missing data . Fisher’s LSD test is a widely used statistical inference method to measure the separation between multiple classes , which is an extension of Student’s t - test to multiple classes , ( Ott and Long - necker , 2003 ) . Here we grouped the x i ’s , representing the volumes , according to the known classes , and measured the separation be - tween groups by calculating D ð i ; j Þ ¼ j (cid:2) x i (cid:3) (cid:2) x j j ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃP m k ¼ 1 P all l in class k k x l (cid:3) (cid:2) x k k 2 n (cid:3) m 1 n i þ 1 n j (cid:9) (cid:10) vuuut ; i ; j ¼ 1 ; 2 ; . . . m ; where m is the number of classes in the data set , n is the number of total volumes , n i is the number of members in i th class and (cid:2) x i is the mean of the i th class . The minimum LSD score , ^ D ¼ min i – j D ð i ; j Þ ; which indicates the least separation between two classes , was used as the performance score of the algorithm . The difference ^ D was compared to a critical value , D c , obtained from Student’s t - distribu - tion at a ¼ 0 : 005 , with n (cid:3) m degrees of freedom . The class separa - tion was considered successful when the difference between the class means was statistically signiﬁcant at a ¼ 0 : 005 , i . e . , ^ D > D c . For each experimental condition , the success rate was deﬁned as the ratio of the number of successful trials over the total number of trials , expressed as a percentage . The k - means algorithm , one of the widely used classiﬁcation / clustering algorithms , was used to demonstrate how our PPCA - EM algorithm facilitates classiﬁcation and clustering . PCA is typi - cally followed by a classiﬁcation algorithm applied to the represen - tation of the data in the principal component subspace . Likewise , classiﬁcation techniques can be applied to the results of PPCA - EM . The combination of the k - means algorithm and the known classes of the data set allows for easy identiﬁcation of any misclas - siﬁed reconstructions . A paucity of misclassiﬁed reconstructions provides an additional indicator of an appropriate extraction of the main features of the data . The accuracy of the estimation of the missing data was evalu - ated by calculating the normalized distance between the complete 3D Fourier volumes reconstructed from all projections and the vol - umes with the missing data estimated . As a distance measure we used the Fourier discrepancy , based on the real space discrepancy ( Herman et al . , 1973 ; Colsher , 1977 ) , d ¼ 1 n X n i ¼ 1 ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃP dj ¼ 1 ð ~ t i ; j (cid:3) t oi ; j Þ 2 P dj ¼ 1 ð t oi ; j (cid:3) (cid:2) t i Þ 2 vuut : ð 21 Þ Here , t oi ; j is the j th component of the i th complete volume , (cid:2) t i is the mean of the i th volume , and ~ t i ; j ¼ h y i i j þ ^ l j ( Eqs . ( 19 ) and ( 11 ) ) is the j th component of the i th volume with the missing data estimated . 4 . Test data 4 . 1 . Model data We applied the PPCA - EM algorithm to a synthetic problem based on a binary version of a 3D reconstruction of complex I from Yarrowia lipolytica ( Radermacher et al . , 2006 ; Clason et al . , 2007 ) . We chose a model derived from a 3D reconstruction of complex I with the motivation that the results obtained here may advance the understanding of the variations we observed earlier . Using a binary version of the structure ensured that the starting volume was complete and had no missing data . The test data set consisted of a set of 3D volumes containing four classes obtained by applying the skew transform x 0 y 0 z 0 0 B @ 1 CA ¼ 1 a b 0 1 c 0 0 1 0 B @ 1 CA x y z 0 B @ 1 CA ð 22 Þ to the binary volume . Here ( x , y , z ) denote the coordinates of the voxel in the original volume ; ð x 0 ; y 0 ; z 0 Þ , the coordinates of the voxel in the skewed volume ; and a , b , c , the parameters that deﬁne the skew operation . Speciﬁcally , we used a ¼ 0 ; b ¼ 0 ; c ¼ 0 for class 1 , a ¼ 0 : 25 ; b ¼ 0 : 1 ; c ¼ 0 : 1 for class 2 , a ¼ 0 : 1 ; b ¼ 0 : 25 ; c ¼ 0 : 1 for class 3 and a ¼ 0 : 1 ; b ¼ 0 : 1 ; c ¼ 0 : 25 for class 4 . These four structures were then resized to 64x64x64 voxels resulting in a voxel size of 9 Å ( Fig . 2 ) . Single - axis tilt projections were calculated with 2 (cid:3) angular interval and low - pass ﬁltered to 36 Å resolution . Gaussian noise was generated , low - pass ﬁltered to the same resolution as the sig - nal and added to every projection separately before calculating each of the reconstructions . The signal - to - noise ratio was mea - sured as the ratio between the standard deviation of the signal 22 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 and the standard deviation of the noise out to 36 Å resolution . From these projections , multiple 3D reconstructions with missing data were calculated using randomly selected subsets of the pro - jections . We used the 3D Radon inversion algorithm as the recon - struction algorithm ( Radermacher , 1994 , 1997 ) . The angular increments for the 3D Radon transforms were the same as for the single - axis tilt series . Therefore , the summation of the 2D Ra - don transforms of the projections into 3D Radon transforms corre - sponded to a simple stacking of each 2D transform into the corresponding angular slice of the 3D transform . No averaging oc - curred , and the signal - to - noise ratio in the 3D transforms is the same as the signal - to - noise ratio in the 2D Radon transform of the projections . 3D polar Fourier transforms were calculated by a 1D Fourier transform of each radial line in the 3D Radon transforms ( Deans , 1983 ) . One hundred experimental conditions were created by using all possible combinations of the following three parameters : signal - to - noise ratio ( 2 . 0 , 1 . 5 , 1 . 0 , and 0 . 5 at 36 Å resolution ; corresponding to 0 . 81 , 0 . 58 , 0 . 41 , and 0 . 19 at full resolution ( 18 Å ) , respectively ) ( see Supplementary Fig . S1 ) ; percentage of missing data ( 10 % , 15 % , 20 % , 25 % , and 30 % ) and total number of volumes in a data set ( 20 , 40 , 60 , 80 , and 100 ) , equally distributed over the four classes . Each combination was repeated 27 times varying the noise and the ran - dom selection of missing data . A total of 2700 data sets were cre - ated to test the algorithm . The algorithm was applied to the 3D polar Fourier transforms weighted with ﬃﬃﬃﬃ r (cid:6) p to partially compensate for the uneven sam - pling in polar coordinates . Working in Fourier space , we can easily restrict the resolution by limiting the radius of the Fourier trans - forms , which also reduces the dimensions of t i . When a discrete po - lar Fourier transform is applied using a 2 (cid:3) sampling interval , 267 , 300 Fourier components are needed to represent the structure to full resolution of 18 Å ( 32 Fourier pixels ) . The resolution limit of 36 Å ( 16 Fourier pixels ) reduces the dimensions of t i to 137 , 700 . The PPCA - EM algorithm was applied using a convergence crite - rion ( Eq . ( 20 ) ) of D k 6 10 (cid:3) 6 . For each data set , eight feature vectors x i ; i ¼ 1 ; . . . ; 8 ( Eq . ( 1 ) ) were determined together with the latent variables x i ( Eq . ( 10 ) ) which are the coordinates of the original vol - umes in the eight dimensional subspaces . The missing data in each volume were additionally estimated based on the eight feature vectors ( Eq . ( 17 ) ) . 4 . 2 . Experimental data The algorithm was applied to cryo - electron microscopy data of Saccharomyces cerevisiae phosphofructokinase ( PFK , EC 2 . 7 . 1 . 11 , 835 kDa , 21S ) . PFK is a glycolytic enzyme that catalyses the phos - phorylation of fructose - 6 - phosphate ( F6P ) in the presence of ATP and its activity is tightly regulated by many allosteric effectors ( Sols , 1981 ) . In the presence of 3 mM F6P the enzyme is in the ac - tive state , while in the presence of 1 mM ATP and 3 mM MgCl 2 the enzyme is in the inactive state . The octameric structure of S . cere - visiae PFK has been solved by a combination of Random Conical Tilt cryo - electron microscopy ( Ruiz et al . , 2001 ) and 3D reference based alignment of cryo - electron microscopy images without tilt in both states to better than 13 Å resolution ( Ruiz et al . , 2003 ; Barc - ena et al . , 2007 ) . The octameric enzyme in both states can be described as a di - mer of tetramers , a top tetramer and a bottom tetramer . The F6P and the ATP states differ mainly in the rotation angle between the top and the bottom tetramers ( 75 (cid:3) rotation for PFK in the F6P - state and 46 (cid:3) rotation for PFK in the ATP - state ) . These differ - ences , easily visualized in 3D ( Fig . 3e – h ) , can only be observed in very speciﬁc 2D projections ( Fig . 3a – d ) . In addition , even though each of the two tetramers in a given state contains 2 a and 2 b sub - units , the tetramers do not possess identical conformations . Pseu - do - symmetric PFK structures can be obtained by applying a rotation of 180 (cid:3) around the short axis of the molecule followed by a 75 (cid:3) rotation for the F6P - state or followed by a 46 (cid:3) rotation for the ATP - state . These symmetry operations bring the bottom tetramers to the positions previously occupied by the top tetra - mers . Both , ATP and F6P induce different structural changes to Fig . 2 . The four starting models derived from a binary volume of complex I from Y . lipolytica , calculated by shearing using Eq . ( 22 ) , low - pass ﬁltered to 36 Å . ( a ) Original volume a ¼ 0 ; b ¼ 0 ; c ¼ 0 ( class 1 ) . ( b ) Volume sheared by a ¼ 0 : 25 ; b ¼ 0 : 1 ; c ¼ 0 : 1 ( class 2 ) . ( c ) Volume sheared by a ¼ 0 : 1 ; b ¼ 0 : 25 ; c ¼ 0 : 1 ( class 3 ) . ( d ) Volume sheared by a ¼ 0 : 1 ; b ¼ 0 : 1 ; c ¼ 0 : 25 ( class 4 ) . The symbols ( j , d , (cid:6) , N ) areused to identifytheclasses insubsequentFigs . 6and 7 . Eventhough theparameters have thesame values in three of the transformations , the visibility of the differences changes depending on the viewing direction . A skew along either the x - axis or the y - axis is more obvious , since we are viewing along the z - direction . Scale bar 100 Å . L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 23 the top and bottom tetramers in the octamer thus introducing a slight asymmetry that is not visible in 2D projections of the en - zyme and it is barely recognizable in 3D structures . The variations observed are mainly concentrated on the catalytic surface deﬁned by the N - terminal domains of the a and b subunits , which exhibit different small relative shifts . These differences have been hypoth - esized as being part of the functional mechanism of PFK ( Barcena et al . , 2007 ) . The cryo - electron microscopy data set of the F6P - bound state contained 16 , 700 aligned projections extracted from 0 (cid:3) - micro - graphs and the cryo - electron microscopy data set of the ATP - bound state contained 14 , 500 aligned projections extracted from 0 (cid:3) - micrographs . Since PFK is an elongated molecule , the projec - tions show PFK mainly rotating around its long axis . Thus , the data sets represent approximately a single - axis tilt series with random tilt angles . For this analysis the projections were interpolated down to a pixel size of 7 . 2 Å . We have used the projections of PFK in the F6P and ATP states with the angular parameters obtained in the original reconstruction , which gives two states showing large con - formational changes . By rotating the projections using the symme - try operations described above ( 180 / 75 for the F6P - state and 180 / 46 for the ATP - state ) , we were able to calculate PFK volumes in pseudo - symmetric states , in order to test the performance of the algorithm for detecting small conformational changes . Twenty - ﬁve different subsets of only 100 randomly selected projections were used to calculate 25 reconstructions for each state . In addition to the missing data occuring in each reconstruction , randomly se - lected angular sections were removed from the 3D Radon / Fourier transforms , to insure that the volumes had at least 40 % missing data in random directions . All reconstructions were aligned to each other prior to any multivariate statistical analysis . The resulting data set contained 100 volumes , each recon - structed from 100 projections of vitriﬁed PFK and exhibiting at least 40 % missing data in their Fourier transforms . Test calculations were carried out in the same order as for the model data : standard PCA applied to the data - set set without missing data . Standard PCA and PCA - EM to the data set with missing data . 5 . Results and discussion The PPCA - EM algorithm was applied to all 2700 model data sets . The results were calculated from the 27 experiments created for each of the 100 conditions deﬁned by the multiple combination of SNR , percentage of missing data and number of volumes ( Fig . 4 ) . A comparison of all the experiments shows the inﬂuence of the different parameters on the performance of the algorithm , mea - sured by the minimum LSD scores ( Fig . 4a – d ) . And the success rates at different SNR are shown in Fig . 4e – h . For example , at a SNR of 0 . 5 , with 30 % percent missing data , and a data set of only 20 volumes , there was no single success in all 27 experiments ( Fig . 4e ) . On the contrary , at a SNR of 2 . 0 , with 10 % percent data missing , and a data set of 100 volumes all 27 trials were successful ( Fig . 4h ) . Some rare success experiments were observed during the extensive testing of the algorithm . For instance , there was one suc - cessful experiment at SNR 1 . 0 , with 20 % missing data , and a data set of only 20 volumes ( Fig . 4f ) . Close analysis of this data set showed that the area of missing data in this set of volumes had a substantial overlap , thus minimizing the inﬂuence of the missing data on the separation between classes . The statistical nature of the experiments causes other ﬂuctuations visible in both SNR = 1 . 5 and SNR = 2 . 0 cases ( Fig . 4g and h ) . An increase in perfor - mance is observed when the missing data increases from 25 % to 30 % in the cases of 20 , 40 , and 60 volumes , but not in the cases of 80 and 100 volumes . These are common statistical ﬂuctuations that occur when only few data points are sampled ( here less than 60 ) and that disappear when the number of samples increases . Based on the test calculations , the minimum conditions re - quired to obtain a certain reliability of the results can be estimated . A success rate above 70 % can be observed for a SNR of 1 if the num - ber of volumes is larger than 40 and the missing data are less than 25 % ( Fig . 4f ) . For a data set of 60 or more volumes , the success rate at a SNR of 1 was always above 70 % for all percentages of missing data tested ( Fig . 4f ) . When the data set contained 100 volumes , a 70 % success rate was achieved for all modeled conditions , includ - ing those with a SNR of 0 . 5 . The three parameters that affect the results of PPCA - EM can be adjusted in various ways to improve the conditions for applying the algorithm . An increase in success rate can be achieved by increasing the number of volumes , by decreasing the percentage of the missing data , or by increasing the SNR for a given data set . The best method to improve the performance of the algorithm de - pends on the microscopy technique used for data collection . When electron tomography is used as the reconstruction technique , an increase in the number of volumes can be easily achieved by col - lecting an additional tomography series , which usually contains a large number of subtomograms of the macromolecular structure of interest . In addition , the amount of missing data can be reduced by tilting to a higher angle , by collecting double - tilt series , or by using the conical tilt geometry ( Radermacher , 1980 ; Radermacher and Hoppe , 1980 ) , see Fig . 5 and Table 1 . Reconstructions from sin - Fig . 3 . Experimental data of PFK in different states . ( a – d ) sample cryo - electron microscopy images each used to reconstruct the structures below in ( e – h ) , respectively . ( e ) PFK in presence of F6P , where the bottom tetramer is in the F6P - bound state . ( f ) PFK in presence of ATP , where the bottom tetramer is in the ATP - bound state . ( g ) PFK in presence of F6P , where the top tetramer is in the F6P - bound state . ( h ) PFK in presence of ATP , where the top tetramer is in the ATP - bound state . The symbols ( (cid:2) , d , N , j ) are used to identify the classes in subsequent Fig . 9 . Scale bar 100 Å . 24 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 gle - axis tilt series with ±60 (cid:3) angular range have 33 . 3 % missing data . The performance of the PPCA - EM algorithm when applied to this data set can be approximately evaluated based on our tests under the condition of 30 % missing data . A dual - axis tilt series also with ±60 (cid:3) angular range dramatically decreases the amounts of missing data to 16 % , and our tests with 15 % missing data provide a good reference for this condition . If the SNR is the limitation , it may be possible to increase the SNR by lowering the resolution while preserving sufﬁcient detail for structural differentiation . When the random conical reconstruction technique is used , the easiest parameter to optimize is the SNR of the reconstructed vol - umes by collecting additional tilt pairs . Often the percentage of missing data can be reduced simply by using a higher tilt angle ( Fig . 5 and Table 1 ) . A large reduction in the percentage of missing Fig . 4 . Results of the2700 tests for 100 different combinationsof the three parameters : signal - to - noise ratio , percentageof missing data , numberof volumes ina data set . Left column ( a – d ) : Each bar represents the mean of the 27 minimum LSD scores for each condition . Test combinations of missing data and number of volumes are represented in graphs for the different SNR used . Error bars show standard deviations . Right column ( e – h ) : Each bar represents the success rates of the 27 experiments for each condition at different SNR . L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 25 data from 13 . 4 % to 6 . 0 % is achieved by increasing the tilt angle from 60 (cid:3) to 70 (cid:3) , which can be easily reached with modern speci - men holders . The performance of the algorithm is illustrated in more detail for one of the data sets containing 100 volumes with a SNR of 0 . 5 and 30 % missing data ( Figs . 6 – 8 ) 1 . Plots of the data in the sub - space deﬁned by the ﬁrst three principal components are shown in Fig . 6 , in which symbols of the same shape and color identify the synthetic original classes . The scatter plots are represented using only the real part of the principal components , which most clearly show the separation of the data . The results of standard PCA when no data are missing demonstrate that PCA is able to capture the main features of the structures and shows an obvious separation into four classes ( Fig . 6a ) . Fig . 6b shows the results of standard PCA when the missing data are replaced with 0 . The missing data dominate the analysis and no class separation can be detected . Even when eight principal components are visualized pairwise in all possible combi - nations , no class separation can be detected ( results not shown ) . When the PPCA - EM is applied to the same data set with missing data ( Fig . 6c ) , the correct clustering is achieved , however , the volumes belonging to classes 3 and 4 , localized at the two opposite ends of a single elongated cloud , are still loosely connected . Fig . 5 . Graph representing the percentage of missing data for different tilting geometries . The x - axis indicates the maximum tilt angle for single - axis and dual - axis tilting , or the ﬁxed tilt angle for conical tilting . Marked are the percentages of missing data for a tilt angle of 60 (cid:3) ( red dots ) and the tilt angles for 20 % missing data ( green stars ) for each different geometry . ( For interpretation of the references to color in this ﬁgure legend , the reader is referred to the web version of this article . ) Table 1 Tilt geometries and percentage of missing data . ( a ) The percentage of missing data for different tilt geometries and tilt angles . For conical / random conical ( RC ) the angular value represents the ﬁxed tilt angle . ( b ) The tilt angles for different tilt geometries and the percentage of missing data . Single - axis Dual - axis Conical / RC a ±30 (cid:3) 66 . 7 % 53 . 9 % 50 . 0 % ±45 (cid:3) 50 . 0 % 33 . 4 % 29 . 3 % ±60 (cid:3) 33 . 3 % 16 . 0 % 13 . 4 % ±70 (cid:3) 22 . 2 % 7 . 5 % 6 . 0 % ±80 (cid:3) 11 . 1 % 1 . 9 % 1 . 5 % b 10 % (cid:7) 81 (cid:3) (cid:7) 67 (cid:3) 64 (cid:3) 15 % (cid:7) 77 (cid:3) (cid:7) 61 (cid:3) 58 (cid:3) 20 % (cid:7) 72 (cid:3) (cid:7) 56 (cid:3) 53 (cid:3) 25 % (cid:7) 68 (cid:3) (cid:7) 52 (cid:3) 49 (cid:3) 30 % (cid:7) 63 (cid:3) (cid:7) 48 (cid:3) 44 (cid:3) Fig . 6 . Scatter plots of the real part of the ﬁrst three principal components , x 1 , x 2 , and x 3 , for a data set with 100 volumes and SNR of 0 . 5 . Symbols correspond to the true classes of each volume . ( a ) Data set with no missing data , standard PCA . The four classes are clearly separated . ( b ) 30 % missing data , standard PCA . The results are dominated by the missing data . ( c ) 30 % missing data , PPCA - EM . Classes 1 and 2 are well separated . Classes 3 and 4 are loosely connected but easily separable . 1 Convergence criterion D k 6 10 (cid:3) 6 , 158 iterations total 81 min ( 30 s per iteration ) run on a single processor of a Quad - Core AMD Opteron™ Processor 2356 . 26 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 When k - means clustering with k = 4 was applied ( Fig . 7 ) , using the same coordinates as in Fig . 6 , the majority of the volumes were classiﬁed correctly into the original classes . Only 3 volumes out of 100 were misclassiﬁed ( indicated by boxes in Fig . 7 ) . Note that no special attempt was made at this point to optimize the classiﬁca - tion algorithm . The PPCA - EM algorithm estimates not only the principal com - ponents but also the missing data for each single volume . The reconstructions with the estimated data ( Fig . 8i1 – l1 ) closely resemble the corresponding reconstructions without missing data ( Fig . 8a1 – d1 ) . When the power spectra of the corresponding vol - umes are compared ( Fig . 8i2 – l2 and a2 – d2 ) , the estimation appears better at lower resolution . However , a comparison of these power spectra with the power spectrum of a noise - free reconstruction ( e . g . , Fig . 1f ) shows that the higher resolution spectrum contains mostly noise . We compared three different methods for estimating the miss - ing data by calculating Fourier discrepancies ( Eq . ( 21 ) ) for the 100 volumes in the data set for each method ( Table 2 ) . The ﬁrst method substitutes the missing data with the weighted mean of the total data set ; the second method substitutes the missing data with the weighted mean of the class to which the volume belongs ; and the third method uses the estimate from the PPCA - EM algo - rithm . The overall weighted mean is the worst estimation of the Fig . 7 . Classiﬁcation results of the k - means algorithm applied to the results of PPCA - EM shown in Fig . 6c . Only three misclassiﬁcations occur , enclosed in boxes . Here , the symbols correspond to the classes identiﬁed by the k - means algorithm . Fig . 8 . Reconstructions of class 1 with complete , incomplete , and estimated data , SNR = 0 . 5 . ( a1 – d1 ) Four reconstructions without missing data , any differences are caused by variation in noise . ( a2 – d2 ) Power spectra of the central slices of the Fourier transforms of ( a1 – d1 ) , respectively . ( e1 – h1 ) Four reconstructions with 30 % missing data . ( e2 – h2 ) Power spectra of the central slices of the Fourier transforms of ( e1 – h1 ) , respectively . ( i1 – l1 ) Four reconstructions with estimated missing data from PPCA - EM . Each reconstruction closely resembles the corresponding complete reconstruction in ( a1 – d1 ) . ( i2 – l2 ) Power spectra of the central slices of the Fourier transforms of ( i1 – l1 ) , respectively , notice the ﬁlled - in estimated missing data . ( m ) Eight consecutive x – z slices around the center of the incomplete reconstruction in ( e1 ) . ( n ) Eight consecutive x – z slices around the center of the reconstruction with estimated missing data in ( i1 ) . Notice how the artifacts caused by the missing data are reduced by PPCA - EM . Scale bar 100 Å . Table 2 The Fourier discrepancy values for the three possible methods for estimating missing data . Fourier discrepancy Total mean 0 . 7301 (cid:7) 0 . 0010 Class mean 0 . 6015 (cid:7) 0 . 0002 PPCA - EM 0 . 5865 (cid:7) 0 . 0003 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 27 Fig . 9 . Scatter plots of the PFK volumes projected onto the ﬁrst principal component , real part vs . imaginary part . Polar Fourier volumes reconstructed with 100 projections were used . Symbols correspond to different states of PFK . ( a ) No missing data , standard PCA . ( b ) 40 % missing data , standard PCA . ( c ) 40 % missing data , PPCA - EM . 28 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 missing data , while the best estimation is obtained by PPCA - EM . The PPCA - EM algorithm aims at estimating the data including the variations originating from the noise , while the estimation from class averages implicitly includes a noise reduction . If a good classiﬁcation can be obtained , the weighted class mean is a reason - able method for estimating the missing data . With a continuous distribution of the data , and no clear classiﬁcation , the estimation by PPCA - EM is superior . The application of the PPCA - EM algorithm to the cryo - electron microscopy PFK data set demonstrates the effectiveness of the algorithm applied to experimental data . The scatter plots of the volumes projected onto the ﬁrst principal components are illus - trated in Fig . 9 , in which the symbols are shaped and colored according to the different states of PFK . Without missing data , standard PCA is able to resolve the volumes into four well sepa - rated clusters ( Fig . 9a ) . Thus , here PCA can capture the features that enable accurate volume classiﬁcation , and can elucidate both the large and small variations in the data set . However , with at least 40 % missing data , standard PCA neither captures the features nor separates the classes clearly ( Fig . 9b ) . The PPCA - EM algorithm , when applied to the same data set with at least 40 % missing data , is able to reproduce the correct clusters in the subspace of the larg - est principal components ( Fig . 9c ) . Data clustering for both PCA and PPCA - EM was checked by examining 2D scatter plots of the vol - umes projected onto different combinations of the real and imag - inary parts , and also the amplitudes of the largest principal components . Interestingly , for the PFK data the best separation was observed when the volumes were projected on the space de - ﬁned by the real part versus the imaginary part of the ﬁrst princi - pal component . It should be noted that for the case of the model data of complex I , the best separation was observed in the 3D space deﬁned by real parts of the ﬁrst three principal components . Thus , once the principal components of a data set are obtained , the data should be analyzed in different 2D or 3D spaces , where the imag - inary parts of the principal components are treated as additional principal components . Our PPCA - EM algorithm performs well on data with real noise as demonstrated by the results obtained with the experimental data set . Even though the Gaussian noise , assumed in the algo - rithm , is an approximation of the noise present in electron micro - graphs , the PPCA - EM algorithm is able to perform a principal component analysis on electron microscopy volumes with missing data . This is not surprising given the fact that standard PCA , where a Gaussian noise assumption is implied , has been highly successful as a multivariate statistical analysis method in the analysis of 2D electron microscopy images . Currently , there are four algorithms available in electron microscopy that can analyze 3D volumes with missing data in dif - ferent orientations . Förster’s algorithm uses constrained cross - cor - relation to reduce the dimensionality of the volumes ( Förster et al . , 2008 ) . Bartesaghi’s algorithm is able to determine the translational and rotational alignments , and assign each volume to a class using a pairwise distance constrained in the commonly present part of the volumes ( Bartesaghi et al . , 2008 ) . Neither algorithms estimate missing data for individual volumes . Scheres’ algorithm , reported after the ﬁrst submission of this paper , aligns , classiﬁes and esti - mates missing data for 3D volumes based on expectation maximi - zation ( Scheres et al . , 2009 ) . None of the three algorithms estimate feature vectors . Our PPCA - EM algorithm extracts feature vectors , reduces the dimensionality of the data , and estimates the missing data for individual volumes . A speciﬁc classiﬁcation algorithm is not included , leaving a wide choice of classiﬁcation techniques . The technique best suited for a speciﬁc data set can be selected . When the data set exhibits continuous variations , these will be vis - ible in the scatter plots produced in feature subspaces , and will not be obscured by a possibly artiﬁcial classiﬁcation . Since our algo - rithm estimates missing data for individual volumes , averaging of subpopulation is not required . In summary , we have derived the explicit formulations for the extension of the probabilistic principal component analysis to the application to 3D reconstructions with missing data . Extensive testing of the algorithm both with model and real data has demon - strated its high performance and illustrated its limitations . Most of these limitations can be overcome by increasing the information in the data set in a microscopy technique dependent fashion . The application to real data has shown that our algorithm can detect slight conformational differences that are not visible in 2D projec - tions and barely visible in 3D . In addition to the separation of het - erogeneous reconstructions , our algorithm estimates correctly the missing data for each single volume without requiring class aver - ages . The importance of this feature will become prominent as more and more biological systems are studied that do not show well deﬁned states but continuous variations . Acknowledgments This work was supported by NIH Grant RO1 GM078202 ( to M . R . ) , and has beneﬁted from NIH Grants RO1 GM068650 ( to M . R . ) and RO1 GM069551 ( to T . R . ) . Additional computer resources provided by the Vermont Advanced Computing Center which is supported by NASA ( Grant No . NNX 08A096G ) are gratefully acknowledged . Appendix A . Supplementary data Supplementary data associated with this article can be found , in the online version , at doi : 10 . 1016 / j . jsb . 2010 . 04 . 002 . References Barcena , M . , Radermacher , M . , Bar , J . , Kopperschlager , G . , Ruiz , T . , 2007 . The structure of the ATP - bound state of S . cerevisiae phosphofructokinase determined by cryo - electron microscopy . Journal of Structure Biology 159 , 135 – 143 . Bartesaghi , A . , Sprechmann , P . , Liu , J . , Randall , G . , Sapiro , G . , Subramaniam , S . , 2008 . Classiﬁcation and 3D averaging with missing wedge correction in biological electron tomography . Journal of Structural Biology 162 , 436 – 450 . Bezdek , J . , 1981 . Pattern Recognition with Fuzzy Objective Function Algorithms . Plenum Press , New York . Bretaudiere , J . , Frank , J . , 1986 . Reconstitution of molecule images analysed by correspondence analysis : a tool for structural interpretation [ published erratum appears in J Microsc 1987 May ; 146 ( Pt 2 ) : 222 ] . Journal of Microscopy 144 , 1 – 14 . Bretaudiere , J . , Dumont , G . , Rej , R . , Bailly , M . , 1981 . Suitability of control materials . General principles and methods of investigation . Clinical Chemistry 27 , 798 – 805 . Carazo , J . M . , Rivera , F . F . , Zapata , E . L . , Radermacher , M . , Frank , J . , 1990 . Fuzzy sets - based classiﬁcation of electron microscopy images of biological macromolecules with an application to ribosomal particles . Journal of Microscopy 157 , 187 – 204 . Clason , T . , Zickermann , V . , Ruiz , T . , Brandt , U . , Radermacher , M . , 2007 . Direct localization of the 51 and 24 kDa subunits of mitochondrial complex I by three - dimensional difference imaging . Journal Structure Biology 159 , 433 – 442 . Colsher , J . G . , 1977 . Iterative three - dimensional image reconstruction from tomographic projections . Computer Graphics and Image Process 6 , 513 . Crowther , R . A . , DeRosier , D . J . , Klug , A . , 1970 . The reconstruction of a three - dimensional structure from projections and its application to electron microscopy . Proceedings of the Royal Society London Series A 317 , 319 – 340 . Deans , S . R . , 1983 . The Radon Transform and some of its Applications . John Wiley & Sons , New York . Dempster , A . P . , Laird , N . M . , Rubin , D . B . , 1977 . Maximum likelihood from incomplete data via the EM algorithm . Journal of the Royal Statistical Society . Series B 39 , 1 – 38 . Diday , E . , 1971 . La méthode de nuées dynamiques . Revue Statistique Appliquée 19 , 19 – 34 . Dunn , J . , 1973 . A fuzzy relative of the ISODATA process and its use in detecting compact well - separated clusters . Journal of Cybernetics 3 , 32 – 57 . Förster , F . , Hegerl , R . , 2007 . Structure determination in situ by averaging of tomograms . Methods in Cell Biology Volume 79 , 741 – 767 . Förster , F . , Pruggnaller , S . , Seybert , A . , Frangakis , A . S . , 2008 . Classiﬁcation of cryo - electron sub - tomograms using constrained correlation . Journal of Structural Biology 161 , 276 – 286 . L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30 29 Frank , J . , van Heel , M . , 1982 . Correspondence analysisof aligned images of biological particles . Journal of Molecular Biology 161 , 134 – 137 . Frank , J . , Goldfarb , W . , Eisenberg , D . , Baker , T . S . , 1978 . Reconstruction of glutamine synthetase using computer averaging . Ultramicroscopy 3 , 283 . Golub , G . , van Loan , C . , 1996 . Matrix Computations . The Johns Hopkins University Press , London . Grünewald , K . , Medalia , O . , Gross , A . , Steven , A . C . , Baumeister , W . , 2003 . Prospects of electron cryotomography to visualize macromolecular complexes inside cellular compartments : implications of crowding . Biophysical Chemistry 100 , 577 – 591 . Herman , G . , Lent , A . , Rowland , S . , 1973 . ART : mathematicsand applications ( a report on the mathematical foundations and on the applicability to real data of the algebraic reconstruction techniques ) . Journal of Theoretical Biology 42 , 1 – 32 . Hoppe , W . , Langer , R . , Knech , G . , Poppe , C . , 1968 . Proteinkristallstrukturanalyse mit Elektronenstrahlen . Naturwissenschaften 55 , 333 . Hoppe , W . , Schramm , H . J . , Sturm , M . , Hunsmann , N . , Gaßmann , J . , 1976a . Three - dimensional electron microscopy of individual biological objects . I . Methods . Zeitschrift fuer Naturforschung 31a , 645 – 655 . Hoppe , W . , Schramm , H . J . , Sturm , M . , Hunsmann , N . , Gaßmann , J . , 1976b . Three - dimensional electron microscopy of individual biological objects . II . Test calculations . Zeitschrift fuer Naturforschung 31a , 1370 – 1379 . Hoppe , W . , Schramm , H . J . , Sturm , M . , Hunsmann , N . , Gaßmann , J . , 1976c . Three - dimensional electron microscopy of individual biological objects . III . Experimental results on yeast fatty acid synthetase . Zeitschrift fuer Naturforschung 31a , 1380 – 1390 . Johnson , S . , 1967 . Hierarchical clustering schemes . Psychometrika 2 , 241 – 254 . Knauer , V . , Hegerl , R . , Hoppe , W . , 1983 . Three - dimensional reconstruction and averaging of 30S ribosomal subunits of Escherichia coli from electron micrographs . Journal of Molecular Biology 163 , 409 – 430 . Lebart , L . , 1984 . Multivariate Descriptive Statistical Analysis . John Wiley & Sons Inc . , New York . Leschziner , A . E . , Nogales , E . , 2006 . The orthogonal tilt reconstruction method : an approach to generating single - class volumes with no missing cone for ab initio reconstruction of asymmetric particles . Journal of Structural Biology 153 , 284 – 299 . Little , R . J . A . , Rubin , D . B . , 1987 . Statistical Analysis with Missing Data . John Wiley , Chichester , UK . MacQueen , J . , 1967 . Some methods for classiﬁcation and analysis of multivariate observations . In : Proceedings of the Fifth Berkeley Symposium on Mathematical Statistics and Probability . University of California Press , Berkeley , pp . 281 – 297 . Markham , R . , Frey , S . , Hills , G . , 1963 . Methods for the enhancement of image detail and accentuation of structure in electron microscopy . Virology 20 , 88 – 102 . Markham , R . , Hitchborn , J . , Hills , G . , Frey , S . , 1964 . The anatomy of the tobacco mosaic virus . Virology 22 , 342 – 359 . Numpy , 2009 . NumPy Reference . Available from : < http : / / numpy . org > . Oettl , H . , Hegerl , R . , Hoppe , W . , 1983 . Three - dimensional reconstruction and averaging of 50S ribosomal subunits of Escherichia coli from electron micrographs . Journal of Molecular Biology 163 , 431 – 450 . Ott , L . , Longnecker , M . T . , 2003 . A First Course in Statistical Methods . Duxbury , Belmont ( Cengage Learning ) . Pearson , K . , 1901 . On lines and planes of closest ﬁt to systems of points in space . Philosophical Magazine 2 ( 572 ) , 559 . Radermacher , M . , 1980 . Dreidimensionale Rekonstruktion bei kegelfrörmiger Kippung im Elektronenmikroskop . Ph . D . Thesis , Technische Universität München . Radermacher , M . , 1988 . Three - dimensional reconstruction of single particles from random and nonrandom tilt series . Journal of Electron Microscopy Technique 9 , 359 – 394 . Radermacher , M . , 1994 . Three - dimensional reconstruction from random projections : orientational alignment via Radon transforms . Ultramicroscopy 53 , 121 – 136 . Radermacher , M . , 1997 . Radon transform techniques for alignment and 3D reconstruction from random projections . Scanning Microscopy 11 , 171 – 177 . Radermacher , M . , Hoppe , W . , 1980 . Properties of 3 - D reconstruction from projections by conical tilting compared to single axis tilting compared to single axis tilting . In : Proceedings of seventh European Congress on Electron Microscopy , vol . 1 . pp . 132 – 133 . Radermacher , M . , Wagenknecht , T . , Verschoor , A . , Frank , J . , 1986 . A New 3 - dimensional reconstruction scheme applied to the 50S ribosomal subunit of E . coli . Journal of Microscopy 141 , Rp1 – Rp2 . Radermacher , M . , Wagenknecht , T . , Verschoor , A . , Frank , J . , 1987 . Three - dimensional reconstruction from a single - exposure , random conical tilt series applied to the 50S ribosomal subunit of Escherichia coli . Journal of Microscopy 146 , 113 – 136 . Radermacher , M . , Ruiz , T . , Clason , T . , Benjamin , S . , Brandt , U . , Zickermann , V . , 2006 . The three - dimensional structure of complex I from Yarrowia lipolytica : a highly dynamic enzyme . Journal of Structural Biology 154 , 269 – 279 . Roweis , S . , 1998 . EM algorithms for PCA and SPCA . In : Advances in Neural Information Processing Systems ( NIPS’97 ) , vol . 10 . MIT Press , pp . 626 – 632 . Ruiz , T . , Kopperschläger , G . , Radermacher , M . , 2001 . The ﬁrst three - dimensional structure of phosphofructokinase from Saccharomyces cerevisiae determined by electron microscopy of single particles . Journal of Structural Biology 136 , 167 – 180 . Ruiz , T . , Mechin , I . , Bar , J . , Rypniewski , W . , Kopperschlager , G . , Radermacher , M . , 2003 . The 10 . 8 - Å structure of Saccharomyces cerevisiae phosphofructokinase determined by cryoelectron microscopy : localization of the putative fructose 6 - phosphate binding sites . Journal of Structural Biology 143 , 124 – 134 . Saxton , W . O . , Frank , J . , 1977 . Motif detection in quantum noise - limited electron micrographs by cross - correlation . Ultramicroscopy 2 , 219 – 227 . Scheres , S . H . , Melero , R . , Valle , M . , Carazo , J . , 2009 . Averaging of electron subtomograms and random conical tilt reconstructions through likelihood optimization . Structure 17 , 1563 – 1572 . Sols , A . , 1981 . Multimodulation of enzyme activity . Current Topics in Cellular Regulation 19 , 77 – 101 . Tipping , M . E . , Bishop , C . M . , 1999 . Probabilistic principal component analysis . Journal of the Royal Statistical Society : Series B : Statistical Methodology 61 , 611 – 622 . van Heel , M . , 1987 . Angular reconstitution : a posteriori assignment of projection directions for 3D reconstruction . Ultramicroscopy 21 , 111 . van Heel , M . , Frank , J . , 1981 . Use of multivariate statistics in analysing the images of biological macromolecules . Ultramicroscopy 6 , 187 – 194 . Walz , J . , Typke , D . , Nitsch , M . , Koster , A . J . , Hegerl , R . , Baumeister , W . , 1997 . Electron tomography of single ice - embedded macromolecules : three - dimensional alignment and classiﬁcation . Journal of Structural Biology 120 , 387 – 395 . Winkler , H . , 2007 . 3D reconstruction and processing of volumetric data in cryo - electron tomography . Journal of Structural Biology 157 , 126 – 137 . Winkler , H . , Taylor , K . A . , 1999 . Multivariate statistical analysis of three - dimensional cross - bridge motifs in insect ﬂight muscle . Ultramicroscopy 77 , 141 – 152 . Yu , L . , Snapp , R . , Radermacher , M . , 2008 . Multivariate statistical analysis of volumes with missing data . In : Proceedings of 35th Annual Meeting of the Microscopy Society of Canada , Montreal , 20 – 23 May . 30 L . Yu et al . / Journal of Structural Biology 171 ( 2010 ) 18 – 30