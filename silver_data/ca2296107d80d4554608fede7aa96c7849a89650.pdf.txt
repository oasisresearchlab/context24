DILS’06 July , 22nd 1 Towards a Model of Towards a Model of Provenance and User Views Provenance and User Views in Scientific Workflows in Scientific Workflows Shirley Cohen Sarah Cohen - Boulakia Susan Davidson University of Pennsylvania DILS’06 July , 22nd 2 Need for provenance ! Need for provenance ! Public Public sourcessources TGCCGTGTGGC TAAATGTCTGT GC … CCCTTTCCGTG TGGCTAAATGT CTGTGC … TGCCGTGTGGC TAAATGTCTGT GC GTCTGTGC… TGCCGTGTGGC TAAATGTCTGT GC GTCTGTGC… TGCCGTGTGGC TAAATGTCTGT GC GTCTGTGC… ATGGCCGTGTG GCTAAATGTCT GTGCCTAACTA ACTAA… Alignments ClustalW PAUPS Phillips … Bootstrap Biologist’s workspace Biologist’s workspace CIPRES project CIPRES project CyberinfrastructureCyberinfrastructure for for PhylogeneticPhylogenetic RESearchRESearch BioinformaticsBioinformatics protocolsprotocols Which sequences have been used to produce this tree ? How this tree has been generated ? ? ? Can I throw away some of these data ? Which ones are really important to keep ? DILS’06 July , 22nd 3 Scientific Analysis Scientific Analysis (cid:123) Explosion of biological data , must be analyzed to create knowledge (cid:123) Scientific analysis is complex (cid:123) Reproducing , interpreting results depends on the provenance provenance of the data ( how , where , who… ) (cid:123) Workflow systems (cid:122) Support scientists in their analysis (cid:122)(cid:122) TraceTrace the data used / generated at each step (cid:122) Are heterogeneousheterogeneous (cid:123) Different graph - based models (cid:123) Different technologies (cid:206) Need a genericgeneric model model of provenance DILS’06 July , 22nd 4 ProvenanceProvenance (cid:123) Provenance is an increasingly important topic (cid:122) specialized workshops , survey papers… (cid:123) Models for data provenance exist in the database community (cid:122) E . g . [ Buneman et al . , 01 ] , [ Bhagwat et al . , 04 ] , [ Widom et al . , 06 ] (cid:123) However , several features of scientific workflows are not addressed (cid:122) Data are derived by chaining chaining and composing composing analytical tools (cid:122) Steps are black boxes black boxes (cid:122) Different viewsviews of a given workflow ( sub - steps ) may be considered (cid:206)(cid:206) ModelModel of provenance for scientific workflows must incorporate these featuresfeatures DILS’06 July , 22nd 5 OutlineOutline (cid:123) Motivation (cid:123)(cid:123) Case study : Tree Inference Case study : Tree Inference (cid:123) Model for provenance and user views (cid:123) Querying provenance (cid:123) Conclusion DILS’06 July , 22nd 6 Tree Inference Workflow Tree Inference Workflow ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) (cid:123) Designed in the context of the CIPRES project (cid:123) Represents how phylogeneticists analyze data (cid:123) Terminology (cid:122) Nodes are step - classes ( static ) (cid:122) Edges capture the flow of data between step - classes (cid:123) Loops are possible (cid:122) An execution of a workflow generates a partial order of steps ( dynamic ) (cid:123) Instances of step classes (cid:122) Each step has input and output data DILS’06 July , 22nd 7 Tree Inference Workflow , cont . Tree Inference Workflow , cont . (cid:123) A step - class may itself be a workflow (cid:123) Users may zoom - in to the boxes (cid:122) Kepler , myGrid… (cid:123) Different user views can be considered (cid:122) Am I allowed to zoom in S4 ? ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S4c ) Bootstrap Tree ( S4d ) Root Tree ( S4a ) Compute Trees ( S4b ) Create Consensus Tree ( O4a ) unrooted trees ( O3 ) edited alignment ( O4b ) consensus tree ( O4c ) bootstrap tree ( O4 ) rooted tree DILS’06 July , 22nd 8 Querying Provenance Querying Provenance (cid:123) From what immediate data products did this tree originate ? (cid:123) What are all the data products which have been used to produce this tree ? (cid:123) What step produced this tree ? (cid:123) What sequence of steps produced this tree ? (cid:206) Data vs step provenance (cid:206) Immediate vs deep provenance ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S4c ) Bootstrap Tree ( S4d ) Root Tree ( S4a ) Compute Trees ( S4b ) Create Consensus Tree ( O4a ) unrootedtrees ( O3 ) editedalignment ( O4b ) consensustree ( O4c ) bootstraptree ( O4 ) rootedtree DILS’06 July , 22nd 9 OutlineOutline (cid:123) Motivation (cid:123) Case study : Tree Inference (cid:123)(cid:123) Model for provenance and user views Model for provenance and user views (cid:123) Querying provenance (cid:123) Conclusion DILS’06 July , 22nd 10 Model of Provenance : Logs Model of Provenance : Logs (cid:123) A log is a sequence of entries (cid:122) Input ( sid , iid , ts ) sid takes iid as input at time ts (cid:122) Output ( sid , did , ts ) sid produces did at time ts (cid:123) Immediate provenance (cid:122) All the data and steps directly used to produce did ImmProv ( did , sid , iid ) : - Input ( sid , iid , tsi ) ∧ Output ( sid , did , tso ) ∧ tsi ≤ tso S1 S2 I1 I2 D O1 Imm . Provenance of O1 ImmDProv : D ImmSProv : S2 Output SID DID TSO - - - - - - - - - - - - - - - S1 D 2 S2 O1 4 Input SID IID TSI - - - - - - - - - - - - - - S1 I1 1 S1 I2 1 S2 D 3 Imm D Prov and Imm S Prov are also defined Each Each input / output input / output data is stored ! data is stored ! DILS’06 July , 22nd 11 Deep Provenance Deep Provenance (cid:123)(cid:123) Recursive Recursive definition (cid:123)(cid:123) Deep Data Deep Data provenance ( D ) : DProv ( did , iid ) : - ImmProv ( did , _ , iid ) DProv ( did , iid ) : - ImmProv ( did , _ , x ) ∧ DProv ( x , iid ) (cid:123)(cid:123) Deep Step Deep Step provenance ( S ) : SProv ( did , sid ) : - ImmProv ( did , sid , _ ) SProv ( did , sid ) : - ImmProv ( did , _ , x ) ∧ Sprov ( x , sid ) S1 S2 I1 I2 D O1 DProv for O1 : [ { D } , { I1 , I2 } ] SProv for O1 : [ { S2 } , { S1 } ] DILS’06 July , 22nd 12 Composition and User Views Composition and User Views (cid:123) What is the immediate data provenance of O4 ? (cid:122) If I can zoom into S4 (cid:206) O4c (cid:122) Otherwise (cid:206) O3 (cid:123)(cid:123) UserView ( U ) : UserView ( U ) : set of the lowest level step classes that U is entitled to see . (cid:123)(cid:123) Ordering on user views : Ordering on user views : U2 > U2 > uu U1U1 U2 is finer than U1 ( sees provenance in more detail ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S4c ) Bootstrap Tree ( S4d ) Root Tree ( S4a ) Compute Trees ( S4b ) Create Consensus Tree ( O4a ) unrootedtrees ( O3 ) editedalignment ( O4b ) consensustree ( O4c ) bootstraptree ( O4 ) rootedtree U1 U2 DILS’06 July , 22nd 13 User Views User Views (cid:123)(cid:123) WhatWhat are User views ? (cid:122) Level of detaildetail the user wishes to track (cid:122)(cid:122) Permissions Permissions given to the user (cid:122)(cid:122) AbilityAbility of the user to see / know the sub - steps ( distributed computation ) (cid:122) Similar to checkpointscheckpoints in logs (cid:123)(cid:123) WhyWhy use User Views ? (cid:122)(cid:122) Throw away Throw away unimportant intermediate results (cid:122)(cid:122) Reduce Reduce the amount of work to be redone (cid:206) Storage efficiencyefficiency DILS’06 July , 22nd 14 Reasoning with User Views Reasoning with User Views (cid:123) Logging occurs at lowest level steps (cid:123) Reasoning uses information from (cid:122) Workflow : Step - classes containment and user views (cid:122) Cinput ( sid , idid , tsi ) , Coutput ( sid , idid , tso ) calculated from log (cid:123) Immediate user - provenance (cid:122) ImmUserProv ( u , did , sid , idid ) : - Cinput ( sid , idid , tsi ) ∧ Coutput ( sid , did , tso ) ∧ tsi ≤ tso ∧ userView ( u , sid ) COutput SID DID TSO - - - - - - - - - - - - - S1 D 2 S2 O1 4 Sc O1 4 Scc O1 4 S3 O2 5 Scc O2 5 CInput SID IDID TSI - - - - - - - - - - - - - - S1 I1 1 Sc I1 1 Scc I1 1 S3 I2 1 Scc I2 1 S2 D 3 S1 S3 S2 I1 I2 O1 O2 D U1 ( black box ) U3 ( admin ) ImmUserDProv for O1 viewed by U2 : { I1 } ImmUserDProv for O1 viewed by U3 : { D } U2 (cid:123) User Deep provenance is analogously defined Sc Scc (cid:206) ImmUser D Prov (cid:206) ImmUser S Prov DILS’06 July , 22nd 15 Reasoning with User Views Reasoning with User Views ( cont . ) ( cont . ) (cid:123) A finer user view user view allows (cid:122) more data and steps to be seen (cid:122) more precise reasoning about data provenance (cid:123) Lemma Given a data object did and two user views u1 and u2 such that u1 < u u2 and did is visible in u1 . Then ProvProv - - visible ( u1 , u1 , did ) visible ( u1 , u1 , did ) ⊇⊇ ProvProv - - visible ( u1 , u2 , did ) visible ( u1 , u2 , did ) Prov - visible ( U1 , U3 , O1 ) = { I1 } Prov - visible ( U1 , U1 , O1 ) = { I1 , I2 } S1 S3 S2 I1 I2 O1 O2 D U1 ( black box ) U3 ( admin ) U2 Sc Scc (cid:206) Different granularitygranularity levels of provenance (cid:206) Storage efficiencyefficiency DILS’06 July , 22nd 16 OutlineOutline (cid:123) Motivation (cid:123) Tree Inference use case (cid:123) Model for provenance (cid:123)(cid:123) Querying Provenance Querying Provenance (cid:123) Conclusion DILS’06 July , 22nd 17 Querying Provenance Querying Provenance (cid:123) From what direct data products did this tree originate this tree originate ? ImmUserDProv ( U1 , O4 ) : O3 ImmUserDProv ( U2 , O4 ) : O4c (cid:123) What are all the data products all the data products which have been used to produce this tree ? userDProv ( U1 , O4 ) : O3 , O2 , O1 , G userDProv ( U2 , O4 ) : O4c , O4b , O4a , O3 , O2 , O1 , G (cid:123) What sequence of steps sequence of steps produced this tree ? userSProv ( U1 , O4 ) : S4 , S3 , S2 , S1 userSProv ( U2 , O4 ) : S4d , S4c , S4b , S4a , S3 , S2 , S1 ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S1 ) Download Sequences GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) GenBank ( S3 ) Refine Alignment ( S4 ) Infer Tree ( S2 ) Create Alignment ( O1 ) raw sequences ( O2 ) alignment ( O3 ) edited alignment ( O4 ) rooted tree Tree Repository If ( rooted tree ( O4 ) = unsatisfactory ) repeat process ( G ) ( S4c ) Bootstrap Tree ( S4d ) Root Tree ( S4a ) Compute Trees ( S4b ) Create Consensus Tree ( O4a ) unrootedtrees ( O3 ) editedalignment ( O4b ) consensustree ( O4c ) bootstraptree ( O4 ) rootedtree U1 U2 DILS’06 July , 22nd 18 ConclusionConclusion (cid:123) Model of provenanceprovenance (cid:122) Based on study of user requirements ( Tree Inference Workflow ) (cid:122) Uses genericgeneric and minimal minimal informationinformation (cid:123) Based on careful studies of workflow systems ( Kepler , MyGrid , Chimera ) (cid:123) Definitions include (cid:123)(cid:123) DataData and Step provenance (cid:123)(cid:123) Immediate Immediate andand DeepDeep provenance (cid:123)(cid:123) User Views User Views (cid:122) Multi - granularitygranularity levels of provenance (cid:122) Only visible and necessary data are kept (cid:206)(cid:206) EfficiencyEfficiency in storage (cid:123) Model is rich enough to answer the collected queries DILS’06 July , 22nd 19 Ongoing Work Ongoing Work (cid:123) Experiment with the expressiveness expressiveness of the language (cid:122) Queries over concurrent and partial executions (cid:122) Use an object - oriented data model ( JDBC / Oracle ) (cid:123)(cid:123) ImplementImplement the model ( efficiently ) (cid:122) Experiment with storage models (cid:122) Collect real scientific logging information (cid:122) Study use within in real workflow system (cid:123) Collaboration with the Kepler group DILS’06 July , 22nd 20 AcknowledgementsAcknowledgements (cid:123) Kepler Group (cid:122) Shawn Bowers (cid:122) Bertram Ludascher (cid:122) Timothy McPhillips (cid:123) Biologists from the CIPRES project (cid:123) Members from the Database group , University of Pennsylvania (cid:123) This work is supported by NSF grants IIS0513778 and IIS0415810