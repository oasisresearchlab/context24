616 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 Symbolic Matching and Constraint Generation for Systematic Comparison of Analog Circuits Cristian Ferent , Student Member , IEEE , and Alex Doboli , Senior Member , IEEE Abstract —This paper proposes an automated technique for systematically generating comparison data between two analog circuits . The comparison data presents the similar and distin - guishing performance characteristics of the circuits with respect to DC - gain , bandwidth , common - mode rejection ratio , noise , and sensitivity . The comparison data is important for getting insight into the common and unique beneﬁts of a circuit , selecting ﬁtting circuit topologies for system design , and reﬁning and optimizing circuit topologies . The technique utilizes matching of the topologies and symbolic expressions of the compared circuits to ﬁnd the nodes with similar electric behavior . The impact on performance of the unmatched nodes is used to express the differentiating characteristics of the circuits . Experiments illustrate the technique for a pair of analog circuit designs . Index Terms —Constraint generation , macromodeling , sym - bolic analysis , systematic comparison . I . Introduction M ACROMODELS are important tools in describing the main features of analog circuits , including : 1 ) mathe - matical dependences between output , nodal , and input signals and device parameters , and 2 ) expressions of performance attributes depending on design variables . The ﬁrst type of macromodels are usually called structural models , and the latter are called black box models . Circuit macromodels have been utilized for many purposes , including fast performance evaluation [ 1 ] , insight gain into circuit behavior and perfor - mance [ 2 ] , design veriﬁcation [ 3 ] , and circuit and system synthesis , including design parameter sizing [ 4 ] – [ 6 ] and circuit topology selection and generation [ 1 ] , [ 2 ] , [ 7 ] . Existing macromodeling methods can successfully tackle a large variety of performance attributes , including small - signal AC [ 8 ] – [ 10 ] , weakly nonlinear performance [ 11 ] – [ 14 ] , and large - signal nonlinear - related attributes [ 15 ] , [ 16 ] . The utilized modeling techniques include regression analysis [ 17 ] – [ 19 ] , symbolic analysis [ 20 ] , neural networks [ 6 ] , piecewise - linear approximation [ 21 ] , optimization - based symbolic descriptions [ 22 ] , support vector machines [ 14 ] , system identiﬁcation [ 16 ] , and model - order reduction [ 2 ] , Manuscript received January 4 , 2012 ; revised May 24 , 2012 ; accepted November 16 , 2012 . Date of current version March 15 , 2013 . This material is based upon work supported by the National Science Foundation , under Grant 0856038 . Any opinions , ﬁndings , and conclusions or recommendations expressed in this material are those of the author ( s ) and do not necessarily reﬂect the views of the National Science Foundation . This paper was recom - mended by Associate Editor G . Gielen . The authors are with the Department of Electrical and Computer Engineer - ing , Stony Brook University ( SUNY ) , Stony Brook , NY 11794 USA ( e - mail : cristian . ferent @ stonybrook . edu ; alex . doboli @ stonybrook . edu ) . Digital Object Identiﬁer 10 . 1109 / TCAD . 2012 . 2234826 [ 23 ] . However , there has been limited work on developing macromodeling methods to relate ( compare ) the performance of two analog circuits , e . g . , DC gain , bandwidth , noise , common - mode rejection ratio ( CMRR ) , and sensitivity . Such comparisons are important in highlighting how different topological structures impact circuit electrical behavior and performance , including the nature and complexity of design tradeoffs , the design variables available to decide the tradeoffs and set each individual performance attribute , and the design conditions under which two circuit topologies present similar or unique behavior and performance . The insight obtained through circuit comparison includes understanding the capabilities and limitations of a circuit compared to other options [ 24 ] and selecting the best circuit topology for a given speciﬁcation [ 2 ] . Other possible applications are incremental topology reﬁnement , and circuit optimization and reuse . It is not trivial to compute the performance similarities and differences between two circuits , and to relate these characteristics to the structural differences of the circuits , including the tradeoffs and design variables of each structure . Simulating and / or individually modeling each circuit gives some insight but accurate understanding of the link between topological variations and performance differences requires detailed analysis [ 24 ] . Previous work suggests that two circuits can be compared using their performance space descrip - tions [ 2 ] , [ 25 ] – [ 27 ] . Performance space descriptions relate mathematically the performance attributes of two structures , like DC gain , 3 dB frequency , and slew rate [ 25 ] . Descriptions are constructed either starting from circuit equations [ 26 ] or using a synthesis tool that produces the Pareto fronts of the performance space [ 25 ] , [ 27 ] . The identiﬁed performance trade - off plots are utilized in topology selection or in set - ting the performance requirements of the circuits in larger systems . However , performance space descriptions abstract all design variables and therefore do not offer insight into how topological differences in two circuits introduce new design variables that create novel tradeoffs and thus new opportunities ( ﬂexibility ) for improving performance . This insight is important not only for circuit topology selection but also for design reuse , including circuit optimization for new requirements , incremental topology changes for novel applica - tions , and design migration to different fabrication processes . This paper proposes an automated technique for systemat - ically producing comparison models for two analog circuits . The models present the similar and distinguishing topological features as well as performance characteristics of the two 0278 - 0070 / $ 31 . 00 c (cid:2) 2013 IEEE FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 617 Fig . 1 . Design insight based on circuit comparison . ( a ) Performances with respect to a single variable . ( b ) Performance tradeoff surfaces . circuits with respect to DC gain , bandwidth , noise , CMRR , and sensitivity . The technique utilizes a dual matching ap - proach of both topologies and symbolic expressions to ﬁnd the nodes with similar electric behavior in different circuits . The distinguishing aspects of the unmatched behavior are also found for the circuits . A set of constraints relate the behavioral descriptions to performance attribute modiﬁcation . The ﬁnal step of the method characterizes how topological and behavioral differences modify tradeoffs in a design , availability of free ( orthogonal ) variables to set performance attributes , and achievable performance values . The presented method focuses on AC performance , but as the structural macromodeling technique [ 10 ] used to describe circuits can also tackle weakly nonlinearities , the authors feel that it should be possible to extend the comparison models to weak nonlinearities too . The paper has the following structure . Section II presents the addressed problem . Sections III and IV detail the model and proposed algorithm for circuit comparison . Section V offers experimental results . Conclusions end the paper . II . Problem Description Comparing the electrical behavior and the performance of two analog circuits requires identifying all related design variables , characterizing the impact of similar and distinguishing variables on circuit behavior and performance attributes , and then relating the resulting performance plots . Intuitively , two circuits can be compared by separately changing the design variable values within their ranges and plotting the values of the relevant performance attributes . Fig . 1 ( a ) illustrates the process . Performance attributes Perf i and Perf j are plotted for various values of variable g while other design parameters are kept constant . The process is repeated for all parameter combinations . The analysis relates the individual performance attributes and their sensitivity with respect to design variables . Performance trade - off surfaces are also generated to present common and distinct performance values . In Fig . 1 ( b ) , the differences between the performance of the two circuits are shadowed . The common performance space is shown without shadow . In this approach , it is difﬁcult to relate the topological similarities and differences between two circuit schematics to the changes in behavior and performance , including any common and distinguishing behavior of the structural elements of the circuits ( e . g . , circuit nodes and subcircuits ) , and their implications in having similar and distinct design tradeoffs and performance . For example , in Fig . 1 ( b ) , the precise reasons that produce the performance space differences for circuit 2 compared to circuit 1 ( the ﬁve gray regions ) are difﬁcult to establish , including the sets of design variables with matched and unmatched effects , the common and distinct relations linking performance attributes to ( matched and unmatched ) variables , the similar and distinct constraints on the variable values , and the similar and different tradeoffs in the two circuits . Speciﬁcally , there is no indication as to how design - speciﬁc constraints improve performance , such as certain pole - zero placements , or constraints on device parameters , e . g . , transconductance and capacitance values being sized according to a certain ratio . In an automated synthesis ﬂow , this insight is useful in incremental circuit topology synthesis , design optimization and reuse , and topology selection . As shown in Section V , performance attributes and design tradeoffs are linked to sets of design variables through nontrivial symbolic expressions and constraints , which are hard to identify and characterize based only on numerical simulation data . Instead , the proposed circuit comparison method tackles the above difﬁculties by symbolically relating the mathematical expressions describing the electrical behavior , performance tradeoffs , and performance attributes of two circuits . It ﬁnds the topologically similar and distinct circuit substructures as well as the nodes with similar electrical behavior . Two nodes have similar behavior if there are conditions under which the symbolic transfer functions ( TFs ) between inputs and nodes can be matched , such that the two TFs represent the same mathematical expression . Examples of such enabling conditions include requirements that certain device parameters are equal , or some devices are much larger ( or smaller ) than others . Finally , the modiﬁcations of performance attributes due to topological and behavioral similarities and differences in two circuits , e . g . , (cid:2) DC gain , (cid:2) bandwidth , (cid:2) CMRR , and (cid:2) noise , are used to compare tradeoffs in a design , availability of free variables to control performance attributes , and achiev - able performance ranges . III . Circuit Description for Systematic Comparison This section presents the description used to systematically compare two circuits . The description deﬁnes the common and distinguishing electric behavior in two circuits by identifying matched nodes with similar voltages and coupling expressions . The description starts from the macromodels of two circuits as this gives explicit details about the nodal behavior of the circuits . A brief overview of the utilized macromodel , called uncoupled building - block behavioral model ( UBBB ) [ 10 ] , is offered next followed by details about the circuit description for comparison . A . Structural Description UBBBs are directed , acyclic signal - ﬂow graphs , in which vertices are circuit nodes , and edges represent the signal cou - pling between nodes . The resistive and capacitive components of the poles at circuit nodes and the relations associated to edges are symbolic expressions deﬁned over the small - signal parameters of circuit devices . The symbolic expressions of UBBBs give insight into the electrical behavior of speciﬁc circuit structures . 618 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 Fig . 2 . ( a ) Schematic and ( b ) UBBB signal - ﬂow graph of two - stage Miller ampliﬁer ; and ( c ) schematic and ( d ) UBBB signal - ﬂow graph of class AB two - stage ampliﬁer [ 28 ] . Fig . 2 ( a ) depicts a two - stage Miller ampliﬁer and Fig . 2 ( b ) presents its UBBB model . All nodes V j are represented in the model , including their resistive ( R j ) and capacitive ( C j ) components . Node coupling is of two types : direct coupling between two nodes ( i . e . , through relations F ( i , j ) ) , and equiv - alent couplings after removing feedback connections ( e . g . , through expressions E ( k , j ) ) . Let N be the set of all circuit node indices . The voltage at node V j is expressed as follows [ 10 ] : V j = R j 1 + sR j C j × ⎛ ⎝ (cid:4) ∀ i ∈ N , i (cid:4) = j F ( i , j ) V i + (cid:4) k (cid:4) = j E ( k , j ) ⎞ ⎠ . ( 1 ) Terms R j and C j , used in deﬁning the circuit poles , are ex - pressions of the transconductance and capacitance parameters of the devices connected at node j . The direct coupling F ( i , j ) of nodes i and j is deﬁned in the s - domain as follows : F ( i , j ) = sC ( i , j ) m ± G ( i , j ) m ( 2 ) where C ( i , j ) m are the junction capacitances and G ( i , j ) m are the terminal transconductances of MOS devices connected to nodes i and j . The equivalent coupling E ( k , j ) results by eliminating all feedback connections in the initial , coupled model and replacing them with equivalent edges [ 10 ] . The edge expressions have the following form : E ( k , j ) = ( sC ( k , j ) m ± G ( k , j ) m ) V k , eq . ( 3 ) k is the circuit node where the eliminated feedback origi - nated , and j is the inﬂuenced node . C ( k , j ) m are the junction capacitances and G ( k , j ) m are the terminal transconductances of the devices connected to nodes k and j . Voltage V k , eq is the equivalent voltage of node k after removing the feedback to node j . The equivalent voltage for p signal inputs V in , v is equal to the following expression [ 10 ] : V k , eq = p (cid:4) v = 1 a k , n s n + · · · + a k , 2 s 2 + a k , 1 s + a k , 0 b k , n s n + · · · + b k , 2 s 2 + b k , 1 s + b k , 0 V in , v . ( 4 ) The symbolic coefﬁcients have the following form : a k , i ( b k , i ) = (cid:4) t ( ± ) (cid:7) k i , k j [ G ( k i , k j ) m ] α k (cid:7) l i , l j [ C ( l i , l j ) m ] β l . ( 5 ) G ( k i , k j ) m is the transconductance between nodes V k i and V k j , and C ( l i , l j ) m is the transcapacitance between nodes V l i and V l j , with α k , β l ∈ { 0 , 1 } and (cid:8) Kk = 1 α k = Nr − i , (cid:8) Ll = 1 β l = i . K and L are the total number of G ( k i , k j ) m and C ( l i , l j ) m in the model . Nr is the number of nodes . B . Circuit Description for Comparison Deﬁnition ( symbolic sets ) : Every node V j of a UBBB signal - ﬂow graph is described as the pair [ P j , E j ] , where P j and E j are symbolic sets . Set P j is the reunion of symbolic expres - sions PR j and PC j representing the resistive and capacitive components of the node’s pole . Set E j is the reunion of sym - bolic expressions containing the C ( j , k ) m and G ( j , k ) m components of each edge originating at node V j and ending at node V k . Example 1 : Node V ∗ 1 of the UBBB signal - ﬂow graph in Fig . 2 ( b ) is described as pair [ P 1 , E 1 ] with P 1 = PR 1 ∪ PC 1 , PR 1 = { g md 5 + g ms 1 + g ms 2 } , PC 1 = { C gd 5 + C db 5 + C gs 1 + C sb 1 + C gs 2 + C sb 2 } , and E 1 = { F ( 1 , 2 ) } ∪ { F ( 1 , 3 ) } = { g ms 1 } ∪ { g ms 2 } . g md and g ms are small signal terminal transconductance param - eters of the uncoupled device model of a MOSFET device M . C gs , C sb , C gd , and C db are the gate - to - source , source - to - bulk , gate - to - drain , and drain - to - bulk capacitances of a MOSFET . Deﬁnition ( matching error ) : Given two symbolic sets S 1 and S 2 , the matching error between symbolic expressions s 1 ∈ S 1 and s 2 ∈ S 2 is function ers : S 1 × S 2 → N , such that ers ( s 1 , s 2 ) = n and n is the number of symbolic terms that occur in s 1 or s 2 but not in both . The concept of (cid:5) - isomorphism deﬁnes an approximate matching of two symbolic sets within a given matching error . The concept is important to capture situations in which the common features of two circuits are more dominant than their distinguishing elements . Deﬁnition ( (cid:5) - isomorphism ) : For value (cid:5) , an (cid:5) - isomorphism of two symbolic sets S 1 and S 2 is the injective mapping f : S 1 → S 2 , such that ers ( s , f ( s ) ) ≤ (cid:5) , ∀ s ∈ S 1 . FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 619 Fig . 3 . Electrical behavior description for comparison . Deﬁnition ( minimal (cid:5) - isomorphism ) : An (cid:5) - isomorphism f : S 1 → S 2 is minimal , if for all (cid:5) - isomorphisms g : S 1 → S 2 and g (cid:4) = f , (cid:8) ∀ s i ∈ S 1 ers ( s i , f ( s i ) ) ≤ (cid:8) ∀ s i ∈ S 1 ers ( s i , g ( s i ) ) . The deﬁnition states that a minimal (cid:5) - isomorphism produces the smallest cumulative matching error computed over all pairs of matched symbolic expressions of the two sets . Deﬁnition ( (cid:5) - matched nodes ) : Two nodes V 1 = [ P 1 , E 1 ] and V 2 = [ P 2 , E 2 ] are (cid:5) - matched if the following three (cid:5) - isomorphisms exist : (cid:5) - isomorphisms f 1 : PR 1 → PR 2 , f 2 : PC 1 → PC 2 , and minimal (cid:5) - isomorphism g : E 1 → E 2 . Deﬁnition ( (cid:5) - matched circuits ) : Given two circuits C 1 and C 2 and value (cid:5) , matching the two circuits within error (cid:5) requires ﬁnding the maximal sets of (cid:5) - matched nodes from the two circuits , such that for any two pairs of matched nodes , e . g . , node V j ∈ C 1 (cid:5) - matches node W k ∈ C 2 and node V i ∈ C 1 (cid:5) - matches node W p ∈ C 2 , the lexicographical ordering of nodes V j and V i in the UBBB model of circuit C 1 is the same as the lexicographical ordering of nodes W k and W p in the UBBB model of circuit C 2 ( e . g . , V j precedes V i in C 1 ’s UBBB and W k precedes W p in C 2 ’s UBBB , or V i precedes V j and W p precedes W k ) . Intuitively , two matched circuits have similar signal ﬂows through their matched nodes , hence signals pass in the same order through the matched nodes . In the above deﬁnition , the similarity of the signal ﬂows is captured by the conditions regarding the lexicographic ordering of matched nodes . The maximal sets of (cid:5) - matching two circuits describe the common electrical behavior of the circuits while unmatched nodes express the distinguishing aspects of the circuits . Let us consider the maximal set for the matching of circuits C 1 and C 2 , and a pair of matched nodes V ∈ C 1 and V ∗ ∈ C 2 . For the lexical ordering of the nodes in the two UBBB models , we deﬁne that nodes V j ∈ C 1 and V ∗ j ∈ C 2 are the immediate predecessors of V and V ∗ , if V j precedes V , V ∗ j precedes V ∗ , V j and V ∗ j are matched , and there are no other matched nodes between nodes V j and V , and between nodes V ∗ j and V ∗ . Let set Prec V be the set of all immediate predecessors of node V and set Prec V ∗ be the set of all immediate predecessors of node V ∗ ( e . g . , nodes V 1 ∈ Prec V and V ∗ 1 ∈ Prec V ∗ , . . . , V k ∈ Prec V and V ∗ k ∈ Prec V ∗ are pairwise matched ) . Lemma 1 : The matched nodes V ∈ C 1 and V ∗ ∈ C 2 can be expressed as in Fig . 3 ( a ) , where for any pair of matched immediate predecessors V i ∈ Prec V and V ∗ i ∈ Prec V ∗ , H ( i ) comm are the TFs produced by the edges directly connecting nodes V i ( V ∗ i ) and V ( V ∗ ) ; H ( i ) 1 , diff ( H ( i ) 2 , diff ) are the TFs produced by the edges connecting V i ( V ∗ i ) and V ( V ∗ ) through unmatched nodes ; and H ( q ) 1 , equiv ( H ( q ) 2 , equiv ) are the TFs of the paths connecting inputs In q ( q = 1 , p ) and node V ( V ∗ ) without passing through any V i ∈ Prec V ( V ∗ i ∈ Prec V ∗ ) . Proof : Due to superposition principle , we can consider a single input In and a single predecessor in sets Prec V and Prec V ∗ . Let us assume that the lemma is false , hence there is a signal path that cannot be added to the TFs H comm , H diff , and H equiv . However , every signal paths in a UBBB starts from an input In , thus the path should at least be part of the corresponding H equiv . Hence , the assumption is incorrect . Example 2 : Fig . 3 ( b ) presents an instance of the general case in Fig . 3 ( a ) . Nodes V 1 and V ∗ 1 are assumed to be matched , thus set Prec V = { V 1 } and set Prec V ∗ = { V ∗ 1 } . Nodes V y and V z are unmatched . Then , H ( 1 ) comm = (cid:8) mi = 1 F ( i ) 1 , H ( 1 ) 1 , diff = F y , 1 F y , 2 , H ( 1 ) 2 , diff = G z , 1 G z , 2 , H 1 , equiv = F ( 1 ) in , and H 2 , equiv = F ( 2 ) in . Example 3 : Let us consider nodes V ∗ o and V o of the two ampliﬁers in Fig . 2 . Their immediate (cid:5) - matched predecessors are V ∗ 3 and V 3 , respectively . The common TF is H ( 1 ) comm = F ( 3 , o ) P 3 P o . For the Miller ampliﬁer , H ( 1 ) 1 , diff = H 1 , equiv = 0 ( no unmatched node ) . For the class AB design H ( 1 ) 2 , diff = F ( 3 , y ) F ( y , o ) P 3 P y P o and H 2 , equiv = E ( o , y ) F ( y , o ) P y P o , due to unmatched node V y . P i is the pole at node i . The following lemma relates the voltages of two circuits in which the immediate predecessor sets Prec of the matched nodes include a single node . Fig . 3 ( d ) shows such a case . Lemma 2 : In the s domain , the voltages at matched nodes V and V ∗ are linked as follows : V = A ( s ) V ∗ + p (cid:4) j = 1 B j ( s ) V in , j ( 6 ) with A ( s ) = A 1 ( s ) ( 1 + H 1 , diff − H 2 , diff H comm + H 2 , diff ) and B j ( s ) = [ ( H comm + H 1 , diff ) B 1 , j ( s ) + H ( j ) 1 , equiv − A ( s ) H ( j ) 2 , equiv ] . TFs H comm , H 1 , diff , H 2 , diff , H ( j ) 1 , equiv and H ( j ) 2 , equiv are deﬁned as in Fig . 3 ( a ) . Terms A 1 ( s ) and B 1 , j are those in expression ( 6 ) set up for the matched immediate predecessors of nodes V and V ∗ . p is the number of inputs . Proof : The proof is by induction . Let us consider the circuit structures in Fig . 3 ( b ) , which correspond to the rep - resentation in Fig . 3 ( a ) for k = 1 . Let us assume that the voltages at nodes V ∗ 1 and V 1 , the predecessors of nodes V ∗ and V , are related as in expression ( 6 ) , V 1 = A 1 ( s ) V ∗ 1 + (cid:8) pj = 1 B 1 , j V in , j . We prove the formula for nodes V ∗ and V . V = ( H comm + H 1 , diff ) V 1 + (cid:8) pj = 1 H ( j ) 1 , equiv V in , j and for V ∗ = ( H comm + H 2 , diff ) V ∗ 1 + (cid:8) pj = 1 H ( j ) 2 , equiv V in , j . Hence , V ∗ 1 = V ∗ − (cid:2) pj = 1 H ( j ) 2 , equiv V in , j H comm + H 2 , diff . After replacing V ∗ 1 in the expression of 620 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 voltage V 1 , V 1 = A 1 ( s ) V ∗ − (cid:2) pj = 1 H ( j ) 2 , equiv V in , j H comm + H 2 , diff + (cid:8) pj = 1 B 1 , j V in , j . Next , V 1 is substituted in the above expression of V , hence V = ( H comm + H 1 , diff ) [ A 1 ( s ) V ∗ − (cid:2) pj = 1 H ( j ) 2 , equiv V in , j H comm + H 2 , diff + (cid:8) pj = 1 B 1 , j V in , j ] + (cid:8) pj = 1 H ( j ) 1 , equiv V in , j . With H comm + H 1 , diff H comm + H 2 , diff = 1 + H 1 , diff − H 2 , diff H comm + H 2 , diff and after rewriting , V = A 1 ( s ) ( 1 + H 1 , diff − H 2 , diff H comm + H 2 , diff ) V ∗ + p (cid:4) j = 1 [ ( H comm + H 1 , diff ) B 1 , j + H ( j ) 1 , equiv − A 1 ( s ) H ( j ) 2 , equiv ( 1 + H 1 , diff − H 2 , diff H comm + H 2 , diff ) ] V in , j . This proves the lemma . Example 4 : This example considers the two - stage Miller ampliﬁer in Fig . 2 ( a ) and the two - stage class AB ampliﬁer [ 28 ] in Fig . 2 ( c ) . The UBBB models of the two circuits are shown in Fig . 2 ( b ) and 2 ( d ) , respectively . The following symbolic expressions correspond to ( 6 ) for matched nodes V 4 and V ∗ 4 . Their matched immediate predeces - sors are nodes V 2 and V ∗ 2 . Nodes V 3 and V ∗ 3 are not matched ( nodes with ∗ are for the Miller ampliﬁer ) : For the two - stage class AB ampliﬁer H 1 , diff = F ( 2 , 3 ) P 3 F ( 3 , 4 ) P 4 ; H ( V in − ) 1 , equiv = P 4 [ E ( o , 4 ) + P 3 F ( 3 , 4 ) [ E ( 4 , 3 ) + E ( o , 3 ) + E ( y , 3 ) + P 1 [ F ( in − , 1 ) + E ( 2 , 1 ) + E ( 3 , 1 ) ] [ F ( 1 , 3 ) + F ( 1 , 2 ) P 2 F ( 2 , 3 ) ] + P 2 F ( 2 , 3 ) [ F ( in − , 2 ) + E ( 3 , 2 ) ] ] ] H ( V in + ) 1 , equiv = P 4 [ E ( o , 4 ) + P 3 F ( 3 , 4 ) [ E ( 4 , 3 ) + E ( o , 3 ) + E ( y , 3 ) + F ( in + , 3 ) + P 1 [ F ( in + , 1 ) + E ( 2 , 1 ) + E ( 3 , 1 ) ] [ F ( 1 , 3 ) + F ( 1 , 2 ) P 2 F ( 2 , 3 ) ] + P 2 F ( 2 , 3 ) E ( 3 , 2 ) ] ] . For the two - stage Miller ampliﬁer H 2 , diff = F ( 2 , 3 ) P ∗ 3 F ( 3 , 4 ) P ∗ 4 ; H ( V in − ) 2 , equiv = P ∗ 4 [ E ( o , 4 ) + P ∗ 3 F ( 3 , 4 ) [ E ( 4 , 3 ) + E ( o , 3 ) + P ∗ 1 [ F ( in − , 1 ) + E ( 2 , 1 ) + E ( 3 , 1 ) ] [ F ( 1 , 3 ) + F ( 1 , 2 ) P ∗ 2 F ( 2 , 3 ) ] + P ∗ 2 F ( 2 , 3 ) [ F ( in − , 2 ) + E ( 3 , 2 ) ] ] ] H ( V in + ) 2 , equiv = P ∗ 4 [ E ( o , 4 ) + P ∗ 3 F ( 3 , 4 ) [ E ( 4 , 3 ) + E ( o , 3 ) + F ( in + , 3 ) + P ∗ 1 [ F ( in + , 1 ) + E ( 2 , 1 ) + E ( 3 , 1 ) ] [ F ( 1 , 3 ) + F ( 1 , 2 ) P ∗ 2 F ( 2 , 3 ) ] + P ∗ 2 F ( 2 , 3 ) E ( 3 , 2 ) ] ] . Variables P i ( P ∗ i ) denote the pole of node V i ( V ∗ i ) , with P i = R i ( 1 + sR i C i ) . H comm = 0 considering predecessors V 2 and V ∗ 2 . Lemma 3 : The transfer function of the subgraph induced by the nodes in the maximal set of (cid:5) - matched nodes describes the common part H comm of the TFs of the two circuits . The induced subgraph includes the nodes in the maximal sets and the arcs that connect these nodes . Proof : Let us assume that the common part H comm of the two TFs is not captured by the maximal set of matched nodes . Hence , there are unmatched nodes that contribute to func - tion H comm . But an unmatched node has resistive , capacitive , or coupling components that do not occur in the other circuit . Thus , the components cannot be part of function H comm . Example 5 : Fig . 3 ( c ) presents the UBBBs of two circuits . The matched nodes are highlighted . The subgraph induced by the matched nodes includes V 1 , V 3 , and V 4 , and the arcs labeled as F 1 , 3 , F 3 , 4 , and F 1 , 4 . The transfer function of the subgraph is F 1 , 3 F 3 , 4 P 1 P 3 P 4 + F 1 , 4 P 1 P 4 . Expression P i deﬁnes the pole at node V i . Example 6 : For the two ampliﬁers in Fig . 2 , the subgraph induced by the perfectly matched nodes ( (cid:5) = 0 ) includes the signal inputs , and nodes V ∗ 1 ( V 1 ) , V ∗ 2 ( V 2 ) , V ∗ 4 ( V 4 ) , and V ∗ o ( V o ) . The set of associated arcs is composed of all F - labeled edges in Fig . 2 , except the encircled ones . TF H comm is constructed from the expressions of all paths across these sets , such as F ( in − , 1 ) F ( 1 , 2 ) F ( 2 , 3 ) P 1 P 2 , F ( in − , 1 ) F ( 1 , 3 ) P 1 , and F ( 3 , 4 ) F ( 4 , o ) P 4 P o . Lemma 4 : The transfer function of the subgraph induced by the unmatched nodes of a circuit expresses TFs H diff and H equiv , the distinguishing part of that circuit compared to the second circuit . The subgraph induced by the unmatched nodes includes the unmatched nodes , the set of direct arcs between the unmatched nodes , the paths from inputs to the unmatched nodes , and the paths from the unmatched nodes to outputs . Proof : The transfer function of the subgraph induced by the unmatched nodes represents the paths that remain in the UBBB model after eliminating the paths of the subgraph induced by the matched nodes . The paths represent the distinguishing features of the circuit compared to the second circuit . Example 7 : For the top circuit in Fig . 3 ( c ) , the subgraph induced by the unmatched nodes includes nodes V 1 , V 2 , V 3 , and V 4 , and arcs F 1 , 2 , F 2 , 3 , and F 3 , 4 . The corresponding transfer function is H 1 , diff = F 1 , 2 F 2 , 3 F 3 , 4 P 1 P 2 P 3 P 4 . Similarly , for the bottom circuit , the induced graph includes nodes V 1 , V 2 , V 3 , and V 4 . The arcs are F 1 , 3 , F 3 , 2 , and F 2 , 4 . The transfer function is H 2 , diff = F 1 , 3 F 3 , 2 F 2 , 4 P 1 P 3 P 2 P 4 . Example 8 : For the class AB ampliﬁer ( compared to the Miller ampliﬁer ) , the set of unmatched nodes includes V 3 and V y ( for (cid:5) = 0 ) with unmatched edges F ( 3 , y ) , F ( y , o ) . Examples of input – output paths contained by the overall H 2 , diff are F ( in − , 1 ) F ( 1 , 2 ) F ( 2 , 3 ) F ( 3 , y ) F ( y , o ) P 1 P 2 P 3 P y P o and F ( in − , 1 ) F ( 1 , 2 ) F ( 2 , 3 ) F ( 3 , 4 ) F ( 4 , o ) P 1 P 2 P 3 P 4 P o . Lemma 5 : For two circuits , the TFs H comm , H diff , and H equiv have the following expression : H = (cid:4) p ∈ P (cid:9) t ∈ p F t ( s ) (cid:9) V j ∈ p 1 R j ( 1 + sR j C j ) ( 7 ) P are the signal paths of the following subgraphs : the subgraph induced by the matched nodes for H comm , and the subgraphs induced by the unmatched nodes for H diff and H equiv . V j represents the nodes of a path p , t are the edges of a path p , and F t are the edge labels . Proof : The proof results from Mason’s rule applied to signal - ﬂow graphs that do not have feedback structures . Example 9 : The following TFs exist for the two structures in Fig . 3 ( c ) . TF H comm = F 1 , 3 F 3 , 4 (cid:3) j ∈ { 1 , 3 , 4 } 1 Rj ( 1 + sR j C j ) + F 1 , 4 (cid:3) j ∈ { 1 , 4 } 1 Rj ( 1 + sR j C j ) , where P i are the symbolic expressions of the pole in node i . F i , j is the symbolic expression deﬁning the connection be - tween nodes i and j . TF H 1 , diff = F 1 , 2 F 2 , 3 F 3 , 4 (cid:3) j ∈ { 1 , 2 , 3 , 4 } 1 Rj ( 1 + sR j C j ) is the dif - ference between the top and bottom structure , and TF H 2 , diff = FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 621 Fig . 4 . Systematic comparison method . F 1 , 3 F 3 , 2 F 2 , 4 (cid:3) j ∈ { 1 , 2 , 3 , 4 } 1 Rj ( 1 + sR j C j ) distinguishes the bottom and top parts . Example 10 : This property can be observed for the two ampliﬁers in Fig . 2 when the expressions of the two input – output paths are combined to form H 2 , diff . The procedure to describe the impact of structural differ - ences on performance attributes considers attributes P deﬁned based on the circuit TFs . Such attributes are differential and common - mode gain , output transfer phase , output sensitivity to design parameters , circuit noise due to MOSFET device thermal and ﬂicker noise , power supply rejection ratio , voltage swing limits at individual circuit nodes , and bandwidth . IV . Systematic Comparison Method Fig . 4 presents the proposed circuit comparison method . Inputs are the UBBB models of two circuits C 1 and C 2 , the ac - ceptable matching error , the performance attributes of interest , and any other relevant design constraints , e . g . , variable ranges . The method includes four steps . Nodal matching , the ﬁrst step , computes for every node V j ∈ C 1 the lists of nodes in C 2 that are (cid:5) - matched . The lists form the possible matching space . The second step , circuit matching , ﬁnds the maximal set of (cid:5) - matched nodes for the two circuits using the lists of matched nodes computed in step one . Then , it relates the electrical behavior of each pair of matched nodes in the maximal set by computing TFs H comm , H diff , and H equiv for the two cir - cuits . The third step , constraint generation , produces symbolic constraints that relate the TFs computed in step two to the performance attributes of interest , e . g . , DC gain , bandwidth , noise , CMRR , and sensitivity , and the modiﬁcations of the at - tributes due to the topological differences of the circuits . Equa - tions ( 22 ) – ( 41 ) illustrate the constraints . Finally , performance characterization describes the capability of a design to meet the speciﬁed performance , including the free and trade - off variables available in each circuit , the tradeoffs of the circuits , and the performance plots . These four steps are detailed next . A . Nodal Matching Nodal matching identiﬁes the lists of nodes in circuit C 2 that are (cid:5) - matched to each node in circuit C 1 . Inputs are the UBBB models of the two circuits . Outputs are the lists of (cid:5) - matched nodes for every node in the two circuits . Note that a node can be matched to several nodes in the other circuit if their symbolic sets meet the matching constraints . The algorithm implements simulated annealing ( SA ) to produce the best matching for a given allowed error . The error counts the number of unmatched symbolic terms in the pole and edge expressions of the nodes . The SA cost function to be minimized is as follows : Cost matching = α × Nr + β × (cid:5) tot . ( 8 ) Term Nr represents the total number of matched groups in the current solution . Note that each unmatched node counts as a separate group . Term (cid:5) tot is the cumulative matching error for all pairs of matched nodes . It counts the number of unmatched resistive ( e . g . , transconductances ) and capacitive terms ( e . g . , C gs ) in the pole expressions , the difference in number of edges for the two nodes , and the number of unmatched capacitive and resistive terms of the edge expressions . α and β are weights associated with the two terms . The ﬁrst term of the cost function aims to ﬁnd as many node matchings as possible while the second term controls the overall matching error . Computing the cumulative matching error (cid:5) tot requires ﬁrst ﬁnding the minimum (cid:5) - isomorphism for all pairs of matched nodes , and then counting the number of unmatched terms of their symbolic sets . Finding the minimum (cid:5) - isomorphism of two nodes is difﬁcult as it is harder than topological matching , an NP - hard problem . We expressed the problem as minimum weight bipartite graph matching . Fig . 5 ( a ) illustrates an example . Each node to be matched represents a partition , and every symbolic expression of a node is a vertex in the partition . For example , vertices e 1 and e 2 correspond to the graph partition describing node V 1 , and vertices e 3 and e 4 are in the partition for node V 2 . Each vertex ( in one partition ) is connected to all vertices from the other partition . The weight of each edge is the matching error between the symbolic expressions of the vertices . The objective is to ﬁnd the edges that connect every vertex in one partition to exactly one vertex in the other partition , such that the overall matching error is minimum . These edges deﬁne the minimum (cid:5) - isomorphism between the two nodes . We used the Hungarian algorithm [ 29 ] to solve this problem as it has polynomial time complexity . Every node matching solution found by SA is veriﬁed for feasibility . The veriﬁcation step ﬁnds the unmatched terms , and then extracts the constraints that must be imposed on design variables of the symbolic expressions , so that the matching is valid . Otherwise , the unmatched terms would be dominant and signiﬁcantly change the behavior of the nodes . The feasibility of the extracted constraints is checked by solving the corresponding linear program ( LP ) formulation . The veriﬁed node matching is infeasible if the LP equations do not have a solution , and is feasible if the LP system is unbounded or has a single solution . Example 11 : Let us consider two nodes with the following unmatched edges : edge e 1 of node V 1 has the symbolic 622 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 Fig . 5 . ( a ) Minimum weight bipartite graph matching for minimum (cid:5) - isomorphism , ( b ) set of constraints , and ( c ) approximation for noise con - straints . expression sC gd 6 − g mg 6 , and edge e 2 of node V 2 has the expression sC gd 11 − g mg 11 + sC 2 . The pole resistive expressions for the two nodes are : PR 1 of node V 1 is g md 10 + g md 12 + g mg 12 , and PR 2 of node V 2 is g md 4 + g md 14 . Finally , the pole capacitive expressions are : PC 1 of node V 1 is C gs 5 + C gd 5 + C gb 5 + C 1 , and PC 2 of node V 2 is C gs 7 + C gd 7 + C gb 7 + C 2 + C 3 . The edges differ by one term , C 2 . Similarly , the poles differ by one resistive term ( g mg 12 ) and one capacitive term ( either C 2 or C 3 ) . Constraint extraction generates the following symbolic equations for which the two nodes can be matched C 2 → γ , such that e 1 ≡ e 2 g mg 12 → γ , such that PR 1 ≡ PR 2 C 1 = C 2 + C 3 , such that PC 1 ≡ PC 2 . The ﬁrst two constraints indicate that the nodes are matched , if C 2 and g mg 12 can be sized to be negligible with respect to the matched components ( γ is the acceptable approximation error ) . The last constraint deﬁnes the possibility of matching either capacitance of node V 2 with that of node V 1 . For the above example , the LP formulation is as follows : minimize : | 0 − C 2 | + | g mg12 − 0 | + | C 1 − ( C 2 + C 3 ) | subjectto : C 2 ≤ γ Clow g mg 12 ≤ γ R low | C 1 − ( C 2 + C 3 ) | ≤ γ C low C 2 ≥ γ C high g mg 12 ≥ γ R high C 1 ≥ γ C high C 2 + C 3 ≥ γ C high . The objective function minimizes the overall errors of all unmatched variables of the pole and edge expressions . Con - straints ≤ state that individual errors must be negligible , while constraints ≥ indicate that unmatched variables must still exist in the expressions , even though their values are small . They are needed to preserve the circuit node structure by avoiding to eliminate parameters or devices from the design . The boundary conditions , γ R low ( high ) and γ C low ( high ) , are set using typical transconductance and capacitance ranges for a technology . B . Circuit Matching The circuit matching step identiﬁes the maximal set of (cid:5) - matched nodes in two circuits . Finding maximal sets is NP - complete as it is similar to best cost matching in directed graphs . The algorithm in Fig . 6 takes as inputs the UBBBs of two circuits C 1 and C 2 and the lists LV of (cid:5) - matched nodes Fig . 6 . Circuit matching heuristic . in C 2 corresponding to every circuit node in C 1 ( the lists are produced by nodal matching ) . It outputs the maximal set . The method computes the maximal set by matching a node V ∈ C 1 with a node V ∗ ∈ C 2 that is the ﬁrst node in breadth - ﬁrst order that is (cid:5) - matched with V and meets one of the following two conditions : 1 ) all input nodes of V and V ∗ are also matched in the maximal set , or 2 ) V ∗ has the least number of inputs . The user indicates the matched inputs . Node V ∗ is always in the list of (cid:5) - matched nodes identiﬁed for node V by nodal matching . Node V is unmatched if its list LV is empty . Example 12 : Fig . 3 ( d ) illustrates the algorithm . Let us assume that nodes V 1 and V 2 have { V ∗ 1 , V ∗ 2 } as their lists of (cid:5) - matched nodes . The input nodes are matched . Then , nodes V 1 and V ∗ 1 are matched in the maximal set because V ∗ 1 precedes V ∗ 2 in the breadth - ﬁrst traversal . Nodes V 2 and V ∗ 2 are matched as this is the only matching alternative for V 2 . Finally , outputs V o and V ∗ o are matched . Note that the nodes encircled with dashed line are unmatched . Also , the signal - ﬂow structures between consecutively matched nodes correspond to Fig . 3 ( b ) . The maximal sets of matched nodes are used to compute TFs H comm , H diff and H equiv for each circuit , as described in Section III . C . Constraint Generation For two circuits , constraint generation computes their com - mon and distinct constraints that link performance attributes to design variables . Inputs are TFs H comm and H diff calculated by circuit matching ( for brevity of notation , we assumed that H diff also includes H equiv ) . The impact on performance attribute P erf i ( e . g . , DC gain , bandwidth , noise , CMRR , and sensitivity ) due to topological and TF differences are estimated using TFs H comm and H diff for every matched cluster of the circuits . Each TF generates a set of constraints that must be met to satisfy performance P erf i . Equations ( 22 ) – ( 41 ) are samples of constraints . 1 . DC gain . A series connection of TFs H comm and H diff produces a DC gain of DC gain H comm × DC gain H diff . A parallel connection creates a DC gain of DC gain H comm + DC gain H diff . 2 . Bandwidth . The relation between the TFs H comm and H diff and bandwidth is estimated using loop - gain - poles product ( GPP ) [ 30 ] ω max ≈ (cid:10) | 1 − DC gain | n (cid:7) i = 1 P i (cid:11) 1 n . ( 9 ) ω max is the estimated maximum bandwidth , and n is the number of dominant poles P i . The bandwidth corresponding FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 623 Fig . 7 . Algorithm for bandwidth - related constraint generation . to TF H comm has the following upper bound : ω H comm max ≈ (cid:10) | 1 − DC gain H comm | m (cid:7) k = 1 P k (cid:11) 1 m ( 10 ) where P k are the m dominant poles of the common TF . The difference TF H diff modiﬁes the bandwidth expression ω max depending on how H comm and H diff are connected with each other , e . g . , series or parallel . For series connection , the bandwidth corresponding to TF H comm × H diff is equal to the following value : ω H comm H diff max ≈ (cid:10) | 1 − DC gain H comm DC gain H diff | m + n (cid:7) k = 1 P i (cid:11) 1 m + n ( 11 ) where TF H diff has n dominant poles that are not among the m dominant poles of TF H comm . The change in bandwidth due to TF H diff is equal to the following expression : ω H comm H diff max ω H comm max ≈ (cid:12) ( DC gain H diff (cid:9) n P i ) m ( DC gain H comm (cid:9) m P i ) n (cid:13) 1 m ( m + n ) . ( 12 ) The above expression indicates that the resulting bandwidth increases if the DC gain of H diff is higher than for H comm , and the distance of the dominant poles to the origin is higher for TF H diff than for H comm . Note that the increase is sublinear ( exponential with subunitary exponent ) . For parallel connection , the bandwidth change due to H comm + H diff is estimated as follows . Let us assume that each TF is expressed as H i = (cid:3) j z j (cid:3) i P i , where z j are zeros and P i are poles . The two bandwidths relate as in the next expression ω H comm + H diff max ω H comm max ≈ ⎡ ⎢⎢⎢⎣ (cid:17)(cid:12) 1 + DC gain H diff DC gain H comm (cid:13) (cid:9) n P i ) (cid:18) m ( DC gain H comm (cid:9) m P i ) n ⎤ ⎥⎥⎥⎦ 1 m ( m + n ) . ( 13 ) Expressions ( 12 ) and ( 13 ) are used repeatedly for general - ized products and sums of TFs . The overall bandwidth also changes because some of the dominant poles of TFs H comm and H diff , respectively , are canceled by the zeros of H diff and H comm . The bandwidth increase is higher if the poles are close to the origin [ 30 ] . Moreover , for TF sums H comm + H diff , pole - zero cancelations are possible only if H comm and H diff have at least one common pole . That common pole can be canceled out by the resulting zero . For example , if TFs H comm = z 1 P 1 P 2 and H diff = z 2 P 1 P 3 then the distinguishing poles P 2 and P 3 cannot be canceled out by the resulting zero z 1 P 3 + P 2 z 2 , but the common pole P 1 can be eliminated . The other bandwidth related constraints state that the secondary poles should be well separated from the origin and that the sum of the dominant poles is close to the origin [ 30 ] . Fig . 7 presents routine Constraints − TFHs , the algorithm for generating constraints for bandwidth performance . The routine is called for every TF pair < H comm , H 1 ( 2 ) , diff > calculated for the two circuits , starting from the inner - most structures and proceeding to the outer - most structures of matched nodes . Arguments are the common and difference TFs as well as the rule saying if the two TFs are added up or multiplied . The routine ﬁrst computes the sets of poles P comm and zeros Z comm for TF H comm , and P diff and Z diff for TF H diff . Then , for every subset i of poles in set P comm ∪ P diff , it generates constraints indicating that the poles are dominant , close to the origin , and the bandwidth change is as expressed in ( 12 ) and ( 13 ) . Then , for every subset k of zeros of set Z comm ∪ Z diff , the algorithm produces constraints for canceling poles and zeros . The produced constraints can be expressed as shown in Fig . 5 ( b ) . Nodes OR describe alternatives of constraints , which may or may not be used in design . For example , constraints for pole and zero cancelation can be optional . Nodes AND indicate sets of compulsory constraints , such as constraints expressing the dominant poles of TFs H comm and H diff . Nodes XOR deﬁne mutually exclusive alternatives , such as the constraint sets created for each possible pole set i . 3 . Noise . Increasing the signal - to - noise ratio ( SNR ) re - quires decreasing the noise power Power noise in the frequency band of interest (cid:2)f . The noise power of noise source i is Power noise = (cid:22) (cid:2)f S i | H i | 2 df , where S i is the power spectral density of the source , and H i is the noise TF . Let us as - sume that the noise TF H i is approximated as shown in Fig . 5 ( c ) , where each segment has a slope of − 20 dBdec , and P n , i are the dominant poles of TF H i . Then , Power noise ≈ (cid:8) f i , f i + 1 S i ( Gain ( f i ) − slope i , i + 1 f ) 2 df . Frequencies f i and f i + 1 correspond to the consecutive poles P n , i and P n , i + 1 . Gain ( f i ) is the gain at frequency f i . The slope of the segment , slope i , i + 1 , depends on the position of pole P i , assuming that every pole introduces a slope change of − 20 dbdec . For thermal noise , S i = 4 kTcg m , hence Power noise = 4 kTcg m (cid:8) f i , f i + 1 ( Gain ( f i ) 2 (cid:2)f − Gain ( f i ) slope i , i + 1 (cid:2)f 2 + slope 2 i , i + 1 (cid:2)f 3 3 ) . If Gain ( f i ) > slope i , i + 1 f i + 1 2 then Gain ( f i ) must decrease to reduce the noise power Power noise . This originates a tradeoff for gain Gain ( f i ) as lower gain produces a smaller noise power but affects other performance attributes , like circuit gain and bandwidth . The constraint analysis for the noise power of ﬂicker noise is similar . D . Performance Characterization Performance characterization identiﬁes the impact of the constraints deduced during the previous steps on circuit per - formance . The deduced constraints include those created by nodal matching ( e . g . , the conditions under which two nodes can be (cid:5) - matched ) , constraint generation process ( i . e . pole and zero placement , pole - zero cancelation , and so on ) , and 624 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 constraints imposed by the requirements of the application . Performance characterization uses these constraints to identify : 1 ) free and trade - off variables ; 2 ) requirements for the variable values , such as variables that must be close to zero or have very large value ( ∞ ) ; and 3 ) variables that must be much smaller or larger than others . Free variables are variables that can improve performance attributes without worsening other performance attributes or affecting other variables . Trade - off variables improve certain attributes while damaging others . The constraints on variable values and their nature ( like free or trade - off variables ) is used to infer their impact on the individual performance attributes . The produced impact data ranks the two circuits with respect to their capabilities in achieving certain performance values . First , the set of constraints is used to identify the free and trade - off variables as well as requirements for their values . The impact of the variables on individual performance attributes is summarized through tables that present how the variable must be changed ( e . g . , increased or decreased ) in order to improve that attribute . Tables I and II in Section V illustrate the concept . Second , the dependency of the performance attributes on free and trade - off variables is computed . The widths of the devices setting the free and trade - off variables are varied over their range . Note that the method presents the relative performance changes of two circuits , and not the absolute performance values ( though this could be easily included ) . The analysis considers two cases for the values of matched param - eters in the two circuits : common parameters are large or small compared to the distinguishing parameters that are varied . Bias currents of circuit branches containing matched devices are kept constant to ensure that the common path is not altered by varying device sizes . For systematic comparison , the output branch of each circuit is also considered at ﬁxed biasing . Figs . 9 and 10 exemplify the analysis results . Every at - tribute P erf i is shown as a plot presenting its dependency on variable var j . As shown in the ﬁgures , the dependency can indicate little correlation with the variable ( e . g . , pole P 1 ) , linear dependency ( i . e . pole P 3 ) , and nonlinearity of various gradients ( such as poles P 2 and P 4 ) . Note that the nature of the dependency plots depends not only on the nature of the constraints deﬁning the variables but also the value ranges of the constants . Section V discusses these aspects in detail . V . Experiments We illustrate the method by comparing the ampliﬁer circuit AMP 1 [ 31 ] with the voltage ampliﬁer AMP 2 [ 24 ] . Fig . 8 shows the two - folded cascode ampliﬁer topologies . Fig . 8 ( c ) depicts the UBBB models of the two circuits . The comparison of a different pair of circuits is presented in [ 32 ] . The combined execution time of the most intensive com - putationally intensive parts , SA and Hungarian algorithm for nodal matching , is 300 s . SA had 1200 iterations . Due to its stochastic nature , the SA algorithm must be restarted about 10 times to generate the complete lists of matched nodes of a node . The execution time of LP equation solving for checking the feasibility of a matching solution is about 0 . 01 s . The execution time was measured on a dual - core PC computer at 2 . 0 GHz . A . Nodal matching In Fig . 8 , the perfectly matched circuit nodes are shown fully ﬁlled . The differential input stage nodes V in + , V in − ( signal inputs ) , V 1 , V 3 , and V 2 in AMP 1 and AMP 2 share the same symbolic pole and coupling expressions ( Fc i , i = 1 , 8 ) in both ampliﬁers . The partially matched nodes are shown with hashed ﬁll ( nodes V4 , V5 , V7 in AMP 1 and AMP 2 ) . The unmatched nodes are encircled : circuit nodes V 6 and V o ( output ) differ signiﬁcantly between the two designs as their symbolic expressions cannot be matched . In addition , nodes V 4 a and V 4 b from AMP 2 have no equivalents in AMP 1 . For the UBBB model graphs in Fig . 8 ( c ) , the common node couplings ( Fc i ) are presented with solid lines and the different couplings ( Fd j ) are shown with bold dashed lines . The set of matched devices ( i . e . with all matched parameters like g mg , C gd , etc . ) includes M 1 , 2 , M 5 , M 3 , 4 , and M 8 , 9 . Indexes are the same for both ampliﬁers . The other devices cannot be fully matched and their parameters account for the different TFs . For example , at the partially matched node V 4 , for the resistive pole component , g md 4 a + g mg 4 a in AMP 2 cannot be matched to g md 8 in AMP 1 . Note that the matched edge Fc 7 is also considered in the expression of H 1 , diff , due to the lack of a direct coupling from node V 4 to V 5 in AMP 2 . B . Circuit Matching The input block contains distinguishing substructures for poles at partially matched nodes V 4 and V 5 , with an unmatched coupling F d 2 from node V 4 . The additional nodal structures of V 4 a and V 4 b , with the respective different graph edges Fd j , j = 3 , 6 , are speciﬁc only to AMP 2 . The output block is characterized only by distinguishing attributes : the same number of nodes are encountered in both ampliﬁers , but with different substructures ( V 6 , V 7 , and V o ) . Different coupling between the output stage nodes are found in AMP 1 and AMP 2 . For example , there is no coupling V 6 → V 7 ( F d 11 ) in AMP 2 , while the output node is no longer linked to the block input node ( V 5 ) but to the internal node V 6 . Using the matched and distinguishing structures , the method produces the set of symbolic transfer functions ( TFs ) for each circuit block , deﬁning both the common and distinguishing symbolic terms . The TFs to node V 5 of the input block of AMP 1 and AMP 2 are as follows : AMP 1 : H V 5 = H ( 1 ) comm × H ( 1 ) 1 , diff + H ( 2 ) comm × H ( 2 ) 1 , diff ( 14 ) AMP 2 : H V 5 = H ( 1 ) comm × H ( 1 ) 2 , diff + H ( 2 ) comm × H ( 2 ) 2 , diff ( 15 ) where H ( 1 ) comm and H ( 2 ) comm are the common signal paths in both ampliﬁers and H ( i ) 1 ( 2 ) , diff ( i = 1 , 2 ) captures the differences of the two input blocks H ( 1 ) comm = Fc 7 P 2 [ ( Fc 4 + P 1 Fc 5 Fc 1 ) V in + + ( P 1 Fc 5 Fc 2 ) V in − ] ( 16 ) H ( 2 ) comm = Fc 8 P 3 [ ( P 1 Fc 6 Fc 1 ) V in + + ( Fc 3 + P 1 Fc 6 Fc 2 ) V in − ] ( 17 ) H ( 1 ) 1 , diff = R 5 1 + sR 5 C 5 , H ( 2 ) 1 , diff = R 5 R 4 Fd 2 Fc 7 ( 1 + sR 5 C 5 ) ( 1 + sR 4 C 4 ) ( 18 ) H ( 1 ) 2 , diff = H ( 1 ) 1 , diff , H ( 2 ) 2 , diff = R 5 R 4 ( Fd 2 + A ) ( 1 + sR 5 C 5 ) ( 1 + sR 4 C 4 ) ( 19 ) FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 625 Fig . 8 . Two - folded cascode ampliﬁers , ( a ) AMP 1 [ 31 ] and ( b ) AMP 2 [ 24 ] , and ( c ) their UBBB models . where P i = R i 1 + sR i C i and A = R 4b Fd 6 1 + sR 4b C 4b (cid:12) Fd 3 + R 4a Fd 4 Fd 5 1 + sR 4a C 4a (cid:13) . The output blocks of the two designs are composed only of unmatched structures , resulting in distinguishing TFs to node V o AMP 1 : H ( 3 ) 1 , diff = R o 1 + sR o C o ( Fd 9 + B ) ( 20 ) where B = R 7 Fd 10 1 + sR 7 C 7 (cid:12) Fd 8 + R 6 Fd 7 Fd 11 1 + sR 6 C 6 (cid:13) AMP 2 : H ( 3 ) 2 , diff = R o 1 + sR o C o (cid:12) R 7 Fd 8 Fd 10 1 + sR 7 C 7 + R 6 Fd 7 Fd 9 1 + sR 6 C 6 (cid:13) . ( 21 ) C . Generate Constraints The impact of the common TFs on performance is char - acterized by ﬁrst eliminating the impact of the distinguishing TFs , e . g . , imposing the conditions that H ( 2 ) 1 , diff match H ( 2 ) 2 , diff or that the effect of H ( 2 ) 1 , diff and H ( 2 ) 2 , diff can be neglected . Then , the DC gain improvement constraints for the common parts is equal to H ( 1 ) comm ≡ H ( 2 ) comm : g mg 1 g ms 8 g md 1 + g md 3 + g ms 8 ( K ( 1 ) diff + K ( 2 ) diff ) (cid:13) . ( 22 ) K ( i ) diff represent the constant values of the corresponding dif - ferent TFs . There is limited DC gain improvement due to the common TFs as only device M 3 is not part of both numerator and denominator in ( 22 ) . Also , setting the two poles of the common TFs ( P 1 , P 2 / P 3 ) to be dominant with respect to those of distinguishing TFs in the input block of the ampliﬁers generates the constraints 1 2 g ms 1 + g md 5 (cid:13) and 2 ( C gs1 + C sb1 ) + C gd5 + C db5 (cid:13) ; ( 23 ) 1 g md 1 + g md 3 + g ms 8 (cid:13) and C gd 1 + C db 1 + C gd 3 + C db 3 + C gs 8 + C sb 8 (cid:13) . ( 24 ) Another tradeoff appears with the constraints imposed for improving noise performance of the common TFs , namely with g ms 1 ( 2 g ms 1 + g md 5 ) ( g md 1 + g md 3 + g ms 8 ) (cid:14) . ( 25 ) In this case , all g m variables are trade - off variables with respect to the dominant pole and DC gain constraints . The tradeoff between gain and noise with respect to g ms 8 can be eliminated by allowing the variable to be sufﬁciently large , e . g . , g ms 8 > > g md 1 + g md 3 . A tradeoff with the dominant position of pole P 2 ( P 3 ) in constraint ( 24 ) still exists . Transfer expressions ( 14 ) – ( 19 ) show that the input blocks of circuits AMP 1 and AMP 2 differ because of the poles at nodes V 5 , V 4 , V 4 a and V 4 b and the coupling between nodes V 4 → V 2 in AMP 1 and V 4 → V 5 , V 4 → V 4 a → V 4 b → V 5 , and V 4 → V 4 b → V 5 in AMP 2 . For the input block of AMP 1 , it produces the following gain improvement constraint K 1 K 2 + g md 11 + K 1 K 3 ( K 2 + g md 10 ) ( K 2 + g md 11 ) (cid:13) . ( 26 ) For AMP 2 , the gain improvement is expressed as K 1 K 2 + g md 4 b + K 1 g mg 4 b ( K 2 + g md 4 a + g mg 4 a ) ( K 2 + g md 4 b ) C (cid:13) , ( 27 ) where C = 1 − g ms4b g ms4b + g md6b + g mg6b . Constants K i include matched parameters K 1 = g mg 1 g ms 8 g md 1 + g md 3 + g ms 8 , K 2 = g md 8 , K 3 = g mg 3 g ms 8 g md 1 + g md 3 + g ms 8 . ( 28 ) The matching of common devices of the differential stage , i . e . M 1 ≡ M 2 , M 3 ≡ M 4 , and M 8 ≡ M 9 , was considered . DC gain of the output block of AMP 1 improves relative to the gain of the same block of AMP 2 if the following constraint is met 1 g md 6 + g md 7 (cid:12) g mg 6 + g mg 7 g mg 13 K 4 + g md 13 D (cid:13) (cid:13) , ( 29 ) where D = g mg15 g md14 + g mg14 + g md15 . In the case of AMP 2 , the output block source follower conﬁguration’s gain can be improved if 1 g ms 11 + g ms 13 (cid:12) g mg 10 g mg 11 K 4 + g ms 10 + g mg 13 g mg 15 g md 14 + g ms 15 (cid:13) (cid:13) , ( 30 ) For both designs , K 4 = g md 12 . For improving CMRR , the underlying constraint involves parameters related only to matched devices g md 5 g md 5 + g ms 1 + g ms 2 < < 1 , (cid:14) . ( 31 ) The differences in the two circuits impact differential and common - mode gain in the same manner , thus resulting in similar CMRR for both circuits . 626 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 TABLE I Performance Tradeoffs in AMP 1 Output Block Variables Gain Noise Pole Set GPP gmd 13 (cid:14) (cid:13) (cid:14) (cid:13) gmg 13 (cid:13) (cid:14) – (cid:13) Cgd 13 + Cdb 13 – (cid:13) (cid:13) (cid:14) Cgs 13 + Cgd 13 + Cgb 13 – (cid:13) (cid:14) – gmd 14 + gmg 14 (cid:14) (cid:13) (cid:13) (cid:14) Cdb 14 + Cgs 14 + Cgb 14 – (cid:13) (cid:14) – gmd 15 (cid:14) (cid:13) (cid:13) (cid:14) gmg 15 (cid:13) (cid:14) – (cid:13) Cgd 15 + Cdb 15 – (cid:13) (cid:14) – gmd 6 (cid:14) (cid:13) (cid:14) – gmg 6 (cid:13) (cid:14) – (cid:13) Cgd 6 + Cdb 6 – (cid:13) (cid:13) (cid:14) gmd 7 (cid:14) (cid:13) (cid:14) – gmg 7 (cid:13) (cid:14) – (cid:13) Cgd 7 + Cdb 7 – (cid:13) (cid:13) (cid:14) Cgs 7 + Cgd 7 + Cgb 7 – (cid:13) (cid:13) (cid:14) Two dominant poles were considered for comparing the gain - poles product ( GPP ) and bandwidth of the two circuits . Topologies can have two poles located before the unity gain frequency , and the pole relative positioning and separation impacts signiﬁcantly the AC performance . For brevity reasons , the discussion refers only to the output block , but a similar analysis was conducted for the input block too . The output block of AMP 1 is characterized by the dominant pole set P o and P 7 ( with P 6 nondominant ) . The constraints for this set are as shown next 1 g md 6 + g md 7 (cid:13) and K 10 + C gd6 + C db6 + C gd7 + C db7 (cid:13) , ( 32 ) 1 K 4 + g md 13 (cid:13) and K 11 + C gd 13 + C db 13 + C gs 7 + C gd 7 + C gb 7 (cid:13) , ( 33 ) 1 g md 14 + g mg 14 + g md 15 (cid:14) and C gd 15 + C db 15 + C gs 13 + C gd 13 + C gb 13 + + C db 14 + C gs 14 + C gb 14 (cid:14) ( 34 ) based on the distinguishing parameters in the conﬁguration of poles P o , P 7 , and P 6 . The circuit block GPP improvement constraints requires K 10 + C gd 6 + C db 6 + C gd 7 + C db 7 (cid:14) and K 11 + C gd 13 + C db 13 + C gs 7 + C gd 7 + C gb 7 (cid:14) and g mg 6 + g mg 7 g mg 13 g mg 15 g md 14 + g mg 14 + g md 15 (cid:13) and 1 K 4 + g md13 (cid:14) . ( 35 ) The common parameters provide constants K 10 = C m 1 and K 11 = C gd12 + C db12 + C m2 . ( 36 ) The output block of AMP 2 is described by three feasible dominant pole sets : ( 1 ) P 6 , P 7 , ( 2 ) P o , P 6 , or ( 3 ) P o , P 7 . For the ﬁrst set , the constraints on distinguishing variables are 1 g ms 15 + g md 14 (cid:13) and C gs 15 + C sb 15 + C gd 14 + C db 14 + C gs 13 + C gd 13 + C gb 13 (cid:13) ; ( 37 ) 1 K 4 + g ms 10 (cid:13) and K 12 + C gs 10 + C sb 10 + C gs 11 + C gd 11 + C gb 11 (cid:13) ; ( 38 ) 1 g ms 11 + g ms 13 (cid:14) and C gs11 + C sb11 + C gs13 + C sb13 (cid:14) ( 39 ) for poles P 6 , P 7 , and P o , respectively . For the remaining two pole sets , constraints ( ( 37 ) ) – ( ( 39 ) ) are reversed based on considered dominant and nondominant poles . TABLE II Performance Tradeoffs in AMP 2 Output Block Variables Gain Noise Pole Set GPP 1 2 3 1 2 3 gms 10 (cid:14) (cid:13) (cid:14) (cid:13) (cid:14) (cid:13) (cid:14) (cid:13) gmg 10 (cid:13) (cid:14) – – – (cid:13) (cid:13) (cid:13) Cgs 10 + Csb 10 – (cid:13) (cid:13) (cid:14) (cid:13) (cid:14) – (cid:14) gmd 14 (cid:14) (cid:13) (cid:14) (cid:14) (cid:13) (cid:13) (cid:13) (cid:14) Cgd 14 + Cdb 14 – (cid:13) (cid:13) (cid:13) (cid:14) (cid:14) (cid:14) – gms 15 (cid:14) (cid:13) (cid:14) (cid:14) (cid:13) (cid:13) (cid:13) (cid:14) gmg 15 (cid:13) (cid:14) – – – (cid:13) (cid:13) (cid:13) Cgs 15 + Csb 15 – (cid:13) (cid:13) (cid:13) (cid:14) (cid:14) (cid:14) – gms 11 (cid:14) (cid:13) (cid:13) (cid:14) (cid:14) (cid:14) – – gmg 11 (cid:13) (cid:14) – – – (cid:13) (cid:13) (cid:13) Cgs 11 + Csb 11 – (cid:13) (cid:14) (cid:13) (cid:13) – (cid:14) (cid:14) Cgs 11 + Cgd 11 + Cgb 11 – (cid:13) (cid:13) (cid:14) (cid:13) (cid:14) – (cid:14) gms 13 (cid:14) (cid:13) (cid:13) (cid:14) (cid:14) (cid:14) – – gmg 13 (cid:13) (cid:14) – – – (cid:13) (cid:13) (cid:13) Cgs 13 + Csb 13 – (cid:13) (cid:14) (cid:13) (cid:13) – (cid:14) (cid:14) Cgs 13 + Cgd 13 + Cgb 13 – (cid:13) (cid:13) (cid:13) (cid:14) (cid:14) (cid:14) – The noise - related comparison of the two circuits is as follows . It includes the noise contribution of different features , while also providing the mechanism to reduce total output noise . The noise performance of the output block in AMP 1 is improved when g mg 13 g mg 15 g md 15 + g md 14 + g mg 14 (cid:14) and g mg7 K 4 + g md13 (cid:14) and g mg 6 g md 6 + g md 7 (cid:14) and K 10 + C gd6 + C db6 + C gd7 + C db7 (cid:13) and K 11 + C gd 13 + C db 13 + C gs 7 + C gd 7 + C gb 7 (cid:13) and C gd 15 + C db 15 + C gs 13 + C gd 13 + C gb 13 + + C db 14 + C gs 14 + C gb 14 (cid:13) or g m 6 ≈ g m 7 and g m13 ≈ g m12 and g m15 ≈ g m14 ( 40 ) while for the output block of AMP 2 , the noise impact of distinguishing parameters is reduced if g mg 10 g mg 11 K 4 + g ms 10 (cid:14) and g mg13 g mg15 g md14 + g ms15 (cid:14) and 1 g ms 11 + g ms 13 (cid:14) and C gs11 + C sb11 + C gs13 + C sb13 (cid:13) and C gs 15 + C sb 15 + C gd 14 + C db 14 + C gs 13 + C gd 13 + C gb 13 (cid:13) and K 12 + C gs 10 + C sb 10 + C gs 11 + C gd 11 + C gb 11 (cid:13) or g m 11 ≈ g m 13 and g m10 ≈ g m12 and g m15 ≈ g m14 . ( 41 ) D . Performance Characterization The output block variables and the related tradeoffs are summarized in Table I for AMP 1 and Table II for AMP 2 . The output block of both ampliﬁers have only trade - off variables . All distinguishing parameters , in either pole set conﬁguration , have at least one conﬂicting variation . For example , in AMP 1 , improving noise performance as in ( ( 40 ) ) and setting dominant pole position as in ( ( 32 ) ) by increasing C gd 6 + C db 6 degrade bandwidth and GPP according to ( ( 35 ) ) . The performance change due to distinguishing parameters was analyzed next to gain insight on the qualitative and quantitative impact of each variable . For the output blocks of the two circuits , Fig . 9 shows the impact on performance in AMP 1 when distinguishing devices M 13 and M 14 are varied . This impacts the design parameters from Table I in rows 1 to 6 . Both widths were changed at the same rate and in the same direction , maintaining a constant current mirror ratio . The ex - amined pole scenario is formed of poles P 7 and P o . The latter was not illustrated as it is considered constant in this case . Both poles are located before frequency f 0 on the frequency FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 627 Fig . 9 . Output block performance tradeoffs for AMP 1 with respect to widths W 13 and W 14 when widths W 15 , W 6 , and W 7 are constant . Fig . 10 . Output block performance tradeoffs for AMP 2 when widths W 13 and W 14 vary in opposing direction . axis . For either common parameter value , gain is not impacted by more than ≈ 5 % across the investigated range . For large common parameters , frequency f P 7 remains relatively unchanged , resulting in a constant distance to frequency f Po . As a result , unity gain frequency is not degraded by more than ≈ 5 % for the maximum reduction in frequency f P 7 . For small common parameters , a more pronounced degradation results , close to ≈ 15 % , since frequency f P 7 can now reduce by ≈ 5 % . The proximity to the constant frequency f Po transforms the pair of poles into a single second order pole , causing the faster reduction in frequency f 0 when widths W 13 and W 14 increase . For noise performance , the two common parameter scenarios behave in opposition . However , in either case , the nonlinear dependence illustrates that the total output noise is reduced when distinguishing parameters are comparable with common constants . This favors the case of large common parameters , as noise is minimum for the highest gain while bandwidth properties are relatively unchanged . The performance trends for varying the current mirror M 14 and M 13 ratio of AMP 2 are given in Fig . 10 . For this analysis , we increase W 13 while reducing W 14 . Notable changes are exhibited in the behavior of gain and noise . As expected , DC gain can now be increased as the current mirror ratio increases and is maximized for the highest ratio W 13 / W 14 . However , the optimal noise performance is now offset from the maximum gain and is minimized for comparable values of the parameters . The small common parameter case is favorable as an extended range of values of the variables offers lower noise . This extended range is due to the smaller impact on the transfer characteristic , which diminishes the impact of the M 14 and M 13 mismatch . The case of large common parameters is deﬁned by a sharper minimum . For both cases , further increasing gain from the noise optimum worsens noise faster than gain improves . E . Summary The gain of AMP 1 can be controlled by six different de - vice widths through 12 distinguishing small - signal parameters . There are four direct and eight inverse relations between gain value and parameters . In terms of the variations required to improve gain , there are four situations of opposing trends ( indicating design tradeoffs ) . For noise , the same six device widths are involved , inﬂuencing a total of 44 distinct transcon - ductance and capacitance parameters . They involve 25 direct ( out of which 21 are square - root dependences ) and 35 inverse relations , with 10 conﬂicting variation cases between parame - ters . In the case of pole sets and bandwidth , the six transistor widths control 35 parameters found in 26 direct and 48 inverse relations for all pole sets considered . There are 39 design trade - off expressions . For AMP 2 , gain can be controlled by seven different de - vice widths through 16 distinguishing small - signal param - eters . There are six direct and 11 inverse relations . There are seven opposing trends ( indicating design tradeoffs ) . For noise , the same seven widths are involved , inﬂuencing a total of 61 distinct transconductance and capacitance parameters . They involve 30 direct ( out of which 24 are square - root dependences ) and 44 inverse relations , with 19 conﬂicting variation cases between parameters . In the case of pole sets and bandwidth , the seven transistor widths control 50 in - ﬂuencing parameters found in 78 direct and 203 inverse relations for all pole sets considered . There are 136 trade - off expressions . The comparison suggests that AMP 2 offers greater ﬂexibil - ity in achieving performance improvements since it presents a considerably increased number of distinguishing design variables that can be used to control performance . AMP 2 is likely to perform better for low noise , high bandwidth applications . The input block characteristics are well con - trolled by parameters related to M 6 a / 6 b : noise minimization and unity gain frequency maximization occur at node V 5 . A lower noise can be transferred to circuit output V o through the characteristic of the output block , which has additional noise reduction through M 10 / 15 while keeping relatively unchanged the bandwidth behavior . The noise of AMP 1 is bounded , hence cannot be improved through distinguishing parameters . 628 IEEE TRANSACTIONS ON COMPUTER - AIDED DESIGN OF INTEGRATED CIRCUITS AND SYSTEMS , VOL . 32 , NO . 4 , APRIL 2013 The size of the symbolic expressions was manageable due to the “partitioning” of the circuits into topologically matched substructures ( like the input and output blocks of the two ampliﬁers ) and separating the symbolic signal paths into common and distinct paths . However , the complexity of the symbolic expressions increases in situations in which there is little matching of topologies and electrical behavior , and therefore , the circuits and their TFs cannot be decomposed . We intend to extend the proposed method to include a more general matching mechanism , in which entire clusters of nodes in a circuit are merged into super - nodes ( characterized by TFs and not poles ) and edges , also labeled by TFs , connect the super - nodes . The matching steps are to be conducted on this more abstract representation . We expect that a critical problem is to understand how node merging must be controlled to obtain good quality comparison results . The imprecision of the circuit comparison method is mainly due to the nodal and circuit matching steps . Certain symbolic terms are neglected as long as the matching error is less than (cid:5) and constraint feasibility is satisﬁed . This can result in ( small ) overestimation of TFs H comm and ( small ) underestimation of the TFs H diff . Therefore , the constraints between variables and performance attributes might incorporate small inaccuracies . Another source of imprecision is due to considering a limited number of dominant poles for constraint generation ( usually 2 or 3 poles ) . However , the trade - off tables are less affected by imprecision as they offer qualitative descriptions , which are less likely to change once the main trends are captured . UBBB models are accurate compared to SPICE simulation [ 10 ] . Performance plots use UBBB models and therefore are also insensitive to the imprecision of the comparison method . Future work could study the impact of the matching error (cid:5) on the imprecision introduced during comparison . In a manual design ﬂow , assuming the UBBB models for circuits are available , the extra effort for using the comparison method relates to correlating the equations of the constraints between variables and performance , the trade - off tables , and the performance plots . Also , effort is needed to select good values for (cid:5) , and deciding which alternatives to analyze for possible pole placements and pole - zero cancellations . F . Applications of Circuit Comparison Method The proposed circuit comparison method can be utilized for the following three design automation tasks . 1 ) Incremental Topology Reﬁnement : The proposed circuit comparison method is useful to identify incremental topology changes that can combine the beneﬁts of each topology . For example , let us consider a high gain requirement . For the output block of AMP 2 , the distinguishing parameters of devices M 10 / 15 do not add gain due to their source follower conﬁguration , which introduces a DC transfer contribution ∝ g mg / ( g mg + g md ) . By comparison , the common source device M 15 in AMP 1 increases gain . An incremental change in AMP 2 for device M 10 / 15 can impact gain by transforming the DC transfer to ∝ g mg / g md ( and changing AMP 2 to a 2 - stage design ) . The change still reduces noise for speciﬁc sizing strategies . However , ﬂexibility of higher frequency behavior is diminished as the resistive components of the poles at nodes V 6 and V 7 are no longer correlated to the device’s 1 / g mg parameter . In the modiﬁed design , 1 / g md controls this aspect and is primarily set by the current of M 12 / 14 . Hence , under ﬁxed bias , increasing W 10 , 15 to improve g mg and gain would negatively impact the frequencies of poles P 6 and P 7 , dominated by the increasing capacitive components . A similar application is circuit topology feature reuse for new constraints , including those due to design migration to different fabrication process . A topology feature is a small structure of devices that can be added to improve the perfor - mance of a circuit without modifying its functionality . The per - formance tradeoffs and performance bottlenecks ( limitations ) of an existing topology can change when moving to another process . The new bottlenecks can be tackled by searching a library of previous designs to ﬁnd topologies with constraints similar to those causing the bottlenecks but also with dis - tinguishing features that compensate for the bottlenecks . The distinguishing features are then reused in the current solution . 2 ) Circuit Optimization : Understanding the nature of the tradeoffs is important to ﬁnd sizing strategies that relax ( or even eliminate ) some performance tradeoffs , and to concen - trate on the variable ranges that are more likely to produce high quality solutions . For example , in the case of large common parameters W 10 and W 15 for AMP 2 , an increase in bandwidth is obtained as W 10 and W 15 increase . However , this can only be performed for the ﬁrst half of the investigated dimension range . The nonlinear dependence ends quite quickly the band - width growth . Therefore , further increasing the differentiating parameters of AMP 2 only deteriorates power consumption and increases area while posing no advantages for band - width . Similarly , in AMP 1 , increasing W 13 and W 14 beyond the midpoint of the range , while large common parameters are considered ( see Fig . 9 ) , does not further improve noise performance , but decreases bandwidth . This insight allows circuit parameter optimization to focus on the more promising subranges of the variables . In [ 33 ] , a parameter optimization technique for reconﬁgurable (cid:2)(cid:8) modulators is presented , in which performance trade - off tables guide the search process . 3 ) Topology Selection : The insight obtained from circuit comparison can be used to infer the relative limits to which performance can be improved through the distinguishing pa - rameters in each design . For example , having small common parameters in AMP 1 shows that while W 14 is kept greater than W 13 , gain can be increased by ≈ 15 % . At the same time , output noise is reduced or kept constant , effectively decoupling the two performances . For large reverse ratios of the devices , in the ﬁnal quarter of the analyzed range , the tradeoff between gain and noise becomes more demanding , as noise deteriorates faster than gain can be improved . For AMP 2 , the gain - noise tradeoff can be eliminated for a larger portion of the investigated sizing range . This offers AMP 2 greater ﬂexibility in addressing other tradeoffs , since a vaster range of relative sizing between devices M 4 a , 4 b and M 6 a , 6 b can be explored . For this case , varying the sizing across ≈ 70 % of the range increases gain by up to 25 % and impacts noise , which can be improved by up to 50 % . The insight is useful in topology selection as it indicates which circuit structure is better suited for a given speciﬁcation . FERENT AND DOBOLI : MATCHING AND GENERATION FOR COMPARISON OF ANALOG CIRCUITS 629 VI . Conclusion This paper proposed an automated technique for systemati - cally producing comparison data between two analog circuits . The data referred to DC gain , bandwidth , noise , CMRR , and sensitivity . The nodes with similar electric behavior in the two circuits were found through a dual matching approach of circuit topologies and symbolic expressions . Dissimilarities are also identiﬁed in the process . Next , the method computed the constraints that relate the electric behavior to changes of the performance attributes . Using the constraints , the ﬁnal step produced the comparison data , which includes modiﬁcation of design tradeoffs , availability of free design variables , and achievable performance values . The procedure considers a ﬁxed operating point for the com - mon processing path , under the assumption that altering the sizing of devices does not change these conditions . Capturing this type of correlations between common and different struc - tures is beyond the scope of this paper . Such considerations can be incorporated into the method by performing DC condition matching to ﬁnd devices that are constrained by the same branch currents . Extending the analysis to nonlinear perfor - mance is another future goal . Another direction is to improve the circuit matching heuristic , e . g . , by using information on the signal paths that are decided as dissimilar to prune the lists of matching candidates of a node . Finally , the circuit similarities and dissimilarities extracted as symbolic expressions can be validated through numeric SPICE simulations of the two cir - cuits . This requires a sampling procedure that comprehensively covers the device size ranges , such that the numeric values meet the found tradeoffs and constraints . References [ 1 ] A . Doboli and R . Vemuri , “Exploration - based high - level synthesis of linear analog systems operating at low / medium frequencies , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 22 , no . 11 , pp . 1556 – 1568 , Nov . 2003 . [ 2 ] P . Li and L . T . Pileggi , “Compact reduced - order modeling of weakly nonlinear analog and RF circuits , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 24 , no . 2 , pp . 184 – 203 , Feb . 2005 . [ 3 ] F . El - Turky and E . Perry , “Blades : An artiﬁcial intelligence approach to analog circuit design , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 8 , no . 6 , pp . 680 – 692 , Jun . 1989 . [ 4 ] E . Martens and G . Gielen , “Classiﬁcation of analog synthesis tools based on their architecture selection mechanisms , ” VLSI J . Integr . , vol . 41 , no . 2 , pp . 238 – 252 , 2008 . [ 5 ] M . Mar Hershenson , S . Boyd , and T . Lee , “Optimal design of a CMOS op - amp via geometric programming , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 20 , no . 1 , pp . 1 – 21 , Jan . 2001 . [ 6 ] B . Liu , F . Fernandez , and G . Gielen , “Efﬁcient and accurate statistical analog yield optimization and variation - aware circuit sizing based on computational intelligence techniques , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 30 , no . 6 , pp . 793 – 805 , Jun . 2011 . [ 7 ] Y . Wei , H . Tang , and A . Doboli , “Systematic methodology for designing reconﬁgurable delta sigma modulator topologies for multimode communication systems , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 26 , no . 3 , pp . 480 – 496 , Mar . 2007 . [ 8 ] Y . Feng and A . Mantooth , “Algorithms for automatic model topology formulation , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 28 , no . 4 , pp . 502 – 515 , Apr . 2009 . [ 9 ] X . Tan , W . Guo , and Z . Qi , “Hierarchical approach to exact symbolic analysis of large analog circuits , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 24 , no . 8 , pp . 1241 – 1250 , Aug . 2005 . [ 10 ] Y . Wei and A . Doboli , “Structural macromodeling of analog circuits through model decoupling and transformation , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 27 , no . 4 , pp . 712 – 725 , Apr . 2008 . [ 11 ] P . Wambacq , G . G . E . Gielen , P . R . Kinget , and W . Sansen , “High - frequency distortion analysis of analog integrated circuits , ” IEEE Trans . Circuits Syst . II , vol . 46 , no . 3 , pp . 335 – 345 , Mar . 1999 . [ 12 ] J . Phillips , “Projection frameworks for model reduction of weakly nonlinear systems , ” in Proc . Design Autom . Conf . , 2000 . [ 13 ] P . Dobrovolny , G . Vandersteen , P . Wambacq , and S . Donnay , “Analysis and compact behavioral modeling of nonlinear distortion in analog communication circuits , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 22 , no . 9 , pp . 1215 – 1227 , Sep . 2003 . [ 14 ] F . De Bernardidis , M . Jordan , and A . SangiovanniVincentelli , “Support vector machines for analog circuit performance representation , ” in Proc . Design Autom . Conf . , 2003 , pp . 964 – 969 . [ 15 ] M . Storace and O . D . Feo , “Piecewise - linear approximation of nonlinear dynamical systems , ” IEEE Trans . Circuits Syst . I , vol . 51 , no . 4 , pp . 830 – 842 , Apr . 2004 . [ 16 ] B . Bond , Z . Mahmood , Y . Li , R . Sredojevic , V . Stojanovic , and L . Daniel , “Com - pact modeling of nonlinear analog circuits using system identiﬁcation via semidef - inite programming and incremental stability certiﬁcation , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 29 , no . 8 , pp . 1149 – 1162 , Aug . 2010 . [ 17 ] X . Huang , C . S . Gathercole , and H . A . Mantooth , “Modeling nonlinear dynamics in analog circuits via root localization , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 22 , no . 7 , pp . 895 – 907 , Jul . 2003 . [ 18 ] H . Liu , A . Singhee , R . A . Rutenbar , and L . R . Carley , “Remembrance of circuits past : Macromodeling by data mining in large analog design spaces , ” in Proc . Design Autom . Conf . , 2002 , pp . 437 – 442 . [ 19 ] T . Eeckekaert , W . Daems , G . Gielen , and W . Sansen , “Generalized posynomial performance modeling , ” in Proc . Design , Autom . Test Europe Conf . , 2003 , pp . 250 – 255 . [ 20 ] G . Gielen and R . Rutenbar , “Computer aided design of analog and mixed - signal integrated circuits , ” in Proc . IEEE , vol . 88 . Dec . 2000 , pp . 1825 – 1854 . [ 21 ] M . Rewienski , A trajectory piecewise - linear approach to model order reduction of nonlinear dynamical systems , Ph . D . Thesis , MIT , 2003 . [ 22 ] T . McConaghy , T . Eckelaert , and G . Gielen , “Caffeine : Template - free symbolic model generation of analog circuits via canonical form function and genetic programming , ” in Proc . ESSCIRC , 2005 , pp . 1082 – 1087 . [ 23 ] J . R . Phillips , “Projection - based approaches for model reduction of weakly nonlinear , time - varying systems , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 22 , no . 2 , pp . 71 – 187 , Feb . 2003 . [ 24 ] G . Palumbo and S . Pennisi , “Current - feedback ampliﬁers versus voltage operational ampliﬁers , ” IEEE Trans . Circuits Syst . I , vol . 48 , no . 5 , pp . 617 – 623 , May 2001 . [ 25 ] G . Stehr , H . Graeb , and K . Antreich , “Analog performance space exploration by normal - boundary intersection and by Fourier – Motzkin elimination , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 26 , no . 10 , pp . 1733 – 1748 , Oct . 2007 . [ 26 ] M . Hershenson , “Efﬁcient description of the design space of analog circuits , ” in Proc . Design Autom . Conf . , 2003 , pp . 70 – 973 . [ 27 ] B . De Smedt and G . Gielen , “Watson : Design space boundary exploration and model generation for analog and RF IC design , ” IEEE Trans . Comput . - Aided Design Integr . Circuits Syst . , vol . 22 , no . 2 , pp . 213 – 224 , Feb . 2003 . [ 28 ] J . Ram´ırez - Angulo , R . G . Carvajal , J . A . Gal´an , and A . L´opez - Mart´ın , “A free but efﬁcient low - voltage class - AB two - stage operational ampliﬁer , ” IEEE Trans . Circuits Syst . II , vol . 53 , no . 7 , pp . 568 – 571 , Jul . 2006 . [ 29 ] J . Munkres , “Algorithms for the assignment and transportation problems , ” J . SIAM , vol . 5 , no . 1 , pp . 32 – 38 , 1957 . [ 30 ] C . J . M . Verhoeven , A . van Staveren , G . L . E . Monna , M . H . L . Kouwenhoven , and E . Yildiz , Structured Electronic Design . Negative - Feedback Ampliﬁers . Dordrecht , The Netherlands : Kluwer , 2006 . [ 31 ] J . Ramos and M . S . J . Steyaert , “Positive feedback frequency compensation for low - voltage low - power three - stage ampliﬁer , ” IEEE Trans . Circuits Syst . II , vol . 51 , no . 10 , pp . 1967 – 1974 , Oct . 2004 . [ 32 ] C . Ferent and A . Doboli , “Systematic comparison of two low - voltage ampliﬁers using topology matching and performance constraints , ” in Proc . IEEE NEWCAS Conf . , Jun . 2012 , pp . 225 – 228 . [ 33 ] Y . Wei and A . Doboli , “Reconﬁgurable deltasigma modulator topology design through hierarchical mapping and constraint transformation , ” VLSI J . Integr . , vol . 42 , no . 2 , pp . 116 – 127 , 2009 . Cristian Ferent ( S’08 ) received the Dipl . Ing . degree in electronics and telecommunications en - gineering from the Technical University of Cluj - Napoca , Romania , in 2007 and the M . S . degree in electrical engineering from Stony Brook University ( SUNY ) , Stony Brook , NY , in 2008 . He is currently a Ph . D . candidate in the Depart - ment of Electrical and Computer Engineering at Stony Brook University ( SUNY ) , NY . His current research interests include in CAD for analog circuit design , particularly methods for systematic compar - ison and classiﬁcation of circuits based on macromodel descriptions . Alex Doboli ( S’99 – M’01 – SM’07 ) received the M . S . and Ph . D . degrees in computer science from “Po - litehnica” University , Timisoara , Romania , in 1990 and 1997 , respectively , and the Ph . D . degree in com - puter engineering from the University of Cincinnati , Cincinnati , OH , in 2000 . He is currently an Associate Professor with the Department of Electrical and Computer Engineering , Stony Brook University ( SUNY ) , NY . His research is in electronic design automation , with a special interest in mixed - signal CAD , hardware - software codesign , and cyber - physical systems . Dr . Doboli is a member of Sigma Xi .