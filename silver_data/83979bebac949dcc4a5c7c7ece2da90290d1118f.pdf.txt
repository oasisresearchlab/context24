1 Machine learning of enhancer - promoter specificity based on enhancer perturbation studies reveals a distinct class of enhancers . Dylan Barth 1 , 2 , Jonathan Cardwell 3 and Mira V . Han * , 1 , 2 1 School of Life Sciences , University of Nevada , Las Vegas , NV 89154 , USA 2 Nevada Institute of Personalized Medicine , Las Vegas , NV 89154 , USA 3 University of Colorado School of Medicine , Denver , CO , 80045 , USA * To whom correspondence should be addressed . Tel : + 1 - 702 - 774 - 1503 ; Fax : 702 - 895 - 3956 ; Email : mira . han @ unlv . edu ABSTRACT : Motivation : Understanding the rules that govern enhancer - driven transcription remains a central unsolved problem in genomics . Now with multiple massively parallel enhancer perturbation assays published , there are enough data that we can utilize to learn to predict enhancer promoter relationships in a data driven manner . Results : We applied machine learning to one of the largest enhancer perturbation studies integrated with transcription factor and histone modification ChIP - seq . Based on the learned model , we confirmed previously reported rules governing enhancer driven transcription , and we gained some insights that generated new hypotheses , such as a novel role for protecting against replication - transcription conflict at the active enhancers in CHAMP1 . We also identified a distinct class of enhancers that drives target promoter transcription , but is not in strong contact with the promoters . There were two clusters of such enhancers that regulated ATG2A and the histone 1 cluster respectively . These enhancers were different from other typical enhancers , in that they had other strong enhancers nearby , and they also had strong H3K4me3 marks at the target promoters , both patterns that typically predict reduced enhancer influence , but here contributing in the opposite way . In summary , we find that integrating genomic assays with enhancer perturbation studies increases the accuracy of the model , and provides novel insights into the understanding of enhancer driven transcription . Availability : the trained models and the source code are available at https : / / github . com / HanLabUNLV / abic . Contact : mira . han @ unlv . edu 1 Introduction Enhancers are regulatory elements that affect gene expression through the direct physical interaction with promoters . This process often involves gathering various context specific transcription factors at the enhancer and the promoter where the general transcription factors bind to activate transcription . This general model has been validated through many studies ( Palstra et al . , 2003 ; Spilianakis & Flavell , 2004 ; Tolhuis et al . , 2002 ) , but it has also been challenged in certain contexts ( Alexander et al . , 2019 ) . But , the majority of chromatin interactions between accessible regions does not involve a promoter . Instead , genes are surrounded by complex chromatin interactions mostly between enhancers creating a dense Chromatin Interaction Network ( ChIN ) ( Miele & Dekker , 2008 ; Sandhu et al . , 2012 ; Thibodeau et al . , 2017 ) . This framework has opened up the possibility of understanding how enhancers work 2 cooperatively and indirectly in a network to fine - tune the level and timing of transcription ( Lim & Levine , 2021 ; Rowley & Corces , 2018 ; Xiao et al . , 2021 ) . A central question surrounding the interaction between regulatory elements and their target genes , is what principles determine which elements regulate any given gene and how such specificity is achieved . One working model that aims to solve this question is the Activity - by - Contact ( ABC ) model developed by Fulco et al . ( Fulco et al . , 2019 ) . Based on solid biological principles , and a simple additivity assumption , the ABC model only requires 3 genome - wide measurements , H3K27ac , DHS , and Hi - C . The model allows the ranking of the enhancer’s importance to a gene’s regulation as proportional to its activity multiplied by contact . Fulco et al . performed CRISPRi flowFISH experiments and showed the utility of the model by predicting enhancer - promoter ( EP ) pairs with state - of - the - art accuracy ( Fulco et al . , 2019 ) . While the ABC model is elegant , and works better than any alternative approach , it does not utilize the full availability of genomic data . Several important biological factors are ignored in the ABC model , such as the combination of transcription factors , the various chromatin marks other than H3K27ac surrounding the enhancer / promoter or the network of interactions in chromatin contact . A 2019 paper by Song et al . focused on the hierarchical network of chromatin interactions and emphasized the role of what they called primary enhancers which came into direct contact with the promoter ( Song et al . , 2019 ) . Song et al . used Hi - C data to create networks with edges representing contact between enhancers and promoters . Enhancers were then given labels based on how closely they were connected to a promoter on the network , such that e 1 was a step - one enhancer , directly in contact with the promoter , and e n was a step - n enhancer , n - 1 steps removed . e 1 s were the main links between the promoter and other enhancers , evidenced by the fact that e 1 s had a higher betweenness centrality score than the rest of the enhancers in the chain ( Song et al . , 2019 ) . Although showing a distinct pattern of contact between different enhancers , this study was limited by the fact that the enhancers they were studying were not functionally verified . This has been a difficult impasse for many studies interested in how enhancers regulate transcription on a large scale , but with the invention of CRISPR interference ( CRISPRi ) , large parallel assays testing the functionality of individual enhancer elements are now possible . Since Fulco et al . ( Fulco et al . , 2019 ) there have been several large scale studies that deploy CRISPRi to perturb multiple enhancers and measure the effects on gene expression often through single cell RNA - seq ( Gasperini et al . , 2019 ; Schraivogel et al . , 2020 ) . The accumulation of such data provides an opportunity to test the enhancer network model on verified enhancer data , and gain a more detailed understanding of different classes of enhancers . Here , we 3 utilized the largest CRISPRi experiment to date ( Gasperini et al . , 2019 ) to predict functional enhancer - promoter pairs that showed significant downregulation after perturbation . Note that this aim is different from many studies that aimed to predict enhancer elements without relations to its target ( de Almeida et al . , 2022 ; Erwin et al . , 2014 ; Yang et al . , 2017 ) . It is also different from numerous studies that came before high - throughput perturbation experiments such as TargetFinder ( Whalen et al . , 2016 ) or JEME ( Q . Cao et al . , 2017 ) that aimed to predict chromatin interactions ( chromatin loops ) without distinguishing functional effects on gene expression ( F . Cao et al . , 2021 ; Fudenberg et al . , 2020 ; Schwessinger et al . , 2020 ) . The most relevant studies would be the recent study by Bergman et al . ( Bergman et al . , 2022 ) and Martinez - Ara et al . ( Martinez - Ara et al . , 2022 ) that systematically examined the compatibility of enhancers and promoters in human and mice respectively . But , the above studies utilized data from episomal high - throughput reporter assays that are different from CRISPRi experiments that occur in native genomic context . By training a machine learning algorithm on the CRISPRi experiments of Gasperini et al . ( Gasperini et al . , 2019 ) , we could integrate various genomic assays measured on the candidate enhancer and target promoter in native genomic context into the feature space , such as the 3D chromatin contact and various TF ChIP - seq . Based on this framework , we aimed to predict functional enhancer - promoter relationships and learn the important features that contribute to enhancer - promoter specificity , especially in cases of direct and indirect contact . 2 Methods 2 . 1 Candidate Enhancer - promoter pair identification To identify the potential candidate enhancer - promoter pairs in regulatory relationships , we decided to utilize the ABC software that will identify all enhancer and target promoter pairs within a 5Mbp window for every gene in the genome . Briefly , the ABC software defines a list of 500 bp candidate enhancers centered around DHS peaks , and filters out enhancers overlapping an annotated Transcription Start Sites ( TSS ) as promoters . We consider the terms TSS and promoter as interchangeable throughout this study . For candidate enhancers that will be mapped to Gasperini2019 , we used the DNase data ENCFF001UWQ and ENCFF000SVO from ENCODE following ( Gasperini et al . , 2019 ) . For candidate enhancers that will be mapped to Fulco2019 , we used the DNase data wgEncodeUwDnaseK562AlnRep1 and wgEncodeUwDnaseK562AlnRep2 from the UCSC genome browser . 4 2 . 2 Chromatin Interaction N etwork ( ChI N ) generation We generated a chromatin interaction network based on Hi - C contact maps centered around the promoter for each gene , where each node was an enhancer or promoter identified by the ABC software above , and the edge weights of the network were equal to the KR - normalized Hi - C contact between those nodes . At this stage , each gene has a very dense network that is both computationally inefficient to traverse and expensive to store in memory ( Fig . 1A ) . For this reason , we decided to simplify the network with edges that correspond to detectable chromatin loops . We used FitHiC2 ( Kaul et al . , 2020 ) with a cutoff of FDR < 0 . 01 to call significant loops , and only kept the contact edges corresponding to loops , filtering out all edges without a significant loop detected ( Fig . 1B ) . Once these simpler networks were created , they were further filtered by only keeping edges connecting enhancers and the promoters that were tested in Gasperini et al . ( Gasperini et al . , 2019 ) . From these simplified networks , the degree of each enhancer with respect to each nearby promoter was determined following ( Song et al . , 2019 ) . In short , enhancers that were directly connected to the promoter with a significant Hi - C loop were labeled e 1 s , and enhancers that were not connected to the promoter , but were connected to an e 1 were labeled e 2 and so on . Enhancers within the same Hi - C window as the promoters were labeled e 0 s , and enhancers that were more than 3 degrees away from the promoter or were not part of that promoter’s subcomponent of the graph were labeled e inf . 2 . 3 Feature Engineering The input to the machine learning pipeline consists of a feature matrix whose rows are enhancer - promoter pairs , and whose columns represent the variables measured for each entry . The features ( variables ) include measures of histone modification ( H3K27ac , H3K4me3 , H3K27me3 ) around the enhancer , the same histone modifications around the TSS , expression level of the target gene , genomic distance between the enhancer and the TSS , Hi - C contact measure between the enhancer and the TSS , the denominator - numerator of the ABC score that we call the rest - of - ABC representing strengths of other enhancers nearby , the various TF presence at the enhancer measured from 250 ChIP - seq experiments , the 250 TF presence at the TSS , and whether a same TF is bound at the enhancer and the TSS . 5 F i g u r e 1 F i g u re 1 . C h r o m a t i n I n t er a c t i o n N e t w o r k ( C h I N ) g e n er a t i o n p r o ce ss . C h r o m a ti n I n t e r ac ti on N e t w o r k g e n e r a ti on p r o ce ss o f t h e H I S T 1 H 2 B D g e n e a nd it s h i gh l y d e n s e s u rr ound i ng H i - C c on t ac t n e t w o r k . N od e s a r e ca nd i d a t e e nh a n ce r s i d e n ti f i e d b a s e d on op e n c h r o m a ti n , a nd e dg e s a r e t h e K R - no r m a li ze d H i - C c on t ac t s c o r e s b e t w ee n t w o nod e s . T h e p r o m o t e r i s s ho w n i n r e d a nd e nh a n ce r nod e s a r e c o l o r s ca l e d b a s e d o n t h e i r A BC ac ti v it y s c o r e ( g r ee n ; h i gh , b l u e ; l o w ) . A ) U n f ilt e r e d n e t w o r k s ho w i ng a ll H i - C c on t ac t s . B ) N e t w o r k w it h e dg e s f ilt e r e d b a s e d on s i gn i f i ca n t H i - C c on t ac t ( F it H i C 2 q - v a l u e < 0 . 01 ) . C ) N e t w o r k w it h nod e s f ilt e r e d b a s e d on e xp e r i m e n t a l d a t a . O n l y e xp e r i m e n t a ll y t e s t e d ( G a s p e r i n i e t a l . , 2019 ) e nh a n ce r nod e s a r e p r e s e n t i n g r a ph . T h e p a t h c onn ec ti ng a s i gn i f i ca n t e 2 e nh a n ce r t o t h e p r o m o t e r i s h i gh li gh t e d i n r e d . 6 The histone modification peaks were obtained from the histone modification ChIP - seq data from ENCODE ( ENCFF384ZZM for H3K27ac , ENCFF681JQI for H3K4me3 , ENCFF937NEW for H3K27me3 ) and processed following the approach of Fulco et al . The enhancer activity is quantified based on a combination ( geometric mean ) of DNase - seq and H3K27ac ChIP – seq signals following the approach of Fulco et al . The Hi - C scores were obtained from the . hic matrix provided by Aiden et al . ( https : / / hicfiles . s3 . amazonaws . com / hiseq / k562 / in - situ / combined _ 30 . hic ) and processed following the approach of Fulco et al . Hi - C contact scores were calculated based on the Hi - C signal between the enhancer and the TSS of the gene . We note here that although we relied on the ABC software for the candidate enhancer list and the normalization of histone modification marks and Hi - C intensities , we didn’t use the final ABC score in our analysis , because we were interested in how individual features contributed to the prediction . The transcription factor peaks were obtained from the “Transcription Factor ChIP - seq Clusters from ENCODE 3” track from the ucsc genome browser , summarized in a downloadable bed format at https : / / hgdownload - test . gi . ucsc . edu / goldenPath / hg19 / encRegTfbsClustered / encRegTfbsClusteredWithCells . hg19 . bed . gz . We extracted the peaks for the K562 cell type from the file and used bedtools to intersect the peaks of each TF with the set of all enhancers and promoters . The peaks were encoded into integers indicating the number of peaks present within the 500bp region . This process culminated in a set of 768 features recorded for 66 , 283 enhancer - promoter pairs based on a set of 250 TFs . The full list of features can be found in Supplementary table 1 . 2 . 4 Training data , validation data and Independent test data . To compile experimentally verified positive and negative enhancer - TSS pairs that we used for training , validation and test , we overlapped our candidate enhancers and promoters with experimental data from two independent CRISPR perturbation studies , Gasperini2019 ( Gasperini et al . , 2019 ) and Fulco2019 ( Fulco et al . , 2019 ) . The output we aimed to predict is a binary class label that was assigned based on the experiments in Gasperini2019 ( or Fulco2019 ) that is positive ( equal to 1 ) only if blocking said enhancer using a CRISPRi gRNA resulted in significant ( FDR < 0 . 1 ) down regulation of the gene . The parameters for the bedtools intersect command ( bedtools intersect - wo - e - f 0 . 3 - F 0 . 3 - a ) were determined based on the fraction parameter that gave us the maximum intersection between our candidate enhancers and Gasperini2019 . Within Gasperini2019 , some of the enhancers were split into smaller segments targeted by different guide RNA , so there were a few n : 1 relationships between the n smaller Gasperini2019 enhancers all 7 contained within a single larger ( 500bp ) candidate enhancer extracted from DHS peaks . For these , if any of the n enhancers were positive in the experiment , the whole candidate enhancer was called positive in our compiled data . Within Fulco2019 , a few of the enhancers were combined and merged in their final table , leading to longer than expected enhancers . This resulted in both n : 1 and 1 : n relationships between enhancers tested in the experiment , and our candidate enhancers . In case of n : 1 , we followed the same rule , and considered our candidate enhancer positive if any of the contained enhancers tested were positive . In case of 1 : n , all of our candidate enhancers were retained in our dataset , but they were all assigned the same positive or negative outcome based on the Fulco2019 results . The compiled dataset of Gasperini2019 and the associated features was divided into training and test data , by setting aside chromosomes 5 , 10 , 15 , and 20 as test sets . An independent second set of test data was generated by compiling the Fulco2019 and the associated features in the same manner . The remaining training data of Gasperini2019 ( chromosomes other than 5 , 10 , 15 , 20 ) was then divided into a 4 x 4 nested blocked cross validation scheme ( using StratifiedGroupKFold ) , where blocking was based on the groups defined by at least 5Mb of gap separating any of the enhancers or TSS in the data . Any enhancer - TSS pairs that are within the block were assigned to the same group , and all data within the same group were assigned into a single fold , ensuring separation by genomic distance , and thus independence between data across each fold ( Whalen et al . , 2022 ; Xi & Beer , 2018 ) . The grouping of the data and folds can be found in Supplementary Table 2 . The outer folds were used for evaluation of performance , while the inner folds were used for hyperparameter optimization . 2 . 5 Machine learning pipeline We used gradient boosting ( XGBoost ) for the learning algorithm ( Chen & Guestrin , 2016 ) . We explored other algorithms that didn’t give us similar or better performance , so we don’t report those results . As described above , the outer folds were used for evaluation of performance , so all of the scaling , feature selection , hyper - parameter optimization was done within the training split of the outer fold . Test split of the outer fold was used for unseen performance evaluation for the pipeline trained on the train split . We didn’t retrain the final pipeline on combined folds . We opted to evaluate the 4 different pipelines produced by 4 folds separately , to get a measure of uncertainty around our performance evaluation . Within each train split , we scaled the features using MinMaxScaler to be between 0 and 1 . We did feature selection using Boruta with SHAP values as importance measures on gradient boosted trees trained through a preliminary 8 optimization ( Kursa & Rudnicki , 2010 ) . We were more lenient in retaining the features by adjusting the max shadow features importance measure by 80 % , and using a p - value cutoff of 0 . 1 . The hyperparameters of the XGBoost classifier were optimized on the inner CVs using Optuna ( Akiba et al . , 2019 ) , with pruning and early stopping based on the validation set metric . Due to the extreme imbalance in our data ( 605 / 65 , 696 positive cases ) , we used Mean Average Precision ( MAP ) averaged across the inner folds as the metric to maximize during CV . We used the default algorithm of Tree - structured Parzen Estimator , and the MedianPruner on the validation MAP . The search space we explored and the final optimized parameters can be found in Supplementary Table 3 . The SHAP values were calculated using the tree SHAP implementation in XGBoost . SHAP values for the four test folds from the four models were combined through concatenation . 3 Results 3 . 1 Enhancer network characteristics In total , we generated 7 , 396 gene networks . After filtering the edges by calling significant loops ( FDR < 0 . 01 ) using the FitHiC2 software ( Fig . 1B ) , and pruning out any nodes that did not overlap with the Gasperini data ( Fig . 1C ) , the networks had an average of 7 . 4 nodes and 55 . 8 edges ( Fig . 2A , 2B ) . Most of these edges did not connect to the promoter , as on average the degree of the promoter is only 4 . 9 . Despite having few edges directly connected to the promoter on average , the promoter node was often very close to the rest of the nodes in the network . Closeness centrality is a measure of how interconnected a node is within a network and is calculated as approximately the reciprocal of the shortest distance to every node in the network . Values near 1 indicate that the node is separated from the rest of the network by small distances on the graph , and values near 0 indicate that the node is separated from the network by large distances . The majority of the promoters in our networks tend toward a closeness measure of 1 , underscoring their importance within the network despite a lack of direct connections to most nodes in the network ( Fig . 2C ) . 9 F i g u r e 2 A B D C E F count count 800 600 400 200 0 800 600 400 200 0 0 10 20 30 nu m b e r o f n o d e s 0 25 50 75 100 nu m b e r o f e d g e s closeness 1 . 0 0 . 8 0 . 6 0 . 4 p e 1 e 2 e 3 - 1 - 2 - 3 - 4 20 15 10 5 0 activity 1500 1000 500 0 distance ( Kbp ) log 10 contact s i g n i f i c a n t n o t s i g n i f i c a n t s i g n i f i c a n t n o t s i g n i f i c a n t s i g n i f i c a n t n o t s i g n i f i c a n t e 1 e 2 e 3 e i n f e 1 e 2 e 3 e i n f e 1 e 2 e 3 e 1 e 2 e 3 e 1 e 2 e 3 e 1 e 2 e 3 F i g u re 2 . C h I N a nd e nh a n cer c h a r a c t er i s t i c s . H i s t og r a m s s ho w i ng d i s t r i bu ti on o f t h e nu m b e r o f nod e s ( A ) a nd e dg e s ( B ) f o r eac h n e t w o r k . C ) C l o s e n e ss m ea s u r e o f eac h c l a ss , e 1 a nd p r o m o t e r s ho w h i gh e r c l o s e n e ss ce n t r a lit y t o eac h n e t w o r k . A c t i v it y ( D ) a nd C on t ac t ( E ) w it h i n eac h c l a ss o f e nh a n ce r d e li m it e d by f un c ti o n a l s i gn i f i ca n ce i n G a s p e r i n i e t a l . 2019 . F ) L i n ea r d i s t a n ce b e t w ee n eac h c l a ss o f e nh a n ce r a n d t h e i r c o rr e s pond i ng p r o m o t e r s m ea s u r e d i n k bp . 10 3 . 2 Enhancer characteristics Out of 65 , 696 enhancer - promoter pairs that were tested by Gasperini2019 , 605 were positive , i . e . perturbation of the enhancer was found to significantly alter the expression of the target gene . Of those 605 significant EP pairs , 26 were classified as e 0 , 347 were classified as e 1 , 29 were classified as e 2 , 11 were classified as e 3 , and the remaining 192 were classified as e inf , as they were either more than 3 steps away from the promoter on the network or they were not significantly connected to the promoter at all using our FitHiC2 threshold of FDR < 0 . 01 . An example of an e 2 is shown in Fig . 1C . Despite the ABC model not taking into account these higher degrees of enhancer contact , the essence of the model can be seen by comparing the activity and contact of each enhancer class ( Fig . 2D - E ) . As expected , the further away from the promoter on the network , the lower the contact with the promoter is . Focusing specifically on the significant EP pairs reveals that for an enhancer to remain functional despite having lower contact with the promoter , it is required to have a slightly higher activity level to compensate . Song et al . ( Song et al . , 2019 ) noticed a distinction that e 2 were much closer to the promoters in linear genomic distance compared to e 1 , which we did not observe ( Fig . 2F ) . 3 . 3 Integration of additional genomic features improves prediction of functional enhancer - promoter pairs . We evaluated the performance of the trained algorithm on various test datasets to get a robust assessment . The overall mean average precision from the inner fold validations were around 0 . 26 ~ 0 . 28 , and the outer fold average precision on the test folds ranged from 0 . 21 ~ 0 . 30 ( Table 1A ) . Although the outer test fold performance has a larger variance , the overall performance between the CV and the test is comparable , showing that we are not overfitting to the training data . We also had an independent test set from Gasperini2019 consisting of chromosomes 5 , 10 , 15 , 20 that were set aside from the nested cross validation design , and the test performance on those data also showed comparable values of average precision between 0 . 23 - 0 . 29 , again showing estimates of performance without overfitting ( Table 1C ) . We find that integrating various genomic measures as features in the learning increased the performance of enhancer - promoter prediction compared to the ABC model or distance - based prediction . On the Gasperini2019 dataset , we are achieving a modest Average Precision of around 0 . 269 , with as many false negatives and more than 11 I nn e r f o l d s C V p e r f o r m a n c e O u t e r f o l d s t e s t p e r f o r m a n c e M e a n a u c p r a u c p r A v e r a g e p r e c i s i o n B a l a n c e d a cc u r a c y F 1 _ s c o r e 0 . 264 0 . 303 0 . 306 0 . 697 0 . 355 0 . 273 0 . 214 0 . 218 0 . 681 0 . 300 0 . 278 0 . 249 0 . 251 0 . 665 0 . 315 0 . 282 0 . 259 0 . 262 0 . 667 0 . 307 T e s t p e r f o r m a n c e o n G a s p e r i n i 2019 . c h r 5 , 10 , 15 , 20 a u c p r a v e r a g e _ p r e c i s i o n b a l _ a cc u r a c y f 1 _ s c o r e 0 . 233 0 . 238 0 . 738 0 . 355 0 . 255 0 . 261 0 . 705 0 . 291 0 . 281 0 . 287 0 . 763 0 . 365 0 . 287 0 . 290 0 . 730 0 . 326 T e s t p e r f o r m a n c e o n F u l c o 2019 a u c p r a v e r a g e _ p r e c i s i o n b a l _ a cc u r a c y f 1 _ s c o r e 0 . 512 0 . 513 0 . 624 0 . 384 0 . 535 0 . 536 0 . 627 0 . 399 0 . 532 0 . 532 0 . 637 0 . 413 0 . 518 0 . 519 0 . 614 0 . 362 G a s p e r i n i e t a l . F u l c o e t a l . p r e d i c t e d p r e d i c t e d 0 1 0 1 a c t u a l 0 8175 109 4883 . 5 10 . 5 1 40 . 5 37 . 5 166 . 5 56 . 5 a . b . c . d . T a b l e 1 T a b l e 1 . M o d e l p er f o r m a n ce . P e rf o r m a n ce o f l ea r n e d m od e l on G a s p e r i n i 2019 a nd F u l c o2019 d a t a s e t s . A ) I nn e r f o l d C V p e rf o r m a n ce a nd ou t e r f o l d t e s t p e rf o r m a n ce f o r eac h o f t h e f ou r m od e l s t r a i n e d on t h e f ou r f o l d s . B ) C on f u s i on m a t r i x p r odu ce d by t h e m od e l on eac h t e s t d a t a a v e r a g e d ac r o ss t h e f ou r m od e l s . C ) T e s t p e rf o r m a n ce on t h e d a t a fr o m G a s p e r i n i e t a l . 2019 . c h r o m o s o m e s 5 , 10 , 15 , 20 . D ) T e s t p e rf o r m a n ce on t h e d a t a fr o m F u l c o e t a l . 2019 12 F i g u re 3 . C o m p a r i s o n o f m o d e l p er f o r m a n ce . P r ec i s i on - r eca ll c u r v e s o f v a r i ou s m od e l s on A ) G a s p e r i n i 2019 a nd B ) F u l c o2019 d a t a s e t s . I n e v e r y ca s e , ou r m od e l t r a i n e d on t h e i n t e g r a t e d g e no m i c d a t a w it h t h e XG B oo s t a l go r it h m ou t p e rf o r m s bo t h d i s t a n ce b a s e d a nd A BC p r e d i c ti on s . 13 twice false positives as the number of true positives ( Table 1B ) . But considering the challenge of the dataset , which is an extremely imbalanced dataset with less than 1 % positive rate ( 78 positive out of 8326 total in the chr 5 , 10 , 15 , 20 test data ) , we see a meaningful increase in the performance ( Fig . 3A ) . With the Fulco 2019 dataset , which has a higher positive rate of about 4 . 3 % ( 223 positive out of 5117 total ) , the performance reaches 0 . 51 ~ 0 . 54 average precision ( Table 1C ) . We see again a meaningful increase in the performance compared to ABC or distance ( Fig . 3B ) . 3 . 4 Feature importance of the learned model corroborates the ABC model and other rules of transcriptional regulation . To understand where the increased performance is coming from , and gain insight into the prediction of functional enhancer - promoter pairs , we tried to explain the trained model using Shapley values ( SHAP ) ( Lundberg & Lee , 2017 ) . The SHAP values show the features that are important in driving the model’s prediction of functional EP pairs . Positive SHAP value means positive impact on prediction , leading the model to predict 1 ( i . e . perturbation of enhancer results in downregulation of target gene ) . Negative SHAP value means negative impact , leading the model to predict 0 ( i . e . perturbation of enhancer did not have effect on target gene ) . Note that positive enhancer - promoter pairs will tend to have large negative effect size in their differential gene expression after perturbation . To avoid confusion between the terms , we will sometimes use the terms functional vs . non - functional EP pairs , instead of positive vs . negative EP pairs , when we are discussing effect size at the same time . To summarize the SHAP values that we obtained , stronger Hi - C contact , shorter distance between enhancer and target TSS , weaker neighboring enhancers near the TSS , higher target gene expression , higher H3K27ac peak at the enhancer , all contributed to the model to predict positive enhancer - promoter pairs ( Fig . 4 ) . The factors that are components for the Activity by Contact model such as the Hi - C contact , and the H3K27ac chromatin marks at the enhancer were at the top of the feature ranking , confirming the validity and power of the ABC model . In addition , the enhancer - promoter is more likely to be positive when the value of the rest - of - ABC score ( ABC denominator – numerator ) is lower , i . e . when the neighboring enhancers nearby are weaker ( although we see some interesting exceptions that we describe below ) . This also justifies the approach of ABC , which compares the relative effect of each enhancer , normalized by the sum of ABC of other nearby elements . In addition to explaining important features , the boosted trees combined with SHAP analysis gave us insight into the quantitative threshold values of the features that lead to different predictions . For example , the dependence plot of Hi - C contact and H3K27ac shows that Hi - C contact , the most important feature , doesn’t need to be very large 14 Figure 4 . SHAP values . SHAP values of most important features ranked from top to bottom by their mean absolute SHAP values . Every sample of the data appears as a point along the horizontal axis . Colors correspond to the measured value of the input data for that variable . The X axis predicts the outcome as positive or negative . For example , high values of Hi - C contact ( red ) predicts positive outcome ( right of the horizonal axis ) , while low values of distance ( blue ) predicts positive outcome ( right of the horizontal axis ) . Here positive outcome means functional E - P pairs where CRISPRi has a downregulation effect . 15 F i g u re 5 . S t r o n g H i - C c o n t a c t p re d i c t s f un c t i o n a l e nh a n cer - p r o m o t er p a i r s . A ) H i - C c on t ac t s ho w s po s iti v e t r e nd w it h S HA P v a l u e s , a nd i n t e r ac ti on w it h H 3 K 27 ac a t t h e e nh a n ce r . V e r ti ca l p a tt e r n o f c o l o r i ng f o r t h e s a m e v a l u e s o f H i - C c on t ac t r e v ea l s i n t e r ac ti on b e t w ee n H i - C a nd H 3 K 27 ac , r eca p t u r i ng t h e dyn a m i c s o f t h e A BC m od e l . B ) S HA P v a l u e s f o r H i - C on t ac t c o l o r e d by g e no m i c d i s t a n ce b e t w ee n e nh a n ce r a nd p r o m o t e r . C ) C on t ac t by s i gn i f i ca n ce boxp l o t w h i c h s ho w s f un c ti on a l e nh a n ce r s a r e i n s t r ong H i - C c on t ac t w it h t h e i r c o rr e s pond i ng p r o m o t e r s m o r e o f t e n t h a n non f un c ti on a l e nh a n ce r s . D ) T h e p r opo r ti on o f s i gn i f i ca n t d a t a i n c r ea s e s a s H i - C c on t ac t i n c r ea s e s . T h e h i gh e s t p r opo r ti on o f s i gn i f i ca n t d a t a i n ou r d a t a s e t h a s a no r m a li ze d H i - C s c o r e o f 0 . 06 . N u m b e r s i n p a r e n t h e s e s s ho w t h e nu m b e r o f s a m p l e s ( n ) i n eac h H i - C b i n . E ) E ff ec t s i ze v s H i - C s c o r e ( s i gn i f i ca n t s a m p l e s i n r e d ) . S i gn i f i ca n t e nh a n ce r - p r o m o t e r p a i r s w it h s t r on g e r H i - C c on t ac t h a v e l a r g e r n e g a ti v e e ff ec t s i ze ( l a r g e r do w n - r e gu l a ti on fr o m CR I SP R i on p a i r e d e nh a n ce r s ) . 16 in value . The SHAP value rises with a steep slope . Even with a KR - normalized Hi - C contact frequency as small as 0 . 01 , the pairs are more likely to be positive , and the SHAP values plateau by the Hi - C value of 0 . 03 ( Fig . 5A - B ) . Since SHAP values are based on the trained predictive model , we explored whether the signal can be seen in the actual data itself . Data from Gasperini2019 and Fulco2019 both showed large differences in the Hi - C contact strengths between positive pairs and negative pairs ( Fig . 5C ) . As seen from SHAP values we saw an increase in the proportion of significant pairs as Hi - C value increases to as low as 0 . 01 and we observe the plateau by Hi - C contact value of 0 . 03 . ( Fig . 5D ) . Among the functional EP pairs , the effect size shows larger negative values with stronger Hi - C contact ( Fig . 5E ) . Here , larger negative effect size means stronger down - regulation with CRISPR interference , i . e . stronger functional effect . Another interesting feature highlighted by the SHAP analysis is the H3K27ac and H3K4me3 chromatin marks at the TSS . Both chromatin marks contribute to negative prediction , meaning that if there is a strong activating mark at the TSS , the model is less likely to predict a functional enhancer - promoter pair for that TSS ( Fig . 6A - B ) . Initially this seems unexpected , but it is consistent with several observations that have been reported on transcriptional regulation . Bergman et al . showed that promoters of ubiquitously expressed ( housekeeping ) genes , which they called P2 promoters , have higher H3K27ac marks at the promoter and are less responsive to distal enhancers ( Bergman et al . , 2022 ) . Similarly , in both Gasperini2019 , and Fulco2019 , the experiments showed that housekeeping genes are depleted from their positive enhancer - promoter pairs , indicating that housekeeping genes are less influenced by enhancers , and their transcription is sufficiently driven by promoters alone . 3 . 5 Transcription factors present at the enhancers predict functional enhancer - promoter pairs while EMSY and HCFC1 present at the TSS predict nonfunctional enhancer - promoter pairs . The transcription factor ChIP - seq peak presence at the TSS and enhancers were not as important as the Hi - C interactions or chromatin marks at the TSS and enhancers , but they contributed to further increase the predictive performance . The most important TFs at the TSS and enhancers contributed in different directions , where the TFs present at the TSS predictions negative ( nonfunctional ) EP pairs , and TFs present at the enhancers predicted positive ( functional ) EP pairs . The two most important TFs are C11orf30 ( EMSY ) at the TSS , and HCFC1 ( HCF1 ) at the TSS , which were both associated with nonfunctional enhancer - promoter prediction ( Fig . 7 , 8 ) . Since EMSY and HCFC1 17 F i g u re 6 . S t r o n g H 3 K 27a c a t t h e p r o m o t er p re d i c t s n o n f un c t i o n a l e nh a n cer - p r o m o t er p a i r s . P r o m o t e r H 3 K 27 ac m a r k s ho w s n e g a ti v e t r e nd o f S HA P v a l u e s . P r o m o t e r H 3 K 27 ac s ho w s c o rr e l a ti on w it h p r o m o t e r H 3 K 4 m e 3 ( A ) a nd t a r g e t g e n e e xp r e ss i o n ( B ) C ) P r o m o t e r H 3 K 27 ac by s i gn i f i ca n ce boxp l o t . S i gn i f i ca n t e nh a n ce r - p r o m o t e r p a i r s s ho w d ec r ea s e d p r o m o t e r H 3 K 27 ac . D ) T h e r e i s r e du c e d s i gn i f i ca n ce a m ong t h e t a r g e t g e n e s w it h t h e s t r ong e s t H 3 K 27 ac m a r k s a t p r o m o t e r s . E ) E ff ec t s i ze v s H 3 K 27 ac s t r e ng t h ( s i gn i f i ca n t i n r e d ) . S t r ong H 3 K 27 ac p r o m o t e r s h a v e s m a ll e r n e g a ti v e e ff ec t s i ze ( w ea k e r do w n - r e gu l a ti on e ff ec t s fr o m CR I SP R i on p a i r e d e nh a n ce r s ) . 18 each interact with the Sin3 histone deacetylase ( HDAC ) respectively , and EMSY is known as a repressor , we initially thought this is through the repressive action of EMSY and HCFC1 at the promoter . But , unexpectedly , Both EMSY and HCFC1 peak at the TSS were associated with higher H3K27ac marks and H3K4me3 marks at the TSS , and more active promoters ( Fig . 7 ) . This was also confirmed through the hierarchical clustering of SHAP values across feature variables . The clustering shows that H3K27ac , H3K4me3 , and HCFC1 at the TSS are correlated in their effect on prediction across features and samples ( Fig . 7A ) . The correlation between HCFC1 and to a lesser extent EMSY with both chromatin marks at the TSS are also found in the ChIP - seq and chromatin data that shows higher ( quantile normalized ) H3K27ac and H3K4me3 chromatin marks when either of the TFs are present . As expected , the ChIP - seq peaks between the two TFs are also correlated , co - occurring more often than by chance . Since SHAP values reflect correlation , not causation , we cannot disentangle the causal relationship between these four variables . But , we can tell that there are correlation among H3K27ac , H3K4me3 , HCFC1 and EMSY peaks at the TSS that all eventually lead to decreased prediction of functional enhancers affecting the target gene . On the other hand , numerous transcription factors found at the enhancer region were predictive of the functional enhancer - promoter pairs in the positive direction . The most important TFs found are the well - known hematopoietic and / or cancer related TFs , STAT2 , STAT1 , CHAMP1 , STAT5A , GATA2 , FOXM1 , etc . ( Fig . 4 , Fig . 9 ) The only gene that shows up as important for prediction that is relatively less studied in the context of hematopoiesis or cancer would be CHAMP1 , a gene associated with a neurodevelopmental disorder ( Hempel et al . , 2015 ; Itoh et al . , 2011 ) . CHAMP1 interacts with Rev7 , HP1 , and POGZ and functions in chromosome segregation and DNA repair ( Li et al . , 2022 ) . We found that CHAMP1 presence at the enhancer is correlated with FOXM1 presence at the enhancer ( correlation coefficient 0 . 428 ) and they both increase the prediction of positive enhancer - promoter pairs . Given the function of the gene , it is possible that the gene is involved in protecting the DNA during replication transcription conflict , and functional enhancers are especially at risk for replication stress in this cancerous system . 19 F i g u re 7 . E M S Y ( C 11o r f 30 ) a nd H C F C 1 a t t h e p r o m o t er p re d i c t s n o n f un c t i o n a l e nh a n cer - p r o m o t er p a i r s . A ) H i e r a r c h i ca l c l u s t e r i ng o f S HA P f ea t u r e s b a s e d on t h e i r c on t r i bu ti on t o p r e d i c ti on . H C F C 1 a t t h e T SS i s c o rr e l a t e d w it h H 3 K 27 ac a nd H 3 K 4 m e 3 a t t h e T SS i n p r e d i c ti ng non f un c ti on a l E P p a i r s . B - E ) S HA P v a l u e s o f H C F C 1 a nd E M S Y ( C 11o r f 30 ) a t t h e p r o m o t e r s . P r e s e n ce o f H C F C 1 a nd C 11o r f 30 p ea k s s ho w c o rr e l a ti on w it h bo t h H 3 K 27 ac a nd H 3 K 4 m e 3 m a r k s a t t h e p r o m o t e r s , a nd s ho w l o w e r S HA P v a l u e s i nd i ca ti ng p r e d i c ti on o f non f un c ti on a l E P p a i r s . 20 F i g u re 8 . E M S Y ( C 11o r f 30 ) a nd H C F C 1 a t t h e p r o m o t er i s a ss o c i a t e d w i t h l e ss s i g n i f i c a n ce a nd s m a ll er e ff ec t s i ze . A ) P r e s e n ce o f C h I P - s e q p ea k s o f E M S Y ( C 11o r f 30 ) a nd B ) H C F C 1 f ound a t p r o m o t e r s a r e a ss o c i a t e d w it h l o w e r p r opo r ti on o f s i gn i f i ca n t e nh a n ce r - p r o m o t e r p a i r s . C ) E ff ec t s i ze s o f d a t a s t r a ti f i e d by t h e nu m b e r o f C 11o r f 30 a nd D ) H C F C 1 a t p r o m o t e r p ea k . T h e p r e s e n ce o f E M S Y o r H C F C 1 a t t h e p r o m o t e r a r e a ss o c i a t e d w it h s m a ll e r n e g a ti v e e ff ec t s i ze ( w ea k e r do w n - r e gu l a ti on e ff ec t s fr o m CR I SP R i on p a i r e d e nh a n ce r s ) . 21 F i g u re 9 . S T A T 1 a nd S T A T 2 a t t h e e nh a n cer p re d i c t s f un c t i o n a l e nh a n cer - p r o m o t er p a i r s . A ) p r e s e n ce o f C h I P - s e q p ea k s o f S T A T 1 a nd B ) S T A T 2 f ound a t e nh a n ce r s a r e a ss o c i a t e d w it h h i gh e r p r opo r ti on o f s i gn i f i ca n t e nh a n ce r - p r o m o t e r p a i r s . E ff ec t s i ze s o f E P p a i r s s t r a ti f i e d by t h e nu m b e r o f C ) S T A T 1 a nd D ) S T A T 2 p ea k s a t t h e e nh a n ce r . T h e p r e s e n ce o f S T A T 1 o r S T A T 2 a t t h e e nh a n ce r s a r e a ss o c i a t e d w it h l a r g e r n e g a ti v e e ff ec t s i ze ( s t r ong e r do w n - r e g u l a ti on e ff ec t s fr o m CR I SP R i on t h e e nh a n ce r s ) . 22 3 . 6 Sorting the enhancers based on chromatin interaction networks reveal a distinct class of enhancers . Machine learning revealed that chromatin interaction measured by Hi - C contact between the enhancer and the promoter is the single most important feature in predicting functional enhancer - promoter pairs . Nevertheless , there are a substantial number of positive functional pairs that are not in strong contact . Gasperini et al . discussed this observation as underscoring the difficulty of the prediction task . In order to understand the difference between functional pairs that are in strong chromatin contact , and functional pairs that are not in contact , we split the data into two classes , direct contact enhancers that we call e1minus ( because it encompasses e 1 enhancers that are in significant contact with TSS based on fitHiC2 calls , and e 0 enhancers that are within the same 5Kb window of Hi - C ) , and indirect enhancers that we call e2plus ( e 2 , e 3 , e inf ) , that are not in direct contact with the TSS in the chromatin interaction network . We trained the same machine learning pipeline on these two subsets of data . Overall , we found that limiting the data to e1minus enhancers with direct contacts ( 341 / 10663 = 3 . 2 % positive rate ) made the prediction easier , reaching average precision that is about 30 % higher than what we saw with the whole data ( Table 2A ) . In contrast , the training and prediction of e2plus enhancers without direct contact ( 167 / 43102 = 0 . 4 % positive rate ) were extremely challenging , resulting in overfitting based on the difference seen between Cross - Validation MAP and Test MAP , and an order of magnitude lower average precision ( Table 2B ) . Despite the lower performance of e2plus enhancers , the overall feature importance based on SHAP values showed generally similar patterns with the model trained on e1minus enhancers , or the model trained on the whole data ( Fig . 10 ) . The features that are high ranking are still high ranking in both sets and predictive in the same directions . There are some differences in the transcription factors important between the two sets , but given the low accuracy of the e2plus data , we are not putting too much weight on the transcription factors that are only found in the e2plus model . 23 high low a . b . Figure 10 . SHAP values for model trained on EPs with vs without direct Hi - C contact . SHAP values showing important feature contributions for model trained on A ) EPs with direct contact ( e1minus data ) and B ) EPs without direct contact ( e2plus data ) . Table 2 . Model performance for model trained on EPs with vs without direct Hi - C contact . performance measure by Average Precision for model trained on A ) EPs with direct contact ( e1minus data ) and B ) EPs without direct contact ( e2plus data ) . 24 We did notice an interesting difference in the feature rest - of - ABC ( ABC denominator - numerator ) , that showed a distinct pattern between the e1minus and e2plus enhancers . Only in the e2plus enhancers , we saw a subset of enhancer - promoter pairs that showed opposite trend from the rest of the data , i . e . stronger positive prediction when the rest - of - ABC is larger ( Fig . 11 B - C ) . We have more confidence in this difference , because , i ) the pattern is replicated in the whole data across more data points ( Fig . 11A ) , ii ) the same subset of enhancer - promoter pairs show an interesting pattern going against the trend with the H3K4me3 at the TSS as well ( Fig . 12 ) . Even though generally the H3K4me3 mark at the TSS shows good correlation with the H3K27ac mark at the TSS , this particular pattern only showed up with H3K4me3 , but not with H3K27ac ( Fig . 12 vs . Fig . 6 ) . What the model is predicting is that for a subset of enhancer - promoter pairs with weaker Hi - C contact , unlike the rest of the data , having other stronger enhancers nearby , and having a strong H3K4me3 peak at the TSS is contributing to the prediction of a functional EP pair . Based on these observations , we went back to our training data from Gasperini2019 , to find the subset of positive cases that are under these conditions . We found 16 positive cases which satisfied all four conditions : i ) Significant by Gasperini et al . ii ) rest - of - ABC score ( ABC denominator – numerator ) > 5 , iii ) KR normalized Hi - C contact < 0 . 003 , iv ) quantile normalized H3K4me3 at the TSS > 0 . 8 . Table 3 lists those 16 cases . Of the 16 , six were clustered enhancers targeting the same gene ATG2A , and four were clustered enhancers targeting genes in the Histone cluster 1 , either HIST1H4H or HIST1H2AC . The histone genes and the gene TBC1D17 were identified as part of the 704 genes that are regulated by super - enhancers in K562 ( Hnisz et al . , 2013 ) . All other genes were also regulated by super - enhancers according to dbSuper , but not in the K562 cell line . For assurance , we checked our blocked Cross Validation design , and confirmed that all of the histone cluster 1 genes and enhancers on chromosome 6 from 25Mb to 29Mb were part of a single fold ( fold 3 ) and not split across folds . The gene ATG2A is an interesting case , where there is a total of 22 enhancers tested by Gasperini et al . , and six of those enhancers were determined to be positive . All six enhancers are included in Table 3 , and are atypical in that they are not in direct contact with the gene’s promoter . 25 F i g u re 11 . A d i s t i n c t c l a ss o f f un c t i o n a l E P p a i r s re v e a l e d b a s e d o n t h e f e a t u re re s t - o f - A B C . A ) S HA P v a l u e s f o r t h e f ea t u r e r e s t - o f - A BC ( A BC d e no m i n a t o r – nu m e r a t o r ) o f t h e m od e l t r a i n e d on t h e t o t a l d a t a s e t . F o r t h e r e s t o f t h e d a t a , l a r g e v a l u e o f r e s t - o f - A BC i nd i ca t e s s t r ong o r m a ny e nh a n ce r s n ea r by a nd p r e d i c t s n on f un c ti on a l E P p a i r s , e x ce p t f o r t h i s s ub s e t o f E P s h i gh li gh t e d w it h a n ov a l . B ) T h e m od e l t r a i n e d on E P p a i r s w it h d i r ec t c on t ac t ( e 1 m i nu s d a t a ) i s m i ss i ng t h i s p a tt e r n . C ) T h i s p a tt e r n i s r eca p t u r e d i n t h e m od e l t r a i n e d on E P p a i r s w it h ou t d i r ec t c on t ac t ( e 2p l u s d a t a ) . 26 SHAP values SHAP values a . b . rest - of - ABC F i g u re 12 . A d i s t i n c t c l a ss o f f un c t i o n a l E P p a i r s a nd H 3 K 4 m e 3 a t t h e p r o m o t er . T h e s a m e c l a ss o f i nd i r ec t bu t f un c ti on a l E P p a i r s a l s o s ho w d i s ti n c t p a tt e r n o f S HA P v a l u e s f o r H 3 K 4 m e 3 a t t h e p r o m o t e r . A ) S HA P p l o t o f p r o m o t e r H 3 K 4 m e 3 m a r k s w it h c o l o r s ca l e d b y H i - C c on t ac t b e t w ee n e nh a n ce r a nd p r o m o t e r a nd B ) r e s t - o f - A BC ( A BC d e no m i n a t o r - nu m e r a t o r ) . F o r t h e r e s t o f t h e d a t a , s t r ong H 3 K 4 m e 3 a t t h e p r o m o t e r p r e d i c t s non f un c ti on a l E P p a i r s , e x ce p t f o r t h i s s ub s e t o f E P s w it hou t d i r ec t c on t ac t a nd s t r o ng / m a ny e nh a n ce r s n ea r by . 27 E nh a n c e r _ t a r g e t S i g n i f i c a n t E ff e c t S i z e p V a l u e A d j u s t e d H i - C _ c o n t a c t r e s t - o f - A B C e nh a n c e r _ H 3 K 27 m e 3 T SS _ H 3 K 4 m e 3 T SS _ H 3 K 27 a c T a r g e t G e n e E x p r e ss i o n c h r 11 : 64102465 - 64102965 _ M R P L 49 T R U E - 0 . 12 8 0 . 085 0 . 000 5 . 486 0 . 000 0 . 973 0 . 951 4 . 427 c h r 11 : 64240339 - 64240839 _ A T G 2 A T R U E - 0 . 10 6 0 . 033 0 . 001 5 . 288 0 . 000 0 . 896 0 . 850 2 . 344 c h r 11 : 65186379 - 65186879 _ A T G 2 A T R U E - 0 . 26 0 0 . 029 0 . 000 5 . 263 0 . 117 0 . 896 0 . 850 2 . 344 c h r 11 : 65188604 - 65189104 _ A T G 2 A T R U E - 0 . 24 1 0 . 028 0 . 000 5 . 280 0 . 234 0 . 896 0 . 850 2 . 344 c h r 11 : 65239487 - 65239987 _ A T G 2 A T R U E - 0 . 15 3 0 . 031 0 . 000 5 . 279 0 . 000 0 . 896 0 . 850 2 . 344 c h r 11 : 65246901 - 65247401 _ A T G 2 A T R U E - 0 . 19 9 0 . 030 0 . 001 5 . 285 0 . 000 0 . 896 0 . 850 2 . 344 c h r 11 : 65261228 - 65261728 _ A T G 2 A T R U E - 0 . 09 6 0 . 033 0 . 000 5 . 289 0 . 000 0 . 896 0 . 850 2 . 344 c h r 19 : 13953511 - 13954011 _ T R M T 1 T R U E - 0 . 06 5 0 . 026 0 . 001 5 . 206 0 . 000 0 . 984 0 . 837 4 . 763 c h r 19 : 50220679 - 50221179 _ T B C 1 D 17 T R U E - 0 . 36 2 0 . 081 0 . 002 6 . 479 0 . 000 0 . 934 0 . 999 2 . 604 c h r 19 : 51106067 - 51106567 _ A T F 5 T R U E - 0 . 20 3 0 . 056 0 . 000 5 . 977 0 . 000 0 . 872 0 . 947 3 . 384 c h r 22 : 19614795 - 19615543 _ D G C R 2 T R U E - 0 . 19 8 0 . 066 0 . 002 5 . 159 0 . 934 0 . 891 0 . 712 3 . 695 c h r 22 : 20175594 - 20176094 _ C L T C L 1 T R U E - 0 . 52 8 0 . 067 0 . 000 5 . 136 0 . 117 0 . 993 0 . 846 1 . 876 c h r 6 : 26478302 - 26478802 _ H I S T 1 H 4 H T R U E - 0 . 18 6 0 . 044 0 . 001 5 . 384 0 . 467 0 . 987 0 . 995 4 . 428 c h r 6 : 26553429 - 26553929 _ H I S T 1 H 2 A C T R U E - 0 . 15 6 0 . 049 0 . 001 5 . 767 0 . 467 0 . 910 0 . 984 5 . 886 c h r 6 : 27145313 - 27145813 _ H I S T 1 H 4 H T R U E - 0 . 11 7 0 . 070 0 . 000 5 . 379 0 . 000 0 . 987 0 . 995 4 . 428 c h r 6 : 27156104 - 27156604 _ H I S T 1 H 4 H T R U E - 0 . 15 3 0 . 086 0 . 001 5 . 372 0 . 117 0 . 987 0 . 995 4 . 428 T a b l e 3 . E xa m p l e s o f a d i s t i n c t c l a ss o f E P p a i r s . C a s e s o f s i gn i f i ca n t E P p a i r s w it hou t d i r ec t c on t ac t t h a t m ee t t h e f o ll o w i ng c r it e r i a : i ) S i gn i f i ca n t by G a s p e r i n i e t a l . ii ) r e s t - o f - A BC ( A BC s c o r e d e no m i n a t o r – nu m e r a t o r ) > 5 , iii ) K R no r m a li ze d H i - C c on t ac t < 0 . 003 , i v ) qu a n til e no r m a li ze d H 3 K 4 m e 3 a t t h e T SS > 0 . 8 . 28 4 Discussion Distal enhancers and their role in transcriptional regulation have been studied for a long time , but each individual study has been limited to a combination of a handful of perturbation on specific enhancer loci . On the other hand , genomic studies have accumulated large amounts of biochemical assays that narrowed down the candidate regulatory elements , and gave meaning to the largely unknown areas of the genome , but they have been limited to clusterings and correlations and few had been functionally verified . But , with progress in technology , we have reached a point where now functional studies are being conducted at a genome - wide scale , and these parallel enhancer perturbation studies have accumulated individual enhancer perturbations and transcription read outs in the order of 10 , 000s of data points , that applying machine learning to the problem of transcriptional regulation specificity has now become practically feasible . By integrating the numerous TF ChIP - seq data from ENCODE , with the experimental study by Gasperini et al . we find that we can train a model that is still limited in its accuracy , but nevertheless useful for gaining insight on how each feature contributes to the model outcome , and for generating hypotheses . The trained model corroborates the current model for enhancer - promoter prediction in many ways , highlighting the importance of interaction between the enhancer and promoter in physical space , and the importance of the activating chromatin marks such as H3K27ac at the enhancer . But , it also provides novel insights , showing that integrating further TF information improves the prediction , and pointing us towards the TFs that make a difference in this particular cell line / tissue context . A few features were noteworthy . The observation that EMSY and HCFC1 was associated with negative prediction , but with higher activating chromatin marks at the TSS was unexpected . Understanding of chromatin modifiers enriched at the TSS is turning out to be more complicated , with many chromatin - associated proteins that were initially known to be either a repressor or an activator to reveal dual roles . EMSY was first characterized as a repressor ( Hughes - Davies et al . , 2003 ) that interacts with BRCA2 , but subsequent reports on EMSY knock - outs and rescue experiments suggest EMSY can also activate transcription ( Varier et al . , 2016 ) . Likewise , HCFC1 ( HCF - 1 ) is known to associate with both activator and repressor E2F proteins and to play different roles in different stages of the cell cycle regulation ( Tyagi et al . MolCell 2007 ) . In our model , the correlated features of EMSY , HCFC1 ( HCF - 1 ) ChIP - seq peaks and highly activating chromatin marks of H3K27ac and H3K4me3 at the TSS all lead to lower probability of predicting a functional enhancer for that target TSS . This is consistent with the recent report on the two classes of promoters by Bergman et al . that showed that promoters of housekeeping genes called P2s with activating motifs had 29 decreased responsiveness to distal enhancers ( Bergman et al . , 2022 ) . In fact , the ChIP - seq peaks of the two transcription factors HCFC1 and EMSY was identified in Bergman et al . among the enriched features that distinguished P2 promoters . We show that this pattern is replicated in a different experiment using CRISPR interference , compared to the massively parallel reporter assay that was used in Bergman et al . ( Bergman et al . , 2022 ) . We found a few unexpected TFs that showed up as important in predicting positive enhancers , one of which was the CHAMP1 peak at the enhancer . This let us hypothesize that CHAMP1 is involved in protecting the chromosome integrity under replication transcription conflict . Enhancers are known to create R - loops similar to gene bodies , which can cause DNA damage by creating a barrier to replication fork progression . ChIP - seq peaks of CHAMP1 was observed to co - occur with peaks of FOXM1 , which is active during late S phase , at the functional enhancers . The fact that a DNA repair gene is predictive of functional enhancers is at first puzzling . But it is consistent with the observation that functional enhancers generate higher level of transcripts and produce more R loops and may indicate that they are at higher risk for DNA damage . Although not part of the top 20 features ( Fig . 4 ) , the ChIP - seq peak of XRCC3 , another gene with function in homologous recombinational repair , was also one of the important features based on its SHAP value . Its presence at the TSS was also positively predictive of functional enhancer - promoter pairs . On the other hand , we found that the TFs that are well - known to bind to enhancers , and are routinely used to identify candidate enhancers , are curiously missing in our importance ranks . For example , we had included the ChIP - seq data for co - activators such as CREBBP ( CBP ) , EP300 ( P300 ) , BRD4 , and CEBPB , but none of them were determined to be important in predicting functional enhancers in this particular dataset . Another set of features deemed not important in our model was the co - binding of identical TFs between enhancers and promoters . We included such features , hypothesizing that TFs may mediate the chromatin interaction between enhancers and promoters , and if so , such TFs would show co - occurring peaks at the enhancers and promoters . But , co - occurring TF peaks were largely absent from the top important features , with SNRNP70 being the only exception . The co - occurring peaks of SNRNP70 showed up among the top 20 SHAP values . Recently , U1 snRNP was shown to tether and mobilize lncRNAs including enhancer RNAs to chromatin in a transcription - dependent manner ( Yin et al . , 2020 ) . Finally , although the majority of the enhancers were consistent with the overall patterns we described above , we found a distinct class of enhancers that went against such patterns . These were enhancers that did not exhibit a direct contact with the promoter measured by Hi - C , and instead were indirectly connected via a chain of enhancer to enhancer contacts . Opposite of the typical enhancers , these were more likely to have an effect when there were strong / numerous 30 other enhancers around , and when the TSS had a strong activating mark of H3K4me3 , but not necessarily of H3K27ac . Clusters of enhancers centered around the histone cluster 1 on chromosome 6 , and the gene ATG2A are good examples of these atypical enhancers identified in the Gasperini experiment . One possible alternative explanation for these cases , other than our hypothesis of regulation through enhancer chain of contact , is that these enhancers are regulating another protein , that then regulates ATG2A through a trans effect . But , if that is the case , we don’t see why it would show association with strength of the other enhancers in the nearby region . Our trained model is limited by its model system which is the K562 cell line . We observe that a lot of the positive data points in the Gasperini data are associated with cell cycle genes , including the histone gene cluster that is partially driven by the indirect enhancers described above . Since the transcriptional regulation of the histone cluster is somewhat specialized , it may not be an optimal model for studying regular enhancer driven regulation . In that sense ATG2A may be the better model to use for studying indirect enhancer regulation . Likewise , the DNA repair genes that are predictive of functional enhancers maybe a phenomenon that is only found in cancerous cells that are under high DNA replication stress . K562 cells are also aneuploids for most of the genome . These chromosomal aberrations are larger in scale than the Hi - C contacts we are measuring here , so it shouldn’t affect our results ( chromosome 9 is excluded from our analysis due to the large - scale chromosomal inversion ) , but it may reduce the power of many of our genomic measurements , such as Hi - C , and ChIP - seq peaks , when homologous aneuploid chromosomes have underlying differences that are masked by aligning to a diploid genome . A more central limitation would be that , since the increased performance relies on the TFs that are potentially cell type specific , the model would not achieve the same prediction accuracy on other cells or tissues . This is both the strength and weakness of the model , in that it becomes more accurate to the system , and loses generalizability . But , hopefully the knowledge that we learned from the model can be transferred to other systems . Acknowledgements We would like to thank Corinne E . Sexton for her insights . Funding This work was supported by the National Science Foundation under Grant No . 1750532 . Conflict of Interest : none declared . 31 References Akiba , T . , Sano , S . , Yanase , T . , Ohta , T . , & Koyama , M . ( 2019 ) . Optuna : A next - generation hyperparameter optimization framework . 2623 – 2631 . Alexander , J . M . , Guan , J . , Li , B . , Maliskova , L . , Song , M . , Shen , Y . , Huang , B . , Lomvardas , S . , & Weiner , O . D . ( 2019 ) . Live - cell imaging reveals enhancer - dependent Sox2 transcription in the absence of enhancer proximity . ELife , 8 , e41769 . https : / / doi . org / 10 . 7554 / eLife . 41769 Bergman , D . T . , Jones , T . R . , Liu , V . , Ray , J . , Jagoda , E . , Siraj , L . , Kang , H . Y . , Nasser , J . , Kane , M . , Rios , A . , Nguyen , T . H . , Grossman , S . R . , Fulco , C . P . , Lander , E . S . , & Engreitz , J . M . ( 2022 ) . Compatibility rules of human enhancer and promoter sequences . Nature , 607 ( 7917 ) , Article 7917 . https : / / doi . org / 10 . 1038 / s41586 - 022 - 04877 - w Cao , F . , Zhang , Y . , Cai , Y . , Animesh , S . , Zhang , Y . , Akincilar , S . C . , Loh , Y . P . , Li , X . , Chng , W . J . , Tergaonkar , V . , Kwoh , C . K . , & Fullwood , M . J . ( 2021 ) . Chromatin interaction neural network ( ChINN ) : A machine learning - based method for predicting chromatin interactions from DNA sequences . Genome Biology , 22 ( 1 ) , 226 . https : / / doi . org / 10 . 1186 / s13059 - 021 - 02453 - 5 Cao , Q . , Anyansi , C . , Hu , X . , Xu , L . , Xiong , L . , Tang , W . , Mok , M . T . S . , Cheng , C . , Fan , X . , Gerstein , M . , Cheng , A . S . L . , & Yip , K . Y . ( 2017 ) . Reconstruction of enhancer – target networks in 935 samples of human primary cells , tissues and cell lines . Nature Genetics , 49 ( 10 ) , 1428 – 1436 . https : / / doi . org / 10 . 1038 / ng . 3950 Chen , T . , & Guestrin , C . ( 2016 ) . XGBoost : A Scalable Tree Boosting System . Proceedings of the 22nd ACM SIGKDD International Conference on Knowledge Discovery and Data Mining , 785 – 794 . https : / / doi . org / 10 . 1145 / 2939672 . 2939785 de Almeida , B . P . , Reiter , F . , Pagani , M . , & Stark , A . ( 2022 ) . DeepSTARR predicts enhancer activity from DNA sequence and enables the de novo design of synthetic enhancers . Nature Genetics , 54 ( 5 ) , 613 – 624 . https : / / doi . org / 10 . 1038 / s41588 - 022 - 01048 - 5 Erwin , G . D . , Oksenberg , N . , Truty , R . M . , Kostka , D . , Murphy , K . K . , Ahituv , N . , Pollard , K . S . , & Capra , J . A . ( 2014 ) . Integrating Diverse Datasets Improves Developmental Enhancer Prediction . PLOS Computational Biology , 10 ( 6 ) , e1003677 . https : / / doi . org / 10 . 1371 / journal . pcbi . 1003677 Fudenberg , G . , Kelley , D . R . , & Pollard , K . S . ( 2020 ) . Predicting 3D genome folding from DNA sequence with Akita . Nature Methods , 17 ( 11 ) , 1111 – 1117 . https : / / doi . org / 10 . 1038 / s41592 - 020 - 0958 - x 32 Fulco , C . P . , Nasser , J . , Jones , T . R . , Munson , G . , Bergman , D . T . , Subramanian , V . , Grossman , S . R . , Anyoha , R . , Patwardhan , T . A . , Nguyen , T . H . , Kane , M . , Doughty , B . , Perez , E . M . , Durand , N . C . , Stamenova , E . K . , Aiden , E . L . , Lander , E . S . , & Engreitz , J . M . ( 2019 ) . Activity - by - Contact model of enhancer specificity from thousands of CRISPR perturbations . BioRxiv , 529990 . https : / / doi . org / 10 . 1101 / 529990 Gasperini , M . , Hill , A . J . , McFaline - Figueroa , J . L . , Martin , B . , Kim , S . , Zhang , M . D . , Jackson , D . , Leith , A . , Schreiber , J . , Noble , W . S . , Trapnell , C . , Ahituv , N . , & Shendure , J . ( 2019 ) . A Genome - wide Framework for Mapping Gene Regulation via Cellular Genetic Screens . Cell , 176 ( 1 ) , 377 - 390 . e19 . https : / / doi . org / 10 . 1016 / j . cell . 2018 . 11 . 029 Hempel , M . , Cremer , K . , Ockeloen , C . W . , Lichtenbelt , K . D . , Herkert , J . C . , Denecke , J . , Haack , T . B . , Zink , A . M . , Becker , J . , Wohlleber , E . , Johannsen , J . , Alhaddad , B . , Pfundt , R . , Fuchs , S . , Wieczorek , D . , Strom , T . M . , van Gassen , K . L . I . , Kleefstra , T . , Kubisch , C . , … Lessel , D . ( 2015 ) . De Novo Mutations in CHAMP1 Cause Intellectual Disability with Severe Speech Impairment . The American Journal of Human Genetics , 97 ( 3 ) , 493 – 500 . https : / / doi . org / 10 . 1016 / j . ajhg . 2015 . 08 . 003 Hnisz , D . , Abraham , B . J . , Lee , T . I . , Lau , A . , Saint - André , V . , Sigova , A . A . , Hoke , H . A . , & Young , R . A . ( 2013 ) . Super - Enhancers in the Control of Cell Identity and Disease . Cell , 155 ( 4 ) , 934 – 947 . https : / / doi . org / 10 . 1016 / j . cell . 2013 . 09 . 053 Hughes - Davies , L . , Huntsman , D . , Ruas , M . , Fuks , F . , Bye , J . , Chin , S . - F . , Milner , J . , Brown , L . A . , Hsu , F . , Gilks , B . , Nielsen , T . , Schulzer , M . , Chia , S . , Ragaz , J . , Cahn , A . , Linger , L . , Ozdag , H . , Cattaneo , E . , Jordanova , E . S . , … Kouzarides , T . ( 2003 ) . EMSY Links the BRCA2 Pathway to Sporadic Breast and Ovarian Cancer . Cell , 115 ( 5 ) , 523 – 535 . https : / / doi . org / 10 . 1016 / S0092 - 8674 ( 03 ) 00930 - 9 Itoh , G . , Kanno , S . , Uchida , K . S . K . , Chiba , S . , Sugino , S . , Watanabe , K . , Mizuno , K . , Yasui , A . , Hirota , T . , & Tanaka , K . ( 2011 ) . CAMP ( C13orf8 , ZNF828 ) is a novel regulator of kinetochore – microtubule attachment . The EMBO Journal , 30 ( 1 ) , 130 – 144 . https : / / doi . org / 10 . 1038 / emboj . 2010 . 276 Kaul , A . , Bhattacharyya , S . , & Ay , F . ( 2020 ) . Identifying statistically significant chromatin contacts from Hi - C data with FitHiC2 . Nature Protocols , 15 ( 3 ) , 991 – 1012 . https : / / doi . org / 10 . 1038 / s41596 - 019 - 0273 - 0 Kursa , M . B . , & Rudnicki , W . R . ( 2010 ) . Feature Selection with the Boruta Package . Journal of Statistical Software , 36 ( 11 ) , 1 – 13 . https : / / doi . org / 10 . 18637 / jss . v036 . i11 33 Li , F . , Sarangi , P . , Iyer , D . R . , Feng , H . , Moreau , L . , Nguyen , H . , Clairmont , C . , & D’Andrea , A . D . ( 2022 ) . CHAMP1 binds to REV7 / FANCV and promotes homologous recombination repair . Cell Reports , 40 ( 9 ) . https : / / doi . org / 10 . 1016 / j . celrep . 2022 . 111297 Lim , B . , & Levine , M . S . ( 2021 ) . Enhancer - promoter communication : Hubs or loops ? Current Opinion in Genetics & Development , 67 , 5 – 9 . https : / / doi . org / 10 . 1016 / j . gde . 2020 . 10 . 001 Lundberg , S . M . , & Lee , S . - I . ( 2017 ) . A unified approach to interpreting model predictions . Advances in Neural Information Processing Systems , 30 . Martinez - Ara , M . , Comoglio , F . , van Arensbergen , J . , & van Steensel , B . ( 2022 ) . Systematic analysis of intrinsic enhancer - promoter compatibility in the mouse genome . Molecular Cell , 82 ( 13 ) , 2519 - 2531 . e6 . https : / / doi . org / 10 . 1016 / j . molcel . 2022 . 04 . 009 Miele , A . , & Dekker , J . ( 2008 ) . Long - range chromosomal interactions and gene regulation . Molecular BioSystems , 4 ( 11 ) , 1046 – 1057 . https : / / doi . org / 10 . 1039 / b803580f Palstra , R . - J . , Tolhuis , B . , Splinter , E . , Nijmeijer , R . , Grosveld , F . , & de Laat , W . ( 2003 ) . The β - globin nuclear compartment in development and erythroid differentiation . Nature Genetics , 35 ( 2 ) , Article 2 . https : / / doi . org / 10 . 1038 / ng1244 Rowley , M . J . , & Corces , V . G . ( 2018 ) . Organizational principles of 3D genome architecture . Nature Reviews Genetics , 19 ( 12 ) , 789 – 800 . https : / / doi . org / 10 . 1038 / s41576 - 018 - 0060 - 8 Sandhu , K . S . , Li , G . , Poh , H . M . , Quek , Y . L . K . , Sia , Y . Y . , Peh , S . Q . , Mulawadi , F . H . , Lim , J . , Sikic , M . , Menghi , F . , Thalamuthu , A . , Sung , W . K . , Ruan , X . , Fullwood , M . J . , Liu , E . , Csermely , P . , & Ruan , Y . ( 2012 ) . Large - Scale Functional Organization of Long - Range Chromatin Interaction Networks . Cell Reports , 2 ( 5 ) , 1207 – 1219 . https : / / doi . org / 10 . 1016 / j . celrep . 2012 . 09 . 022 Schraivogel , D . , Gschwind , A . R . , Milbank , J . H . , Leonce , D . R . , Jakob , P . , Mathur , L . , Korbel , J . O . , Merten , C . A . , Velten , L . , & Steinmetz , L . M . ( 2020 ) . Targeted Perturb - seq enables genome - scale genetic screens in single cells . Nature Methods , 17 ( 6 ) , 629 – 635 . https : / / doi . org / 10 . 1038 / s41592 - 020 - 0837 - 5 Schwessinger , R . , Gosden , M . , Downes , D . , Brown , R . C . , Oudelaar , A . M . , Telenius , J . , Teh , Y . W . , Lunter , G . , & Hughes , J . R . ( 2020 ) . DeepC : predicting 3D genome folding using megabase - scale transfer learning . Nature Methods , 17 ( 11 ) , 1118 – 1124 . https : / / doi . org / 10 . 1038 / s41592 - 020 - 0960 - 3 34 Song , W . , Sharan , R . , & Ovcharenko , I . ( 2019 ) . The first enhancer in an enhancer chain safeguards subsequent enhancer - promoter contacts from a distance . Genome Biology , 20 ( 1 ) , 197 . https : / / doi . org / 10 . 1186 / s13059 - 019 - 1808 - y Spilianakis , C . G . , & Flavell , R . A . ( 2004 ) . Long - range intrachromosomal interactions in the T helper type 2 cytokine locus . Nature Immunology , 5 ( 10 ) , Article 10 . https : / / doi . org / 10 . 1038 / ni1115 Thibodeau , A . , Márquez , E . J . , Shin , D . - G . , Vera - Licona , P . , & Ucar , D . ( 2017 ) . Chromatin interaction networks revealed unique connectivity patterns of broad H3K4me3 domains and super enhancers in 3D chromatin . Scientific Reports , 7 ( 1 ) , Article 1 . https : / / doi . org / 10 . 1038 / s41598 - 017 - 14389 - 7 Tolhuis , B . , Palstra , R . - J . , Splinter , E . , Grosveld , F . , & de Laat , W . ( 2002 ) . Looping and Interaction between Hypersensitive Sites in the Active β - globin Locus . Molecular Cell , 10 ( 6 ) , 1453 – 1465 . https : / / doi . org / 10 . 1016 / S1097 - 2765 ( 02 ) 00781 - 5 Varier , R . A . , de Santa Pau , E . C . , van der Groep , P . , Lindeboom , R . G . H . , Matarese , F . , Mensinga , A . , Smits , A . H . , Edupuganti , R . R . , Baltissen , M . P . , Jansen , P . W . T . C . , ter Hoeve , N . , van Weely , D . R . , Poser , I . , van Diest , P . J . , Stunnenberg , H . G . , & Vermeulen , M . ( 2016 ) . Recruitment of the Mammalian Histone - modifying EMSY Complex to Target Genes Is Regulated by ZNF131 * . Journal of Biological Chemistry , 291 ( 14 ) , 7313 – 7324 . https : / / doi . org / 10 . 1074 / jbc . M115 . 701227 Whalen , S . , Schreiber , J . , Noble , W . S . , & Pollard , K . S . ( 2022 ) . Navigating the pitfalls of applying machine learning in genomics . Nature Reviews Genetics , 23 ( 3 ) , 169 – 181 . https : / / doi . org / 10 . 1038 / s41576 - 021 - 00434 - 9 Whalen , S . , Truty , R . M . , & Pollard , K . S . ( 2016 ) . Enhancer – promoter interactions are encoded by complex genomic signatures on looping chromatin . Nature Genetics , 48 ( 5 ) , 488 – 496 . https : / / doi . org / 10 . 1038 / ng . 3539 Xi , W . , & Beer , M . A . ( 2018 ) . Local epigenomic state cannot discriminate interacting and non - interacting enhancer – promoter pairs with high accuracy . PLOS Computational Biology , 14 ( 12 ) , e1006625 . https : / / doi . org / 10 . 1371 / journal . pcbi . 1006625 Xiao , J . Y . , Hafner , A . , & Boettiger , A . N . ( 2021 ) . How subtle changes in 3D structure can create large changes in transcription . ELife , 10 , e64320 . https : / / doi . org / 10 . 7554 / eLife . 64320 35 Yang , B . , Liu , F . , Ren , C . , Ouyang , Z . , Xie , Z . , Bo , X . , & Shu , W . ( 2017 ) . BiRen : Predicting enhancers with a deep - learning - based model using the DNA sequence alone . Bioinformatics , 33 ( 13 ) , 1930 – 1936 . https : / / doi . org / 10 . 1093 / bioinformatics / btx105 Yin , Y . , Lu , J . Y . , Zhang , X . , Shao , W . , Xu , Y . , Li , P . , Hong , Y . , Cui , L . , Shan , G . , Tian , B . , Zhang , Q . C . , & Shen , X . ( 2020 ) . U1 snRNP regulates chromatin retention of noncoding RNAs . Nature , 580 ( 7801 ) , 147 – 150 . https : / / doi . org / 10 . 1038 / s41586 - 020 - 2105 - 3