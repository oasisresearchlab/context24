JOURNAL OF COMPUTATIONAL . PHYSICS 23 , 321 - 341 ( 1977 ) Numerical integration of the Cartesian Equations of Motion of a System with Constraints : Molecular Dynamics of n - Alkanes JEAN - PAUL RYCKAERT * , GIOVANNI CICCOTTI + , AND HERMAN J . C . BERENDSEN * Centre Europten de Calcul Atomique et Molhxlaire ( CECAM ) , Bhtiment 506 , Umbersit de Paris XI , 91405 Orsay , France Received July 19 , 1976 A numerical algorithm integrating the 3N Cartesian equations of motion of a system of N points subject to holonomic constraints is formulated . The relations of constraint remain perfectly fulfilled at each step of the trajectory despite the approximate character of numeric - al integration . The method is applied to a molecular dynamics simulation of a liquid of 64 n - butane molecules and compared to a simulation using generalized coordinates . The method should be useful for molecular dynamics calculations on large molecules with internal degrees of freedom . 1 . INTR ~ D ~ JCTI ~ N The method of molecular dynamics ( MD ) , which has been widely used in the past for studying simple liquids and solids , has more recently been applied to molecular systems with internal degrees of freedom such as N , [ l ] , H , O [ 2 ] and even C , H , , [ 3 ] . In applying the MD method three problems arise : ( a ) the choice of a suitable mechani - cal model , ( b ) the derivation of the equations of motion of the system and ( c ) the choice of an efficient algorithm for the numerical integration of these equations . In polyatomic molecules , the fast internal vibrations are usually decoupled from rotational and translational motions and can therefore be frozen by introducing a certain number of rigid bonds and angles in the skeleton of the molecule . For example , Nz becomes a rod , H , O a rigid triangle and C4H , , a nonrigid solid with one internal rotation [ l , 2 , 31 . The classical way to treat such systems is in terms of generalized coordinates ( Lagrange - Hamilton formalism ) , but as the number of internal degrees of freedom increases it rapidly becomes harder to write down explicitly the appropriate equations of motion . * Fact & des Sciences , Universite Libre de Bruxelles , Brussels , Belgium . + Gruppo Nazionale di Struttura della Materia , Consiglio Nazionale delle Ricerche , and Istituto di Fisica “G . Marconi , ” Universita di Roma , Roma , Italy . * Laboratory of Physical Chemistry , The University of Groningen , Zemikelaan , NG8002 Groningen , the Netherlands . 327 Copyright Q 1977 by Academic Press . Inc . AlI rights of reproduction in any form reserved . ISSN 0021 - 9991 328 RYCKAERT . CICCOTTI AND BERENDSEN Some time ago , Orban and Ryckaert [ 4 ] suggested the use of Cartesian equations of motion in order to describe the dynamical behavior of n - alkane chains , built up of n CH2 or CH , point units connected by n - 1 rigid bonds and n - 2 rigid angles between adjacent bonds . These equations are in fact the Lagrange equations of motion of the first kind [ 5 ] , in which the forces of constraint appear explicitly ; the dependence of these forces on the positions and velocities of the centers of force is obtained from the relations of constraint ( see Section 2 or [ 4 ] ) . On integrating these equations numerically , Orban and Ryckaert obtained quite promising preliminary results . However , one difficulty remained in their approach . The constraints are satisfied exactly at some initial time , but not at later times , because in the numerical integration of a large set of coupled differential equations the computed trajectory deviates more and more from the true one as time proceeds . This is a consequence of the approximate character of the algorithm which is used , and in the present case means that the numerical values of the constrained bond lengths and angles gradually depart from their original values . It follows that after a sufficiently long time the character of the system is strongly modified . In principle , the time step can be reduced sufficiently to obtain an acceptable discrepancy in the constraints after the total time of integra - tion , but this would be very inefficient . In order to avoid these difficulties in the nume - rical computations we have developed a method which is still based on Cartesian coordinates , but leads now to a trajectory in which all constraints are fulfilled exactly at each step of the integration . This is obtained without any loss of precision . Consider a system of N interacting points subject to I holonomic constraints % ( W ) = 0 ( k = I , . . . , I ) . ( 1 ) The force acting on each point can be divided into two contributions : the force Fi due to the potential energy and the force of constraint Gt due to all constraints ok involving the ith particle . Gi can be written [ 5 ] Gi = - ik X , ( r ) Via , , 1 where the { h , ( r ) } are a set of I Lagrangian multipliers depending only on time . Let us suppose that the integration algorithm used takes into account the time derivatives of forces up to order n - 2 ( n is often equal to 2 ) , and that it is equivalent to a Taylor expansion of the coordinates r ( t + At ) up to order ( At ) “ , where At is the time step . In order to be consistent with the integration algorithm , the derivatives of G , and hence of ( A } also have to be known up to order n - 2 . To avoid the errors implied in the conservation of the constraints , which are accumulative , we employ a method by which the 1 relations of constraint are exactly fulfilled at time t + At . Thus instead of solving for { hrP2’ ( t ) } , a set of parameters ( n } are obtained . In Section 2 we show that the substitution of ( yk } for { h ~ - 2 ) ( t ) } means that the calculation of coordinates at successive steps is stiI1 exact up to ( dt ) m , and thus can be applied in any molecular dynamics algorithm . In addition , the constraints are now automatically fulfilled . INTEGRATION OF A SYSTEM WITH CONSTRAINTS 329 In Section 3 , we apply the procedure to the well - known algorithm used by Verlet [ 6 ] . This algorithm is particularly suitable for use with our method because the forces of constraint have not to be evaluated explicitly at time t . Their effect is obtained instead from the calculation of the set of 1 parameters { n } . The 1 equations giving them are quadratic in { y ) ; they can be solved by an iterative process . In Section 4 the method is applied to a liquid system of 64 n - butane molecules considered as a system of 256 CH , or CH , “particles , ” but subject additionally to five constraints per molecule ( three rigid bonds and two rigid angles ) . A numerical comparison between the trajectory obtained by integration of the equations of the system in generalized coordinates , and the path obtained with the method described in Section 3 , shows that for this relatively simple system the two methods are equally economic in terms of computing time . In Section 5 an alternative iterative procedure is described that allows the constraints to be satisfied at each step without solving the equations for { n } explicitly . The method is based on successively satisfying each of the constraints and is suitable for straight - forward application to large molecules with a complicated set of constraints . The main advantage of the method introduced here is that it allows the use of equations of motion in Cartesian form in the simulation of the molecular dynamics of complex molecules , with elimination of the motion of irrelevant internal degrees of freedom . This opens the way to study complex ( macro ) molecular systems , where , on the one hand , the number of degrees of freedom must be reduced as much as possible and on the other hand , the use of generalized coordinates is prohibitively complicated . The application to the study of liquid n - alkanes ( both pure liquid and mixtures ) with arbitrary n is straightforward . In the Appendix we give explicitly the equations necessary to deal with such systems . 2 . INTEGRATION OF THE CARTESIAN EQUATIONS OF MOTION OF AN N - POINT SYSTEM SUBJECT TO HOLONOMIC CONSTRAINTS : METHOD OF LAGRANGIAN MULTIPLIERS Consider a system of N interacting particles . Let ri and ki be the position and the velocity of the ith particle ( i = l , . . . , N ) and let V ( { r } ) be the potential energy of the system . We suppose that the system is subject to I holonomic constraints : ak ( { r ( t ) } ) G ( rj ( t ) - rj ( t ) ) * - di = 0 ( k = l , . . . , 1 ) , ( 2 . 1 ) where k is a label for the rigid bond ( ij ) of length dii . The 3N Lagrangian equations of motion of the first kind , in which the forces of constraint appear explicitly , are given [ 5 ] by miZi = Fi + Gi = - V , V - 1 , A , Violi ( i = l , . . . , N ) , ( 2 . 2 ) 1 where Fi is the force on i resulting from the potential energy V , Gi is the force on i due to all constraints ( 2 . 1 ) involving i , . and h , are the Lagrangian’ multipliers associated @ l / 23 / 3 - 8 330 RYCKAERT , CICCOTTI AND BERENDSEN with ( sle . The 3N equations ( 2 . 2 ) and the 1 relations of constraint ( 2 . 1 ) together constitute 3N + I equations for 3N + I unknowns ( { r ( t ) > , { h ( t ) } ) . If the initial configu - ration ( { r , ( O ) } , { ii ( O ) ] ) is specified and all constraints are satisfied , the trajectory of the system is uniquely determined by ( 2 . 1 ) and ( 2 . 2 ) . Let us look for the analytical solution of the equations of motion ( 2 . 2 ) by writing X , ( t ) = f , gqt , ) ( t ; , ro ) ” . 0 We can obviously calculate r , ( t , { h ( r ) } ) as an explicit function of the set { XCn ) ( l , ) } . The latter , as we shall see , can easily be obtained from ( 2 . 1 ) . With the use of ( 2 . 3 ) we find a Taylor expansion for the solution of ( 2 . 2 ) as and are the time derivative - of order s of the functions Fi and Gi computed at time t = to . In order to compute the set { hp’ ( t , ) } , s = 0 , I , . . . , we have merely to exploit the information contained in Eqs . ( 2 . 1 ) . As these hold at any time , all time derivatives of ( 2 . 1 ) must vanish . We write the system of equations uk ‘“ + 2’ ( { r ( to ) ) ) = [ g uk ( { r ( t ) ) ) ] tEt = 0 ( k = 1 , . . . , 0 . 0 An explicit evaluation of the time derivatives gives [ ( vpp” - ~ ) lto 1 P , ~ 7Pl , = 0 . ( 2 . 5a ) INTEGRATION OF A SYSTEM WITH CONSTRAINTS 331 The last line is obtained by substitution of r ~ s + z - a ) by the corresponding term in Eq . ( 2 . 4 ) . Isolating the terms of the highest order ( s ) in A , i . e . , the terms with ( Y = 0 and fi = S , we can rewrite Eq . ( 2 . 5a ) as + 9y { hy ) ( r , ) , . . . , C3to ) L No ) , Wo ) l ) = 0 . ( 2 . 5b ) Here , 9 is a known function of the time derivatives of h’s of order less than s and of the coordinates and momenta at time i , , . We see that all { Xp ) } ( s = 0 , l , . . . ) can be obtained by successively inverting the system of linear equations ( 2 . 5b ) for s = 0 , l , . . . . In this way Eqs . ( 2 . 2 ) are reduced to ordinary second order differential equations which can be integrated numerically [ 4 ] . The difficulty now arises that the constraints are fulfilled only to the order in the time step which is implicit in the use of a specific algorithm , and the discrepancy will grow in time much more rapidly than linearly . To overcome this problem , we have developed a method that automatically incorporates the exact constraints ( 2 . 2 ) , but does not introduce any additional errors in the computation of the trajectory . Consider the case when the algorithm used involves an error in the coordinates of order ( dt ) m + l . In the simplest case of Taylor’s expansion , this is the order of the first omitted term . If the algorithm uses the time derivatives of the forces up to order n - 2 , corresponding to the nth derivatives of the space coordinates , we have to compute { A ( “ ) ( t , ) , . . . , A + * ) ( t , , ) } and we will have at worst u ( { r - - + ( f ) } ) = O [ ( Llt ) cm + l ) l where r / ( l ) denotes the values obtained from the algorithm for ri ( t ) . Instead of this , let us compute from Eq . ( 2 . 5 ) only the first ( n - 3 ) derivatives of the h , ‘s at I , and replace { Xr - * ’ ( I , ) } by a set of parameters { yk } such that the relations uk ( Mh Y . v ) I ) = 0 ( 2 . 7 ) are satisfied . Because the Ap - “ ) appear in the expansion Eq . ( 2 . 4 ) always multiplied by ( LI ~ ) ~ , it follows that A ? - * ) ( r , ) - ya = O [ ( Ar ) m + l - n ] . ( 2 . 8 ) Thus , comparing again with Eq . ( 2 . 4 ) , we see that the difference between the trajectory computed with yh ( tO ) and that computed with Ap - “‘ ( to ) is of O [ ( At ) m + l ] . This is of the same order as the error implicit in the algorithm , but the constraints are now perfectly fulfilled . 332 RYCKAERT , CICCOTTI AND BERENDSEN To make the discussion more specific , we write the value of ri ( t , + dl ) , given by the algorithm , as the sum of two contributions : ri ( rO + Ar , ( h $ “ ( t , , ) , . . . , hi ? - 3’ ( r , , ) , yk ] ) = ri’ ( to + At , { h $ “ ( t , ) , . . . , hj ; “ - 3’ ( to ) } ) + W , , + At , hi ) ( 2 . 9 ) such that ri’ is independent of yk and 6ri is linear in ylc and depends further only on { ri ( t , ) } . Substituting Eq . ( 2 . 9 ) into ( 2 . 1 ) , we find for the kth constraint involving the pair ( i , j ) : 2 ( rj’ - r , ‘ ) - ( Srj - Sri ) + ( Srj - hi ) ’ = & j - ( rj’ - b’ ) ‘ . ( 2 . 10 ) The 6ri are given in terms of Taylor’s expansion by ( Eq . ( 2 . 4 ) ) : The resulting set of 1 equations ( 2 . 10 ) ( one for each constraint ) constitutes a matrix equation for the vector ( yK } . Two remarks can be added . First , Eqs . ( 2 . 10 ) are nonlinear , but can be solved in a quite efficient way by iteration . This is justified for dt - + 0 because then the terms nonlinear in yB are small . Thus the iteration procedure can be initiated by substituting { yk = 0 } in all nonlinear terms , and the iteration always converges rapidly to the physical solution of the second - degree equations . Second , the method is particularly suitable and efficient for use with the simple algorithm of Verlet [ 6 ] . In this case n in Eq . ( 2 . 9 ) is equal to 2 and no h’s have to be computed at all . In the next section we shall describe the method for this particular case in detail . 3 . NUMERICAL INTEGRATION METHOD USING THE METHOD OF UNDETERMINED PARAMETERS As we have already mentioned in the Introduction , our aim is to perform molecular dynamics calculations with the Cartesian equations of motion for polyatomic molecules visualized as systems of interacting point - atoms subject to rigid bonds . The method of undetermined parameters explained in the previous section has now to be combined with a specific integration scheme . In practice we have used the well - known algorithm [ 6 ] given by ( h is the time step ) u ( h ) = - 24 ( - - h ) + 2U ( O ) + h2ql ) + W4h ( 3 . 1 ) G ( O ) = ( u ( h ) - u ( - - h ) ) / 2h + O ( h2 ) . ( 3 . 2 ) INTEGRATION OF A SYSTEM WITH CONSTRAINTS 333 Using the method of Section 2 Eqs . ( 2 . 9 ) , ( 2 . 10 ) , and ( 2 . 1 l ) , the algorithm ( 3 . 1 ) becomes for each point of the system : with r , ( h ) = rdh , { Ykl ) = riYh ) + k ( h ) ri’ ( h ) = - ri ( - h ) + 2ri ( 0 ) + ( h2 / m , ) F , ( O ) , ( 3 . 3 ) h ( h ) = ( h2 / W > ik yk [ viuk ] t , , the { yk } being obtained from ~ k ( Wh { rkNH = 0 ( k = I , . . . , I ) . ( 3 . 4 ) The argument of Section 2 , Eq . ( 2 . 8 ) shows that Yk ( O ) = h , ( O ) + O ( h2 ) ( k = I , . . . , 1 ) . ( 3 . 5 ) Thus , the algorithm ( 3 . 3 ) , ( 3 . 4 ) leads to the required trajectory exact up to the third order in h ( as usual ) , but for which the constraints are now perfectly obeyed . More - over , the { X , ( O ) } need no longer be evaluated : the computation of the forces of con - straint at time t = 0 is now converted in the evaluation of 1 parameters ( rk } . We can illustrate this last step in the procedure in the case of rigid constraints ( 2 . I ) , i . e . , ( rj ( t ) - q ( t ) ) ” - df‘ = 0 , ( 3 . 6 ) where dij is the constant length of the ( ij ) pair . Following the methods already dis - cussed we can obtain from ( 2 . 1 l ) , 2 ( rj’ ( h ) - b’ ( h ) ) ( - - h2 ik Yk [ ( 2 - 2 ) Ok ] t o + h4 i , i , ’ , . : . ’ [ ( + - 2 ) uk ] t = o [ ( 2 - 2 ) uk * ] t - O 11 = di”j - ( rj’ ( h ) - ri ' ( h ) ) 2 . ( 3 . 7 ) If there are I rigid bonds ij , we have to solve a system of I quadratic equations in yk ; this can be achieved by means of the following iterative procedure . The nth iterated value { # I } is obtained by solving the linearized equations derived by substituting the ( # - ‘ ] } in the quadratic terms of ( 3 . 7 ) . The process is initiated with { rkol = 0 } and converges in a few steps because the quadratic terms in ( 3 . 7 ) are proportional to h4 and give only small contributions for the usual time steps used in molecular dynamics . In a numerical test of this method on liquid n - butane ( Section 4 ) , three or four itera - 334 RYCKAERT , CICCOTTI AND BERENDSEN tions are sufficient to satisfy the constraints to a relative discrepancy in the displace - ments of order IO - lo . In the Appendix , we give the explicit form of ( 3 . 7 ) for an n - point chain simulating an n - alkane ; we consider the semirigid model of a chain for which all bonds between adjacent atoms of the chain and all angles between adjacent bonds are rigid , i . e . , a total of ( 2 ~ 2 - 3 ) rigid constraints . Algorithm ( 3 . 3 ) is not self - starting ; we must therefore evaluate two successive configurations of the system { r , ( O ) } , & ( A ) } . m order to initiate the integration . If ( { rJO ) , ii ( O ) } ) is the initial state of the system such that all constraints are satisfied , we can obtain { ri ( h ) } to a reasonable approximation ( error in O ( h3 ) ) by applying the general method given in Section 2 to the Taylor expansion up to the second order . The method for computing the ( rli } is identical to the procedure developed for the algorithm ( 3 . 3 ) , ( 3 . 4 ) . 4 . THE CASE OF ~ - BUTANE : COMPARISON WITH INTEGRATION IN GENERALIZED COORDINATES In order to compare our integration method in Cartesian coordinates with the classi - cal method involving generalized coordinates , we have applied both methods to a system of 64 n - butane molecules . The model of the n - butane molecule was previously described in Ref . [ 3 ] . For present purposes we recall that the molecule is represented as a four - point system with three rigid bonds between adjacent points ( C - C bonds ) and two rigid angles of 109”28’ between adjacent bonds ( C - C - C angles ) . The whole system is enclosed in a cubical box with periodic boundary conditions ; the density p = 0 . 675 g / cm3 matches that of liquid butane and the kinetic energy corresponds to a temperature of ~ 200°K . 1 . Integration in Generalized Coordinates Lagrange equations of the second kind are written in the following generalized coordinates [ 3 ] : three coordinates for the center of mass of each molecule ; three Eulerian angles giving the orientation of a reference frame attached to the molecule ; and one angle of internal rotation around the C - C central bond for each molecule . Those equations are integrated with the Gear algorithm used previously by Rahman and Stillinger [ 2 ] . 2 . Integration in Cartesian Coordinates Lagrange equations of the first kind are integrated by the method of undetermined parameters given in Section 3 . These equations of motion and the equations giving the ( yk } of n - butane are given in the Appendix for n - alkanes of any length . Let { r ( l ) ( t ) } and ( r ( “ ) ( t ) } be the trajectory of the system ( 256 CH , or CH2 particles ) obtained , respectively , by methods 1 and 2 , starting with the same initial cotiguration INTEGRATION OF A SYSTEM WITH CONSTRAINTS 335 at t = to . ( { r @ ) ( t ) } is calculated from the corresponding generalized coordinates at time t . ) We define 256 xi ( r , “‘ ( t ) - ri’2’ ( t ) ) 2 / 256 1’2 , 1 1 ( r ( t ) > = [ fi ( r ? ‘ ( t ) - r1” ( 0 ) ) 2 / 256 ] 1’2 . 1 ( 4 . 1 ) ( 4 . 2 ) The calculations in each case were carried out with the same value of the time step , i . e . , It = 1 . 95 lo - l5 set , over a period T = 1 . 56 lo - l3 set sufficiently long to observe an appreciable modification of the system ( the normalized center of the mass velocity - autocorrelation function decreases from 1 to 0 . 3 during this time interval ) . Equations ( 4 . 1 ) and ( 4 . 2 ) being zero at time r , , , we obtained for t = to + T ( I Sr ( r , + T ) I ) = 1 . 1 1O - 4 A , ( r ( to + T ) ) = 0 . 6 8 . Hence , after a time T , both numerical paths have diverged with a relative average discrepancy of 2 . 10 - * . On a larger scale of time , no drift of the total energy was ob - served in either case . Instead , it oscillates around a stable value with an amplitude of ~ 10 - ~ of the kinetic energy . The computer times required for a single integration step were , respectively , 3 . 25 set in method 1 and 1 . 30 set in method 2 on an IBM 370 / 168 . Both methods seem then comparable in efficiency for an n - butane liquid . The advan - tage of the Cartesian method , as we mentioned earlier , is that it can be readily extended to larger n - alkanes . 5 . AN ALTERNATIVE PROCEDUREFORCOORDINATERESETTING The method described in Section 3 for “reseting” the coordinates by solving Eqs . ( 2 . 10 ) requires a matrix inversion at each step in order to compute the yk . An alternative method based on a physical picture of the process by which the con - straints are corrected is described below . The procedure is valid for algorithms requir - ing no derivatives of the forces , such as the Verlet algorithm . Let the kth constraint be given by ok = ( ri - rj ) ” - df , = 0 . ( 5 . 1 ) In the method described in Section 3 , the constraints are satisfied by adding displace - ment vectors 6ri to the vectors ri’ , which resulted from a nonconstrained time step , 336 RYCKAERT , CICCOTTl AND BERENDSEN such that ok = 0 for { ri = ri’ + 6ri ) . According to Eq . ( 3 . 3 ) the displacements are given for the Verlet algorithm by = - F tk ykrij ( hA ( 5 . 2 ) where rij = ri - rj is the vector associated to the kth rigid bond . If We define gij = - 2 ( 4t ) 2 Yk , then gijrJt , J / mi is the contribution of the kth constraint to the displacement 6ri . Likewise gjirji ( to ) / mj is the contribution of the same constraint to the displacement 6ri . Obviously gii = gij . In a physical picture this means that constraint forces of equal magnitudes and opposite orientations are applied to the particles i and j , in the direction of the bond between i and j for the configuration of the system at time t , . Since the yk are uniquely determined , the gij are also uniquely determined . It thus follows that any convergent procedure that results in satisfying all constraints by displacements of the form while gj , = gij for all constrained pairs ( i , j ) and gij = 0 for all other pairs will give results equivalent to those of the method described in the previous sections . Our alternative method , referred to as the procedure “SHAKE , ” is an iterative method that considers all constraints in successi0n . l Given the particle i the procedure corrects its position ( and that of j ) for the action of the kth constraint according to ( 5 . 4a ) tikrj = - gijrjj ( t & / WZj - ( 5 . 4b ) Consequently the position ri’ , initially produced by the nonconstrained time step ( cf . , Eqs . ( 2 . 9 ) and ( 3 . 3 ) ) , is corrected with xk 6kri and the next particle is considered . In this way , for each constraint a quadratic equation in gij is obtained . Defining and r’ = ri’ + kgk Sk’ri - ( rl’ + , zk @ ‘rj ) 6r = Skrt - 89 , , 1 Copies of the Fortran subroutine “SHAKE” are available on request by writing to the third author . INTEGRATION OF A SYSTEM WlTH CONSTRAINTS 337 r = ri ( to ) - ri ( t , J , g = g , and d = di , , we can write the constraint relations as with ( r’ + Sr ) 2 - dZ = 0 ( 5 . 5 ) Sr = ( - $ + $ ) s , which yields the equation 2 ( - g . ( r * r’ ) + ( - $ + k ) ” g’ + 2 = d * - r’2 . ( 5 . 6 ) The fulfillment of the kth constraint partially destroys that of the previous constraints k’ < k . Therefore the procedure is subsequently iterated until every ulc is less than a specified tolerance . As a result of the completed procedure a total correction { Sri } is obtained according to Eq . ( 5 . 3 ) , where now gij is equal to the sum of all gij’S obtained in the successive iterations . For computational efficiency Eq . ( 5 . 6 ) is solved only to first order for each constraint , i . e . , the term in g2 is neglected . The iterative nature of the procedure assures that each quadratic equation is finally also solved within the specified tolerance . The procedure was compared with the matrix method for a molecular dynamics step on a single decane molecule with a time step of 4 x lo - l6 sec . Both the initial configuration { r ( t , ) } and the configuration ( r’ } after an unconstrained step were taken from the dynamics run . The relative performance of the two methods is very depen - dent on the required accuracy of the resetting procedure : the number of iterations required and the computer time for SHAKE resetting increase roughly proportional to the negative logarithm of the tolerance , while for the matrix method practically all the time is spent on matrix inversion and a high accuracy can be attained with little additional effort . Both methods give identical numerical results within the specified tolerance . For a relative tolerance of lo - ? in the constraints both methods used the same central processor time ( 90 msec on a CDC Cyber 74 - 16 ) ; for better accuracies the matrix method is faster , while for lower accuracies SHAKE is to be preferred . For a tolerance of IO - 1a , SHAKE was roughIy twice as slow as for a tolerance of IO - ‘ . SHAKE has the advantage of being generally applicabile also to very large mole - cules containing hundreds of atoms . For small molecules in accurate molecular dynamics runs , however , the matrix resetting method is to be preferred . VI . CONCLUSIONS In this paper , we have described an algorithm for the integration of the cartesian equations of motion of an N point system subject to holonomic constraints ; the relations of constraint remain satisfied exactly at each step in the trajectory . 338 RYCKAERT , CICCOTTI AND BERENDSEN For liquid n - butane we have compared the method with the corresponding integra - tion scheme in generalized coordinates . The two methods are of similar efficiency ; this is expected to remain so for larger molecules . In fact , the suitable time step for the method of undetermined parameters is of the same order of magnitude as those generally chosen in other molecular dynamics studies [ l , 2 , 31 . For the n - butane case , the computer time per step is 2 . 5 times smaller in the Cartesian method although the calculation of the forces are performed once per step in both methods . The difference in the computer time is mainly due to the greater simplicity of the Cartesian method , in which all calculations are performed in a unique reference frame with a unique set of variables . For the same reason , there is no significant differ - ence in the required storage of data used in both methods . We can therefore claim that if we add holonomic constraints to a system of N interacting free points , the numerical integration of the new equations of motion does not introduce new techni - cal problems , the time step remains approximatively the same , and the computer time does not increase much , because the handling of the forces of constraint does not involve complicated manipulations . Apart from the calculation of these forces , the program remains exactly equivalent to that for simple liquids . The new method would be adequate for the study of the physical properties of systems involving molecules with a large number of internal degrees of freedom , in which case the equations of motion in generalized coordinates become rather imprac - tical . Molecular dynamics studies of pure n - decane and n - decane - solvent mixtures are now in progress . APPENDIX : CARTESIAN FORCES OF CONSTRAINTS FOR AN ~ - POINT SEMIRIGID CHAIN @ ALKANE ) The model of an n - alkane molecule is an extension of that used for n - butane [ 3 ] . It is a semirigid ( linear ) chain of n - CH , or CH , groups considered as interacting points : the rigidity of the chain results of ( n - 1 ) fixed bonds between adjacent groups ( C - C bonds of length a = 1 . 53 A ) and ( n - 2 ) fixed angles ( C - C - C of angle 0 = 109O . 28’ ) . The internal motion of the chain results in ( n - 3 ) internal rotations around the C - C bonds . The physical forces in this system are due to all pair interactions ( as Lennard - Jones interactions , for example ) between groups belonging to different molecules or between groups belonging to the same molecule ( from the third neighbor - ing ones ) . If we number i = 1 , 2 , . . . , n - 1 , n the groups from one terminal group to the other , let { r , } , ( ei } , { Fi } , and { Gi } be , respectively , their positions , velocities , physical forces , and forces of constraint . All relations of constraint can be written as ( ri + l - ri ) 2 - u2 = 0 ( i = l , . . . , n - 1 ; bond constraint ) , ( A - 1 ) ( To2 - ri ) * - b2 = 0 ( i = l , . . . , n - 2 ; angle constraint ) , b = 2u sin 012 . 0 - W INTEGRATION OF A SYSTEM WITH CONSTRAINTS 339 In order to get a single expression of Gi in terms of the { h } , ( 2 . 2 ) , we label the relations of constraint ( A . l ) and ( A . 2 ) and their corresponding Lagrangian multipliers in the following way : c = 1 ) 3 , 5 ) . . . , ( 2n - 3 ) corresponds to the successive bond constraints ( A . l ) between pairs of adjacent groups 21 , 32 , . . . , n ( n - 1 ) . c = 2 , 4 , . . . , ( 2n - 4 ) corresponds to the successive angle constraints ( A . 2 ) between second neighbor groups 31 , 42 , . . . , n ( n - 2 ) . For each group of the chain , the equations of motion ( 2 . 2 ) become rnifi = Fi + Gi ( A - 3 ) where Gi = - 2X , , & - ri - & - 2Xzi - , ( ri - ri - J + 2hdri + , - rd + 2k & i + 2 - rd . 64 . 4 ) ( For i = 1 , 2 , . . . , ( n - 1 ) and n , some terms involving nonexisting groups must be dropped in ( A . 4 ) . ) Equation ( A . 3 ) can be integrated with the algorithm given in Section 3 . Applying our procedure ( 3 . 3 ) , ( 3 . 4 ) , we obtain the following expressions ri ( h ) = ri’ ( h ) + hi ( h ) ( A . 3 where ri ( N = - - d - - h ) + 2rdO ) + ( hz / mi ) W ) , hi ( h ) = ( P / m , ) Gi , with G = 2 [ - - - ydri - ri - J - yzi - s ( ri - ri - d + m - l ( ri + l - ri ) + y2i ( rf + 2 - rd . G - w The { yk ) are a set of ( 2n - 3 ) parameters corresponding to the { X , ( O ) } through relation ( 3 . 5 ) if the { yk } are solutions of the ( 2n - 3 ) Eqs . ( 3 . 8 ) obtained by substituting ( AS ) in ( A . l ) and ( A . 2 ) . In order to obtain the solution of this set of ( 2n - 3 ) quadratic equations in the ( 2n - 3 ) { rlc } by the iterative procedure of Section 3 , it is convenient to write them in the following matricial form where the kth line corresponds to the equation involving the kth constraint where A is a ( 2n - 3 , 2n - 3 ) matrix whose elements are zero except for those given 340 RYCKAERT , CICCOTTI AND BERENDSEN below , y is the column vector ( yl , y2 , . . . , Y . + ~ ) , and B is the column vector whose elements collect all terms nonlinear in y in the kth equation . If k is odd ( constraint between groups labeled , ( k + 1 ) / 2 , ( ( k + 1 ) / 2 ) + 1 ) 4 = a * - C & + 3 ) 12 - rik + ~ d * - $ Gtk + 3 ) / 2 - Gk + ld , Ak . k - 3 = g @ ik + 3 ) / 2 - rik + d * ( r ( k + l ) h - r ( k - 3d , 4112 & . . k - 2 = 7 ( rik + , ) i2 - rik + l ) j2 ) * ( r ( k + 1 ) 12 - r ( k - l ) i3 ) r A k . k - 1 = - g @ tk + 3 ) / 2 - rik + l ) / 3 ) . hk + 3 ) / 3 - r ( k - lh ! ) 9 A k , k = - z @ ik + S ) / Z - rtk + l ) 12 ) ’ h + 3 ) / 2 - r ( k + ld A k . k + l = - $ @ ik + 3 ) / 2 - h + l ) d . hk + 5 ) / 2 - r ( k + l ) 12 ) 9 4h2 Ak . k + 2 - m bik + 3 ) / 2 - rik + 1 ) 12 ) ’ hk + 5 ) / 2 - r ( k + 3h ) ? - & + l ) l2 ) ’ hk + 7h - r ( k + 3d If k is even ( constraints between groups labeled k / 2 and ( k / 2 ) ] + 2 ) & = b * - @ ik + 4 ) / 2 - & 2 ) ’ - $ ( % + 4 ) / z - Gk , 2 > * , 4h2 Ak . k - 4 = m @ ik + 4 ) / 2 - & 2 ) ’ trk / 2 - r ( k - 4 ) la ) s 4h2 Ak . k - 3 = m b ? k + 4 ) / 2 - h2 ) ’ hk / 3 - r ( k - 2 ) / 2 ) s Ak . k - - l = - g @ ik + 4 ) / 2 - & / 2 ) ’ hk + 2 ) / 2 - rk / 2 ) 9 A 8h2 k . k = - m @ ik + 4h - kl2 r’ ) ’ hk + 4h - rk / 2 ) v A k . kfl = - $ bik + 4 ) / 2 - & P ) ’ hk + 4 ) / 2 - r ( k + 2d9 A k . k + 3 = g ( rik + 4h - 642 ) ’ hk + d / 2 - r ( k + 4 ) / 2 ) y A k . kf4 = g @ ik + 4 ) / S - r & 2 ) ’ hk + 3 ) / 2 - r ( k + 4 ) / 2 ) e INTEGRATION OF A SYSTEM WITH CONSTRAINTS 341 ACKNOWLEDGMENTS The authors wish to thank Professor A . Bellemans , Dr . G . Jacucci , and Dr . J . Orban for many stimulating discussions and suggestions . They are much indebted to Dr . I . R . MacDonald for the critical lecture of the manuscript . One of us ( J . P . R . ) is also grateful to the “Institut pour I’Encourage - ment de la Recherche Scientifique dans I’Industrie et I’Agriculture” for financial support . REFERENCES 1 . J . BAROJAS , D . LEVFSQUE , AND B . QUENTREC , Phys . Rec . A 7 ( 1973 ) , 1092 . 2 . A . RAHMAN AND F . H . STILLINGER , J . Chem . Phys . 55 ( 1971 ) , 3336 ; J . Chem . Phys . 60 ( 1974 ) , 1545 . 3 . J . P . RYCKAERT AND A . BELLEMANS , Chem . Phys . Letr . 30 ( 1975 ) , 123 . 4 . J . ORBAN AND J . P . RYCKAERT , Report on CECAM Workshop , “Methods in Molecular Dynamics , ” 1974 , unpublished . 5 . T . C . BRADBURY , “Theoretical Mechanics , ” Chap . XI , Wiley International Editions , New York , 1968 . 6 . L . VERLET , Phys . Rev . 159 ( 1967 ) , 98 .