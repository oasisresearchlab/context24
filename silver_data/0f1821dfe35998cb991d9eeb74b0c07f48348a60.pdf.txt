CLASSIFICATION , AVERAGING AND RECONSTRUCTION OF MACROMOLECULES IN ELECTRON TOMOGRAPHY A . Bartesaghi , 1 P . Sprechmann , 2 G . Randall , 2 G . Sapiro 3 and S . Subramaniam 1 1 Center for Cancer Research , National Institutes of Health , Bethesda , MD 20892 2 Instituto de Ingenier´ıa El´ectrica , Universidad de la Rep´ublica , Montevideo , Uruguay , 11800 3 Electrical and Computer Engineering Department , University of Minnesota , Minneapolis , MN 55455 ABSTRACT Electron tomography provides opportunities to determine three - dimensional cellular architecture at resolutions high enough to identify individual macromolecules such as pro - teins . Image analysis of such data poses a challenging prob - lem due to the extremely low signal - to - noise ratios that makes individual volumes simply too noisy to allow reliable struc - tural interpretation . This requires using averaging techniques to boost the signal - to - noise ratios , a common practice in elec - tron microscopy single particle analysis where they have pro - ven to be very powerful in elucidating high resolution struc - ture . Although there are signiﬁcant similarities in the way data is processed , several new problems arise in the tomogra - phy case that have to be properly dealt with . Such problems involve dealing with the missing wedge characteristic of lim - ited angle tomography , the need for robust and efﬁcient 3D alignment routines , and design of methods that account for diverse conformations through the use of classiﬁcation . We present a framework for reconstruction via alignment , classi - ﬁcation and averaging of volumes obtained from limited an - gle electron tomography , providing a powerful tool for high resolution structure determination and description of confor - mational variability in a biological context . Index Terms —Tomography , Image registration , Image clas - siﬁcation , Clustering methods . 1 . INTRODUCTION Transmission electron microscopes can be used to determine three - dimensional structure using principles that are very sim - ilar to those used in technologies such as computerized axial tomography . A series of projection images spanning a lim - ited angular range is obtained by tilting the specimen rel - ative to the electron beam , and combine them using back projection algorithms to generate a three - dimensional volume This work has been partially supported by ONR , NSF , DARPA , and NGA . PS and GR performed part of this work while at the University of Minnesota visiting ECE and IMA . of the imaged object . Electron tomography technology pro - vides opportunities to determine three - dimensional cellular architecture at resolutions of approximately 50 ˚A or better , it is especially applicable for the structural analysis of or - ganelles and other macromolecular assemblies that are too heterogeneous to be investigated by NMR or X - ray crystal - lographic techniques . The development of reliable compu - tational approaches for the analysis of electron tomography data is a challenging problem due to the extremely low signal - to - noise ratios and high structural complexity that are inher - ent to biological specimens . One of the factors limiting sig - nal strength comes from the potential of electrons to damage organic matter , which necessitates the use of electron doses that are high enough to obtain measurable contrast , but low enough to minimize structural damage . This is particulary true for cryo - microscopy where reconstructed volumes are simply too noisy to allow direct high resolution interpretation . The idea is to register and then average multiple noisy copies of the same structure so that signal strength can be improved . The beneﬁts of using averaging techniques for boosting the signal - to - noise ratio are well established and routinely used in electron microscopy single particle analysis [ 1 , 2 ] . There are though , fundamental differences in the type of data be - ing processed which is now three - dimensional , very hetero - geneous and affected by the missing wedge . In this context , averaging will only make sense within a classiﬁcation frame - work that prevents copies coming from different conforma - tional structures to be averaged . Current techniques for 3D averaging of cryo tomographic data require availability of an initial reference , to which all volumes are aligned and aver - aged regardless of the conformational heterogeneity [ 3 , 4 ] . Many times , selection of the reference is done on a subjec - tive basis resulting in high resolution maps that are strongly biased and poorly representative of the underlying data . We present a framework for alignment , classiﬁcation and averaging of tomographic volumes that deals with noisy , het - erogenous and wedge affected volumes and does not require initial references . The idea is to identify and register volumes that represent similar conformations so they can be averaged for improving the signal - to - noise . As a key component of 244 1­4244­0672­2 / 07 / $ 20 . 00 ©2007 IEEE ISBI 2007 the framework , we introduce in Section 2 a fast 3D align - ment technique that takes the missing wedge into account , enabling for the ﬁrst time computation of complete distance matrices for a more accurate approach to classiﬁcation than current multivariate statistical analysis techniques [ 4 ] . 2 . ALIGNMENT OF VOLUMES AFFECTED BY THE MISSING WEDGE Volumes reconstructed from limited angle tomography are intrinsically affected by a missing wedge of information in Fourier space . According to the central slice theorem , see e . g . [ 5 ] , each measured projection provides frequency infor - mation in a slice through the origin ( orthogonal to the inci - dent beam ) typically covering a ± 60 degree range , see Fig . 1 ( left ) . Given two such volumes , the alignment problem con - sists in ﬁnding the rigid transformation between the two that minimizes a given dissimilarity criteria . In three - dimensions this is a six degree - of - freedom ( DOF ) problem , one rotation and one translation per coordinate axis . Standard 3D align - ment techniques ( including widely used cross - correlation ) are known to give biased estimates as they tend to align the areas of missing frequency information to one another [ 6 ] . To deal with this problem we restrict the computation of the dissimilarity measure to the overlapping regions in Fourier space between the two volumes . Since the overlap region changes as volumes are rotated , this has to be done differently for each tentative 3D rotation requiring the use of exhaustive search to determine the best matching rotation . This however , will have no practical interest due to the huge computational burden involved . To overcome this difﬁculty we address the alignment in two stages , rotations are ﬁrst recovered within the Spherical Harmonics ( SH ) framework and then spatial shifts are obtained by Fourier based cross - correlation . The reasons for using SH are twofold . One is the existence of a fast convolution theorem that allows direct calculation of the rotations ( avoiding the brute force search ) [ 7 ] . Second , the missing wedge will have a trivial decomposition in this repre - sentation ( see below ) . In order to decouple the six DOF prob - lem into two problems of three DOF each , for the ﬁrst stage we use the amplitude of the Fourier Transform ( FT ) which is invariant to translations . In the SH framework we repre - sent each volume as a scalar image deﬁned on the unit sphere S 2 , obtained by integrating the amplitude of the 3D FT along rays though the origin . Using this representation , the missing wedge simply appears as an occluding mask on the sphere as seen in Fig . 1 ( right ) . If we denote the two scalar images on the sphere by a ( x ) , b ( x ) : S 2 → (cid:3) , their matching score in the presence of occluding masks m a ( x ) , m b ( x ) : S 2 → { 0 , 1 } is deﬁned for each R in the 3D rotation group as : S ( R ) = (cid:2) x ∈ S 2 (cid:3) a ( x ) − b ( R t x ) (cid:4) 2 m a ( x ) m b ( R t x ) dx ( 1 ) and the goal is to ﬁnd R that minimizes this quantity . Using Fig . 1 . Missing wedge in limited angle tomography . Left : Projections are taken in a limited angular range providing slices of information in Fourier space ( central slice theorem ) . Right : Spherical Harmonics representation of a wedge affected volume obtained by projecting ( onto the unit sphere ) the magnitude of its 3D Fourier Transform along rays through the origin . the convolution theorem on the sphere , Eq . 1 can be expressed as a series of convolutions : S = a 2 m a (cid:2) m b − 2 ( am a ) (cid:2) ( bm b ) + m a (cid:2) b 2 m b , ( 2 ) which can be computed rapidly as products of FTs . The best R is readily obtained by localizing the minima within the cor - relation volume S . The accuracy of this solution is limited by sampling of the SH grid , the number of coefﬁcients used in the SH expansion and also because we are projecting the vol - umetric data into a lower dimensional space ( the sphere ) . We therefore reﬁne this estimate using off - the - shelf optimization routines that locally maximize the 3D cross - correlation ( com - puted exclusively on overlapping frequency components ) , and also give the shifts in the three coordinate axis . 2 . 1 . Performance of the alignment routine In general , success of the alignment routine depends on the size of the missing wedge with respect to image features and also the amount of noise present . Under certain circumstances , the available information in Fourier space may not be enough to allow correct matching of volumes even in the noise - free case . We evaluate the performance of our alignment tech - nique under different amounts of noise and missing wedge sizes on a three - legged non - symmetric 3D phantom model . For each ( noise , wedge ) pair we produced randomly rotated copies under the same noise and wedge conditions and com - puted the average alignment error ( comparing the Frobenius norm of the linear transformation matrices to the correct val - ues ) . In Fig . 2 we show alignment error plots using the usual cross - correlation alignment and the technique described in Section 2 . In the ﬁrst case , alignment performance degrades quickly for tilt ranges smaller than ± 70 and modest noise lev - els , while in the second case the low error area extends sig - niﬁcantly up to ± 55 degrees and shows better tolerance to noise . To illustrate the potential implications of this , we built a three - fold symmetric phantom with a simulated extension in one of the legs to mimic the interaction between macro - molecular complexes of dissimilar sizes by cryo - electron to - mography . Seventy randomly oriented copies of the phantom were generated . Projections of each volume were taken in a 245 Fig . 2 . Average alignment error for different sizes of missing wedge and noise levels . Left : Using the usual cross - correlation alignment , total MSE = 3 . 72 . Right : Using the technique introduced in Section 2 , total MSE = 1 . 37 . Fig . 3 . Effect of alignment errors due to the missing wedge in volume av - eraging . Left : Phantom model . Center : Average of 70 volumes aligned with the technique presented in Section 2 nicely recovers the small feature in one of the legs . Right : Same average obtained after cross - correlation alignment spreads the feature among the three legs due to frequent alignment errors . ± 60 range , and Simultaneous Iterative Reconstruction Tech - nique ( SIRT ) was used for reconstruction . We aligned all vol - umes in the set using cross - correlation alignment as well as our technique and computed the corresponding volume aver - ages . Results are shown in Fig . 3 , observe how using cross - correlation alignment ( even in the noise - free case ) the small feature spreads out in all three legs due to frequent alignment errors while properly accounting of the missing wedge main - tains the correct geometry . 3 . VARIABILITY ANALYSIS VIA CLASSIFICATION In order to deal with the great heterogeneity characteristic of biological material and at the same time be able to achieve signal - to - noise ratios that permit high resolution interpreta - tion , a classiﬁcation strategy to averaging must be adopted making sure averages are computed strictly from homoge - neous sets of volumes . In practice , some degree of true den - sity variability will be sacriﬁced in favor of improving the signal level . The value of classiﬁcation techniques is that of providing a glimpse of the landscape of conformations so that an educated decision can be made on what level of averaging is most appropriate . The classiﬁcation problem can be stated as the following : given a set of volumes that are noisy and rotated copies ( affected by the missing wedge in different ori - entations ) of many different conformations , the goal is to re - cover class averages that represent each of the conformations . The number of representative classes is initially unknown and we assume that for each class there are enough copies in uni - formly distributed orientations so that isotropic resolution can be attained in the average maps . Our approach to classiﬁcation is divided in three stages . First , we compute a distance matrix by aligning all pairs of volumes in the set . The deﬁnition of distance is that intro - duced in Section 2 that measures similarity between volumes based only on overlapping frequency components . Although still computationally demanding , this is now feasible because we have overcome the need for brute force search . More im - portantly , this will enable a more accurate approach to clas - siﬁcation that is unbiased and does not require initial refer - ences . Next , a hierarchical clustering technique using com - plete linkage ( farthest neighbor ) is used to build an initial dendrogram [ 2 ] . Cutting the tree at a small enough threshold , yields classes of volumes that are very similar to one another . The idea here is to get an initial and very conservative set of references that will later be reﬁned . Note that many volumes may be left out this initial classiﬁcation ( depending on the number of neighbors and how close they are to each other ) , and homogeneous classes may be split down into sub - classes of stronger similarity . In the third stage , these classes are used as seeds to an iterative procedure ( reminiscent of k - means ) that progressively reﬁnes class averages by re - assigning vol - umes to references . In each iteration , volumes are assigned to the closest reference using an elimination step to get rid of outliers . To allow early associations to be changed as the loop advances , volumes may be assigned to a different reference in each iteration . References are continuously compared to each other to determine if they actually represent the same confor - mation so they can be merged together . 1 We use bundle align - ment to guarantee that volumes within a class are optimally aligned using an iterative reference - free algorithm [ 2 ] . The classiﬁcation loop is terminated when no signiﬁcant changes are observed indicating convergence was achieved . The reﬁnement step is somewhat similar to that used in single particle analysis [ 1 ] , as before however , there are some fundamental differences due to the fact that these are 3D wedge affected volumes . Progressive averaging will not only in - crease the signal - to - noise , but will also effectively decrease the size of the missing wedge further improving the accu - racy of subsequent alignments . This however , requires careful computation of averages in Fourier space to prevent missing wedge regions to be averaged with areas of valuable infor - mation ( this will happen if averages are computed directly in image space ) . Unlike the 2D case , here we can incorporate a number of geometric constraints within the classiﬁcation loop that result in improved robustness . For example , we can use the linear transformations between all pairs of volumes ( com - puted and stored during the ﬁrst step of the classiﬁcation ) , to enforce alignment consistency checks within sets of volumes . That is , if volumes ( A , B ) are related by the linear transfor - mation T A , B and ( B , C ) by T B , C , then A and C should be related by T A , B • T B , C , otherwise , this may be an indication 1 References are merged if their distance falls below a given threshold . 246 Fig . 4 . Classiﬁcation experiment on a set of 80 volumes reconstructed from noisy ± 60 degree projections . Top : Four phantom conformations . Center : Slices through some of the initial SIRT reconstructed volumes and ﬁnal aver - ages after classiﬁcation . Bottom : 3D class averages after classiﬁcation ( left ) and incorrect average of all volumes without classiﬁcation ( right ) . that alignment errors have occurred . Also , when assigning a volume to a reference we consider not only its distance to the reference , but also the distances to all volumes contributing to that reference , as well as the amount of wedge overlap , so associations can be made much more accurately . 3 . 1 . Classiﬁcation experiments We analyze the performance of the clustering method with two different experiments . In the ﬁrst , four different phan - toms were generated , Fig . 4 ( top ) . Phantom conﬁgurations were deliberately selected to produce high degree of simi - larity between densities despite being different from one an - other , e . g . , one of the trimer conﬁgurations is obtained by adding an extra leg to the dimer conﬁguration . Twenty ran - domly rotated copies of each model were produced giving a total of 80 volumes . As routinely done in cryo - tomography , forty projections of each were taken in a ± 60 range and noise was added to each projection . Volumes were then recon - structed using the SIRT reconstruction technique . The dis - tance matrix , as well as all alignments within the loop , were computed using bandpass ﬁltered versions of the input vol - umes . Nine classes were extracted from the initial hierar - chical clustering and used to initialize the loop . After three iterations , four class averages were obtained , shown in Fig . 4 . Also shown in this ﬁgure is an average obtained without proper classiﬁcation as currently done in cryo - tomography studies , showing how inaccurate this is for describing hetero - geneous datasets . For the second experiment , we generated phantoms in three stoichiometry conﬁgurations with differ - ent quantities in each group : monomers ( 55 ) , dimers ( 75 ) and trimers ( 45 ) . We also added to the set 25 volumes generated as random noise making a total of 200 volumes . The distance matrix was computed and twenty initial classes obtained by thresholding the hierarchical clustering dendrogram . After running the loop , the three class averages were recovered with all outlier volumes left out ( results not shown due to space limitations , will be presented at the meeting ) . The code for the experiments was parallelized to take advantage of the high performance computational capabilities of the Biowulf Linux cluster at the National Institutes of Health , Bethesda , MD . 4 . CONCLUDING REMARKS We presented a framework for alignment , classiﬁcation and averaging of volumes obtained from limited angle electron tomography . We showed the potential misinterpretations aris - ing from not carefully considering the wedge and the variabil - ity in this type of analysis . To illustrate the importance of our framework , we used realistic 3D phantoms since ground - truth was needed . Experiments with real data from our lab are cur - rently underway . Availability of such image processing tools has enormous implications as it will confer new capabilities to electron tomography technology , allowing a whole new spec - trum of discoveries in molecular and cellular biology . 5 . REFERENCES [ 1 ] van Heel M , Gowen B , Matadeen R , Orlova EV , and Finn R , “Single - particle electron cryo - microscopy : Towards atomic resolution , ” Q Rev Biophys , vol . 33 , 2000 . [ 2 ] Joachim Frank , “Three - Dimensional Electron Mi - croscopy Of Macromolecular Assemblies : Visualization Of Biological Molecules In Their Native State” , Oxford Univ Press , February 2006 . [ 3 ] F . Forster , O . Medalia , N . Zauberman , W . Baumeister , and D . Fass , “Retrovirus envelope protein complex struc - ture in situ studied by cryo - electron tomography , ” PNAS , vol . 102 , no . 13 , pp . 4729 – 4734 , 2005 . [ 4 ] H . Winkler , “3D reconstruction and processing of vol - umetric data in cryo - electron tomography , ” Journal of Structural Biology , August 2006 , In Press . [ 5 ] F . Natterer and F . Wuebbeling , Mathematical Methods in Image Reconstructions , SIAM , Philadelphia , 2001 . [ 6 ] A . S . Frangakis , J . Bohm , F . Forster , S . Nickell , D . Nicas - tro , D . Typke , R . Hegerl , and W . Baumeister , “Identiﬁ - cation of macromolecular complexes in cryoelectron to - mograms of phantom cells , ” PNAS , vol . 99 , no . 22 , pp . 14153 – 14158 , 2002 . [ 7 ] P . J . Kostelec and D . N . Rockmore , “FFTs on the rotation group , ” Tech . Rep . , Santa Fe Institute , 2003 . 247