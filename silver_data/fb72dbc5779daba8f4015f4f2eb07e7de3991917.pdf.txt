1 Maximum - likelihood model fitting for quantitative analysis of SMLM data Yu - Le Wu 1 , 3 , Philipp Hoess 1 , Aline Tschanz 1 , 3 , Ulf Matti 1 , Markus Mund 1 , 2 , and Jonas Ries 1 * 1 European Molecular Biology Laboratory ( EMBL ) , Cell Biology and Biophysics Unit , Heidelberg , Germany 2 University of Geneva , Department of Biochemistry , Geneva , Switzerland 3 Candidate for Joint PhD Programme of EMBL and University of Heidelberg * Correspondence : Jonas . ries @ embl . de Abstract Quantitative analysis is an important part of any single - molecule localization microscopy ( SMLM ) data analysis workflow to extract biological insights from the coordinates of the single fluorophores , but current approaches are restricted to simple geometries or do not work on heterogenous structures . Here , we present LocMoFit ( Loc alization Mo del Fit ) , an open - source framework to fit an arbitrary model directly to the localization coordinates in SMLM data . Using maximum likelihood estimation , this tool extracts the most likely parameters for a given model that best describe the data , and can select the most likely model from alternative models . We demonstrate the versatility of LocMoFit by measuring precise dimensions of the nuclear pore complex and microtubules . We also use LocMoFit to assemble static and dynamic multi - color protein density maps from thousands of snapshots . In case an underlying geometry cannot be postulated , LocMoFit can perform single - particle averaging of super - resolution structures without any assumption about geometry or symmetry . We provide extensive simulation and visualization routines to validate the robustness of LocMoFit and tutorials based on example data to enable any user to increase the information content they can extract from their SMLM data . 2 Introduction Single - molecule localization microscopy ( SMLM ) , such as PALM ( photoactivated localization microscopy 1 , 2 ) or STORM ( stochastic optical reconstruction microscopy 3 ) , enables nanometer optical super - resolution and has widespread applications in cell and structural biology . SMLM is based on precisely localizing single switchable fluorophores that are sparsely activated in individual camera frames . From the coordinates of the fluorophores , determined in thousands of frames , a super - resolution image is reconstructed . Visual inspection of this image can provide insights into the investigated biological system , but to gain reliable mechanistic insights , a quantitative analysis is indispensable . This is especially true when large amounts of data are created using high - throughput SMLM 4 – 7 , which precludes a visual analysis . Such a quantitative analysis aims at informing on properties of the biological system or at probing functional differences among different conditions with statistical confidence . Standard image analysis algorithms can be applied directly to a rendered pixelated super - resolution image , but often their performance is limited due to the very different image formation process and information content in SMLM compared to standard fluorescence microscopy . The primary data in SMLM , but also in the new MINFLUX 8 super - resolution technology , are not the reconstructed images , but a list of coordinates of fluorophores , often with additional information such as an estimate of the localization uncertainty . Thus , algorithms that directly use these coordinates can exploit this additional information and can produce more accurate and robust results 9 . These algorithms can be assigned to several classes 9 : Spatial descriptive statistics , such as pair - correlation 10 or Ripley’s K - function 11 , inform on the clustering state and cluster sizes in specific regions of interest . After segmentation of individual structures , they can be classified 12 , or analyzed with a geometric analysis . Examples include size estimation from the standard deviation of the coordinates , fitting of single or double Gaussians to line profiles 13 – 15 , or fitting of a circle to extract the diameter of ring - shaped structures 16 , 17 . However , to date , only simple models have been used that cannot adequately describe the complex geometry of many cellular structures . In particle averaging or fusion , an approach adapted from electron microscopy , hundreds of particles or structures are registered and averaged to result in a final model with improved resolution and signal 18 – 20 . However , this approach relies on the underlying biological structures to be identical with minimal biological variability . Neither of these approaches is applicable to the most typical scenario of SMLM data analysis : Usually , some aspects of the geometry underlying the structure of interest can be guessed from visual inspection of the super - resolution images or from prior knowledge based on structural biology techniques . The data analysis task then consists of first selecting the most likely geometry from a class of possible models and second extracting precise parameters describing this geometry . Such analysis would be applicable to individual structures and thus could quantify biological and functional heterogeneities . However , to our knowledge , algorithms for such analysis of SMLM data do not yet exist . Here , we developed Loc alization Mo del Fit ( LocMoFit ; Fig . 1 ) , a general framework to fit an arbitrary model to coordinate - based SMLM data . Based on maximum likelihood estimation ( MLE ) , it identifies the most likely model from a class of models and estimates the most likely parameters of the model that describe the experimental structure . If the underlying geometry cannot be guessed , LocMoFit can be used for particle averaging to calculate an average model under the assumption of identical structures . Advanced visualization routines and a simulation engine allow for efficient validation and quality control . LocMoFit , written in MATLAB , has an API for integration into own code and can be easily extended by user - defined models . Seamless integration of LocMoFit in the open - source analysis platform SMAP 21 provides access to plenty of tools for SMLM for localization , post - processing and quantification . 3 Distributed as open source and with numerous examples and extensive documentation , LocMoFit will enable many researchers to perform quantitative analysis of their data with unprecedented efficiency , accuracy and statistical power . Figure 1 . Overview of LocMoFit . a - c , Workflow of the fitting procedure . a , Inputs of LocMoFit are the spatial coordinate 𝑥⃗ ! and localization precision 𝜎⃗ ! of each localization 𝑘 and a geometric model 𝑓 parameterized by parameters 𝑝 . b , First the probability density function ( PDF ) 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) of the input model is constructed . c , From the model PDF the likelihood is calculated that the model describes the data . A maximum likelihood estimation ( MLE ) routine searches in the parameter space and maximizes the log - likelihood to find parameter values that best describe the localizations . In the example , a 2D arc model ( cyan ) , parameterized by positions 𝑥 " , 𝑦 " , rotational angle 𝛾 , linkage error 𝜖 , arc opening angle θ , and radius r , is fitted to the single - color data ( orange dots ) . d - h , Features of the framework . d , Simulation engine for validation . Labels are simulated as samples drawn from the PDF and localizations are then calculated based on fluorophore properties including photon counts , re - blinks , and labeling efficiency . e , The framework supports flexible model forms including discrete / continuous models and images . f , It can assemble complex composite models from simple ones and supports 3D and multi - color data . In the example , the composite model M is formed by combining two ring models ( 𝑚 # and 𝑚 $ ) and one cylindrical model ( 𝑚 % ) , which are assigned to different channels , represented by different colors . Background models 𝑚 & ’ are incorporated channel - wise . g , LocMoFit allows multi - step successive optimization to avoid local optima . In the example , a smooth , continuous ring model is used to robustly estimate approximate parameters . These are then passed on as start parameters for a fit with a detailed eight - fold symmetric model with discrete corners . h , Model selection . Based on the corrected version of Akaike information criterion ( AIC C ) reported by LocMoFit , the model that best describes the data can be selected . In the example , the arc model 𝑚 ( has a smaller AIC C than the bucket model 𝑚 & , reflecting that it is a better model for describing the example localizations . Results Localization Model Fit ( LocMoFit ) LocMoFit fits a geometric model 𝑓 ( 𝑝 ) to a set of 𝐾 localizations 𝑙 ! = { 𝑥⃗ ! , 𝜎⃗ ! } ( Fig . 1a - c ) in a region with a defined boundary that we call ‘site’ , which corresponds to one biological structure or ‘particle’ . 𝑙 ! are obtained by fitting camera images with a model of the point spread function and are described by their coordinates 𝑥⃗ = { 𝑥 , 𝑦 , 𝑧 } , the uncertainties of the coordinates 𝜎⃗ = 1𝜎 " , 𝜎 # , 𝜎 $ 2 for 3D data and 𝑥⃗ = { 𝑥 , 𝑦 } and 𝜎⃗ = 1𝜎 " , 𝜎 # 2 for 2D data . We demonstrate the workflow using an arc site generated using the simulation functionality of LocMoFit ( Fig . 1d ) . 𝑓 ( 𝑝 ) describes the spatial distribution of the imaged fluorophores and is parameterized by the set of parameters 𝑝 . Our approach is to use maximum likelihood estimation ( MLE ) to find the set of parameters 𝑝̂ that , together with 𝑓 ( 𝑝 ) , best describes the measured 𝑙 ! ( Fig . 1c ) . For this , we first use 𝑓 ( 𝑝 ) to calculate the probability density function ( PDF ) 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) that describes the probability that , if we acquire a single localization 𝑙 with the uncertainty 𝜎⃗ at random , it is found at the coordinate 𝑥⃗ . The likelihood to obtain the set 𝑙 ! of 𝐾 localizations in a measurement is then given by the product of individual probabilities : 4 𝐿 ( 𝑝 ) = ∏ 𝑀 ( 𝑥⃗ ! , 𝜎⃗ ! | 𝑝 ) ! . ( 1 ) We then use an optimization algorithm to find the parameters 𝑝̂ that maximize 𝐿 ( 𝑝 ) : [ 𝐿9 , 𝑝̂ ] = argmax % 𝐿 ( 𝑝 ) . ( 2 ) 𝐿9 denotes the estimate of the maximum likelihood . For efficiency and to prevent a small joint probability from being rounded to zero , the natural logarithm of the likelihood , the log - likelihood 𝐿𝐿 ( 𝑝 ) , is usually used in practice ( see Fig . 1c ) . The PDF 𝑀 is constructed from the geometric model 𝑓 ( 𝑝 ) . 𝑓 ( 𝑝 ) is defined either in a continuous or a discrete form , or supplied as an image ( Fig . 1e ) . A continuous 𝑓 ( 𝑝 ) describes the shapes formed by the fluorophores such as one - dimensional lines ( e . g . filaments or rings ) or two - dimensional surfaces ( spheres , patches ) , while a discrete 𝑓 ( 𝑝 ) describes the exact fluorophore positions . In the simplest case , 𝑓 ( 𝑥⃗ , 𝑝 ) directly describes whether a fluorophore can be found at the position 𝑥⃗ . Due to a limited localization precision 𝜎⃗ , the position of the localization coordinate is not equal to the true position of the fluorophore , but is instead randomly displaced by 𝜎⃗ . This localization uncertainty is used when constructing the PDF by convolving 𝑓 ( 𝑥⃗ , 𝑝 ) with a Gaussian function with standard deviations given by the mean of the localization precision 〈 𝜎⃗ 〉 ( ⨂ denotes the convolution ) : 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) = D & ( " ⃗ , % ) ∭ & ( " ⃗ , % ) , " , # , $ E ⨂𝐺 ( 𝑥⃗ , 〈𝜎⃗〉 ) . ( 3 ) Alternatively , LocMoFit can take into account that each localization has its specific lateral and axial localization uncertainties . In this scenario , the model 𝑣⃗ - = 𝑓 ( 𝑝 ) directly specifies the expected coordinates 𝑣⃗ - of the in total 𝐽 fluorophore positions in the model . The likelihood that the localization 𝑥⃗ ! stems from the fluorophore 𝑣⃗ - is described by a Gaussian function and depends on the distance between 𝑥⃗ ! and 𝑣⃗ - and the localization precision 𝜎⃗ ! . To construct the model 𝑀 for this single localization , we sum over all model localizations 𝑗 : 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) = 1 𝐽 K ( 2𝜋 ) . / 0 det ( 𝚺 ) . 10 exp S− 1 2 U𝑥⃗ − 𝑣⃗ - V 2 𝚺 . 1 U𝑥⃗ − 𝑣⃗ - VW 3 - 41 . ( 4 ) The parameters 𝑝 consist of intrinsic parameters 𝑝 5 that directly determine the shape of the model and extrinsic parameters 𝑝 6 that describe the rigid transformation and rescaling of the model . 𝑝 6 = 1𝑥⃗ 7 , 𝛼⃗ , 𝑆 , ZZ⃗ 𝑤 8 , 𝜖 2 includes the position of the model 𝑥⃗ 7 , the orientation , described by the rotation angles 𝛼⃗ around the coordinate axes , an optional global scaling factor 𝑆⃗ , and the proportional weight 𝑤 8 of a constant background PDF 𝑀 89 that accommodates the localizations that cannot be described by the geometric PDF . An optional additional uncertainty 𝜖 accommodates an uncertainty that cannot be described by the localization precision , such as a linkage error of the fluorophore ( e . g . , due to immunolabeling with primary and secondary antibodies ) , small - scale deformations of the structure that are not described by the model or residual instabilities of the microscope . 𝚺 = diagU𝜎 " 0 , 𝜎 # 0 , 𝜎 $ 0 V is the diagonal matrix of the square of the localization uncertainties and det ( 𝚺 ) is the determinant of the matrix 𝚺 . When 𝑝 6 is fitted during the MLE , the expected coordinates 𝑣⃗ - are replaced by 𝑅𝑣⃗ - + 𝑥⃗ 7 , the uncertainty 𝜎⃗ ! by ‘𝜎⃗ ! 0 + 𝜖 0 , and the geometric PDF 𝑀 ( 𝑥⃗ ! , 𝜎⃗ ! | 𝑝 ) by ( 1 − 𝑤 8 ) 𝑀 ( 𝑥⃗ ! , 𝜎⃗ ! | 𝑝 ) + 𝑤 8 𝑀 89 . From the optimization , we obtain the parameter estimates 𝑝̂ along with the 95 % confidence intervals of each fit parameter . 5 To describe a more complex geometry , a composite model ( magenta only in Fig . 1f ) PDF 𝑀 : can be formed by a linear combination of sub models 𝑀 ; that share the same background : 𝑀 8 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) = K 𝑤 ; 𝑀 ; ( 𝑥⃗ , 𝜎⃗ | 𝑝 ; ) ; + 𝑤 89 𝑀 89 , ( 5 ) where the sum of weights ∑ 𝑤 ; ; + 𝑤 8 = 1 for normalization and 𝑝 = { 𝑝 ; , 𝑚 = 1 … 𝑁 } for in total N component models . When fitting a composite model to more than one color at a time ( e . g . both colors in Fig . 1e ) , the model PDF can be constructed as 𝑀 ; : ( 𝑥⃗ ! : , 𝜎⃗ ! : | 𝑝 ; : ) = K 𝑀 : ( 𝑥⃗ ! : , 𝜎⃗ ! : | 𝑝 : ) < ) : . ( 6 ) Here , each localization is not only described by its coordinate and localization precision , but also its color 𝑐 . Note that each single - color PDF 𝑀 : ( 𝑥⃗ ! : , 𝜎⃗ ! : | 𝑝 : ) is evaluated only with the localizations of the corresponding color . 𝑤 : is the weight for each color and is by default set to 1 and therefore not active . If the colors have very different numbers of localizations , the fit can be dominated by one color . In this case , one can set 𝑤 : = ∑ 𝐾 : : / 𝐾 : , the inverse of the fraction of localizations with the respective color , to scale to the number of multiplications in Equation ( 1 ) and thus give each color the same weight in the fit . Equation ( 6 ) is the general form of the model PDF , which can describe a vast class of biological structures . To prevent the optimization from getting stuck in a local maximum of the likelihood , LocMoFit allows the user to chain several fitting steps with different models ( usually in the order from smooth to detailed ) , passing on the parameter estimates from the previous step to the next one as the initial parameters ( Fig . 1g ) . Since the likelihood itself is a measure of the goodness of fit , the model that best describes the data can be identified by comparing the log - likelihood , or more precisely the Akaike information criterion 22 , of different models fitted to the same data ( Fig . 1h ) . The probabilistic likelihood 𝐿 ( 𝑝 ) used in LocMoFit is related to cross - correlation used in other studies for measuring similarity between sites 23 , 24 . Indeed , we can obtain the cross - correlation cost function by replacing the multiplication of 𝐿 ( 𝑝 ) ( see equation ( 1 ) ) with a summation : 𝐿 : : ( 𝑝 ) = K 𝑀 ( 𝑥⃗ ! , 𝜎⃗ ! | 𝑝 ) . ! ( 7 ) This cost function corresponds to a general cross - correlation cost function 23 , 24 under the assumption of a constant localization uncertainty for the template . Also , it is closely related to the Bhattacharya cost function that was previously used for particle fusion in SMLM 18 , 19 . Simulation and validation To test the robustness of specific model fitting pipelines , we included a comprehensive simulation engine in LocMoFit ( Fig . 1d ) , as an extension of the engine applied in our previous work 17 . This engine uses a realistic description of fluorophore blinking ( see Methods ) to generate synthetic localization data from any model . Fitting these synthetic structures allows comparing the fitted model parameters to the ground truth . We usually validate a fitting pipeline with simulations before applying it to experimental data . We systematically investigated on the example of the nuclear pore complex ( NPC ) how the precision and accuracy of the fit parameters depends on localization precision , background localizations , labeling efficiency and number of localizations per fluorophore ( re - blinks ) ( see Extended Data Figure 1 and Extended Data Figure 2 and Methods ) . 6 As Nup96 has been assigned into EM - densities 25 , we know that it distributes in two rings , exhibits an 8 - fold rotational symmetry in the NPC and that each symmetric unit is occupied by two copies per ring . Based on this prior knowledge , we constructed our detailed model of the NPC ( Extended Data Figure 1a ) . We simulated localization data of NPCs with pre - defined parameters , the ‘ground truth’ , as shown in Supplementary Table 1 . We acquired the parameter estimates by fitting the simulated data with the model and computed the errors of the estimates . As shown in Extended Data Figure 2 , the errors in the estimated parameters ( e . g . , position , rotation , ring radius or distance ) are close to zero with small spreads , showing that the fitting is unbiased and reliable for a large range of experimental conditions . Too low labeling efficiencies , however , resulted in a bias of the average ring separation to smaller distances ( Extended Data Figure 2a ) . The reason is that under these labeling efficiencies a subset of the NPCs has one ring entirely unlabeled , and the remaining ring is well fitted by the two - ring model with a small separation parameter ( Extended Data Figure 3 ) . This highlights the importance of simulations for identifying potential factors to be considered when interpreting results . As expected , the precision in the parameter estimates was the highest for brightest fluorophores , and lowest backgrounds . The remaining fitting parameters showed negligible systematic errors . Extracting structural parameters from individual sites LocMoFit allows determining specific and meaningful structural parameters from individual sites without any averaging , which can be used to gain structural insights into multi - protein assemblies and to investigate biological heterogeneity . Here , we demonstrate the power and flexibility of LocMoFit on two biological structures that have been used extensively as test structures in SMLM , the nuclear pore complex ( NPC ) and microtubules . We imaged the protein Nup96 tagged with SNAP - tag in the NPC in a genome edited cell line 17 , 26 and obtained hundreds of NPC structures per field of view ( Fig . 2a - f ) . In 3D reconstructions , Nup96 appeared as two parallel rings ( Fig . 2a , b ) . We thus fitted the NPC with a two - ring model to extract the approximate positions and orientations of each site as initial parameters for a more detailed model fit . We fitted each nuclear pore with the NPC model ( as shown in Fig . 2c , the same as Extended Data Figure 1a ) to extract structural parameters of NPCs : the radius 𝑟 of the rings , the separation 𝑠 between the rings and the azimuthal ‘twist’ angle 𝜃 between the rings . For the mean values ± standard deviations we found 𝑟 = 53 . 4 ± 2 . 3 nm and 𝜃 = 8 . 8 ± 9 . 0° , in line with previously reported values 17 . As depth - dependent aberrations lead to a scaling in z depending on the position 𝑧 7 of the NPC above the coverslip 27 , we used the measured 𝑠 to directly calibrate and correct for this distortion ( see Methods and Extended Data Figure 4 ) . To investigate if the variation of the parameters is technical or due to biological heterogeneities , we compared our results to simulations ( Extended Data Figure 5 ) and indeed found a larger spread of the experimental parameters ( Fig . 2d - f , green compared to gray ) , hinting to sources of variations that we did not consider in the model , possibly biological heterogeneity . These results demonstrate that LocMoFit allows investigating the distribution of parameters for heterogenous structures . Next , we demonstrated analysis of extended structures with LocMoFit on the example of immunolabeled microtubules ( Fig . 2g - j , original data from Speiser et al . 28 ) . The apparent diameter of the ring is of interest , because it directly informs on the linkage error induced by the primary and secondary antibodies 29 in indirect immunolabeling . As microtubules are generally curved , in the past the radius was usually measured only on short segments ( less than 500 nm long ) using a geometric fit to the cross - sectional profile 13 , 29 , risking a bias from low 7 labeling densities and residual curvature . In LocMoFit , we implemented a fitting model that describes a curved tube ( Fig . 2i ) and thus can trace extended ( micrometer - long ) curved microtubule segments ( Fig . 2h ) . We measured the apparent radius 𝑟 of the immunolabeled microtubules as 24 . 1 ± 3 . 4 nm , 11 . 6 nm larger than the true mean outer radius ( 12 . 5 nm ) of microtubules themselves , and similar to the reported mean radius of the shell of fluorophores in indirectly immunolabeled microtubles 29 . Figure 2 . Quantifying structures at single sites . a - f , Quantification of NPCs . a , Representative image of the Nup96 - labeled NPCs ( Nup96 - SNAP - AF647 ) in a 3D dataset ( top view ) . b , single NPCs ( localizations in orange ) as indicated in a are fitted with the eight - fold symmetric model ( cyan ) shown in ( c ) . The model is parameterized by the listed parameters ( blue ) . d - e , Histograms of three fitted parameters : radius r = 53 . 4 ± 2 . 3 nm ( d ) , separation s = 50 . 2 ± 5 . 8 nm ( e ) , and twist θ = 8 . 8 ± 9 . 0° ( f ) . ‘Sim’ stands for simulation ( gray ) . Sample size : n s = 3 , 524 , n c = 5 . g - j , Quantification of microtubules . g , Representative image of immunolabeled microtubules in a 3D dataset ( top view ) . h , One microtubule segment ( red ) as indicated in g is fitted by the linear - tube model ( i ) . The fitted model is indicated in cyan . i , The linear - tube model parameterized by the listed parameters ( blue ) , the control points 𝑐 * define a cubic spline . j , Histogram of the fitted radius r = 24 . 1 ± 3 . 4 nm , based on segments of 1 µm length . Sample size n s = 161 , n c = 1 . Shown values are mean ± s . d . , based on n s sites in total n c cells . Scale bars , 1 μm ( a , g ) , 100 nm ( b , h ) . Model Selection Using a model that faithfully approximates the biological structure is key to performing a meaningful analysis in LocMoFit . We can use LocMoFit to select the best out of a class of models by comparing the corrected version of Akaike information criterion 22 ( AIC C ) after fitting . AIC C is a derivation from maximum likelihood , with a penalty for the number of free parameters 𝑃 and with a correction for sample size , here the number of localizations 𝐾 ( see Methods ) 22 : 𝐴𝐼𝐶 = = 𝐴𝐼𝐶 + ( 2𝑃 0 + 2𝑃 ) / ( 𝐾 − 𝑃 − 1 ) , where 𝐴𝐼𝐶 = 2𝑃 − 2 ln 𝐿9 . 𝐿9 is the maximum likelihood acquired by Equation ( 2 ) . For visualization , we additionally normalize the 𝐴𝐼𝐶 = by the number of localizations . In practice , we would like to choose a model with fewer parameters and yet a larger maximum likelihood . Therefore , the smallest AIC indicates the best model when fitting the same data . To validate this idea , we fitted different models to each NPC in the Nup96 dataset ( Fig . 2a , b ) . These models were rotationally symmetric with different symmetries ( from 6 - fold to 10 - fold , see insets in Fig . 3a ) . The 8 - fold symmetric model clearly shows the lowest AIC C overall , in line with the known symmetry of the NPC 25 . To further validate the model - selection functionality of LocMoFit , we used its simulation engine 8 to generate NPCs with different rotational symmetries . We demonstrate that the cumulative distributions allowed identifying the correct symmetry as a matching symmetry always had the lowest AIC C ( Extended Data Figure 6a ) . The differences in AIC C decreased with increasing similarity of the models , rendering the distinction of a 10 - fold symmetric model from a 9 - fold pore more challenging ( Extended Data Figure 6a ) . On the single - site level , a proper identification of the correct model is not always possible due to the relatively large variance of the AIC C ( Fig . 3b ) . Even in the simulations , a small but noticeable fraction of 8 - fold symmetric NPCs have a lower AIC C when fitted with a 6 - fold symmetric model than an 8 - fold symmetric model ( Extended Data Figure 6b ) . A different symmetry ( e . g . , the 6 - fold from the 8 - fold ) , if present , stands out only when it has a comparably large population , as shown by the simulations in Extended Data Figure 6c . Figure 3 . Model selection . a , Cumulative distribution of the normalized AIC C acquired by fitting the same experimental NPC dataset with models having different rotational symmetries . The AIC C was normalized by the number of localizations and assumes lower values for better fits . The ( correct ) 8 - fold symmetric model corresponds to the lowest normalized AIC C . b , Scatter plot showing AIC C of fitting the same sites with models having 6 - fold and 8 - fold rotational symmetries . The gray diagonal line indicates equal AIC C . Sample size : n s = 3 , 524 , n c = 5 . Static and dynamic protein density maps Multi - color microscopy is widely used for studying multi - protein assemblies 6 , 20 , 30 , 31 . However , especially in SMLM , the number of simultaneous labels in the same sample is still a bottleneck because of spectral overlap and different optimal imaging conditions for different fluorophores , limiting routine multi - color SMLM to two or three colors . Also , interpretation of hundreds of individual sites is challenging . Here we show how to bypass this limit using LocMoFit by reconstructing average density maps of multi - protein assemblies from pairs of dual - color data ( Fig . 4a - d ) . In this strategy , we use one protein as a ‘reference structure’ that is always imaged together with a second ‘target’ protein , labeled in a different color . By fitting a model to the reference structure , we can determine the precise location and orientation of each site and thus register all sites from individual data sets , but also from data sets for different target proteins . Here we showcase this approach on the example of the NPC using endogenously tagged Nup96 as the reference structure ( Fig . 4a - d ) . As target proteins we chose immunolabelled Elys , Nup133 , Nup62 , Nup153 , and the NPC channel , stained by wheat germ agglutinin ( WGA ) . From a fit of the NPC model ( Fig . 2c ) to the Nup96 localizations in all data sets and sites we could calculate average distributions of all target proteins ( Fig . 4c ) from single sites ( Fig . 4a , b ) and integrate all target proteins into a single coordinate system as an average protein density map ( Fig . 4d ) . Note that this approach greatly increases the effective labeling efficiency of the target protein and can produce high - contrast averages even for very poor labeling ( compare Fig . 4b to the average ) , and thus can reveal structural details not apparent in single images . 9 Figure 4 . Static and dynamic protein density maps . a - d , Average density map of the nuclear pore complex . a - b , representative images of individual sites showing Nup96 - SNAP - AF647 and immunolabeled Elys - CF680 ( a ) or Nup133 - CF680 ( b ) . c , A model fit to the reference protein Nup96 allows registering all sites of one data set and integrating different dual - color data sets into one common coordinate system ( d ) . NR and CR denotes nucleoplasmic and cytoplasmic rings , respectively . See Supplementary Movie 1 . Sample size : Elys : 𝑛 + = 704 ; Nup133 : 𝑛 + = 704 ; Nup62 : 𝑛 + = 605 ; Nup153 : 𝑛 + = 419 ; WGA : 𝑛 + = 488 . 𝑛 , = 1 for all . e - i , Dual - color dynamic reconstruction of endocytosis in yeast . e , Overview image of a single yeast cell showing Abp1 - mMaple and Las17 - SNAP - AF647 . f , Individual endocytic sites are fitted with a dual - color model ( h ) that reflects the expected distribution ( g ) of Abp1 and Las17 6 : We model Abp1 as a semi - ellipsoid and Las17 as a thick ring and project these geometries in 2D . The fitted axial length of Abp1 is used as a proxy for pseudotime to sort individual endocytic sites according to their progression along the endocytic time line . The fitted position and orientation are then used to average all sites in each time bin ( i ) . Bin size : 21 sites . Sample size : 𝑛 + = 130 , 𝑛 , = 51 . A running average can be found in Supplementary Movie 2 . Scale bars : 100 nm ( a - d , f , i ) , 500 μm ( e ) . 10 LocMoFit can also perform a dynamic reconstruction of multi - protein assemblies from static super - resolution snapshots . The idea is to use LocMoFit to extract features of the structure that can be used for pseudo - temporal sorting and to then average individual structures in each time bin . We illustrate this approach on the example of the machinery that drives clathrin - mediated endocytosis in yeast , which is known to show highly regular dynamics and composition 32 . From prior super - resolution 6 and electron - microscopy 33 studies we know that the actin nucleation promoting factor Las17 forms a ring at the plasma membrane and that the actin binding protein Abp1 decorates the dome - shaped actin network that elongates during endocytosis 32 . By fitting a model that reflects this geometry to dual - color 2D data ( Fig . 4e - h ) , obtained by focusing on the midplane of yeast cells , we use the length of the Abp1 structures to sort all sites according to their progression along the endocytic time line . We then distribute the structures in individual time bins and use the fitted position and orientation for averaging ( Fig . 4i , Supplementary Movie 2 ) to result in dynamic protein localization maps . Model - free averaging Model - free averaging or particle fusion is an approach that fuses particles , or sites , that share the same underlying structure together to form an average that approximates the underlying structure . Particles can be aligned based on templates / models , which however can lead to a so - called ‘template bias’ : The final average can be biased towards the template , and even wrongfully reveal structures present in the template that are not present in the particles . Therefore , we would caution against interpreting the distribution of the reference Nup96 in Fig . 4 . As the alignment of the other proteins was solely calculated based on this reference structure , they do not display template bias . Model - free particle fusion on the other hand allows calculation of unbiased average protein distribution maps and has been implemented based on alignment of particles using pair - wise cross - correlations 18 , 19 , 23 . In LocMoFit we can use individual particles as models for other particles to determine their relative position and orientation and use those in an iterative workflow for model - free particle fusion ( Fig . 5 ) . Here , we illustrate this based on Nup96 in the NPC . As the log - likelihood is a measure for the similarity , we can efficiently construct the initial template : From an all - against - all pairwise registration of a subset of particles we can identify the particle that shows the highest degree of similarity to all other particles as a seed ( Fig . 5b ) . We then cumulatively fuse the other sites in the order of their total similarity ( Fig . 5c ) . This initial template is then used to register the remaining particles in the data set . The resulting average can then be used for the next round of registration ( Fig . 5d ) . This step is iterated until convergence of the optimization ( Fig . 5f ) . The resulting 3D average of Nup96 clearly resolves the two rings in the NPC and their 8 - fold symmetry ( Fig . 5g ) . In addition , it reveals subtle structural details such as the elongated , tilted shape of the corners ( Fig . 5h ) that directly reflects that in each ring each symmetric unit is occupied by two Nup96 copies with slightly different radii ( Fig . 5g ) . In summary , LocMoFit allows for bias - free high - quality 3D averaging without any assumptions on the underlying geometry and symmetry . 11 Figure 5 . Model - free particle averaging . a - e , Workflow . a , Example single NPC particles . We assumed that all the sites are samples of the same underlying distribution . b , We first find a site ( in the example the site iv ) that best describes all other sites based on the rank on sum log - likelihood ( LL ) of the all - to - all matrix , where the 50 subset sites were fitted to each other . c , The initial template is built based on sequential registration in the order of the sum LL rank . d , The final fused particle is used to register all sites in the 318 - site data set . This procedure yields an updated fused particle , which is used to register the data set again . This process is iterated until convergence . f - h , The final average calculated from 318 particles without any assumption on the underlying geometry or symmetry in a tilted view ( f ) , and for comparison the EM density of the NPC with C - termini of Nup96 indicated in red . ( g ) , Top and side view , where the nucleoplasmic and cytoplasmic rings are shown together ( left panel ) , or separately ( middle , right panels ) ( h ) . See Supplementary Movie 3 . The two proteins per ring per symmetric unit give rise to tilted elongated average protein distributions in the averages ( arrows in h ) . Scale bars : 50 nm . Discussion In this study , we present LocMoFit , a powerful and general framework for extracting quantitative descriptors of cellular structures by fitting an arbitrary , parameterized model to SMLM data . As the fitting is performed on individual structures without averaging , this will help investigating biological heterogeneities among structures that are currently difficult to quantify with electron microscopy , where typically many identical structures need to be averaged to reach sufficient signal - to - noise ratios . LocMoFit relies on choosing a model that can represent the data . A wrong model will still result in the most likely parameters that explain the experiment , but these parameters then might become difficult to interpret or meaningless . So how can we construct a model for a biological structure ? Usually , a simple geometry or symmetry can be guessed by visual inspection of the data , from prior knowledge based on other techniques , or by model - free particle averaging , as also implemented in LocMoFit . It is then key to define the parameters in a way that the model is as general as possible and can describe a large class of experimental structures . For instance , all the models used in this study are not rigid templates , but can change their size and shape during optimization . In case of competing models , the more likely model can be chosen based on its lower AIC C ( Fig . 3 ) , taking the sample size and the number of free parameters into account 22 . Of equal importance to selecting the right model is the quality of the data , which must contain sufficient information to unambiguously define the multiple model parameters . In case of low labeling densities , large localization errors or structures with few features , simple models with few free parameters have a lower risk for overfitting than complex models . Even a well - chosen model might not converge to the global optimum . In these cases , choosing proper initial parameters in a first fitting step with a simpler model or even manually can provide a good 12 solution , as choosing an optimizer in LocMoFit that performs a parameter search over defined intervals instead of gradient descent . LocMoFit is equipped with tools for facilitating the reliability of data analysis . One of the tools is visualization , which allows users to inspect , as we always recommend , the results of the fit efficiently . Furthermore , the reliability is hard to examine without knowing the ground truth of the data 34 , 35 . In line with this , LocMoFit provides a simulation engine that generates SMLM coordinate data with a given model and known parameters and allows investigating the precision of the parameter estimates , the suitability of a model to fit data of a specified quality and the impact of initial parameters on convergence . Integrating large datasets into an average representation in the form of protein localization maps can be a useful and complementary approach to a statistical analysis of parameters extracted from individual sites . LocMoFit can calculate such average representations by determining the precise position and orientation of a reference structure and use this to align target proteins , imaged in a second channel . By additionally evaluating a parameter that changes monotonously over time , LocMoFit can extend this approach to dynamic , time - resolved localization maps . However , whenever templates or models are used for registration , the averages might be biased towards the model 36 . Thus , care should be taken when interpreting the averages of the reference structures . Target structures that were not considered during the alignment , on the other hand , should be free of such model bias . This model bias can be avoided largely when using template - free particle averaging ( Fig . 5 ) . This approach is commonly used in electron microscopy and has been introduced to SMLM data recently 23 , 18 , 19 , with or without an adaption . The adaption was implemented because of the different data types between SMLM ( sparse and coordinate - based ) and EM ( dense and intensity - based ) 18 . LocMoFit too performs particle fusion directly on the coordinates and takes into account the localization precisions . Our new approach of selecting the most representative particles to construct the initial template minimizes the bias of seed selection , while avoiding a computationally expensive all - to - all registration . When we construct average protein density maps or template - free particle averages , we need to assume that all particles are based on the same underlying structure . However , biological variability is expected in most experiments . In this case , the resulting distributions are averages over the different conformations and can be biased towards a sub - population . In the future , a combination of averaging with classification 24 , as we demonstrated when we reconstructed the dynamic protein maps of endocytosis ( Fig . 4i ) , could extend particle averaging to heterogenous and dynamic cellular structures . In the current framework , more than one fluorophore per target molecule and repeated activation of a single fluorophore are not considered during fitting , but we investigated their impact with simulations . A future extension to a probabilistic model of fluorophore blinking and non - stoichiometric labeling , possibly using a Bayesian framework 37 , would further improve robustness and accuracy . Currently , a fit to a single site takes seconds to minutes ( 5 - 10 seconds for an NPC and CME site , 10 - 20 minutes for a micrometer - long microtubule , depending on the complexity of a model and the number of localizations of a site ) , allowing even large data sets with hundreds of sites to be analyzed in overnight runs on a standard CPU ( e . g . , Intel core i5 - 4460 ) . In the future , deploying LocMoFit on clusters or GPUs could further improve performance . Published as open - source , LocMoFit is readily useable as part of the SMLM software platform SMAP 21 , allowing users to easily fit their own data with any of the numerous pre - defined models using a graphical user interface . To this end , we provide detailed documentation , tutorials , and example files . Alternatively , LocMoFit can be run independently of SMAP and 13 provides an API for integration in own software . All models used in this study are ready - to - use and available to the public domain and can be combined into complex composite models . New models can be created with basic programming expertise . We encourage users to deposit their own models to our Git repository to facilitate knowledge sharing . LocMoFit will enable many researchers to greatly increase the information that can be extracted from their data and to develop new and complex data analysis workflows that drive biological discovery . Methods LocMoFit framework Model fitting in LocMoFit LocMoFit fits a parameterized geometric model to a set of localizations from the same site through Maximum Likelihood Estimation ( MLE ) . LocMoFit requires two inputs : 1 ) a parameterized geometric model 𝑓 ( 𝑝 ) that describes the distribution of the fluorophores in the structure with the set of parameters 𝑝 of the model , and 2 ) a set of 𝐾 localizations 𝑙 ! = { 𝑥⃗ ! , 𝜎⃗ ! } . 𝑥⃗ = { 𝑥 , 𝑦 , 𝑧 } are the coordinates of a detected emitter and 𝜎⃗ = 1𝜎 " , 𝜎 # , 𝜎 $ 2 the associated uncertainties . 𝑥⃗ ! and 𝜎⃗ ! are typically obtained by fitting an experimental or Gaussian point spread function model to the raw camera frames using maximum likelihood estimation 38 , 39 . To take into account localization uncertainties , we do not use 𝑓 ( 𝑝 ) directly for fitting , but instead a probability density function ( PDF ) 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) , which is derived from 𝑓 ( 𝑝 ) as described in the next section . 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) describes the probability of finding a single random localization 𝑙 at the coordinate 𝑥⃗ given an uncertainty 𝜎⃗ and model parameters 𝑝 . If we measure a set 𝑙 ! of 𝐾 localizations and assume that they are random and independent variables of the PDF 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) , the likelihood to obtain precisely these localizations 𝑙 ! is simply the product of individual probabilities as shown in equation ( 1 ) . To find the set of parameters 𝑝̂ that , together with 𝑀 ( 𝑝 ) and therefore 𝑓 ( 𝑝 ) , best describes 𝑙 ! , we maximize this likelihood using an optimization algorithm ( see section Optimization procedure ) as shown in equation ( 2 ) . Calculation of the probability density function Here we discuss how to calculate the PDF 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) from the geometric model 𝑓 ( 𝑝 ) . 𝑓 ( 𝑝 ) can be defined as either a fluorophore density map , discrete fluorophore coordinates or a continuous fluorophore distribution . In the first scenario when defined as a fluorophore density map , the geometric model 𝑑 = 𝑓 ( 𝑥⃗ , 𝑝 ) directly outputs the density 𝑑 of the fluorophore at the position 𝑥⃗ . Here 𝑓 ( 𝑥⃗ , 𝑝 ) is not necessarily normalized . If the localization uncertainty has been included in 𝑓 ( 𝑝 ) , its PDF 𝑀 ( 𝑥⃗ | 𝑝 ) can be derived by simple normalization : 𝑀 ( 𝑥⃗ | 𝑝 ) = & ( " ⃗ , % ) ∭ & ( " ⃗ , % ) , " , # , $ . ( 8 ) Otherwise , the uncertainty can be introduced by convolving 𝑓 ( 𝑥⃗ , 𝑝 ) with a Gaussian function with a standard deviation defined by the average localization uncertainty 〈𝜎⃗〉 as in equation ( 3 ) . In practice , the model 𝑓 ( 𝑝 ) can be supplied as an image for a 2D fit , an image stack for a 3D fit , or directly as a function . 14 In the second scenario when defined as discrete fluorophore coordinates , the geometric model 𝑓 ( 𝑝 ) specifies the expected coordinates 𝑣 - of the fluorophores so that 𝑣 - = 𝑓 ( 𝑝 ) . To derive the PDF for this case , let us consider a simple one - dimensional example , in which a fluorophore at position 𝑣 with a localization precision 𝜎 is repeatedly localized , resulting in measured coordinates 𝑥 ! . These measured coordinates then scatter around the true position with a standard deviation of 𝜎 , following a Gaussian distribution . Thus , the probability that the measured coordinate 𝑥 is caused by the fluorophore at position 𝑣 is 18 , 23 , 19 : 𝑀 ( 𝑥 , 𝜎 | 𝑣 ) = 1 √2𝜋𝜎 exp S− ( 𝑥 − 𝑣 ) 0 2𝜎 0 W . ( 9 ) If we have 𝐽 model fluorophore positions 𝑣⃗ - , the probability that they describe a single measured localization 𝑙 = { 𝑥⃗ , 𝜎⃗ } is given by the sum of the individual probabilities ( now for the 2D or 3D case ) as in equation ( 4 ) . The likelihood function 𝐿 ( 𝑝 ) is then calculated according to equation ( 1 ) by multiplying the probabilities of all measured localizations . Compared to the first case ( equation ( 3 ) ) , in which only the average localization precision is used to blur the model , here all localization precisions 𝜎⃗ ! contribute individually to the PDF so that more precise localizations have higher impact . As the stochastic nature of single - molecule imaging leads to a wide distribution of the localization precisions , this increases the accuracy by properly weighting the single localizations in the PDF . In the third scenario when defined as continuous fluorophore distributions , the geometric model 𝑣⃗ = 𝑓 ( 𝑢Z⃗ , 𝑝 ) describes a parametric line ( e . g . a filament or a ring ) or surface ( e . g . a spherical shell ) , in which fluorophores are distributed with constant density . The vector variable 𝑢Z⃗ has only one element when describing a parametric line and two when describing a surface . In practice , LocMoFit works with a discrete form 𝑓 , ( 𝑝 ) of the geometric function 𝑓 ( 𝑢Z⃗ , 𝑝 ) . To discretize 𝑓 ( 𝑢Z⃗ , 𝑝 ) , either LocMoFit renders J fluorophores 𝑣⃗ 3 on the line or surface based on J vectors 𝑢Z⃗ 3 across the range defined by the user and assigns every point a weight 𝑞 - inversely scaled to local density , having [ 𝑣 > ZZZ⃗ , 𝑞 - ] = 𝑓 , ( 𝑝 ) = 𝑓U𝑢 > ZZZ⃗ , 𝑝V , or the user defines J fluorophores 𝑣⃗ 3 evenly distributed on the line or surface defined by [ 𝑣 > ZZZ⃗ , 𝑞 - ] = 𝑓 ( 𝑝 ) , with 𝑞 - = 1 . In either case , the maximum spacing 𝛿 between adjacent points defined in 𝑣⃗ 3 is required to be smaller than the minimal localization precision of the K localizations to retain continuity : 𝛿 < 0 . 75 min ! ∈ { 1…B } 1𝜎 " ! , 𝜎 # ! , 𝜎 $ ! 2 . To improve the computational speed by reducing the size of the model , LocMoFit also allows the user to define a minimal localization precision 𝜎 ; 5D so that any 𝜎 " ! , 𝜎 # ! , and 𝜎 $ ! smaller than 𝜎 ; 5D are set to 𝜎 ; 5D . This setting increases the required spacing 𝛿 and reduces the required sampling rate ( associated with J ) and therefore the size of the model . With discrete positions of fluorophores 𝑣⃗ 3 , the convolution can be seen as placing Gaussian functions centered at all the positions in 𝑣⃗ 3 . By having 𝑣⃗ 3 , we can utilize equation ( 4 ) to construct the PDF with the introduction of 𝑞 - : 𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) = 1 ∑ 𝑞 - - K 𝑞 - ( 2𝜋 ) . / 0 det ( 𝚺 ) . 10 exp S− 1 2 U𝑥⃗ − 𝑣⃗ - V 2 𝚺 . 1 U𝑥⃗ − 𝑣⃗ - VW 3 - 41 . ( 10 ) Equation ( 4 ) is then a special form of equation ( 10 ) with 𝑞 - = 1 . In this study , we refer to a discrete model when it is constructed based on either equation ( 4 ) or equation ( 10 ) , and to a continuous model when it is constructed based on either equation ( 3 ) or equation ( 8 ) . 15 Optimization procedure To find the set of parameters 𝑝̂ that maximizes 𝐿 ( 𝑝 ) , the user can select either an evolutionary algorithm that searches parameters more globally , a simplex - based derivative - free searching , or a gradient - descent optimizer . Before optimization , the user can define which parameters to fit and which to set to a constant value , and their initial guesses and boundaries . The initial guesses can be either pre - defined values or values derived from user - defined rules . For fitting , we classify the parameters 𝑝 into intrinsic parameters 𝑝 5 that directly determine the shape of the model and extrinsic parameters 𝑝 6 = 1𝑥⃗ 7 , 𝛼⃗ , 𝑆 ZZZ⃗ , 𝜖 , 𝑤 89 2 that describe the position of the model 𝑥⃗ 7 , the orientation , described by the rotation angles 𝛼⃗ about the three axes , and optionally a global scaling factor 𝑆⃗ , an uncertainty 𝜖 additional to the localization precision , and the weight 𝑤 89 of a constant background PDF 𝑀 89 to accommodate the localizations that cannot be described by the geometric PDF ( see next section ) . Here the rotation angles 𝛼⃗ = { 𝛼 , 𝛽 , 𝛾 } about the x , y , and z axes , respectively , define the rotation matrix : 𝑹 = # cos 𝛽 cos 𝛾 − cos 𝛽 sin 𝛾 sin 𝛽 cos 𝛼 sin 𝛾 + cos 𝛾 sin 𝛼 sin 𝛽 cos 𝛼 cos 𝛾 − sin 𝛼 sin 𝛽 sin 𝛾 − cos 𝛽 sin 𝛼 sin 𝛼 sin 𝛾 − cos 𝛼 cos 𝛾 sin 𝛽 cos 𝛾 sin 𝛼 + cos 𝛼 sin 𝛽 sin 𝛾 cos 𝛼 cos 𝛽 . . ( 11 ) 𝑆⃗ = { 𝑠 " , 𝑠 " , 𝑠 $ } contains the scaling factors of the three spatial axes , defining the scaling matrix 𝑆 = diagU𝑆⃗V . For a model in the continuous form , we use the extrinsic parameters 𝑝 6 to reversely transform the localizations , which is computationally more efficient than to transform the model . Thus , during the optimization , we first transform the localization coordinates as 𝑥⃗ E = 𝑹 . 1 𝑺 . 1 ( 𝑥⃗ − 𝑥⃗ 7 ) . ( 12 ) For a discrete model we translate and rotate the model instead to avoid computationally costly rotation of the anisotropic multidimensional Gaussian ( equation ( 4 ) ) , particularly in 3D . In this case , the fluorophore positions of the model 𝑣⃗ are transformed during optimization as : 𝑣⃗ E = 𝑺 ( 𝑹𝑣⃗ + 𝑥⃗ 7 ) . ( 13 ) As a result of maximizing the likelihood with respect to 𝑝 5 and 𝑝 6 , we obtain the parameter estimates 𝑝̂ 5 and 𝑝̂ 6 along with their 95 % confidence intervals . Background localizations and additional uncertainties In real experiments , unspecific background fluorophores , localizations from neighboring structures or large localization errors lead to localizations that are not described by the model . This mismatch can introduce a bias in the parameter estimates . We accommodate these so - called ‘background’ localizations with an evenly distributed ( constant ) PDF 𝑀 89 : 𝑀 8 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ) = U1 − 𝑤 89 V𝑀 ( 𝑥⃗ , 𝜎⃗ | 𝑝 ; ) + 𝑤 89 𝑀 89 . ( 14 ) The set of parameters 𝑝 ; contains all elements of 𝑝 except for the background weight 𝑤 89 . 𝑀 89 = 𝑑 . F with 𝑑 the length of a site and 𝐷 is the dimension , so that the summed probability of 𝑀 89 over the site is one . 𝑤 89 is the background weight that represents the fraction of localizations that are considered background . The total number 𝐾 89 and density 𝜌 89 of background localizations can be obtained as 𝐾 89 = 𝐾 ∙ 𝑤 8 and 𝜌 89 = 𝐾 89 𝑑 0 ⁄ . The difference of the total number of localizations 𝐾 and 𝐾 89 is then the total number of localizations described by the model 𝐾 ; = 𝐾 − 𝐾 89 . The localization precision 𝜎 often underestimates the true spread of localizations in real experiments . The reason can be instabilities like thermal drifts or vibrations during the experiment , the size of the label that displaces the fluorophore from the target structure ( linkage error ) or biological variability that leads to a spread of the fluorophores that is not described in 16 the model . These additional uncertainties , quantified by the parameter 𝜖 , lead to an additional blurring ( equation ( 3 ) ) with 〈𝜎〉 0 → 〈𝜎〉 0 + 𝜖 0 . In equation ( 4 ) we take 𝜖 into account with a modified covariance matrix : 𝚺 = diagU𝜎 " 0 + 𝜖 0 , 𝜎 # 0 + 𝜖 0 , 𝜎 $ 0 + 𝜖 0 V . ( 15 ) 𝜖 can be specified by the user or used as an additional free fitting parameter . Composite models LocMoFit allows the user to combine several simple models into a single one by adding up and re - normalizing the PDFs of each model ( see equation ( 5 ) ) . The sum of weights is one : ∑ 𝑤 ; ; + 𝑤 89 = 1 . 𝑤 ; represents the proportion of the localizations that can be described by the component PDF 𝑀 ; . With the weights we can estimate the number of localizations 𝐾 ; coming from a specific component model 𝑀 ; by 𝐾 ; = 𝐾 ⋅ 𝑤 ; . Note that here we define the extrinsic parameters 𝑝 ; 6 ( except for the model weight 𝑤 ; ) of the m th component model ( 𝑚 > 1 ) with respect to the first component model , with a value zero indicating the same transformation as the first component model . That is , the rigid transformation of the first component model ( according to 𝑝 16 ) is first applied to all component models , followed by the rigid transformation of the m th component model ( according to 𝑝 ; 6 ) applied to only the m th component model . The user can select which parameters are fixed among the models and which are fitted independently . This greatly facilitates constructing complex models . When fitting multi - color SMLM data , each localization is not only described by its coordinate and localization precision , but also its color 𝑐 . In this case , we can define a separate model for each color channel and fit all models simultaneously , as shown in equation ( 6 ) . The weight for each color channel 𝑤 : is introduced to minimize the effects of different numbers of localizations between different colors and can be assigned as 𝑤 : = ∑ 𝐾 : : 𝐾 : ⁄ , where 𝐾 : is the number of localizations with the color 𝑐 . 𝑤 : is used as an exponent to normalize the different multiplications , which scales to the number of localizations , in Equation ( 1 ) . When the effects of different numbers of localizations are preferred , weighting can be switched off by setting 𝑤 : = 1 . Note that each single - color PDF 𝑀 : ( 𝑥⃗ ! : , 𝜎⃗ ! : | 𝑝 : ) ( with the background PDF 𝑀 89 : , as described by equation ( 5 ) for an individual model or equation ( 6 ) for a composite model ) is evaluated only with the localizations of the corresponding color . Chaining fitting steps for improved convergence For complex models with many fitting parameters , optimizers are limited in scanning the entire parameter space to find a global optimum and might get stuck in a local maximum of the likelihood . Thus , LocMoFit allows the user to chain several fitting steps with different models and use the results of the previous step as the initial parameter for the next one . Note that the first step can employ user - defined rules / functions to provide initial parameter estimates . Then , the user can use a less complex model with strong blur ( equation ( 15 ) ) , using a global optimizer before fine - tuning the fit with a simplex or gradient - descend optimizer on the precise model . In this way , LocMoFit efficiently finds the global maximum of the cost function 𝐿 ( 𝑝 ) . The relation between likelihood and cross - correlation The likelihood 𝐿 ( 𝑝 ) can be seen as a metric that describes the similarity between model 𝑓 ( 𝑝 ) and data 𝑙 ! from the probabilistic aspect . By changing the multiplication in equation ( 1 ) to summation , we get another metric that is regularly used for pattern matching and represents the cross - correlation between model and data : 17 𝐿 : : ( 𝑝 ) = K 𝑀 ( 𝑥⃗ ! , 𝜎⃗ ! | 𝑝 ) . ! ( 16 ) When using a model 𝑓 ( 𝑝 ) in the discrete form , by plugging its PDF ( as in equation ( 4 ) ) into equation ( 16 ) , we get a similar form as the correlation between two sets of points derived in Schnitzbauer et al . 23 , with the exception that we do not assign uncertainties to fluorophore coordinates in the model . Also , it is closely related to the Bhattacharya cost function and derivations that were previously used for particle fusion 18 , 19 and detecting structural heterogeneity 24 in SMLM . Therefore , the cross - correlation 𝐿 : : ( 𝑝 ) can also be used as the objective function in LocMoFit . Data analysis Model fitting Model fitting requires segmented sites ( see the section Segmentation of sites ) . Nup96 : We used three models to describe Nup96 in different fitting steps . The first model , 𝑁𝑃𝐶 ; 1 , is a composite model of two identical rings , with a radius 𝑟 of 53 . 7 nm , shifted along their common axis . The extrinsic parameters of the upper ring were fixed to those of the lower ring , except for the z position . This model was implemented as a fluorophore density map . The second model , 𝑁𝑃𝐶 ; 0 , is a dual - ring model that has two identical parallel rings , parameterized by intrinsic parameters ring radius 𝑟 and ring separation s . This model was implemented as a discretized continuous fluorophore distribution . The third model , 𝑁𝑃𝐶 ; / , was built using the 𝑁𝑃𝐶 ; 0 as a backbone , having the continuous rings replaced by fluorophore positions ( Fig . 2c ) . Two of the fluorophores form a unit , which is evenly placed eight times on one ring rotationally and yield 32 positions in total . Since the rings are not continuous anymore , the twist 𝜃 between the two rings is also an intrinsic parameter in addition to the two parameters inherited from the second model . For single - color NPC data ( Fig . 2a - f ) , we chained these three fitting steps : 1 ) fitting with 𝑁𝑃𝐶 ; 1 to roughly measure the orientations , positions , and ring separations of the NPCs , 2 ) fitting with 𝑁𝑃𝐶 ; 0 to refine the previously measured parameters and to measure radii , and 3 ) fitting with the 𝑁𝑃𝐶 ; / to measure the ring twist , with the extra uncertainty 𝜖 a free parameter to allow exploring parameter space more during optimization . The initial parameters of a later step were inherited from the final parameters of the previous step . All parameter settings are summarized in Supplementary Table 3 . For dual - color NPC data ( Fig . 4a - d ) , Nup96 was fitted in two chained steps : 1 ) fitting with 𝑁𝑃𝐶 ; 1 as for the single - color data , and 2 ) fitting with 𝑁𝑃𝐶 ; / , having intrinsic parameters fixed to the mean parameter values that were extracted from the single - color data ( Fig . 2d - f ) . All parameter settings are summarized in Supplementary Table 5 . For the model selection , the fitting steps were the same as for single - color NPC data except that different rotational symmetries were used as specified . Microtubules : We used two models to describe microtubules . The first model , 𝑀𝑇 ; 1 , describes a cubic spline in 3D . In this model , the spline is defined as piece - wise third - order polynomials that traverse through a set of odd number 𝑁 of equidistant control points , in the order 𝑞 = 1 to N . The middle point ( 𝑞 = 𝑞 7 = ( 𝑁 + 1 ) / 2 ) is defend as the reference position 𝑥⃗ mid = { 𝑥 mid , 𝑦 mid , 𝑧 mid } . Starting from the middle point , the rest of control points are defined in two directions , one from 𝑞 = 𝑞 7 − 1 to 1 and the other from 𝑞 = 𝑞 7 + 1 to 𝑁 . Following these orders , the position of one control point ( 𝑞 = 𝑞 D ) is defined by its distance 𝑑 from the previous control point and the azimuth 𝜃 J and elevation angle 𝜑 J , defined relative to the 18 previous control point . The second model , 𝑀𝑇 ; 0 , uses the first model as a backbone , rendering rings , centered at equidistant points on the backbone spline , perpendicular to the backbone ( Fig . 2i ) . Thus , the radius 𝑟 of the rings is an intrinsic parameter in addition to the ones inherited from the first model . Both models were implemented as discretized continuous fluorophore distributions . In this study , we used the number of control points 𝑁 = 5 and the distance between points 𝑑 = 250 nm . Microtubules ( Fig . 2g - j ) were fitted with two chained steps : 1 ) fitting with 𝑀𝑇 ; 1 , having a large extra uncertainty 𝜖 to estimate the center line of microtubule segments , and 2 ) fitting with 𝑀𝑇 ; 0 to refine the path of the microtubules and to measure the radius . The initial parameters of the second step were inherited from the final parameters of the first step . All parameter settings are summarized in Supplementary Table 4 . Endocytic structures : For fitting endocytic sites , we used a composite model formed by a two element model : projections of a 3D hemispheroid and a thick ring onto the 2D imaging plane ( Fig . 4g ) . This model was implemented as a discretized continuous fluorophore distribution . In the imaging plane , the base of the hemispherical projection is limited to below the thick - ring projection . The hemispherical projection is parameterized by the half long and half short axes 𝑎 and 𝑏 of a hemispheroid . The thick - ring projection is parameterized by the thickness 𝑡 and the inner / outer radii 𝑟 and 𝑞 of the ring . This model was fitted to the yeast endocytic sites in the dual - color dataset ( Fig . 4e - i ) . The hemispheroid was only fitted to Abp1 localizations and the thick ring to Las17 localizations , respectively . All parameters are summarized in Supplementary Table 6 . Simulation We performed realistic simulations based on a two - state ( bright and dark ) fluorophore model plus bleaching 40 . ( 1 ) First , we defined model parameters , which can be fixed numbers or uniformly distributed random variables within specified boundaries . ( 2 ) With the defined model parameters , we generated protein positions for each simulated site by taking all the N positions ( e . g , 32 positions for the eight - fold symmetric model of the NPC ) of proteins defined in a point model or randomly drawn N samples from a specified PDF with no uncertainty . ( 3 ) With a probability 𝑝 label , a fluorescence label was created at a protein position . ( 4 ) Linkage displacements in x , y and z were added to a label and were determined as normally distributed random variables with a variance corresponding to the linkage error 𝜖 . ( 5 ) Each fluorophore appeared at a random time and lived for a time 𝑡 O , determined as a random variable from an exponential distribution . ( 6 ) A label had a probability 𝑝 react to be reactivated and then appeared at a random later time point , otherwise it was bleached . ( 7 ) When it was on , a fluorophore had a constant brightness . Thus , the brightness in each frame was proportional to the fraction of the time the fluorophore was on in each frame . ( 8 ) The emitted photons in each frame were determined as a random Poisson variable with a mean corresponding to the average brightness in the frame . ( 9 ) For each frame , we calculated the CRLB ( Cramér - Rao lower bound ) in x , y and z from the number of photons and the background photons 41 . ( 10 ) This error was added to the true x , y and z positions of the fluorophores as normally distributed random values with a variance corresponding to the respective calculated CRLB . Simulation parameters are summarized in Supplementary Table 1 . The simulated localizations were processed with the same data analysis pipeline as the real data . 19 Reference - based averaging of multi - color data To create the average density map of the nuclear pore complex , in each site only Nup96 localizations were fitted as described in the section Model fitting in LocMoFit , Nup96 . Each site was transformed to the orientation and position of the model so that all the sites were in the same coordinate system . The transformed localizations of all sites then formed the averages . For the dynamic reconstruction of CME in yeast , all sites were sorted by the fitted length of the hemi - ellipsoid describing Abp1 localizations . The orientation of each site was aligned to the direction of the membrane invagination and the estimated position of the Las17 ring model defined the origin . Each time bin was then created from the localizations of 21 aligned sites . The movie of the dynamic reconstruction ( Supplementary Movie 3 ) was generated by running averaging through the aligned sites over the pseudotime : each frame comprised 15 sites and the step size was one site . A technical limitation of this example is the use of indirect immunolabeling . Here , varying epitope accessibility and non - random orientation of the antibodies can result in systematic differences between protein density maps and true distributions of the proteins , which in principle can be overcome with improved labeling schemes . Model selection In LocMoFit , we provided the corrected Akaike information criterion 22 ( 𝐴𝐼𝐶 = ) as the metric for performing the model selection . In general , a model with more free parameters tends to fit better . Therefore , instead of using the maximum likelihood 𝐿9 as the metric , 𝐴𝐼𝐶 = 2𝑃 − 2 ln 𝐿9 was suggested for penalizing the number of free parameters 𝑃 22 . In practice , we would like to choose a model with fewer parameter and yet a larger maximum likelihood . Therefore , the smallest AIC indicate the best model when fitting the same data . To avoid overfitting caused by small sample size , the corrected 𝐴𝐼𝐶 = includes an additional penalty : 𝐴𝐼𝐶 = = 𝐴𝐼𝐶 + ( 2𝑃 0 + 2𝑃 ) / ( 𝐾 − 𝑃 − 1 ) , where 𝐾 is sample size 22 . When 𝐾 → ∞ , the additional penalty term approaches zero so that 𝐴𝐼𝐶 = converges to 𝐴𝐼𝐶 . In LocMoFit , the sample size 𝐾 is the number of localizations . For visual comparison of the 𝐴𝐼𝐶 = we normalize by the number of localizations 𝐾 . Model - free averaging For model - free averaging of Nup96 particles , we first estimated the approximate orientations and positions of each particle by fitting with a continuous dual - ring model . Next , we generated an initial model from a subset of transformed particles 𝑃 1 … 𝑃 S7 . To this end , we defined the localization coordinates of each particle as the fluorophore positions of a point model . Positions and orientations of all model particles were corrected according to their estimates . Then , we fitted each model to all other particles in the 50 - particle subset . Based on LL values acquired by all - against - all pairwise fitting , we then built a similarity matrix 𝑀 . We then cumulatively fused the particles in the order 𝑅 of their total similarity : each particle 𝑃 [ U45 ] was registered to the fused particle 𝑇 [ U45 . 1 ] starting with the highest - ranked particle 𝑇 1 = 𝑃 [ U41 ] . This initial model 𝑇 that was used to register the remaining particles 𝑃 S1 … 𝑃 077 in the 200 - particle data set . The resulting average 𝑇 was then used as the new initial template for the next round of registration . This step was iterated until convergence and yielded the final average 𝑇(cid:139) . See Algorithm 1 for the pseudocode . 20 Algorithm 1 . Model - free averaging Input : k individual particles 𝑷 𝟏 𝑷 𝟐 … 𝑷 𝒌 , each contains localization coordinates and uncertainties Output : final average 𝑻 Procedure : / / all - against - all pairwise registration among a 𝒏 - sites subset of particles with 𝒏 < 𝒌 / / 𝒌 is the total number of particles in the data set for each pair { 𝒊 , 𝒋 } ∈ { 𝟏 … 𝒏 } if 𝒊 ≠ 𝒋 / / LocMoFit ( 𝑨 , 𝑩 ) represents fitting 𝑨 to 𝑩 through LocMoFit matrix 𝑴 [ 𝒊 , 𝒋 ] ← maximum log - likelihood of LocMoFit ( 𝑷 𝒊 , 𝑷 𝒋 ) else 𝑴 [ 𝒊 , 𝒋 ] ← 0 end if end for vector R ← rank ( rowsum ( M ) ) / / forming the first data - driven template 𝑻 ← 𝑷 [ 𝑹4𝟏 ] / / taking the particle with the highest total similarity as the seed for 𝒊 = 𝟐 … 𝒏 𝑷 E ← 𝑷 [ 𝑹4𝒊 ] registered to 𝑻 through LocMoFit ( 𝑻 , 𝑷 [ 𝑹4𝒊 ] ) 𝑻 ← 𝑷 E ∪ 𝑻 end for / / iterative optimization of the average particle until no further improvement / / the optimization stops when 𝑱 unimproved iterations reached 𝑺 ← −𝒊𝒏𝒇 / / initializing the current best score 𝑺 𝑻(cid:157) ← 𝑻 / / use the current 𝑻 as the initial template for the iterative registrations repeat for 𝒊 = 𝟏 … 𝒌 𝑳 𝒊 ← maximum log - likelihood of LocMoFit ( 𝑻(cid:157) , 𝑷 𝒊 ) 𝑷 𝒊E ← 𝑷 𝒊 registered to 𝑻 through LocMoFit ( 𝑻(cid:157) , 𝑷 𝒊 ) end for 𝑺(cid:139) ← sum ( 𝑳 𝟏 … 𝑳 𝒌 ) / / the current score 𝑻(cid:157) ← 𝑷 𝟏E ∪ 𝑷 𝟐E … 𝑷 𝒌E / / 𝑻(cid:157) is the template for the next iteration if 𝑺(cid:139) > 𝑺 / / if there is an improvement 𝑻 ← 𝑻(cid:157) / / 𝑻 is the current best average 𝑺 ← 𝑺(cid:139) 𝒋 ← 𝟎 else / / if there is no improvement 𝒋 ← 𝒋 + 𝟏 end if until 𝒋 = 𝑱 / / stops when no improvement for m consecutive times return 𝑻 as the final average 21 Sample preparation Preparation of coverslips 24 mm round glass coverslips were cleaned overnight in methanol / hydrochloric acid ( 50 / 50 ) while stirring . They were then rinsed repeatedly with ddH 2 O until the pH of the washing solution remained neutral . They were then placed overnight into a laminar flow cell culture hood to dry them before finalizing the cleaning of coverslips by ultraviolet irradiation for 30 min . For yeast samples , the coverslips were subsequently plasma cleaned for 5 - 10 min . A drop of 20 µL concanavalin A ( ConA ) solution ( 4 mg / mL in PBS ) was added to each coverslip , spread out with a pipette tip , and let incubate for 30 min in a humidified atmosphere . Then , the remaining liquid was removed and the coverslips were dried overnight at 37°C . Prior to use , the remaining salts were washed off with ddH 2 O . Sample seeding Cells were seeded on clean glass coverslips 2 days before fixation to reach a confluency of about 50 – 70 % on the day of fixation . They were grown in growth medium ( DMEM ; catalog no . 11880 - 02 , Gibco ) containing 1× MEM NEAA ( catalog no . 11140 - 035 , Gibco ) , 1× GlutaMAX ( catalog no . 35050 - 038 , Gibco ) and 10 % [ v / v ] fetal bovine serum ( catalog no . 10270 - 106 , Gibco ) for approximately 2 days at 37 °C and 5 % CO 2 . Before further processing , the growth medium was aspirated and samples were rinsed twice with PBS to remove dead cells and debris . Unless otherwise stated , all experimental replicates were performed on cells of a different passage with separated sample preparation . Imaging buffers Yeast samples were mounted in D 2 O blinking buffer ( 50 mM Tris - HCl pH 8 , 10 mM NaCl , 100 U / mL glucose oxidase , 0 . 004 % [ w / v ] catalase , 10 % [ w / v ] D - glucose , 20 mM cysteamine , in 90 % D 2 O ) . NPC samples were imaged in 50 mM Tris - HCl pH 8 , 10 mM NaCl , 100 U / mL glucose oxidase , 0 . 004 % [ w / v ] catalase , 10 % [ w / v ] D - glucose , 35 mM cysteamine . Preparation of NPC samples For single - color imaging , coverslips containing Nup96 - SNAP - tag cells ( catalog no . 300444 , CLS Cell Line Service ) were rinsed twice with warm PBS . Prefixation was carried out in a 2 . 4 % [ w / v ] formaldehyde ( FA ) in PBS solution for 40 s before the samples were permeabilized in 0 . 4 % [ v / v ] Triton X - 100 in PBS for 3 min . Complete fixation was carried out in 2 . 4 % [ w / v ] FA in PBS for 30 min followed by 3 × 5 min washing steps in PBS after fixation . Subsequently , the sample was incubated for 30 min with Image - iT FX Signal Enhancer ( catalog no . I36933 , Thermo Fisher Scientific ) before staining with SNAP dye buffer ( 1 µM BG - AF647 ( catalog no . S9136S , New England Biolabs ) and 1 µM dithiothreitol in 0 . 5 % [ w / v ] bovine serum albumin ( BSA ) in PBS ) for 2 h at room temperature . To remove unbound dye , coverslips were washed three times for 5 min in PBS . At this point , the sample was ready for single color super - resolution imaging . For simultaneous dual - color imaging with immunostaining , samples were further blocked with 5 % [ v / v ] normal goat serum ( NGS ) ( catalog no . PCN5000 , lifeTech ) in PBS for 1 h . Binding of primary antibody ( Elys ( catalog no . HPA031658 , Atlas Antibodies , 1 : 50 ) , Nup133 ( catalog no . HPA059767 , Atlas Antibodies , 1 : 150 ) , Nup62 ( catalog no . 610498 , BD Biosciences , 22 1 : 150 ) , Nup153 ( catalog no . ab24700 , Abcam , 1 : 60 ) ) was achieved by incubation with the respective antibody diluted in 5 % [ v / v ] NGS in PBS for 1 h . Coverslips were washed three times for 5 min with PBS to remove unbound antibody and subsequently stained with CF660C labeled anti - rabbit antibody ( catalog no . 20183 , Biotium ) or anti - mouse antibody ( catalog no . 20815 , Biotium ) diluted 1 : 150 in PBS containing 5 % [ v / v ] NGS for 1 h . After three washes with PBS for 5 min each , the sample was postfixed for 30 min using 2 . 4 % [ w / v ] FA in PBS , rinsed with PBS , quenched in 100 mM of NH 4 Cl for 5 min and rinsed three times for 5 min with PBS . For simultaneous dual - color imaging with WGA staining , cells on a coverslip were fixed , permeabilized , and stained with SNAP dye as described above . The sample was then incubated for 10 min with 1 : 5 , 000 diluted WGA - CF680 ( catalog no . 29029 - 1 , Biotium ) in 100 mM Tris pH 8 . 0 , 40 mM NaCl , and rinsed three times with PBS . Before imaging , samples were mounted into custom sample holders in appropriate imaging buffers ( see section Imaging buffers ) . The holder was sealed with parafilm . Strain and sample preparation for yeast The yeast strain expressing Abp1 tagged with mMaple 42 and Las17 tagged with SNAP f tag 43 was described previously ( JRY0014 ; 6 ) . Briefly , the two proteins were tagged at their C - termini at the endogenous loci 44 . The strain was verified by colony PCR and fluorescence microscopy . Prior to the day of imaging , yeast cells were inoculated from single colonies on plates into 10 mL YPAD in a glass flask , and grown overnight at 30°C with shaking . The next morning , the culture was diluted into 10 mL YPAD in a glass flask to an OD 600 of 0 . 25 , and grown for 3 more hours at 30°C , typically reaching an OD 600 of 0 . 6 - 1 . 0 . For sample preparation , 2 mL of the culture were collected by centrifugation at 500 rcf . for 3 min , resuspended in 100 - 150 µL YPAD , and pipetted on a ConA - coated coverslip . During all following incubation steps the samples were protected from light . The cells were allowed to settle for 15 min in a humidified atmosphere . Next , the coverslip was directly transferred into the freshly prepared fixation solution ( 4 % [ w / v ] FA , 2 % [ w / v ] sucrose in PBS ) . After 15 min of fixation with gentle orbital shaking , the sample was quenched in 100 mM NH 4 Cl in PBS for 15 min . Quenching was repeated once more before the coverslips was washed once in PBS for 5 min . Next , cells were permeabilized for 30 min by addition of the permeabilization solution ( 0 . 25 % [ v / v ] Triton X - 100 , 50 % [ v / v ] ImageIT FX , in PBS ) . The coverslip was washed twice in PBS for 5 min and then transferred face down on a drop of 100 µL staining solution ( 1 µM SNAP Surface Alexa Fluor 647 , 1 % [ w / v ] BSA , 1 mM DTT , 0 . 25 % [ v / v ] Triton X - 100 , in PBS ) on parafilm . After staining for 90 min , the sample was washed 3 times in PBS for 5 min each . Microscopy Microscope setup and imaging All SMLM data in mammalian cells were acquired on a custom built widefield setup described previously 6 , 45 . Briefly , the free output of a commercial laser box ( LightHub , Omicron - Laserage Laserprodukte ) equipped with Luxx 405 , 488 and 638 and Cobolt 561 lasers and an additional 640 nm booster laser ( iBeam Smart , Toptica ) were collimated and focused onto a speckle reducer ( catalog no . LSR - 3005 - 17S - VIS , Optotune , Dietikon ) before being coupled into a multi - mode fiber ( catalog no . M105L02S - A , Thorlabs ) . The output of the fiber was magnified by an achromatic lens and focused into the sample to homogeneously illuminate an area of about 1 , 000 µm 2 . The laser was guided through a laser cleanup filter ( 390 / 482 / 563 / 640 HC 23 Quad , AHF ) to remove fluorescence generated by the fiber . Emitted fluorescence was collected through a high numerical aperture ( NA ) oil immersion objective ( HCX PL APO 160× / 1 . 43 NA , Leica ) , filtered by a 700 / 100 bandpass filter ( catalog no . ET700 / 100m , Chroma ) and imaged onto an Evolve512D EMCCD camera ( Photometrics ) . For the filter settings for dual - color imaging see below ( Ratiometric dual - color SMLM ) . The z focus was stabilized by an infrared laser that was totally internally reflected off the coverslip onto a quadrant photodiode , which was coupled into closed - loop feedback with the piezo objective positioner ( Physik Instrumente ) . Laser control , focus stabilization and movement of filters was performed using a field - programmable gate array ( Mojo , Embedded Micro ) . The pulse length of the 405 nm ( laser intensity ≈ 28 W cm −2 ) laser was controlled by a feedback algorithm to sustain a predefined number of localizations per frame . Typical acquisition parameters are ~ 100 , 000 frames , a frame rate of 100 ms , and the laser intensity of 6 kW / cm 2 as a good compromise between localization precision and imaging time 26 . Samples were mounted and imaged until almost all fluorophores were bleached and no further localizations were detected under continuous ultraviolet irradiation . The yeast dual - color data were acquired on a microscope with a commercial laser box ( iChrome MLE , Toptica , Gräfelfing ) with 405 nm , 561 nm , and 640 nm lasers and a 640 nm booster laser ( Toptica ) which were coupled via single - mode . The output of the fiber was collimated , focused on the BFP of the TIRF objective ( 60× NA 1 . 49 , Nikon ) , and adjusted for epi illumination . The emitted fluorescence was laterally constricted by a slit , split by a dichroic mirror ( 640LP , ZT640rdc , Chroma ) , filtered by the respective bandpass filters ( transmitted / AF647 : 676 / 37 , FF01 - 676 / 37 - 25 , Semrock ; reflected / mMaple : 600 / 60 , NC458462 , Chroma ) , and imaged on two parts of the EMCCD camera ( iXON Ultra , Andor ) . The focus was stabilized as described for the system above . The microscopes were controlled by µManager 46 through the Easier Micro - Manager User interface ( EMU 47 ) . Pixel size calibration The effective pixel size of the microscope was calibrated by translating fluorescent beads , immobilized on a coverslip , with a calibrated sample stage ( SmarAct ) that operated in close loop . From the measured translation of many beads the pixel size could be calibrated with a high accuracy . Ratiometric dual - color SMLM For ratiometric dual - color imaging of AF647 and CF680 , the emitted fluorescence was split by a 665LP beamsplitter ( catalog no . ET665lp , Chroma ) , filtered by a 685 / 70 ( catalog no . ET685 / 70m , Chroma ) bandpass filter ( transmitted light ) or a 676 / 37 ( catalog no . FF01 - 676 / 37 - 25 , Semrock ) bandpass filter ( reflected light ) and imaged side by side on the EMCCD camera . The color of the individual blinks was assigned by calculating the ratio of the intensities in the two channels . Astigmatic 3D SMLM The 3D SMLM data was acquired using a cylindrical lens ( f = 1 , 000 mm ; catalog no . LJ1516L1 - A , Thorlabs ) to introduce astigmatism . The data were fitted and analyzed as described previously 39 . First , z stacks with known displacement of several ( 15 – 20 ) fields of view of TetraSpeck beads on a coverslip were acquired to generate a model of the experimental point spread function . This model was then used to determine the z position of the individual localizations . 24 Dual - color SMLM in yeast Raw data were acquired with 30 ms exposure time . The images acquired in the two channels ( described above ) were merged using a transformation which was determined using images of beads that are fluorescent in both channels ( TetraSpeck ) . Data processing SMLM data analysis was conducted using previously published algorithms with custom software written in MATLAB ( super - resolution microscopy analysis platform , SMAP 21 ) , available as open source at github . com / jries / SMAP . 3D bead calibration Tetra - Speck beads ( 0 . 75 µL from stock , catalog no . T7279 , Thermo Fisher ) were diluted in 360 µL dH 2 O , mixed with 40 µL 1 M MgCl 2 and put on a coverslip in a custom - manufactured sample holder . After 10 min , the mix was replaced with 400 µL dH 2 O . Using Micro - Manager , about 20 positions on the coverslip were defined and the beads were imaged acquiring z stacks ( −1 to 1 µm , 10 nm step size ) using the same filters as used in the intended experiment . Fitting and postprocessing Two - dimensional data were fitted with a symmetric Gaussian PSF model with the PSF size , x , y , photons per localization and the background as free - fitting parameters using maximum likelihood estimation 39 . 3D data were fitted using an experimentally derived PSF model from the 3D bead calibration with x , y , z , photons per localization and the background as free - fitting parameters using maximum likelihood estimation 39 . Fitted data were first grouped by merging localizations persistent over consecutive frames within 35 nm from each other ( with an allowed gap of one dark frame ) into one localization with its position calculated by the weighted average of individual x , y and z positions . Photons per localization as well as the background were summed over all frames in which the grouped localization was detected . Data was then drift corrected in x , y and z by a custom algorithm based on redundant cross - correlation . From the spread of the redundant displacements we estimated the accuracy of the drift correction to be better than 1 . 5 nm in x and y and 2 nm in z . To exclude bad fits and z position to reject molecules far away from the focal plane , the filtering was applied as follows . 3D data of Nup96 were filtered based on lateral localization precision ( [ 0 , 5 ] nm ) , z position ( boundaries defined to exclude localizations away from the nuclear envelope ) , log - likelihood ( lower boundary defined to exclude the left tail of the distribution ) , and frames ( boundaries defined to exclude ~ 1 , 000 very first and last frames ) . 3D data of Microtubules were filtered based on lateral localization precision : ( [ 0 , 5 ] nm ) and frames ( [ 30 , 000 , 90 , 000 ] , also for efficiency ) . 3D dual - color data of NPCs were filtered based on lateral localization precision ( [ 0 , 10 ] nm for Nup96 and [ 0 , 5 ] nm for target proteins ) , log - likelihood ( lower boundary defined to exclude the left tail of the distribution ) , and frames ( boundaries defined to exclude very first and last thousands of frames ) . 2D dual - color data of endocytic sites in yeast were filtered based on localization precision ( [ 0 , 25 ] nm ) , PSF size ( [ 0 , 175 ] nm ) , frames ( boundaries defined to exclude ~ 20 , 000 very first and last frames ) . Segmentation of sites All NPC images used in this work that are based on Nup96 - derived data , were segmented automatically in SMAP . For this , reconstructed images were convolved with a kernel 25 consisting of a ring with a radius corresponding to the radius of the NPC , convolved with a Gaussian . Local maxima over a user - defined threshold were treated as possible candidates . Candidates were cleaned up by three additional steps . ( 1 ) We fitted the localizations corresponding to each candidate with a circle and excluded structures with a ring radius smaller than 40 nm or larger than 70 nm . ( 2 ) Localizations were refitted with a circle of fixed radius to determine the center coordinates . Structures were rejected if more than 25 % of localizations were closer than 40 nm to the center or if more than 40 % of localizations were further away than 70 nm from the center , as these typically did not visually resemble NPCs or were two adjacent wrongly segmented NPCs . ( 3 ) Sites with the number of localization smaller than 30 were further removed to ensure the sufficient sampling of the underlying biological structure . In images of microtubules , a circular boundary with a radius of 500 nm was used to crop microtubules into sites to get segments that were at least one micrometer long . In a site with more than one microtubule , a polygon mask was used to further retain only one segment of interest . Endocytic sites in yeast were manually picked and rotated so that the direction of the invagination was pointing upwards . Correction of depth - dependent distortion We observed a depth - dependent distortion along the z - axis , as reported previously 27 . The distortion is reflected by the depth - dependent ring separations s of NPCs ( Extended Data Figure 4a ) . As the expected ring separation for Nup96 is known , we used it as the standard to correct the distortion . By definition the ring separation is the distance between the two rings of one NPC so that 𝑠 = 𝑥⃑ ] 1 − 𝑥⃑ ] 0 , where 𝑥⃑ ] 1 and 𝑥⃑ ] 0 are the center positions of the two rings . As the orientation of an NPC is not necessary perpendicular to the x - y plane , we measured the tilt angle radian ψ of an NPC from the z - axis , and used the angle to derive the vertical component of the separation as 𝑠 $ = 𝑠 cos 𝜓 = 𝑧 ] 1 − 𝑧 ] 0 . We also calculated the expected 𝑠 $ as E ( 𝑠 $ ) = E ( 𝑠 ) cos 𝜓 , with E ( 𝑠 ) defined as 49 . 3 nm , the known average NPC ring separation 17 . With these values , we can calculate for each NPC a scaling factor 𝑠 & ( 𝑧 ) = E ( 𝑠 $ ) 𝑠 $ ⁄ . We found that the moving median of 𝑠 $ along z - axis appeared as a quadradic - like curve . We then fitted a quadradic function 𝑠 $ = 𝑐 1 𝑧 0 + 𝑐 0 𝑧 + 𝑐 / to the data . Given that the correction factor represents the change of the expected z position over the change of measured z position , 𝑠 & ( 𝑧 ) ≈ 𝜕𝐸 ( 𝑧 ) / 𝜕𝑧 . We then defined 𝑧 7 , which makes 𝑠 & ( 𝑧 ) = 1 , as the origin of distortion . The expected or undistorted z position can then be acquired as 𝐸 ( 𝑧 ) = ∫ 𝑠 & ( 𝑧 ) 𝑑𝑧 with 𝐸 ( 𝑧 7 ) = 𝑧 7 . The corrected z position of each localization k was then defined as 𝑧 ! E = 𝐸 ( 𝑧 ! ) − 𝐸 ( 0 ) for keeping the focal point zero . This correction was applied to all the NPC data sets before further quantifications . Acknowledgements We thank I . Schoen and J . Hériché for inputs on the manuscript . This work was supported by the European Research Council ( grant no . ERC CoG - 724489 to J . R . ) , the National Institutes of Health Common Fund 4D Nucleome Program ( grant no . U01 EB021223 to J . R . ) , the Human Frontier Science Program ( grant no . RGY0065 / 2017 to J . R . ) , and the European Molecular Biology Laboratory . Author contributions J . R . and Y . W . conceived the approach , developed the methods and wrote the software . U . M . , P . H . , A . T . , and M . M . acquired the data . Y . W . , A . T . , P . H . , M . M . , and U . M . analyzed the data . Y . W . and J . R . wrote the manuscript with input from all authors . 26 References 1 . Rust , M . J . , Bates , M . & Zhuang , X . Sub - diffraction - limit imaging by stochastic optical reconstruction microscopy ( STORM ) . Nature Methods 3 , 793 – 795 ( 2006 ) . 2 . Heilemann , M . et al . Subdiffraction - Resolution Fluorescence Imaging with Conventional Fluorescent Probes . Angewandte Chemie International Edition 47 , 6172 – 6176 ( 2008 ) . 3 . Betzig , E . et al . Imaging Intracellular Fluorescent Proteins at Nanometer Resolution . Science 313 , 1642 – 1645 ( 2006 ) . 4 . Holden , S . J . et al . High throughput 3D super - resolution microscopy reveals Caulobacter crescentus in vivo Z - ring organization . Proceedings of the National Academy of Sciences 111 , 4566 – 4571 ( 2014 ) . 5 . Douglass , K . M . , Sieben , C . , Archetti , A . , Lambert , A . & Manley , S . Super - resolution imaging of multiple cells by optimized flat - field epi - illumination . Nature Photon 10 , 705 – 708 ( 2016 ) . 6 . Mund , M . et al . Systematic Nanoscale Analysis of Endocytosis Links Efficient Vesicle Formation to Patterned Actin Nucleation . Cell 174 , 884 - 896 . e17 ( 2018 ) . 7 . Klevanski , M . et al . Automated highly multiplexed super - resolution imaging of protein nano - architecture in cells and tissues . Nat Commun 11 , 1552 ( 2020 ) . 8 . Balzarotti , F . et al . Nanometer resolution imaging and tracking of fluorescent molecules with minimal photon fluxes . Science 355 , 606 – 612 ( 2017 ) . 9 . Wu , Y . - L . , Tschanz , A . , Krupnik , L . & Ries , J . Quantitative Data Analysis in Single - Molecule Localization Microscopy . Trends in Cell Biology 0 , ( 2020 ) . 10 . Sengupta , P . et al . Probing protein heterogeneity in the plasma membrane using PALM and pair correlation analysis . Nature Methods 8 , 969 – 975 ( 2011 ) . 11 . Owen , D . M . et al . PALM imaging and cluster analysis of protein heterogeneity at the cell surface . Journal of Biophotonics 3 , 446 – 454 ( 2010 ) . 12 . Danial , J . S . H . & Garcia - Saez , A . J . Quantitative analysis of super - resolved structures using ASAP . Nat Methods 16 , 711 – 714 ( 2019 ) . 13 . Dempsey , G . T . , Vaughan , J . C . , Chen , K . H . , Bates , M . & Zhuang , X . Evaluation of fluorophores for optimal performance in localization - based super - resolution imaging . Nat Methods 8 , 1027 – 1036 ( 2011 ) . 14 . Xu , K . , Babcock , H . P . & Zhuang , X . Dual - objective STORM reveals three - dimensional filament organization in the actin cytoskeleton . Nature Methods 9 , 185 – 188 ( 2012 ) . 15 . Xu , K . , Zhong , G . & Zhuang , X . Actin , spectrin , and associated proteins form a periodic cytoskeletal structure in axons . Science 339 , 452 – 456 ( 2013 ) . 16 . Shi , X . et al . Super - resolution microscopy reveals that disruption of ciliary transition - zone architecture causes Joubert syndrome . Nat Cell Biol 19 , 1178 – 1188 ( 2017 ) . 17 . Thevathasan , J . V . et al . Nuclear pores as versatile reference standards for quantitative superresolution microscopy . Nat Methods 16 , 1045 – 1053 ( 2019 ) . 18 . Heydarian , H . et al . Template - free 2D particle fusion in localization microscopy . Nature Methods 15 , 781 – 784 ( 2018 ) . 19 . Heydarian , H . et al . 3D particle averaging and detection of macromolecular symmetry in localization microscopy . Nature Communications 12 , 2847 ( 2021 ) . 20 . Sabinina , V . J . et al . Three - dimensional superresolution fluorescence microscopy maps the variable molecular architecture of the nuclear pore complex . MBoC 32 , 1523 – 1533 ( 2021 ) . 21 . Ries , J . SMAP : a modular super - resolution microscopy analysis platform for SMLM data . Nature Methods 17 , 870 – 872 ( 2020 ) . 22 . Cavanaugh , J . E . Unifying the derivations for the Akaike and corrected Akaike information criteria . Statistics & Probability Letters 33 , 201 – 208 ( 1997 ) . 23 . Schnitzbauer , J . et al . Correlation analysis framework for localization - based superresolution microscopy . PNAS 115 , 3219 – 3224 ( 2018 ) . 24 . Huijben , T . A . P . M . et al . Detecting structural heterogeneity in single - molecule localization microscopy data . Nat Commun 12 , 3791 ( 2021 ) . 25 . von Appen , A . et al . In situ structural analysis of the human nuclear pore complex . Nature 526 , 140 – 143 ( 2015 ) . 26 . Diekmann , R . et al . Optimizing imaging speed and excitation intensity for single - molecule localization microscopy . Nat Methods 17 , 909 – 912 ( 2020 ) . 27 . Li , Y . , Wu , Y . - L . , Hoess , P . , Mund , M . & Ries , J . Depth - dependent PSF calibration and aberration correction for 3D single - molecule localization . Biomedical Optics Express 10 , 2708 – 2718 ( 2019 ) . 28 . Speiser , A . et al . Deep learning enables fast and dense single - molecule localization with high accuracy . bioRxiv 2020 . 10 . 26 . 355164 ( 2020 ) doi : 10 . 1101 / 2020 . 10 . 26 . 355164 . 27 29 . Früh , S . M . et al . Site - Specifically - Labeled Antibodies for Super - Resolution Microscopy Reveal In Situ Linkage Errors . ACS Nano acsnano . 1c03677 ( 2021 ) doi : 10 . 1021 / acsnano . 1c03677 . 30 . Dani , A . , Huang , B . , Bergan , J . , Dulac , C . & Zhuang , X . Superresolution Imaging of Chemical Synapses in the Brain . Neuron 68 , 843 – 856 ( 2010 ) . 31 . Sieben , C . , Banterle , N . , Douglass , K . M . , Gönczy , P . & Manley , S . Multicolor single - particle reconstruction of protein complexes . Nat Methods 15 , 777 – 780 ( 2018 ) . 32 . Picco , A . , Mund , M . , Ries , J . , Nédélec , F . & Kaksonen , M . Visualizing the functional architecture of the endocytic machinery . eLife 4 , 1039 ( 2015 ) . 33 . Kukulski , W . , Schorb , M . , Kaksonen , M . & Briggs , J . A . G . Plasma membrane reshaping during endocytosis is revealed by time - resolved electron tomography . Cell 150 , 508 – 520 ( 2012 ) . 34 . Venkataramani , V . , Herrmannsdörfer , F . , Heilemann , M . & Kuner , T . SuReSim : simulating localization microscopy experiments from ground truth models . Nature Methods 13 , 319 – 321 ( 2016 ) . 35 . Griffié , J . et al . Virtual - SMLM , a virtual environment for real - time interactive SMLM acquisition . bioRxiv 2020 . 03 . 05 . 967893 ( 2020 ) doi : 10 . 1101 / 2020 . 03 . 05 . 967893 . 36 . Henderson , R . Avoiding the pitfalls of single particle cryo - electron microscopy : Einstein from noise . PNAS 110 , 18037 – 18041 ( 2013 ) . 37 . Fazel , M . , Wester , M . J . , Rieger , B . , Jungmann , R . & Lidke , K . A . Sub - Nanometer Precision using Bayesian Grouping of Localizations . bioRxiv 752287 ( 2019 ) doi : 10 . 1101 / 752287 . 38 . Smith , C . S . , Joseph , N . , Rieger , B . & Lidke , K . A . Fast , single - molecule localization that achieves theoretically minimum uncertainty . Nat Methods 7 , 373 – 375 ( 2010 ) . 39 . Li , Y . et al . Real - time 3D single - molecule localization using experimental point spread functions . Nature Methods 15 , 367 – 369 ( 2018 ) . 40 . Sage , D . et al . Super - resolution fight club : assessment of 2D and 3D single - molecule localization microscopy software . Nat Methods 16 , 387 – 395 ( 2019 ) . 41 . Mortensen , K . I . , Churchman , L . S . , Spudich , J . A . & Flyvbjerg , H . Optimized localization analysis for single - molecule tracking and super - resolution microscopy . Nature Methods 7 , 377 – 381 ( 2010 ) . 42 . McEvoy , A . L . et al . mMaple : A Photoconvertible Fluorescent Protein for Use in Multiple Imaging Modalities . PloS one 7 , e51314 ( 2012 ) . 43 . Sun , X . et al . Development of SNAP - tag fluorogenic probes for wash - free fluorescence imaging . Chembiochem : a European journal of chemical biology 12 , 2217 – 2226 ( 2011 ) . 44 . Mund , M . , Kaplan , C . & Ries , J . Localization microscopy in yeast . in Methods in Cell Biology vol . 123 253 – 271 ( Elsevier , 2014 ) . 45 . Deschamps , J . , Rowald , A . & Ries , J . Efficient homogeneous illumination and optical sectioning for quantitative single - molecule localization microscopy . Optics express 24 , 28080 – 28090 ( 2016 ) . 46 . Edelstein , A . D . et al . Advanced methods of microscope control using μManager software . J Biol Methods 1 , e10 ( 2014 ) . 47 . Deschamps , J . & Ries , J . EMU : reconfigurable graphical user interfaces for Micro - Manager . http : / / biorxiv . org / lookup / doi / 10 . 1101 / 2020 . 03 . 18 . 997494 ( 2020 ) doi : 10 . 1101 / 2020 . 03 . 18 . 997494 . 28 Extended Data Figures Extended Data Figure 1 . Example sites simulated across various conditions . a , the NPC model used for simulations . b - e , example simulated NPCs across different localization precision ( b ) , labeling efficiency ( c ) , background ( d ) , and re - blinks ( e ) . In b , corresponding photon counts 𝑛 - . with zero fluorescence background 𝑏𝑔 were used to derive the specified median localization precisions . In c - e , all sites were simulated with 𝑛 - . = 5 , 000 and 𝑏𝑔 = 100 photons / pixel / localization and yielded a median lateral localization precision of 3 . 6 nm . STORM mode and the condition as for b except for the parameters specified in the headers . Detailed simulation parameters are shown in Supplementary Table 1 . Scale bars : 100 nm . 29 Extended Data Figure 2 . Errors of parameter estimations against factors contributing to data quality in the simulated datasets . Each panel shows the estimation errors of one parameter in the three imaging modes , across different levels of either labeling efficiency ( a ) , background ( b ) , re - blinks ( c ) , or localization precision ( d ) . Example sites of some conditions are shown in Extended Data Figure 1 . The dots indicate mean errors and their standard deviations are indicated by dashed lines . Simulation parameters and plotted statistics are shown in Supplementary Table 1 and Supplementary Table 2 , respectively . Sample size : n s = 1 , 000 for each dot . 30 Extended Data Figure 3 . Distributions of the fitted ring separation at different labeling efficiencies in simulated data . Three side - view examples of pores at different fitted ring separations , indicated by red crosses . All examples are from the dataset simulated with 30 % labeling efficiency . Scale bar : 100 nm . Extended Data Figure 4 . Correction of z - dependent distortion . a . A scatter plot showing the z - dependent spatial distortion along the z axis , as the NPC ring separation appears dependent on the z position . b . The median correction factor over z positions can be approximated by a quadratic fit . The correction factor is defined as the expected ring separation divided by a fitted ring separation before the correction . c . Fitted ring separations over the z positions after the correction based on the correction factor . NPCs with ring separations smaller than 35 nm ( gray horizontal lines , likely stemming from NPCs with only a single ring labeled ) and with z positions further than 150 nm away from the focus ( gray vertical lines ) were excluded from the curve fit and the following analysis . Each point represents one NPC . All the data points in a - c are from the same field of view . Side - view examples of sites at different z positions before ( d ) and after ( e ) the correction , corresponding to the data points indicated by the numbered red circles in a and c . Scale bars : 100 nm . 31 Extended Data Figure 5 . Simulations based on experimental parameters . a , Representative images of the simulated Nup96 - labeled NPCs in 3D ( top view ) . b , single NPCs ( orange ) as indicated in a are fitted with the eight - fold symmetric model . c - e , Histograms of three fitted parameters : radius r = 53 . 5 ± 1 . 5 nm ( c ) , separation s = 50 . 3 ± 3 . 8 nm ( d ) , and twist θ = 8 . 6 ± 5 . 9° ( e ) . Simulation parameters are summarized in Supplementary Table 1 . Sample size : n s = 4 , 000 . Scale bars : 100 nm . Extended Data Figure 6 . Validation of the model selection using simulations . a , Normalized AIC C of fitting simulated NPCs with different rotationally symmetric models . Each panel corresponds to a simulated NPC dataset generated from the model indicated in the insets . Sample size : n s = 3 , 000 for each panel . b , Scatter plot showing normalized AIC C values of fitting the simulated 8 - fold symmetric sites with models having 6 - fold and 8 - fold rotational symmetries . c , Scatter plot showing normalized AIC C values of fitting both the simulated six - fold and eight - fold symmetric sites with models having six - fold and eight - fold rotational symmetries . The gray diagonal lines indicate equal normalized AIC C values . Simulation parameters are summarized in Supplementary Table 1 and correspond to SMLM in the dSTORM mode . 32 Supplementary information Supplementary Table 1 . Simulation parameters . Parameter Value * Unit Symbol Extended Data Figure 1 and Extended Data Figure 2 SMLM property photon count 5000 * * background 100 * * photons / pixel / localization labelling efficiency 60 percent re - activation 2 lifetime 2 frame linkage error 5 nm number of frames 100000 NPC model parameter x [ - 50 , 50 ] nm 𝑥 ! y [ - 50 , 50 ] nm 𝑦 ! z [ - 50 , 50 ] nm 𝑧 ! xrot [ - 15 , 15 ] degree 𝛼 yrot [ - 15 , 15 ] degree 𝛽 zrot [ 0 , 360 ] degree 𝑟 variation 0 nm 𝜖 weight 1 𝑤 " xscale 1 𝑠 # yscale 1 𝑠 $ zscale 1 𝑠 % ringDistance 50 nm 𝑠 radius 53 . 5 nm 𝑟 cornerDegree 12 degree 𝜓 azimuthalShift 8 . 8 degree 𝜃 background weight 0 . 1 𝑤 & ’ Simulations in Figure 2 , Extended Data Figure 5 , and Extended Data Figure 6 SMLM property photon count 12000 background 260 photons / pixel / localization labelling efficiency 67 percent re - activation 4 . 1 lifetime 2 frame linkage error 5 nm number of frames 100000 NPC model parameter x [ - 50 , 50 ] nm 𝑥 ! y [ - 50 , 50 ] nm 𝑦 ! z [ - 50 , 50 ] nm 𝑧 ! xrot [ - 15 , 15 ] degree 𝛼 yrot [ - 15 , 15 ] degree 𝛽 zrot [ 0 , 360 ] degree 𝑟 variation 0 nm 𝜖 weight 1 𝑤 " xscale 1 𝑠 # yscale 1 𝑠 $ zscale 1 𝑠 % ringDistance 50 . 2 nm 𝑠 radius 53 . 4 nm 𝑟 cornerDegree 12 degree 𝜓 azimuthalShift 8 . 8 degree 𝜃 background density 20 𝜇𝑚 ( ) 𝜌 & ’ * These values were used unless indicated otherwise . * * Photon counts for getting different localization precisions ( indicated in the parentheses ) in Extended Data Figure 2a : 370 ( 11 nm ) , 550 ( 8 nm ) , 920 ( 6 nm ) , 1 , 900 ( 4 nm ) , 6 , 500 ( 2 nm ) , 22 , 300 ( 1 nm ) , with zero fluorescence background . 33 Supplementary Table 2 . Data points plotted in Extended Data Figure 2 Parameter Data point * mean error ± standard deviation Unit 𝑥 ! locprec _ 1 0 . 1 ± 1 . 3 nm 𝑥 ! locprec _ 2 - 0 . 1 ± 1 . 6 nm 𝑥 ! locprec _ 4 0 . 0 ± 1 . 6 nm 𝑥 ! locprec _ 6 0 . 0 ± 1 . 9 nm 𝑥 ! locprec _ 8 0 . 0 ± 2 . 0 nm 𝑥 ! locprec _ 11 0 . 1 ± 2 . 8 nm 𝑧 ! locprec _ 1 0 . 0 ± 2 . 9 nm 𝑧 ! locprec _ 2 - 0 . 1 ± 3 . 4 nm 𝑧 ! locprec _ 4 - 0 . 2 ± 3 . 8 nm 𝑧 ! locprec _ 6 0 . 0 ± 4 . 1 nm 𝑧 ! locprec _ 8 0 . 2 ± 4 . 9 nm 𝑧 ! locprec _ 11 - 0 . 1 ± 6 . 4 nm 𝛼 locprec _ 1 0 . 0 ± 4 . 1 º 𝛼 locprec _ 2 - 0 . 3 ± 4 . 7 º 𝛼 locprec _ 4 0 . 1 ± 5 . 9 º 𝛼 locprec _ 6 0 . 4 ± 5 . 6 º 𝛼 locprec _ 8 0 . 1 ± 7 . 4 º 𝛼 locprec _ 11 0 . 5 ± 9 . 5 º 𝑠 locprec _ 1 - 0 . 4 ± 5 . 2 nm 𝑠 locprec _ 2 - 0 . 4 ± 5 . 0 nm 𝑠 locprec _ 4 - 1 . 1 ± 7 . 1 nm 𝑠 locprec _ 6 - 1 . 8 ± 7 . 3 nm 𝑠 locprec _ 8 - 2 . 5 ± 8 . 1 nm 𝑠 locprec _ 11 - 4 . 1 ± 10 . 1 nm 𝑟 locprec _ 1 0 . 0 ± 1 . 0 nm 𝑟 locprec _ 2 0 . 0 ± 1 . 0 nm 𝑟 locprec _ 4 0 . 1 ± 1 . 2 nm 𝑟 locprec _ 6 0 . 1 ± 1 . 2 nm 𝑟 locprec _ 8 0 . 0 ± 1 . 5 nm 𝑟 locprec _ 11 0 . 0 ± 1 . 9 nm 𝜃 locprec _ 1 0 . 1 ± 3 . 3 º 𝜃 locprec _ 2 0 . 0 ± 3 . 3 º 𝜃 locprec _ 4 - 0 . 1 ± 4 . 5 º 𝜃 locprec _ 6 - 0 . 3 ± 5 . 4 º 𝜃 locprec _ 8 0 . 3 ± 7 . 0 º 𝜃 locprec _ 11 - 0 . 3 ± 8 . 5 º 𝑤 & ’ locprec _ 1 - 0 . 4 ± 7 . 8 % 𝑤 & ’ locprec _ 2 - 0 . 6 ± 7 . 7 % 𝑤 & ’ locprec _ 4 - 0 . 4 ± 8 . 1 % 𝑤 & ’ locprec _ 6 0 . 5 ± 8 . 6 % 𝑤 & ’ locprec _ 8 0 . 8 ± 8 . 9 % 𝑤 & ’ locprec _ 11 3 . 6 ± 10 . 3 % 𝜖 locprec _ 1 0 . 0 ± 0 . 9 nm 𝜖 locprec _ 2 0 . 0 ± 1 . 1 nm 𝜖 locprec _ 4 - 0 . 1 ± 1 . 2 nm 𝜖 locprec _ 6 - 0 . 2 ± 1 . 3 nm 𝜖 locprec _ 8 - 0 . 2 ± 1 . 3 nm 𝜖 locprec _ 11 0 . 0 ± 1 . 6 nm 𝑥 ! bg _ 0 0 . 0 ± 1 . 1 nm 𝑥 ! bg _ 10 0 . 0 ± 1 . 8 nm 𝑥 ! bg _ 20 0 . 0 ± 3 . 5 nm 𝑥 ! bg _ 30 0 . 0 ± 4 . 4 nm 𝑥 ! bg _ 40 - 0 . 1 ± 3 . 7 nm 𝑧 ! bg _ 0 0 . 0 ± 2 . 5 nm 𝑧 ! bg _ 10 0 . 0 ± 4 . 8 nm 34 𝑧 ! bg _ 20 - 0 . 4 ± 6 . 9 nm 𝑧 ! bg _ 30 - 0 . 6 ± 7 . 4 nm 𝑧 ! bg _ 40 0 . 0 ± 8 . 5 nm 𝛼 bg _ 0 0 . 1 ± 3 . 6 º 𝛼 bg _ 10 - 0 . 1 ± 5 . 6 º 𝛼 bg _ 20 - 0 . 1 ± 8 . 4 º 𝛼 bg _ 30 0 . 4 ± 8 . 4 º 𝛼 bg _ 40 0 . 1 ± 10 . 6 º 𝑠 bg _ 0 - 0 . 8 ± 5 . 2 nm 𝑠 bg _ 10 - 1 . 1 ± 7 . 7 nm 𝑠 bg _ 20 - 1 . 3 ± 8 . 5 nm 𝑠 bg _ 30 - 1 . 8 ± 10 . 4 nm 𝑠 bg _ 40 - 1 . 9 ± 11 . 9 nm 𝑟 bg _ 0 0 . 1 ± 0 . 8 nm 𝑟 bg _ 10 0 . 1 ± 1 . 3 nm 𝑟 bg _ 20 0 . 2 ± 1 . 6 nm 𝑟 bg _ 30 0 . 2 ± 1 . 9 nm 𝑟 bg _ 40 0 . 4 ± 2 . 0 nm 𝜃 bg _ 0 0 . 2 ± 3 . 1 º 𝜃 bg _ 10 - 0 . 2 ± 4 . 6 º 𝜃 bg _ 20 0 . 0 ± 5 . 8 º 𝜃 bg _ 30 0 . 0 ± 6 . 3 º 𝜃 bg _ 40 - 0 . 2 ± 6 . 8 º 𝑤 & ’ bg _ 0 0 . 3 ± 1 . 3 % 𝑤 & ’ bg _ 10 - 0 . 5 ± 8 . 1 % 𝑤 & ’ bg _ 20 - 1 . 4 ± 10 . 2 % 𝑤 & ’ bg _ 30 - 2 . 2 ± 11 . 5 % 𝑤 & ’ bg _ 40 - 2 . 4 ± 11 . 7 % 𝜖 bg _ 0 - 0 . 3 ± 0 . 6 nm 𝜖 bg _ 10 - 0 . 1 ± 1 . 1 nm 𝜖 bg _ 20 0 . 2 ± 1 . 8 nm 𝜖 bg _ 30 0 . 3 ± 1 . 6 nm 𝜖 bg _ 40 0 . 6 ± 2 . 0 nm 𝑥 ! LE _ 70 0 . 0 ± 1 . 3 nm 𝑥 ! LE _ 60 0 . 0 ± 1 . 8 nm 𝑥 ! LE _ 50 0 . 1 ± 3 . 2 nm 𝑥 ! LE _ 40 0 . 2 ± 5 . 2 nm 𝑥 ! LE _ 30 0 . 0 ± 7 . 4 nm 𝑧 ! LE _ 70 0 . 1 ± 2 . 8 nm 𝑧 ! LE _ 60 0 . 0 ± 4 . 8 nm 𝑧 ! LE _ 50 - 0 . 4 ± 6 . 3 nm 𝑧 ! LE _ 40 - 0 . 5 ± 8 . 2 nm 𝑧 ! LE _ 30 - 1 . 0 ± 12 . 0 nm 𝛼 LE _ 70 0 . 1 ± 3 . 4 º 𝛼 LE _ 60 - 0 . 1 ± 5 . 6 º 𝛼 LE _ 50 0 . 2 ± 8 . 4 º 𝛼 LE _ 40 1 . 0 ± 11 . 4 º 𝛼 LE _ 30 1 . 5 ± 16 . 0 º 𝑠 LE _ 70 - 0 . 2 ± 4 . 0 nm 𝑠 LE _ 60 - 1 . 1 ± 7 . 7 nm 𝑠 LE _ 50 - 3 . 0 ± 10 . 2 nm 𝑠 LE _ 40 - 4 . 4 ± 13 . 0 nm 𝑠 LE _ 30 - 9 . 1 ± 19 . 1 nm 𝑟 LE _ 70 0 . 0 ± 1 . 0 nm 𝑟 LE _ 60 0 . 1 ± 1 . 3 nm 𝑟 LE _ 50 0 . 2 ± 1 . 7 nm 𝑟 LE _ 40 0 . 4 ± 2 . 1 nm 𝑟 LE _ 30 0 . 8 ± 3 . 0 nm 𝜃 LE _ 70 0 . 0 ± 3 . 2 º 35 𝜃 LE _ 60 - 0 . 2 ± 4 . 6 º 𝜃 LE _ 50 - 0 . 3 ± 5 . 6 º 𝜃 LE _ 40 0 . 0 ± 7 . 5 º 𝜃 LE _ 30 - 0 . 4 ± 9 . 6 º 𝑤 & ’ LE _ 70 - 1 . 0 ± 7 . 2 % 𝑤 & ’ LE _ 60 - 0 . 5 ± 8 . 1 % 𝑤 & ’ LE _ 50 - 0 . 8 ± 9 . 0 % 𝑤 & ’ LE _ 40 - 1 . 1 ± 9 . 5 % 𝑤 & ’ LE _ 30 - 1 . 3 ± 9 . 9 % 𝜖 LE _ 70 - 0 . 1 ± 1 . 1 nm 𝜖 LE _ 60 - 0 . 1 ± 1 . 1 nm 𝜖 LE _ 50 0 . 0 ± 1 . 4 nm 𝜖 LE _ 40 0 . 1 ± 1 . 5 nm 𝜖 LE _ 30 0 . 1 ± 1 . 6 nm 𝑥 ! RB _ 0 - 0 . 1 ± 1 . 8 nm 𝑥 ! RB _ 1 0 . 1 ± 2 . 0 nm 𝑥 ! RB _ 2 0 . 0 ± 1 . 8 nm 𝑥 ! RB _ 3 0 . 0 ± 1 . 6 nm 𝑥 ! RB _ 4 0 . 0 ± 1 . 9 nm 𝑧 ! RB _ 0 0 . 1 ± 4 . 0 nm 𝑧 ! RB _ 1 0 . 0 ± 4 . 0 nm 𝑧 ! RB _ 2 0 . 0 ± 4 . 8 nm 𝑧 ! RB _ 3 - 0 . 1 ± 4 . 3 nm 𝑧 ! RB _ 4 - 0 . 1 ± 4 . 0 nm 𝛼 RB _ 0 - 0 . 3 ± 5 . 9 º 𝛼 RB _ 1 - 0 . 1 ± 5 . 6 º 𝛼 RB _ 2 - 0 . 1 ± 5 . 6 º 𝛼 RB _ 3 0 . 2 ± 5 . 9 º 𝛼 RB _ 4 0 . 5 ± 5 . 9 º 𝑠 RB _ 0 - 0 . 4 ± 6 . 4 nm 𝑠 RB _ 1 - 0 . 7 ± 6 . 2 nm 𝑠 RB _ 2 - 1 . 1 ± 7 . 7 nm 𝑠 RB _ 3 - 1 . 1 ± 6 . 4 nm 𝑠 RB _ 4 - 1 . 3 ± 7 . 1 nm 𝑟 RB _ 0 0 . 2 ± 1 . 2 nm 𝑟 RB _ 1 0 . 1 ± 1 . 1 nm 𝑟 RB _ 2 0 . 1 ± 1 . 3 nm 𝑟 RB _ 3 0 . 1 ± 1 . 2 nm 𝑟 RB _ 4 0 . 1 ± 1 . 2 nm 𝜃 RB _ 0 0 . 0 ± 5 . 3 º 𝜃 RB _ 1 0 . 1 ± 4 . 5 º 𝜃 RB _ 2 - 0 . 2 ± 4 . 6 º 𝜃 RB _ 3 - 0 . 2 ± 4 . 4 º 𝜃 RB _ 4 - 0 . 1 ± 4 . 3 º 𝑤 & ’ RB _ 0 - 0 . 7 ± 7 . 8 % 𝑤 & ’ RB _ 1 - 1 . 1 ± 8 . 3 % 𝑤 & ’ RB _ 2 - 0 . 5 ± 8 . 1 % 𝑤 & ’ RB _ 3 - 0 . 7 ± 7 . 9 % 𝑤 & ’ RB _ 4 - 1 . 0 ± 7 . 9 % 𝜖 RB _ 0 - 0 . 3 ± 1 . 2 nm 𝜖 RB _ 1 - 0 . 2 ± 1 . 2 nm 𝜖 RB _ 2 - 0 . 1 ± 1 . 1 nm 𝜖 RB _ 3 0 . 0 ± 1 . 1 nm 𝜖 RB _ 4 0 . 0 ± 1 . 2 nm * Abbreviations : ‘locprec’ for localization precision , ‘LE’ for labeling efficiency , ‘BG’ for background , and ‘RB’ for re - blink . 36 Supplementary Table 3 . Fitting settings used in this study for Nup96 in single color data . Step Model Parameter type Internal parameter name Free parameter Relative Absolute Initial value Unit Symbol LB UB LB UB 1 1 𝑒 x yes - 50 50 - 150 150 𝑥0 * nm 𝑥 ! 1 1 𝑒 y yes - 50 50 - 150 150 𝑦0 * nm 𝑦 ! 1 1 𝑒 z yes - 100 20 - 300 300 𝑧̃ * − 40 nm 𝑧 ! 1 1 𝑒 weight no 1 𝑤 " 1 1 𝑒 xrot yes - 30 30 - inf inf 0 º 𝛼 1 1 𝑒 yrot yes - 30 30 - inf inf 0 º 𝛽 1 1 𝑒 zrot no 0 º 𝛾 1 1 𝑒 xscale no 1 𝑠 # 1 1 𝑒 yscale no 1 𝑠 $ 1 1 𝑒 zscale no 1 𝑠 % 1 1 𝑒 variation no 0 nm 𝜖 1 2 𝑒 x no 0 nm 𝑥 ! 1 2 𝑒 y no 0 nm 𝑦 ! 1 2 𝑒 z yes - 40 100 0 300 40 nm 𝑧̂ ! 1 2 𝑒 xrot no 0 º 𝛼 1 2 𝑒 yrot no 0 º 𝛽 1 2 𝑒 zrot no 0 º 𝛾 1 2 𝑒 variation no 0 nm 𝜖 1 2 𝑒 weight no 1 𝑤 " 1 2 𝑒 xscale no 0 𝑠 # 1 2 𝑒 yscale no 0 𝑠 $ 1 2 𝑒 zscale no 0 𝑠 % 1 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 0 𝑤 & ’ 2 1 𝑒 x yes - 20 20 - 150 150 𝑥7 ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ " ] nm 𝑥 ! 2 1 𝑒 y yes - 20 20 - 150 150 𝑦7 ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ ) ] nm 𝑦 ! 2 1 𝑒 z yes - 20 20 - 300 300 𝑧̂ ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ . ] nm 𝑧 ! 2 1 𝑒 xrot yes - 15 15 - inf inf inherited º 𝛼 2 1 𝑒 yrot yes - 15 15 - inf inf inherited º 𝛽 2 1 𝑒 zrot no 0 º 𝛾 2 1 𝑒 variation yes 0 20 1 20 0 nm 𝜖 2 1 𝑒 weight no 1 𝑤 " 2 1 𝑒 xscale no 0 𝑠 # 2 1 𝑒 yscale no 0 𝑠 $ 2 1 𝑒 zscale no 0 𝑠 % 2 1 𝑖 azimuthalShift no 0 º 𝜃 2 1 𝑖 cornerDegree no 12 º 𝜓 2 1 𝑖 ringDistance yes - 10 10 0 100 inherited nm 𝑠 2 1 𝑖 radius yes - 10 10 30 70 inherited nm 𝑟 2 L1 𝑒 weight no inherited 𝑤 & ’ 3 1 𝑒 x no inherited nm 𝑥 ! 3 1 𝑒 y no inherited nm 𝑦 ! 3 1 𝑒 z no inherited nm 𝑧 ! 3 1 𝑒 xrot no inherited º 𝛼 3 1 𝑒 yrot no inherited º 𝛽 3 1 𝑒 zrot yes - 180 180 - inf inf 0 º 𝑟 3 1 𝑒 variation yes - 10 10 1 20 5 nm 𝜖 3 1 𝑒 weight no inherited 𝑤 " 3 1 𝑒 xscale no inherited 𝑠 # 3 1 𝑒 yscale no inherited 𝑠 $ 3 1 𝑒 zscale no inherited 𝑠 % 3 1 𝑖 ringDistance no inherited nm 𝑠 3 1 𝑖 radius no inherited nm 𝑟 3 1 𝑖 cornerDegree no 12 º 𝜓 3 1 𝑖 azimuthalShift yes - 180 180 - inf inf 0 º 𝜃 3 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 inherited 𝑤 & ’ Note : In column Parameter type , 𝑖 and 𝑒 represent intrinsic and extrinsic parameters , respectively . In column Model , L1 represents layer 1 . In column initial value , a tilde operator represents a median value , a hat operator indicates a parameter estimate , and superscripts represent steps and models ( e . g . , 𝑧̂ " # , $ means the estimate of 𝑧 " from model 2 in step 1 ) . The function 𝑧⃗ [ ! ] ′ = 𝜙 ( 𝑧 ) [ ! ] outputs the k th element of the vector 𝑧⃗ ′ derived from 𝑧⃗ = [ 0 0 𝑧 ] rotated by the rotation matrix constructed using > 𝛼 @ # , # , 𝛽B # , # , 𝑟̂ # , # D as the angles { 𝛼 , 𝛽 , 𝛾 } in the equation 37 ( 11 ) . ‘inherited’ indicates that a value is inherited from its counterpart estimate in the last step . Other symbols have the same meanings as in the main text . Abbreviations : LB / UB : lower / upper boundaries . Blanks indicate values not applicable . Supplementary Table 4 . Fitting settings used in this study for microtubules . Step Model Parameter type Internal parameter name Free parameter Relative Absolute Initial value Unit Symbol LB UB LB UB 1 1 𝑒 x no 𝑥0 * nm 𝑥 ! 1 1 𝑒 y no 𝑦0 * nm 𝑦 ! 1 1 𝑒 z no 𝑧̃ * nm 𝑧 ! 1 1 𝑒 xrot no 0 º 𝛼 1 1 𝑒 yrot no 0 º 𝛽 1 1 𝑒 zrot no 𝑝𝑐𝑎𝑅𝑜𝑡 ( 𝑥0 * , 𝑦0 * , ) º 𝛾 1 1 𝑒 variation yes - Inf Inf 30 45 40 nm 𝜖 1 1 𝑒 weight no 1 𝑤 " 1 1 𝑒 xscale no 1 𝑠 # 1 1 𝑒 yscale no 1 𝑠 $ 1 1 𝑒 zscale no 1 𝑠 % 1 1 𝑖 xMid yes - Inf Inf - 500 500 0 nm 𝑥 / 1 1 𝑖 yMid yes - Inf Inf - 500 500 0 nm 𝑦 / 1 1 𝑖 zMid yes - Inf Inf - 500 500 0 nm 𝑧 / 1 1 𝑖 dist no 250 nm 𝑞 1 1 𝑖 rotAziL1 yes - 25 25 - Inf Inf 0 º 𝜃 0 " 1 1 𝑖 rotEleL1 yes - 25 25 - Inf Inf 0 º 𝜑 0 " 1 1 𝑖 rotAziR1 yes - 25 25 - Inf Inf 0 º 𝜃 1 " 1 1 𝑖 rotEleR1 yes - 25 25 - Inf Inf 0 º 𝜑 1 " 1 1 𝑖 rotAziL2 yes - 25 25 - Inf Inf 0 º 𝜃 0 ) 1 1 𝑖 rotEleL2 yes - 25 25 - Inf Inf 0 º 𝜑 0 ) 1 1 𝑖 rotAziR2 yes - 25 25 - Inf Inf 0 º 𝜃 1 " 1 1 𝑖 rotEleR2 yes - 25 25 - Inf Inf 0 º 𝜑 1 " 1 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 0 . 5 𝑤 & ’ 2 1 𝑒 x no inherited nm 𝑥 ! 2 1 𝑒 y no inherited nm 𝑦 ! 2 1 𝑒 z no inherited nm 𝑧 ! 2 1 𝑒 xrot no inherited º 𝛼 2 1 𝑒 yrot no inherited º 𝛽 2 1 𝑒 zrot no inherited º 𝛾 2 1 𝑒 variation no 7 nm 𝜖 2 1 𝑒 weight no inherited 𝑤 " 2 1 𝑒 xscale no inherited 𝑠 # 2 1 𝑒 yscale no inherited 𝑠 $ 2 1 𝑒 zscale no inherited 𝑠 % 2 1 𝑖 xMid yes - 30 30 - 500 500 inherited nm 𝑥 / 2 1 𝑖 yMid yes - 30 30 - 500 500 inherited nm 𝑦 / 2 1 𝑖 zMid yes - 30 30 - 500 500 inherited nm 𝑧 / 2 1 𝑖 r yes - Inf Inf 10 60 30 nm 𝑟 2 1 𝑖 dist no inherited nm 𝑞 2 1 𝑖 rotAziL1 yes - Inf Inf - 25 25 inherited º 𝜃 0 " 2 1 𝑖 rotEleL1 yes - Inf Inf - 25 25 inherited º 𝜑 0 " 2 1 𝑖 rotAziR1 yes - Inf Inf - 25 25 inherited º 𝜃 1 " 2 1 𝑖 rotEleR1 yes - Inf Inf - 25 25 inherited º 𝜑 1 " 2 1 𝑖 rotAziL2 yes - Inf Inf - 25 25 inherited º 𝜃 0 ) 2 1 𝑖 rotEleL2 yes - Inf Inf - 25 25 inherited º 𝜑 0 ) 2 1 𝑖 rotAziR2 yes - Inf Inf - 25 25 inherited º 𝜃 1 " 2 1 𝑖 rotEleR2 yes - Inf Inf - 25 25 inherited º 𝜑 1 " 2 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 inherited 𝑤 & ’ Note : In column Parameter type , 𝑖 and 𝑒 represent intrinsic and extrinsic parameters , respectively . In column Model , L1 represents layer 1 . In column initial value , a tilde operator represents a median value . The function 𝑝𝑐𝑎𝑅𝑜𝑡 ( 𝑥 * , 𝑦 * , ) outputs the angle between the x - axis and the first component of the localizations in the x - y plane . ‘inherited’ indicates that a value is inherited from its counterpart estimate in the last step . Other symbols have the 38 same meanings as in the main text . Abbreviations : LB / UB : lower / upper boundaries . Blanks indicate values not applicable . Supplementary Table 5 . Fitting settings used in this study for Nup96 in dual - color data . Step Model Parameter type Internal parameter name Free parameter Relative Absolute Initial value Unit Symbol LB UB LB UB 1 1 𝑒 x yes - 50 50 - 150 150 𝑥0 * nm 𝑥 ! 1 1 𝑒 y yes - 50 50 - 150 150 𝑦0 * nm 𝑦 ! 1 1 𝑒 z yes - 100 20 - 300 300 𝑧̃ * − 40 nm 𝑧 ! 1 1 𝑒 weight no 1 𝑤 " 1 1 𝑒 xrot yes - 30 30 - inf inf 0 º 𝛼 1 1 𝑒 yrot yes - 30 30 - inf inf 0 º 𝛽 1 1 𝑒 zrot no 0 º 𝛾 1 1 𝑒 xscale no 1 𝑠 # 1 1 𝑒 yscale no 1 𝑠 $ 1 1 𝑒 zscale no 1 𝑠 % 1 1 𝑒 variation no 0 nm 𝜖 1 2 𝑒 x no 0 nm 𝑥 ! 1 2 𝑒 y no 0 nm 𝑦 ! 1 2 𝑒 z yes - 30 100 0 300 40 nm 𝑧 ! 1 2 𝑒 xrot no 0 º 𝛼 1 2 𝑒 yrot no 0 º 𝛽 1 2 𝑒 zrot no 0 º 𝛾 1 2 𝑒 variation no 0 nm 𝜖 1 2 𝑒 weight no 1 𝑤 " 1 2 𝑒 xscale no 0 𝑠 # 1 2 𝑒 yscale no 0 𝑠 $ 1 2 𝑒 zscale no 0 𝑠 % 1 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 0 𝑤 & ’ 2 1 𝑒 x yes - 20 20 - 150 150 𝑥7 ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ " ] nm 𝑥 ! 2 1 𝑒 y yes - 20 20 - 150 150 𝑦7 ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ ) ] nm 𝑦 ! 2 1 𝑒 z yes - 20 20 - 300 300 𝑧̂ ! " , " + 𝜙 ( 𝑧̂ ! " , ) ) [ . ] nm 𝑧 ! 2 1 𝑒 xrot yes - 10 10 - Inf Inf inherited º 𝛼 2 1 𝑒 yrot yes - 10 10 - Inf Inf inherited º 𝛽 2 1 𝑒 zrot yes - 180 180 - inf inf [ 1 360 ] º 𝑟 2 1 𝑒 variation yes - 10 10 1 20 5 nm 𝜖 2 1 𝑒 weight no 1 𝑤 " 2 1 𝑒 xscale no 1 𝑠 # 2 1 𝑒 yscale no 1 𝑠 $ 2 1 𝑒 zscale no 1 𝑠 % 2 1 𝑖 ringDistance no 50 . 2 nm 𝑠 2 1 𝑖 radius no 53 . 4 nm 𝑟 2 1 𝑖 cornerDegree no 12 º 𝜓 2 1 𝑖 azimuthalShift no 8 . 8 º 𝜃 2 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 inherited 𝑤 & ’ Note : In column Parameter type , 𝑖 and 𝑒 represent intrinsic and extrinsic parameters , respectively . In column Model , L1 represents layer 1 . In column initial value , a tilde operator represents a median value , a hat operator indicates a parameter estimate , and superscripts represent steps and models ( e . g . , 𝑧̂ " # , $ means the estimate of 𝑧 " from model 2 in step 1 ) . The function 𝑧⃗ [ ! ] ′ = 𝜙 ( 𝑧 ) [ ! ] outputs the k th element of the vector 𝑧⃗ ′ derived from 𝑧⃗ = [ 0 0 𝑧 ] rotated by the rotation matrix constructed using > 𝛼 @ # , # , 𝛽B # , # , 𝑟̂ # , # D as the angles { 𝛼 , 𝛽 , 𝛾 } in the equation ( 11 ) . ‘inherited’ indicates that a value is inherited from its counterpart estimate in the last step . Other symbols have the same meanings as in the main text . Abbreviations : LB / UB : lower / upper boundaries . Blanks indicate values not applicable . 39 Supplementary Table 6 . Fitting settings used in this study for endocytic sites in yeast . Step Model Parameter type Internal parameter name Free parameter Relative Absolute Initial value Unit Symbol LB UB LB UB 1 1 𝑒 x yes - 30 30 - 150 150 0 nm 𝑥 ! 1 1 𝑒 y yes - 50 50 - 150 150 𝑦0 * " nm 𝑦 ! 1 1 𝑒 zrot yes - 15 15 - Inf Inf 0 º 𝛾 1 1 𝑒 variation no 0 nm 𝜖 1 1 𝑒 weight no 1 𝑤 " 1 1 𝑒 xscale no 1 𝑠 # 1 1 𝑒 yscale no 1 𝑠 $ 1 1 𝑖 innerRadius no 40 nm 𝑟 1 1 𝑖 outerRadius no 70 nm 𝑞 1 1 𝑖 thickness no 60 nm 𝑡 1 2 𝑒 x no 0 nm 𝑥 ! 1 2 𝑒 y yes - 300 50 - 200 200 0 nm 𝑦 ! 1 2 𝑒 zrot no 0 º 𝛾 1 2 𝑒 variation no 0 nm 𝜖 1 2 𝑒 weight no 1 𝑤 " 1 2 𝑒 xscale no 0 𝑠 # 1 2 𝑒 yscale no 0 𝑠 $ 1 2 𝑖 a no 85 nm 𝑎 1 2 𝑖 b yes 0 250 1 270 0 nm 𝑏 1 L1 𝑒 weight yes - 1 1 0 . 001 0 . 999 0 𝑤 & ’ 1 L2 𝑒 weight yes - 1 1 0 . 001 0 . 999 0 𝑤 & ’ Note : In column Parameter type , 𝑖 and 𝑒 represent intrinsic and extrinsic parameters , respectively . In column Model , L1 and L2 represent layer 1 and layer 2 . In column initial value , a tilde operator represents a median value , a hat operator indicates a parameter estimate , and superscripts represent channels ( e . g . , 𝑦G ! # means the median of 𝑦 2 , or y positions of localizations , in channel 1 ) . Other symbols have the same meanings as in the main text . Abbreviations : LB / UB : lower / upper boundaries . Blanks indicate values not applicable .