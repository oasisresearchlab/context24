The Ultrasonic Distance Alarm System Based on MSP430F449 Li Zhengdong 1 , Huang Shuai 1 1 Staff room of Communication Tactics Chongqing Communication College Chongqing , China gusi @ foxmail . com Lin Zhaoyang 2 , Luo Weifeng 1 , He Daxi 1 2 Scientific research department College of National Defense Information Science Wuhan , China zhangyang @ sina . com Abstract — The principle ultrasonic distance measurement was introduced . Using Texas Instrument ' s microcontroller MSP430F449 and ultrasonic sensor TCT40 - 16F , an ultrasonic measurement and alarm system with high precision was designed . Adopting the method of MJ echo capture , the system can measure the distance well and truly , and can send the real - time distance data to the LCD screen of system . Once the distance was less than the setting value , the system would alarm immediately . In addition , the system uses temperature sensor for temperature compensation , which effectively improves the ranging accuracy . Experimental results show that the system has high range accuracy , and can complete the distance measuring task in cars . Keywords - Alarm ; Ultrasonic ; Measure ; Transmit ; Accuracy I . I NTRODUCTION Nowadays , ultrasonic distance measurement has been more widely used in liquid measurement and construction measurement . As a modern measure method , ultrasonic has lots of strongpoint , such as non - contacting measured object , with a wide measurement range , not be affected by light and the color of the detected objects , the easy control . Based on the principle of ultrasonic distance measurement , using the MJ [ 1 - 3 ] value method to capture the echo method , adopting Texas Instrument ' s microcontroller MSP430F449 [ 4 , 5 ] and ultrasonic sensor TCT40 - 16F , this paper designed an ultrasonic measurement and alarm system in cars with high precision , and finished the hardware producing and the software debugging . II . T HEORY OF U LTRASONIC D ISTANCE M EASUREMENT Ultrasonic ranging mainly uses the reflection characteristics of ultrasonic to measure . Ultrasonic transmitter continues to emit ultrasonic . Once the ultrasonic reach the surface of obstacle through the medium , the reflected wave will spread through the media and return to the ultrasonic receiver . The ultrasonic receiver will translate the sound waves into the electrical signals and send it to the control system . The diagram of ultrasonic distance measurement is shown in figure 1 . Micro controller obstacle transmitter receiver Figure 1 . The block diagrams of the ultrasonic distance alarm system III . A RCHITECTURE OF H ARDWARE The system consists of MSP430F449 microcontroller , ultrasonic transmitter module , ultrasonic receiver module , LCD display module , temperature measurement module , voice alarm module . The system uses the sending and receiving ultrasonic sensor as the signal terminals . When the microcontroller receives an external ranging command , MSP430F449 will generate 40KHz frequency signal to drive the ultrasonic emission sensor . The temperature sensor DSl8820 will collect the temperature data and send it to the microcontroller for further correction . Once the ultrasonic receiving sensor received the signal , the signal would pass through filter , amplifier and would be sent to the comparator of MSP430F449 . The microcontroller captures the current value of Time A . Through the theory of ultrasonic , the distance will be calculated and shown in LCD screen immediately . If the distance is less than the threshold , the system would startup voice alarm . A . The main microcontroller The Texas Instruments MSP430 family of ultra low - power microcontrollers consists of several devices featuring different sets of peripherals targeted for various applications . The architecture , combined with five low - power modes , is optimized to achieve extended battery life in portable measurement applications . The device features a powerful 16 - bit RISC CPU , 16 - bit registers , and constant generators that contribute to maximum code efficiency . The digitally controlled oscillator ( DCO ) allows wake - up from low - power modes to active mode in less than 6 us . 2013 Fifth Conference on Measuring Technology and Mechatronics Automation 978 - 0 - 7695 - 4932 - 3 / 12 $ 26 . 00 © 2012 IEEE DOI 10 . 1109 / ICMTMA . 2013 . 307 1249 2013 Fifth Conference on Measuring Technology and Mechatronics Automation 978 - 0 - 7695 - 4932 - 3 / 12 $ 26 . 00 © 2012 IEEE DOI 10 . 1109 / ICMTMA . 2013 . 307 1249 The MSP430F449 is a microcontroller configurations with two 16 - bit timers , a high - performance 12 - bit A / D converter , dual 12 - bit D / A converters , three configurable operational amplifiers , one universal serial communication interface ( USCI ) , one universal synchronous / asynchronous communication interface ( USART ) , DMA , 80 I / O pins , and a liquid crystal display ( LCD ) driver with regulated charge pump . In view of these advantages , the system uses the MSP430F449 as the main controller . B . The module of the transmitter The System uses two separate transmitting and receiving piezoelectric ultrasonic sensors and chooses the resonant method using computer control , which can force the piezoelectric vibration . The transmitting drive circuit is realized by the bridge circuit made up of the binary non - gate CD4049 [ 6 ] . In CD4049 , a non - gate provide 180° of phase shift for one side of the drive , and the other side of the signal is driven by the phase signal . This kind of structure doubles the output voltage . Two doors are paralleled , which will provide sufficient drive current for each side of the transmitting sensor . By debugging , the circuit can be amended to the best state , in order to drive the ultrasonic sensor to transmit ultrasonic . Ultrasonic transmitter module circuits are shown in figure 2 . Figure 2 . The Circuits of ultrasonic transmitter module C . The module of the receiver Ultrasonic receiver module uses TI ' s high - speed op amp TLV2771 [ 7 ] for signal amplification . TLV2771 has high gain bandwidth and can provide high gain in 40KHz . The high - Q of receiving sensor can provide excellent frequency characteristics , except for 40KHz frequency signal . In MSP430F449 , the internal reference level of integrated comparator A is selected as 0 . 5Vcc . When the echo is received , if the sensor voltage is higher than the reference level , then the microcontroller will trigger the output of comparator A CAOUT , and the comparator A capture interrupt immediately . At the same time , the count value of Timer A is attained from the capture / compare register CCR1 . This value is the time from the ultrasonic sensor launching ultrasonic to receiving ultrasonic . Ultrasonic receiver module circuits are shown in figure 3 . Figure 3 . The Circuits of ultrasonic receiver module D . The module of the temperature detection As the velocity is affected by temperature , to improve the measurement accuracy , the system design temperature detection circuit , which uses digital sensors DSl8B20 [ 8 ] to collect temperature signal . DSl8B20 is a single - wire serial digital temperature sensors and it can be connected directly with a microcontroller . The measurement range is in - 55 (cid:263) ~ 125 (cid:263) , and the measurement accuracy is 0 . 5 (cid:263) when in - 10 (cid:263) ~ 85 (cid:263) . According to actual measurements of temperature , the ultrasonic velocity can be corrected . E . The module of the alarm Voice circuit uses Winbond ' s voice chip ISD4004 [ 9 ] as the main chip . ISD4004 is a long non - volatile voice chip , whose working voltage is 3V . The sampling frequency can be 4 . 0KHz , 5 . 3KHz , 6 . 4KHz and 8 . 0KHz , and the corresponding single recording time are 8min , 10min , 12min and 16min . ISD4004 storages direct analog signal , so it has excellent sound quality . IV . A RCHITECTURE OF S OFTWARE When the power is on , the system will initialize all data at first , and then will maintain in sleep mode until MSP430F449 basic timer 1 is interrupt and their BT _ IST return activity patterns , which start a measurement cycle . The timer A is set to 16 bits counting mode , and the ACLK is selected as the clock source . Capture / compare register CCR1 is set to compare mode , and the initial value is set to 12 so as to the P1 . 5 output 12 cycles of 40KHz pulse sequences . Next there is a 36 ACLK cycles of delay to ensure the stability of the sensor output . This is realized by setting the initial value of CCR1 to 36 . When the CCR1 is in the wait state , the controller maintains in LPM0 state and is ready to receive the echo . Once the echo signal passed the filter and the amplifier and reached the microcontroller comparator A , the comparator provides an immediate capture interrupt . The 1250 1250 value of Timer A is captured from the register CCR1 , which is the time from the ultrasonic sensor launching ultrasonic to receiving ultrasonic . The value of counter should add 48 so as to compensate for 12 cycles pulse and 36 cycles of delay . After adjusted , the value of CCR1 is the exact time of the whole ultrasonic measurement . Then , the actual distance can be calculated by the formula and can real - time display on the LCD screen . Also , once the detected distance is less than the threshold , the voice alarm system will startup . V . T HE E XPERIMENTAL R ESULTS AND A NALYSIS When the distance is between 200mm to 1000mm , and the ambient temperature change from 0 (cid:263) ~ 40 (cid:263) , many times actual tests are finished . As the system increases the temperature compensation systems and software technologies , they greatly improve the accuracy of the measurement system . Table I shows the comparison of actual distance and measurement distance when the ambient temperature is 26 (cid:263) . The results confirm the effectiveness and reliability of the design . When the distance range between 200mm and 1000mm , the maximum measurement error is less than 6mm , and it fully meet the requirements of most occasions . TABLE I C OMPARISON OF A CTUAL D ISTANCE AND M EASURE D ISTANCE (cid:3) (cid:36)(cid:36)(cid:70)(cid:87)(cid:88)(cid:68)(cid:79)(cid:3) (cid:39)(cid:76)(cid:86)(cid:87)(cid:68)(cid:81)(cid:70)(cid:72)(cid:3) (cid:80)(cid:80)(cid:3)(cid:3) (cid:48)(cid:72)(cid:68)(cid:86)(cid:88)(cid:85)(cid:72)(cid:3) (cid:39)(cid:76)(cid:86)(cid:87)(cid:68)(cid:81)(cid:70)(cid:72)(cid:3) (cid:80)(cid:80)(cid:3)(cid:3) (cid:36)(cid:69)(cid:86)(cid:82)(cid:79)(cid:88)(cid:87)(cid:72)(cid:3) (cid:40)(cid:85)(cid:85)(cid:82)(cid:85)(cid:3) (cid:80)(cid:80)(cid:3)(cid:3) (cid:20)(cid:19)(cid:19)(cid:3) (cid:37)(cid:79)(cid:76)(cid:81)(cid:71)(cid:3) (cid:71)(cid:76)(cid:86)(cid:87)(cid:68)(cid:81)(cid:70)(cid:72)(cid:3) (cid:18)(cid:3) (cid:21)(cid:19)(cid:19)(cid:3) (cid:20)(cid:28)(cid:26)(cid:3) (cid:16)(cid:22)(cid:3) (cid:22)(cid:19)(cid:19)(cid:3) (cid:22)(cid:19)(cid:23)(cid:3) (cid:23)(cid:3) (cid:23)(cid:19)(cid:19)(cid:3) (cid:23)(cid:19)(cid:21)(cid:3) (cid:21)(cid:3) (cid:24)(cid:19)(cid:19)(cid:3) (cid:24)(cid:19)(cid:23)(cid:3) (cid:23)(cid:3) (cid:25)(cid:19)(cid:19)(cid:3) (cid:24)(cid:28)(cid:24)(cid:3) (cid:16)(cid:24)(cid:3) (cid:26)(cid:19)(cid:19)(cid:3) (cid:25)(cid:28)(cid:23)(cid:3) (cid:16)(cid:25)(cid:3) (cid:27)(cid:19)(cid:19)(cid:3) (cid:26)(cid:28)(cid:23)(cid:3) (cid:16)(cid:25)(cid:3) (cid:28)(cid:19)(cid:19)(cid:3) (cid:28)(cid:19)(cid:22)(cid:3) (cid:22)(cid:3) (cid:20)(cid:19)(cid:19)(cid:19)(cid:3) (cid:28)(cid:28)(cid:27)(cid:3) (cid:16)(cid:21)(cid:3) VI . C ONCLUSIONS In this paper , MSP430F449 is used as the core of ultrasonic measurement warning system in cars . The system can realize real - time detection of the distance , and simultaneously display on the LCD screen on the system . Once the distance is less than a certain threshold , the system will immediately initiate a voice alarm . In addition , the system uses temperature sensor for temperature compensation , so as to effectively improve the range accuracy . Experimental results show that the system circuit design is reasonable , its accuracy is high , and it can meet the use of reversing radar parking assist system . Therefore , this design has great value and broad application prospect . R EFERENCES [ 1 ] Angrisani L , Dapante P , D ’ Apdzzo M . Detection of echoes from multilayer structures by using the wavelet transform [ C ] , IEEE Instrumentation and Measurement Technology Conference – IMTC ’ 96 . Brussels , Belgium : [ s . n . ] , 1996 : 895 - 900 . [ 2 ] Daponte P , Fazio G , Molinaro A . Detection of echoes using Time - Frequency Analysis [ C ] , IEEE Instrumentation and Measurement Technology Conference – IMTC ’ 99 . Venice , Italy : [ s . n . ] , 1999 : 1687 - 1692 . [ 3 ] Barshan , Billur . Fast processing techniques for accurate ultrasonic range measurements [ J ] . Measurement Science and Technology , 2000 . 11 ( 1 ) : 45 - 50 [ 4 ] ] Texas Instruments . MSP430Fx44x Mixed Signal Microcontroller [ OL ] 2007 . 10 , http : / / www . ti . com . cn [ 5 ] Texas Instruments . MSP430x4xx Family User ’ s Guide [ OL ] 2009 . 04 , http : / / www . ti . com . cn [ 6 ] Texas Instruments . CD4049 [ OL ] 2009 . 04 , http : / / www . ti . com . cn [ 7 ] Texas Instruments . 2 . 7 - V High - Slew - Rate Rail - to - Rail Output Operational Amplifiers with Shutdown [ OL ] 2001 . 03 , http : / / www . ti . com . cn [ 8 ] Dallas Semiconductor Inc . High - Precision 1 - Wire Digital Thermometer [ OL ] , 2008 . 04 , http : / / china . maxim - ic . com [ 9 ] Winbond Electronic Corporation America . Single - Chip Voice Record / Playback Devices [ OL ] 2000 . 08 , http : / / www . Winbond . com 1251 1251