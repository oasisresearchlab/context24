Residual - based Shadings for Visualizing ( Conditional ) Independence Achim Zeileis David Meyer Kurt Hornik http : / / www . ci . tuwien . ac . at / ~ zeileis / Overview • The independence problem in 2 - way contingency tables – standard approach : χ 2 test – alternative approach : max test • Visualizing the independence problem – association plots – mosaic plots • Extensions – visualization & signiﬁcance testing – perceptually uniform HCL colors – conditional independence in multi - way tables – implementation in grid The independence problem Standard approach : • Analyze the relationship between two categorical vari - ables based on the associated 2 - way contingency table . • Measure the discrepancy between observed frequen - cies { n ij } and expected frequencies under indepen - dence { ˆ n ij } by the Pearson residuals : r ij = n ij − ˆ n ij q ˆ n ij . • Use the Pearson X 2 statistic for testing : X 2 = X ij r 2 ij , which has an unconditional asymptotic χ 2 distribution . The independence problem Alternative approach ( es ) : • There are many conceivable functionals λ ( · ) which lead to reasonable test statistics λ ( { r ij } ) . • In particular : M = max ij | r ij | . Then , every residual exceeding the critical value c α vio - lates the null hypothesis at level α . • Instead of relying on unconditional limiting distribu - tions , perform a permutation test , either by simulating or computing the conditional permutation distribution of λ ( { r ij } ) . The independence problem Treatment and improvement in a double - blind clinical trial for 84 patients with rheumatoid arthritis : Improvement Treatment None Some Marked Total Placebo 29 7 7 43 Treated 13 7 21 41 Total 42 14 28 84 X 2 = 13 . 055 p = 0 . 0014 M = 1 . 987 p = 0 . 0018 Visualization Mosaic plot : Display in which the sizes of the mosaic tiles is proportional to the observed frequencies { n ij } . Constructed by recursive paritioning with respect to condi - tional relative frequencies . Association plot : Display for the Pearson residuals { r ij } and the raw residu - als { n ij − ˆ n ij } in an rectangular array . Visualization Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Visualization Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Friendly shading Colors are commonly used to enhance these plots . In par - ticular , Friendly ( 1994 ) suggested shadings for mosaic dis - plays . In R these are implemented based on HSV colors . The HSV color space is one of the most common imple - mentations of color in many computer packages . Hue , sat - uration and value range in [ 0 , 1 ] . Friendly shading The hue is typically used to code the sign of the residuals : • blue ( h = 2 / 3 ) for positive residuals ( | r ij | > 0 ) , • red ( h = 0 ) for negative residuals ( | r ij | < 0 ) . Friendly’s extended mosaic displays use the saturation to code the absolute size of the residuals : • no saturation ( s = 0 ) for | r ij | < 2 , • medium saturation ( s = 0 . 5 ) for 2 ≤ | r ij | < 4 , • full saturation ( s = 1 ) for | r ij | ≥ 4 . Friendly shading 0 . 5 0 . 75 1 0 . 5 0 . 75 1 1 0 . 75 0 . 5 0 . 25 0 0 . 25 0 . 5 0 . 75 1 hue = 0 hue = 2 / 3 saturation v a l ue Friendly shading −1 . 94 0 . 00 1 . 98 Pearsonresiduals : Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Problem 1 : Signiﬁcance Intuition : • No color in the plot conveys the impression that there is no signiﬁcant departure from independence . • Vice versa , colored cells would convey the impression that there is signiﬁcant dependence . Currently , both is not true . Problem 1 : Signiﬁcance Approach 1 : use the 90 % and 99 % critical values for the max statistic M instead of 2 and 4 . • color ⇔ signiﬁcance • highlights the cells which “cause” the dependence ( if any ) . But : This does not work for the χ 2 test ( or any other func - tional λ ( · ) ) . Approach 2 : Use value to code the result of a signiﬁcance test for independence , i . e . , use darker colors to code non - signiﬁcance . Problem 1 : Signiﬁcance −1 . 94 −1 . 71 −1 . 21 0 . 00 1 . 21 1 . 71 1 . 98 Pearsonresiduals : Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Problem 2 : HSV Colors Disadvantages of HSV - based shadings : • Flashy colors good for drawing attention to a plot , but hard to look at . • Perceptually not uniform : The three perceptual dimen - sions of the human visual system ( hue , lightness , satu - ration ) are poorly mapped to the three dimensions of the HSV color space . In particular , saturation is not uniform across different hues . • This can lead to color - caused optical illusions in graphs . • White is not very suitable as a neutral color , grey con - veys neutrality much better . Problem 2 : HSV Colors Perceptually uniform color spaces and color palettes in - clude : • Munsell color notation • ColorBrewer . org • CIELAB and CIELUV spaces Ihaka ( 2003 ) discusses how the CIELUV color space can conveniently be used for statistical graphs by taking polar coordinates → HCL colors . HCL colors are deﬁned by hue ( in [ 0 , 360 ] ) , chroma and luminance ( in [ 0 , 100 ] ) . HCL space essentially looks like a double cone . Problem 2 : HSV Colors 50 75 100 50 75 100 100 75 50 25 0 25 50 75 100 hue = 0 hue = 260 chroma l u m i nan c e Problem 2 : HSV Colors −1 . 94 −1 . 71 −1 . 21 0 . 00 1 . 21 1 . 71 1 . 98 Pearsonresiduals : Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Problem 2 : HSV Colors −1 . 94 −1 . 71 −1 . 21 0 . 00 1 . 21 1 . 71 1 . 98 Pearsonresiduals : Improved T r ea t m e n t T r ea t ed P l a c ebo None Some Marked Conditional independence Principal idea of the mosaic plot : • subdivision of tiles according to conditional probabilities → can also be used for multi - way tables Can easily be used for visualizing complete / joint / conditional indpendence . Hence , mosaic displays are well - suited for visualizing hier - archical log - linear models . The same idea does not directly apply to association plots . Conditional independence Conditional indpendence : Admission ⊥⊥ Gender | Department at UC Berkeley . −3 . 13 −2 . 14 −1 . 70 0 . 00 1 . 70 2 . 14 Pearsonresiduals : Dept Admit G e nd e r A F e m a l e Ad Rj M a l e B Ad Rj C Ad Rj D Ad Rj E Ad Rj F Ad Rj Conditional independence Correspondence : • conditioning in the model ( → shading of residuals ) • conditioning in the visual display → can also be done in Trellis - like layout This idea does also work for association plots . Conditional independence Dept = A Admit G e nd e r F e m a l e M a l e Admit Reject Dept = B Admit G e n d e r F e m a l e M a l e Admit Reject Dept = C Admit G e nd e r F e m a l e M a l e Admit Reject Dept = D Admit G e n d e r F e m a l e M a l e Admit Reject Dept = E Admit G e nd e r F e m a l e M a l e Admit Reject Dept = F Admit G e n d e r F e m a l e M a l e Admit Reject Conditional independence Dept = A Admit G e nd e r F e m a l e M a l e Admit Reject Dept = B Admit G e n d e r F e m a l e M a l e Admit Reject Dept = C Admit G e nd e r F e m a l e M a l e Admit Reject Dept = D Admit G e n d e r F e m a l e M a l e Admit Reject Dept = E Admit G e nd e r F e m a l e M a l e Admit Reject Dept = F Admit G e n d e r F e m a l e M a l e Admit Reject Implementation in grid The graphics engine grid overcomes the old R concept of plots with a plot region surrounded by a margin . grid is • based on generic drawing regions ( viewports ) , • allows for plotting to relative coordinates , • is also the basis for an implementation of Trellis graphics called lattice . ( see Murrell , 2002 ) Thus , the new implementation of mosaic and association plots makes them easily reusable , e . g . , in Trellis - like lay - outs . Implementation in grid The functions themselves are highly extensible via panel functions and give ﬁne control over • graphical parameters , • labeling , • spacing . These ( and many more functions ) are provided in the pack - age vcd for visualizing categorical data , available from the Comprehensive R Archive Network http : / / CRAN . R - project . org /