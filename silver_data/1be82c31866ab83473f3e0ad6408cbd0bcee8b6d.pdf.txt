Lawrence Berkeley National Laboratory Recent Work Title Real - space refinement in PHENIX for cryo - EM and crystallography Permalink https : / / escholarship . org / uc / item / 97f877th Journal Acta Crystallographica Section D : Structural Biology , 74 ( 6 ) Authors Afonine , PV Poon , BK Read , RJ et al . Publication Date 2018 - 06 - 01 DOI 10 . 1107 / S2059798318006551 Peer reviewed eScholarship . org Powered by the California Digital Library University of California research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 https : / / doi . org / 10 . 1107 / S2059798318006551 531 Received 10 January 2018 Accepted 27 April 2018 Keywords : real - space refinement ; cryo - EM ; crystallography ; map interpolation ; atomic - centered targets ; PHENIX . Real - space refinement in PHENIX for cryo - EM and crystallography Pavel V . Afonine , a , b * Billy K . Poon , a Randy J . Read , c Oleg V . Sobolev , a Thomas C . Terwilliger , d , e Alexandre Urzhumtsev f , g and Paul D . Adams a , h a Molecular Biophysics and Integrated Bioimaging Division , Lawrence Berkeley National Laboratory , Berkeley , CA 94720 , USA , b Department of Physics and International Centre for Quantum and Molecular Structures , Shanghai University , Shanghai 200444 , People’s Republic of China , c Cambridge Institute for Medical Research , University of Cambridge , Wellcome Trust / MRC Building , Hills Road , Cambridge CB2 0XY , England , d Bioscience Division , Los Alamos National Laboratory , Los Alamos , NM 87545 , USA , e New Mexico Consortium , Los Alamos , NM 87545 , USA , f Faculte´ des Sciences et Technologies , Universite´ de Lorraine , BP 239 , 54506 Vandoeuvre - les - Nancy , France , g Centre for Integrative Biology , IGBMC , CNRS – INSERM – UdS , 1 Rue Laurent Fries , BP 10142 , 67404 Illkirch , France , and h Department of Bioengineering , University of California Berkeley , Berkeley , California , USA . * Correspondence e - mail : pafonine @ lbl . gov This article describes the implementation of real - space reﬁnement in the phenix . real _ space _ reﬁne program from the PHENIX suite . The use of a simpliﬁed reﬁnement target function enables very fast calculation , which in turn makes it possible to identify optimal data - restraint weights as part of routine reﬁnements with little runtime cost . Reﬁnement of atomic models against low - resolution data beneﬁts from the inclusion of as much additional information as is available . In addition to standard restraints on covalent geometry , phenix . real _ space _ reﬁne makes use of extra information such as secondary - structure and rotamer - speciﬁc restraints , as well as restraints or constraints on internal molecular symmetry . The re - reﬁnement of 385 cryo - EM - derived models available in the Protein Data Bank at resolutions of 6 A˚ or better shows signiﬁcant improvement of the models and of the ﬁt of these models to the target maps . 1 . Introduction Improvements in the cryo - electron microscopy ( cryo - EM ) technique have led to a rapid increase in the number of high - resolution three - dimensional reconstructions that can be interpreted with atomic models ( Fig . 1 ) . This has prompted a number of new developments in PHENIX ( Adams et al . , 2010 ) to support the method , from model building ( Terwilliger , Adams et al . , 2018 ) , map improvement ( Terwilliger , Sobolev et al . , 2018 ) and reﬁnement ( Afonine et al . , 2013 ) to model validation ( Afonine et al . , 2018 ) . In this manuscript , we focus on atomic model reﬁnement using a map ( primarily cryo - EM , but the same algorithms and software are also applicable to crystallographic maps ) . Model reﬁnement is an optimization problem and as such it requires the deﬁnition of three entities ( for reviews , see Tronrud , 2004 ; Watkin , 2008 ; Afonine et al . , 2012 , 2015 ) . Firstly , the model , i . e . a mathematical construct that explains the experimental data , with an associated set of reﬁnable parameters : in this case an atomic model with coordinates whose positions can be varied to improve the ﬁt to the data . Seondly , the target function that links the model parameters to the experimental data : this function scores model - to - data ﬁt and therefore guides reﬁnement . Finally , an optimization method that changes the values of reﬁnable model parameters such that the model agreement with the experimental data is improved . In PHENIX , gradient methods are used through ISSN 2059 - 7983 L - BFGS ( Liu & Nocedal , 1989 ) for this goal . If the target function is expressed through diffraction intensities or struc - ture factors , reﬁnement is usually referred to as reciprocal - space , or Fourier - space , reﬁnement ( FSR ) . Alternatively , a target function may be formulated in terms of a map : a Fourier synthesis in the case of crystallography or a three - dimensional reconstruction from projections in the case of cryo - EM . Such reﬁnement is referred to as real - space reﬁnement ( RSR ) . In both cases the targets are the sums over a large number of similar terms corresponding to either reﬂections ( FSR ) or map grid points ( RSR ) . A key methodological difference is that for RSR each term depends on only a few atoms , while for FSR each term depends on all model parameters . Most modern macromolecular reﬁnement programs were developed for crystallographic data and therefore perform reﬁnement in reciprocal space , at least as their main mode of operation ( see Table 1 in Afonine et al . , 2015 ) . This work focuses on the real - space reﬁnement of coordinates of atomic models . In cryo - EM studies real - space reﬁnement is a natural choice because a three - dimensional map is the output of the single - particle image - reconstruction method ( see , for example , Frank , 2006 ) and does not change in a fundamental way as the atomic model is improved . This is not the case for crystallo - graphy , where the experimental data are diffraction intensities , and the associated and vital phase information has to be obtained indirectly . In crystallography , obtaining the best phases typically involves their calculation from atomic models , in turn making the resulting maps model - biased ( see , for example , Hodel et al . , 1992 ) . Although FSR methods are predominant in crystallographic reﬁnement , RSR is attractive in some contexts as it makes it possible to reﬁne parts of the model locally and fast , and model incompleteness does not inﬂuence reﬁnement as it does for FSR ( Lunin et al . , 2002 ) . For this reason RSR has been particularly popular in the context of interactive model - building software such as FRODO , O ( Jones , 1978 ; Jones et al . , 1991 ) , MAIN ( Turk , 2013 ) and Coot ( Emsley & Cowtan , 2004 ; Emsley et al . , 2010 ) . In the case of cryo - EM an atomic model can also be reﬁned using a reciprocal - space target . This can be achieved by converting the map into Fourier coefﬁcients . These Fourier coefﬁcients can then be used in reciprocal - space reﬁnement using standard reﬁnement protocols that are well established for crystallographic structure reﬁnement ( see , for example , Cheng et al . , 2011 ; Baker et al . , 2013 ; Brown et al . , 2015 ) . We note , however , that unless the map is converted to the full corresponding set of Fourier coefﬁcients ( and not a subset containing only a sphere limited to the stated resolution ) this conversion may not be lossless . To address the emerging structure - reﬁnement needs of the rapidly growing ﬁeld of cryo - EM , the phenix . real _ space _ reﬁne program ( Afonine et al . , 2013 ) , which is capable of the reﬁnement of atomic models against maps , has been intro - duced into the PHENIX suite . It is not limited to cryo - EM and can also be used in crystallographic reﬁnement ( X - ray , elec - tron or neutron ) . In this paper , we describe the implementa - tion of the phenix . real _ space _ reﬁne program and demonstrate its performance by applications to simulated data and to cryo - EM models in the PDB ( Bernstein et al . , 1977 ; Berman et al . , 2000 ) and corresponding maps in the EMDB ( Henrick et al . , 2003 ) . This is a work in progress , and further details and advances will be reported as the program evolves . To date , phenix . real _ space _ reﬁne has been used in a number of docu - mented structural studies ( see , for example , Fischer et al . , 2015 ; Shalev - Benami et al . , 2016 ; Chua et al . , 2016 ; Ahmed et al . , 2016 ; Yang et al . , 2016 ; Gao et al . , 2016 ; Chen et al . , 2016 ; Bhardwaj et al . , 2016 ; Lokareddy et al . , 2017 ; Hryc et al . , 2017 ; Ahmed et al . , 2017 ; Demo et al . , 2017 ; Paulino et al . , 2017 ; Liu et al . , 2017 ) . 2 . Methods 2 . 1 . Refinement flowchart Fig . 2 shows the model - reﬁnement ﬂowchart as it is imple - mented in phenix . real _ space _ reﬁne . This is very similar to the reciprocal - space reﬁnement workﬂow implemented in phenix . reﬁne ( see Fig . 1 in Afonine et al . , 2012 ) . The program begins by reading a model ﬁle , in PDB or mmCIF format , map data ( as an actual map in MRC / CCP4 format or as Fourier map coefﬁcients in MTZ format ) and other parameters , such as resolution ( if a map is provided ) or additional restraint deﬁnitions for novel ligands , internal molecular symmetry ( e . g . NCS in crystallography ) or secondary structure . Once inputs have been read , the program proceeds to calculations that constitute a set of tasks repeated multiple times ( macro - cycles ) . Tasks to be performed during the reﬁnement are deﬁned by the program automatically and / or by the user . In its default mode the program will only perform gradient - driven minimization of the entire model . Other nondefault tasks allow optimization using simulated annealing ( SA ; Bru¨nger et al . , 1987 ) , morphing ( Terwilliger et al . , 2013 ) , rigid - body reﬁnement ( see Afonine et al . , 2009 and references therein ) and systematic residue side - chain optim - izations using grid searches in torsion (cid:2) - angle space ( Oldﬁeld , 2001 ) . Parts of the model related by internal symmetry are determined automatically , if available , or can be deﬁned by the user . In the presence of such internal symmetry , restraints or constraints can be applied between the coordinates of related research papers 532 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Figure 1 Number of cryo - EM - derived models in the PDB at resolutions of 6 A˚ or better . molecules . The operators relating molecules can also be reﬁned . The result of reﬁnement , i . e . the reﬁned model , is output as a ﬁle in PDB or mmCIF format . Central to almost all tasks performed within a reﬁnement macro - cycle is the target function . Its choice is the key for the success of reﬁnement , i . e . efﬁcient convergence to an improved model . Also of the same importance is the assess - ment of reﬁnement progress by quantifying model quality and the goodness of model - to - map ﬁt throughout the entire process . Some relevant points are discussed below . 2 . 2 . Refinement target function Macromolecular cryo - EM or crystallographic experimental data are almost always of insufﬁcient quality to reﬁne para - meters of atomic models individually . To make reﬁnement practical , restraints or constraints are almost always used in order to incorporate extra information into reﬁnement , and the corresponding procedures are called restrained or constrained reﬁnement . In restrained reﬁnement the target function is a sum of data - based and restraints - based compo - nents : T ¼ T data þ w restraints (cid:3) T restraints : ð 1 Þ The ﬁrst term scores the model - to - data ﬁt and the second term incorporates a priori information about the model . The weight w restraints balances the contribution of restraints to maximize the model - to - data ﬁt while also obeying the a priori infor - mation , and an optimal choice of its value is crucial . Constrained reﬁnement does not change the target function but rather changes ( reduces ) the set of independent para - meters that can vary . Examples include rigid - body reﬁnement , the use of a riding model ( Sheldrick & Schneider , 1997 ) to parameterize the positions of H atoms in reﬁnement or the implementation of RSR by Diamond ( 1971 ) using torsion angles as variables . 2 . 2 . 1 . Model - to - map target ( T data ) . In RSR , the T data term scores the ﬁt of the model being reﬁned to a target map . In cryo - EM the map is a three - dimensional reconstruction , while in crystallography it may be , for example , a 2 mF obs (cid:4) DF model map ( Read , 1986 ) . It is possible to express the difference between the two maps in the integral form ( see , for example , Diamond , 1971 ) 1 T data ¼ R V ½ (cid:3) calc ð r Þ (cid:4) (cid:3) tar ð r Þ(cid:5) 2 d r : ð 2 Þ For ( 2 ) we suppose that the original target map is optimally scaled to the model map ( Diamond , 1971 ; Chapman , 1995 ) . In the following , we will consider the target to be essentially unchanged by manipulations that shift its value by a constant or a scale factor , as such manipulations do not change the position of the minimum of the target . If the Euclidean norms of (cid:3) tar ( r ) and (cid:3) calc ( r ) are conserved during reﬁnement [ i . e . if R V (cid:3) 2tar ð r Þ d r = constant , as will be the case when the target map itself does not change , and if R V (cid:3) 2calc ð r Þ d r = constant , which will be true if the overlap of atomic densities does not change ] then minimization of ( 2 ) is equivalent to minimization of the anticorrelation target , which does not need the maps to be optimally scaled , T data ¼ (cid:4) R V (cid:3) calc ð r Þ (cid:3) tar ð r Þ d r : ð 3 Þ Assuming the target (cid:3) tar and model - calculated (cid:3) calc maps are provided on the same grid , a continuous integration in ( 2 ) and ( 3 ) can be replaced with a numeric integration over the regular grid on which the maps are available ( see , for example , Diamond , 1971 ) , T data ¼ P n 2 G ½ (cid:3) calc ð n Þ (cid:4) (cid:3) tar ð n Þ(cid:5) 2 ð 4 Þ or T data ¼ (cid:4) P n 2 G (cid:3) calc ð n Þ (cid:3) tar ð n Þ ; ð 5 Þ respectively . The set G of grid nodes used to calculate the targets ( i . e . the integration volume ) is either the whole map or research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 533 Figure 2 Flowchart for phenix . real _ space _ reﬁne . 1 It is a widely known consequence of Parseval’s theorem [ see , for example , Diamond ( 1971 ) or Arnold & Rossmann ( 1988 ) ] that this is equivalent to a least - squares target between a full set of the corresponding complex Fourier coefﬁcients ; CNS ( Bru¨nger et al . , 1998 ) describes this as a ‘vector LS target’ . an envelope ( mask ) surrounding the whole atomic model or its part that is subject to reﬁnement . To match the ﬁnite resolution of the target map in ( 5 ) accurately , several steps are required to compute the model map . Firstly , the model map distribution is calculated using one of the available approximations ( Sears , 1992 ; Maslen et al . , 1992 ; Waasmaier & Kirfel , 1995 ; Grosse - Kunstleve et al . , 2004 ; Peng et al . , 1996 ; Peng , 1998 ) . A set of Fourier coefﬁcients is then calculated from the distribution up to the resolution limit speciﬁed by the target map . 2 Finally , a subset of these coefﬁ - cients is used to calculate the model Fourier synthesis (cid:3) calc that can then be used in ( 5 ) . This synthesis is a representation of a model image at a given resolution . A typical reﬁnement may require hundreds or even thousands of such model - image calculations , which are computationally expensive , involving two Fourier transforms . Alternatively , a model map may be calculated from the atomic model directly as a sum of individual contributions of M atoms , with each contribution being a Fourier image ( or its approximation ) of the corresponding atom at a given resolu - tion ( see , for example , Diamond , 1971 ; Lunin & Urzhumtsev , 1984 ; Chapman , 1995 ; Mooij et al . , 2006 ; Sorzano et al . , 2015 ) . While this is much faster than the previous method , it may be less accurate and still be computationally expensive , especially for large models . A numeric integration over the whole map ( 5 ) can be simpliﬁed by the integration exploring the volume directly around the atomic centers r m , m = 1 , . . . M : T data ¼ (cid:4) P M m ¼ 1 (cid:3) calc ð r m Þ ~ (cid:3)(cid:3) tar ð r m Þ : ð 6 Þ Here , ~ (cid:3)(cid:3) tar ð r m Þ are the values interpolated from the nearby grid node values (cid:3) tar ( n ) to the atomic centers r m ( Appendices A and B ) . Neglecting the local variation of the model map at the atomic centers ( e . g . at low resolution ) and thus supposing (cid:3) calc ( r m ) ’ constant for all m , the target simpliﬁes further as ( Rossmann , 2000 ; Rossmann et al . , 2001 ) T data ¼ (cid:4) P M m ¼ 1 ~ (cid:3)(cid:3) tar ð r m Þ : ð 7 Þ The hypothesis (cid:3) calc ( r m ) ’ constant seems to be reasonable at low resolution , when a calculated map can be considered to be rather ﬂat . On the other hand , minimization of ( 7 ) is essen - tially a ﬁtting of atoms to the nearest peaks of the target map , which seems to be appropriate at high resolution as well . We show below ( x 3 ) that indeed this target function is efﬁcient over a large resolution range ; Appendix B supports this observation through the equivalence of targets ( 7 ) and ( 5 ) when taking map blurring / sharpening into account . If the difference in atomic size cannot be neglected , this target function can be modiﬁed to T data ¼ (cid:4) P M m ¼ 1 w m ~ (cid:3)(cid:3) tar ð r m Þ ; ð 8 Þ where w m is an atom - speciﬁc weight . For example , w m can be the electron number of the corresponding atom or it can be set negative for O atoms of Asp and Glu residues in the case of cryo - EM or for atoms that have a negative scattering length ( such as hydrogen ) in the case of neutron diffraction data . Clearly , for most of the macromolecular structures under consideration here these atom - centered targets are nearly the same , and for simplicity in the following we refer only to ( 7 ) unless otherwise stated . The computational cost of ( 7 ) is proportional , with a very small coefﬁcient , to the number of atoms and therefore these targets are much faster to calculate compared with ( 5 ) , making it advantageous for the reﬁnement of large models . Unlike ( 4 ) or ( 5 ) , the computational cost of ( 7 ) or ( 8 ) does not depend on the resolution or map - sampling rate . Essentially , target ( 5 ) optimizes the ﬁt of the shape between model - calculated and experimental maps , while target ( 7 ) simply guides atoms to the nearest peaks in the experimental map . Therefore , reﬁnement using ( 5 ) can produce a more accurate model - to - map ﬁt . An optimal reﬁnement protocol may consist of using target ( 7 ) for routine reﬁnements and using ( 5 ) for the ﬁnal reﬁnement . 2 . 2 . 2 . Restraints ( T restraints ) . In restrained reﬁnement , extra information is introduced through the term T restraints with some weight ( 1 ) . This extra term restrains model parameters to be similar , but not necessarily identical , to some reference values . At high to medium resolutions of approximately 3 A˚ or better , a standard set of restraints as implemented in PHENIX includes ( Grosse - Kunstleve & Adams , 2004 ) restraints on covalent bond lengths and angles , dihedral angles , planarity and chirality restraints , and a nonbonded repulsion term . However , at lower resolutions the amount of experimental data is insufﬁcient to preserve the geometry characteristics of a higher level of structural organization ( such as secondary structure ) , and therefore including extra information ( restraints or constraints ) to help to produce a chemically meaningful model is desirable . These extra restraints or constraints may include similarity of related copies ( NCS in the case of crystallography ) , restraints on secondary structure and restraints to one or more external reference models ( for implementation details in PHENIX , see Headd et al . , 2012 , 2014 ; Sobolev et al . , 2015 ) . phenix . real _ space _ reﬁne can use the following extra restraints and constraints . ( i ) Distance and angle restraints on hydrogen - bond patterns for protein helices and sheets and DNA / RNA base pairs . ( ii ) Torsion - angle restraints on idealized protein secondary - structure fragments . ( iii ) Restraints to maintain stacking bases in RNA / DNA parallel . ( iv ) Ramachandran plot restraints . ( v ) Amino - acid side - chain rotamer - speciﬁc restraints . ( vi ) C (cid:4) deviation restraints . ( vii ) Reference - model restraints , where a reference model may be a similar structure of better quality or the initial position of the model being reﬁned . ( viii ) Similarity restraints in torsion or Cartesian space . ( ix ) NCS constraints . research papers 534 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 2 In crystallography , the set of the calculated Fourier coefﬁcients usually coincides with that of the experimentally measured intensities . 2 . 2 . 3 . Relative weight . The relative weight w restraints is chosen such that the model ﬁts the map as well as possible while maintaining reasonable deviations from ideal covalent bond lengths and angles . In PHENIX , w restraints for RSR is determined by systematically trying a range of plausible values and performing a short reﬁnement for each trial value . A similar procedure in FSR would be very computationally expensive because for each trial value of w restraints the whole structure would need to be used . In RSR this is computa - tionally feasible using ( 7 ) but not ( 5 ) . The weight - calculation procedure implemented in phenix . real _ space _ reﬁne splits the model into a set of randomly chosen segments , each one a few residues long . After trial reﬁnements of each segment with different weights , the best weight is deﬁned as the one that results in a model possessing reasonable bond and angle root - mean - square deviations ( r . m . s . d . s ) and that has the best model - to - map ﬁt among all trial weights . The obtained array of best weights for all fragments is ﬁltered for outliers and the average weight is calculated and deﬁned as the best weight for the ﬁnal reﬁnement . This calculation typically takes less than a minute on an ordinary computer and is independent of the size of the structure or map . Instead of computing an average single weight for the entire model , this protocol can be extended ( work in progress ) to calculate and use different weights for different parts of the map , accounting for varia - tions in local map quality . 2 . 3 . Evaluation of refinement progress and results It is recognized that model validation ( see , for example , Bra¨nde´n & Jones , 1990 ; Read et al . , 2011 ; Wlodawer & Dauter , 2017 ) is a critical step in structure determination , and a number of corresponding tools have been developed in crystallography ( see , for example , Chen et al . , 2010 ; Read et al . , 2011 ; Gore et al . , 2017 ; Williams et al . , 2018 and references therein ) and some in cryo - EM studies ( see , for example , Henderson et al . , 2012 ; Tickle , 2012 ; Lagerstedt et al . , 2013 ; Barad et al . , 2015 ; Pintilie et al . , 2016 ; Joseph et al . , 2017 , Afonine et al . , 2018 ) . Generally , the process consists of assessing data , model quality and model - to - data ﬁt quality , and is performed locally and globally . At the stage of reﬁning a model we assume that the intrinsic data quality has already been evaluated , and only model quality and model - to - data ﬁt need to be monitored . The methods and tools to evaluate the geometric quality of a model are the same in crystallography and in cryo - EM . For example , the PHENIX comprehensive validation program provides an extensive report on model quality , making extensive use of the MolProbity validation algorithms ( Chen et al . , 2010 ; Richardson et al . , 2018 ) . In crystallography , the model - to - data ﬁt is quantiﬁed by crystallographic R and R free ( Bru¨nger , 1992 ) factors , which are global reciprocal - space metrics . In cryo - EM , model and data validation is currently performed by the comparison of complex Fourier coefﬁcients in resolution shells ; these coefﬁcients are calculated from the model and from the full map or half - maps ; different masks can be applied prior to calculation of these coefﬁcients . Also in real space the model - to - data ﬁt can be evaluated locally or globally by various correlation coefﬁcients between a model - calculated map and the experimentally derived map ( Urzhumtsev et al . , 2014 ; Afonine et al . , 2018 ) . Some of these tools are used in x 3 . 2 , where models extracted from the PDB are reﬁned against experimental cryo - EM maps . 3 . Results 3 . 1 . Test refinements with simulated data Below , we illustrate the performance of reﬁnement at different resolutions and map sharpnesses and using atomic models with various amounts of error in the coordinates . All reﬁnements were performed using reﬁnement target ( 1 ) with geometry restraints included with optimal weights and data term ( 7 ) . We begin with several numerical tests using simu - lated data . The advantage of such tests is that one can study individual effects in a setting where the answer is known . 3 . 1 . 1 . Preparing simulated data . A model from the PDB ( PDB entry 3vb1 ) was chosen as a test model . The following manipulations were made to this model prior to test calcula - tions : ( i ) the model was placed in a sufﬁciently large P 1 unit cell , ( ii ) alternative conformations were replaced with a single conformation and ( iii ) model geometry was regularized using the phenix . geometry _ minimization tool until convergence . In the following , we refer to this model as a reference model . Several Fourier maps at different resolutions d high ( 1 , 2 , 3 , 4 , 5 and 6 A˚ ) were calculated from the reference model consid - ering three different overall B factors of 0 , 100 and 200 A˚ 2 ; these maps mimic (cid:3) tar ( 18 maps in total ) . The maps were calculated on a grid with the step equal to d high / 4 . Additionally , we calculated the same maps on a much ﬁner grid with a step of 0 . 2 A˚ ; the same step was used for all maps independent of their resolution . research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 535 Figure 3 Reﬁnement of the exact model against 18 maps computed as described in x 3 . 1 . 1 . Each circle shows the root - mean - square deviation between the reﬁned model and the reference model . Blue , green and orange full circles correspond to maps with overall B factors of 0 , 100 and 200 A˚ 2 , respectively . Open circles correspond to the map with an overall B factor of 100 A˚ 2 computed on the ﬁner grid with a step of 0 . 2 A˚ . See x 3 . 1 . 2 for details . 3 . 1 . 2 . Refinement of the exact reference model . Firstly , we reﬁned the reference model against ﬁnite - resolution maps calculated from this model , as described in x 3 . 1 . 1 . While the reference model corresponds to the minimum of ( 5 ) , this is not the case for ( 7 ) because map peaks in ﬁnite resolution Fourier images do not necessarily correspond to atomic centers . Therefore , it is expected that reﬁnement using ( 7 ) may shift the model from its original , correct , position . The goal of this test is to provide an estimate of the magnitude of these shifts after reﬁnement . For each reﬁned model we calculated the root - mean - square deviation ( r . m . s . d . ) from the reference model . Fig . 3 summarizes the result of this test . We observe the following . ( i ) Reﬁnement using a ﬁner grid does not have any signiﬁcant effect compared with using a d high / 4 grid step ( compare the orange dots and black circles in Fig . 3 ) . ( ii ) The r . m . s . d . increases as the resolution worsens and ranges from as low as 0 . 01 A˚ at 1 A˚ resolution to as high as 0 . 48 A˚ at 6 A˚ resolution . These r . m . s . d . s are small compared with the details that can be resolved in maps at these resolutions . This justiﬁes the use of a target ( 7 ) that is less accurate but much faster to calculate than ( 5 ) . ( iii ) Map sharpness has a mixed effect . At high resolution ( 1 – 2 A˚ ) maps corresponding to the lowest B of 0 A˚ 2 produce more accurate results . At intermediate resolutions ( 3 – 5 A˚ ) maps corresponding to both the lowest and the largest B perform worse compared with those corresponding to an inter - mediate value ( B = 100 A˚ 2 ) . Maps with the largest B of 200 A ˚ 2 result in overall less accurate models . These observa - tions suggest that depending on resolu - tion some attenuation of map sharpness may be useful . 3 . 1 . 3 . Refinement of perturbed refer - ence models . Here , we describe tests that are similar to those in x 3 . 1 . 2 except that instead of reﬁning the reference model we reﬁned perturbed reference models . These perturbed models were obtained by running molecular - dynamics ( MD ) simulations using the phenix . dynamics tool until a prescribed r . m . s . d . compared with the reference model was achieved . Given the stochastic nature of MD , it is possible to obtain many different models with the same r . m . s . d . from the reference model . Owing to the limited convergence radius of reﬁnement and the ﬁnite resolution of the data , reﬁnement of these models will not produce exactly the same reﬁned models . Therefore , to ensure more robust statistics , for each chosen r . m . s . d . we generated an ensemble of 100 models . The r . m . s . d . values between the perturbed and reference models were chosen to be 0 . 5 , 1 . 0 , 1 . 5 and 2 . 0 A˚ . We research papers 536 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Figure 4 Reﬁnement of perturbed models against maps computed as described in x 3 . 1 . 1 . The horizontal axis shows the r . m . s . d . between the reference model and perturbed models : 0 . 5 , 1 . 0 , 1 . 5 and 2 . 0 A˚ . The vertical axis shows the r . m . s . d . between the reference model and the reﬁned models . Blue , green and orange full circles correspond to maps with overall B factors of 0 , 100 and 200 A˚ 2 , respectively . See x 3 . 1 . 3 for details . then reﬁned each of these 100 (cid:3) 4 = 400 models against each of 18 maps ( x 3 . 1 . 1 ) calculated on a grid with a spacing of d high / 4 . For each reﬁned model ( from 100 (cid:3) 4 (cid:3) 6 (cid:3) 3 = 7200 reﬁned models ) we calculated the r . m . s . d . from the reference model and then the average r . m . s . d . over the corresponding ensemble of 100 models . Fig . 4 summarizes the results of this test . We observe the following . ( i ) In most cases reﬁnement was able to signiﬁcantly reduce the difference between the reference and starting perturbed models . The reﬁnement of models with a starting r . m . s . d . of 0 . 5 A˚ gives similar results as the reﬁnement of a nonperturbed reference model ( similar r . m . s . d . ) . ( ii ) In almost all cases using a blurred map results in less accurate reﬁned models . ( iii ) In the case of large errors ( 1 . 5 – 2 A˚ ) reﬁnement against a 1 A˚ resolution map corresponding to an overall B of 0 A˚ 2 performs the worst compared with blurrier maps . This can be rationalized as the peaks on a very sharp map are narrow and sufﬁciently large displacements of atoms away from these peaks results in shifts that are outside the convergence radius of minimization . ( iv ) At resolutions of 3 – 5 A˚ using neither very sharp nor very blurred maps produces the best results , although the effect is rather small . This suggests that there exists an optimal sharpening B value that is most suitable for reﬁnement at a given resolution . 3 . 2 . Refinement using data from the PDB and EMDB 3 . 2 . 1 . Cryo - EM maps . Three - dimensional reconstructions ( cryo - EM maps ) represent the electric potential of the sample . Therefore , these maps are expected to have negative features around negatively charged moieties such as aspartate and glutamate ( see , for example , Hryc et al . , 2017 ) . Furthermore , such moieties may be susceptible to radiation damage and therefore may have a weaker footprint in the reconstructions . This may have an implication for real - space reﬁnement that uses target ( 7 ) [ or ( 5 ) if the form factors do not reproduce the negative features ] because this target favors atomic shifts towards positive map peaks . To investigate this effect , we surveyed map values at atomic positions considering recon - structions at 3 A˚ or better and map – model correlation better than 0 . 8 . This selected nine ( map , model ) pairs . Prior to calculations , we normalized all selected maps to have zero mean value and a standard deviation of 1 . Fig . 5 ( a ) shows the distribution of map values for four groups of atoms : main - chain atoms , side - chain O atoms of Asp and Glu residues that may be negatively charged ( OD1 , OD2 , OE1 and OE2 ) , side - chain atoms of Arg and Lys residues that may be positively charged ( NH1 , NH2 and NZ ) and all other side - chain atoms . We observe that side - chain O atoms of Asp and Glu residues indeed have systematically weaker map values , with about 8 % of atoms having values below a threshold of (cid:4) 1 times the r . m . s . of the map . Negative map values for all other kinds of atoms are greater than (cid:4) 0 . 5 r . m . s . and may be considered as noise . We note that the size and ﬂexibility of Asp , Glu , Arg and Lys side chains are likely to contribute to systematically weaker densities for these side chains . We repeated the same analysis for maps of lower resolution ( 3 – 4 A˚ ; Fig . 5 b ) . Here , the number of reliably observed atoms with negative features in the map is less than 1 % . This analysis shows that for the majority of cryo - EM models ( resolution of 3 A˚ or worse ) the concern about negative features in the map is rather small and is unlikely to affect the results of reﬁnement using ( 7 ) signiﬁcantly . On the other hand , the rapidly increasing number of higher resolution cryo - EM maps ( better than 3 A˚ ) is likely to highlight the limitation of ( 7 ) and to demand further improvements of the reﬁnement target [ such as using ( 8 ) with properly chosen weights ] . 3 . 2 . 2 . Default refinement . In order to test the suggested methods and demonstrate their utility , we re - reﬁned 385 cryo - EM models from the PDB that are reported at a resolution of 6 A˚ or better , that have model – map correlation greater than 0 . 3 and that contain only residues and ligands that are known to the PHENIX restraint library . A number of metrics were analyzed : the model - to - map correlation coefﬁcient CC mask calculated in the map region around the model ( for an exact deﬁnition , see Afonine et al . , 2018 ) , the number of Rama - chandran plot and rotamer outliers , excessive C (cid:4) deviations , the MolProbity clashscore ( Chen et al . , 2010 ) and the EMRinger score ( Barad et al . , 2015 ; calculated for 277 entries research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 537 Figure 5 Distribution of cryo - EM map values ( scaled in r . m . s . ) for selected groups of atoms , considering maps at 3 A˚ or better ( a ) and 3 – 4 A˚ ( b ) resolution . See x 3 . 2 . 1 for details . with maps at 4 . 5 A˚ resolution or better ) , all calculated for the initial models from the PDB and for the models after reﬁne - ment . Default parameters were used in all reﬁnements that , in addition to standard restraints , also include rotamer , C (cid:4) deviations and Ramachandran plot restraints , as well as NCS constraints where applicable ( see x 2 . 2 . 2 ) . The program ran successfully , generating a reﬁned model for all cases and highlighting the robustness of the algorithms and their implementation . In all cases we observe a substantial overall improvement of geometry metrics , such as reduced or fully eliminated Ramachandran plot and rotamer outliers , C (cid:4) deviations and MolProbity clashscore , as well as improvement of the model - to - data ( map ) ﬁt ( Fig . 6 ) . Clearly , the removal of some outliers can be attributed to the use of rotamer , C (cid:4) deviations and Ramachandran plot restraints . Therefore , we also used an orthogonal validation metric to assess model improvement : EMRinger ( Barad et al . , 2015 ) . We observe that the overall average EMRinger score for the initial models is 1 . 73 and that for the reﬁned models is 2 . 26 . The improvement of the EMRinger score for the reﬁned models indicates that the amino - acid side chains are more chemically realistic and better ﬁt the map . Detailed validation or analysis of individual reﬁnement results is outside the scope of this work , but will be important in the future to assess the impact of stereochemical restraints on models , particularly when the starting models are of very poor quality . 3 . 2 . 3 . Refinement against sharpened maps . Our tests using simulated data ( x 3 . 1 ) have indicated that map sharpening or blurring may be useful in reﬁnement . To investigate this with the real experimental data we performed the following test . We selected models similarly to as described in x 3 . 2 . 2 , additionally requiring that independent half - maps had also been deposited by the researcher . This resulted in 76 entries . We performed test reﬁnements against the ﬁrst of the two half - maps and evaluated the reﬁned model - to - data ﬁt using the original second half - map that had not been used in any calculations . In two independent reﬁnements , the ﬁrst half - map was taken either as deposited or modiﬁed with phenix . auto _ sharpen ( Terwilliger , Sobolev et al . , 2018 ) to auto - matically optimally sharpen or blur the map . Fig . 7 shows the model – map correlation CC mask for models reﬁned against the original and sharpened ﬁrst half - maps ; the original second half - maps were used to compute the correlations . Overall , the CCs across all 76 cases are similar for reﬁnement against the original ﬁrst half - map and the sharpened ﬁrst half - map . The reﬁned models ﬁt slightly but systematically better when using sharpened maps if the original model – map CC is low ( < 0 . 5 ) and systematically slightly worse if the original model – map correlation is higher ( CC > 0 . 5 ) . This agrees with the obser - vation that target ( 7 ) allows the removal of large errors but may slightly distort exact models ( x 3 . 1 . 2 ) . Also , we note that the MolProbity scores for models reﬁned against sharpened maps are systematically better , but the difference is small . 3 . 2 . 4 . Re - refinement of the TRPV1 structure . The structure of the TRPV1 ion channel ( PDB entry 3j5p ; EMDB code EMD - 5778 ) was determined by single - particle cryo - EM ( Liao et al . , 2013 ) at a resolution of 3 . 28 A˚ . The model was built manually and was not subjected to reﬁnement . As the model was not reﬁned it contains substantial geometry violations : the clashscore is high ( (cid:6) 100 ) and about one third of the side chains are identiﬁed as rotamer outliers ( Table 1 ) . More recently , the better resolved part of this structure has been research papers 538 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Figure 6 Model statistics before ( brown ) and after ( blue ) reﬁnement using phenix . real _ space _ reﬁne , showing Ramachandran plot and residue side - chain rotamer outliers , C (cid:4) deviations , MolProbity clashscore and model – map correlation coefﬁcient ( CC mask ) . The scatter plot shows the EMRinger score for the original and reﬁned models ( resolution better than 4 . 5 A˚ ) . re - evaluated using the same data ( Barad et al . , 2015 ; PDB entry 3j9j ; ankyrin domain not included ) . This involved some rebuilding and reﬁnement using algorithms implemented in the Rosetta suite ( DiMaio et al . , 2015 ) . The resulting model has a much improved clashscore and EMRinger score ( Barad et al . , 2015 ) and no rotamer outliers , yet the number of Rama - chandran plot outliers has increased compared with the original model ( Table 1 ) . We performed a reﬁnement of PDB entry 3j5p ( the portion that matches PDB entry 3j9j ) using phenix . real _ space _ reﬁne with all default settings and auto - matically , with no manual intervention , using the original , deposited map . The reﬁnement took about 3 min on a Macintosh laptop . 3 Overall , the reﬁned model is similar to PDB entry 3j9j ( virtually no rotamer or Ramachandran plot outliers ) , the EMRinger score is improved further and the model - to - map correlation ( CC mask ) is increased compared with both PDB entries 3j5p and 3j9j . Notably , the MolProbity clashscore decreased from 100 . 8 to 5 . 6 as a result of the resolution of numerous steric clashes ( Fig . 8 ) . Modeling experimental data at reso - lutions below atomic ( around 1 – 1 . 5 A˚ and better ) may not be unambiguous ( Terwilliger et al . , 2007 ) . Therefore , it may be instructive to perform several trial reﬁnements , each using the exact same settings but different ( perturbed ) input models . Here , we generated an ensemble of 100 perturbed models by running molecular - dynamics simulation ( using phenix . dynamics tool ) until the r . m . s . deviation between the starting and simulated models reached 3 A˚ ( Fig . 9 a ) . We then reﬁned all models using phenix . real _ space _ reﬁne until convergence . This resulted in 100 reﬁned models that are overall similar but vary locally ( Fig . 9 b ) . This highlights the fact that a single - model repre - sentation of experimental data is an approximation and should not be taken too literally ( for example , when it comes to measuring and reporting distances between atoms ) . Also , this test demonstrates the rather large convergence radius of phenix . real _ space _ reﬁne : the average map – model correlation ( CC mask ) across all 100 reﬁned models is 0 . 80 , with the smallest and largest values being 0 . 79 and 0 . 81 . 4 . Conclusions Reﬁnement of an atomic model against a map is increasingly important as the technique of cryo - EM rapidly develops . We have described the algorithms implemented in a new PHENIX tool , phenix . real _ space _ reﬁne , that was speciﬁcally designed to perform such real - space reﬁnements . RSR is a natural choice for cryo - EM , unlike crystallography , where real - space methods are complementary to Fourier - space reﬁne - ment and are somewhat limited since crystallographic maps are almost always model - biased . Nevertheless , while this work was inspired by rapid advances in the ﬁeld of cryo - EM and the increasing number of three - dimensional reconstructions that allow atomic models to be reﬁned ( as opposed to rigid - body docked ) , the implementation is not limited to cryo - EM and crystallographic maps can also be used . The proposed real - space reﬁnement procedure is fast owing to the use of an atom - centered reﬁnement target function that has been shown to be efﬁcient at all tested resolutions from 1 to 6 A˚ . Several options for key calculation steps , such as map interpolation , gradient calculation and preliminary processing of the target ( experimental ) map , are available with the default choices selected on the basis of extensive test calcu - lations . The real - space reﬁnement algorithm includes a fast and efﬁcient search for the optimal relative weight of restraints , a procedure that is extremely challenging for research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 539 Figure 7 Left , correlation coefﬁcient CC mask calculated using the original second half - maps and maps calculated from models reﬁned against the ﬁrst half - maps : original ( x axis ) versus sharpened ( y axis ) . Right , MolProbity scores for models using original ﬁrst half - maps versus sharpened ﬁrst half - maps . Table 1 Summary of statistics for the original model ( PDB entry 3j5p ) , that re - reﬁned by Barad et al . ( 2015 ) ( PDB entry 3j9j ) and that re - reﬁned by phenix . real _ space _ reﬁne models . Metric 3j5p† 3j9j 3j5p† ( phenix . real _ space _ reﬁne ) CC mask 0 . 65 0 . 59 0 . 82 EMRinger score 1 . 2 2 . 6 3 . 3 R . m . s . d . Bonds ( A˚ ) 0 . 01 0 . 02 0 . 01 Angles ( (cid:7) ) 1 . 50 1 . 10 1 . 44 Ramachandran plot ( % ) Favored 95 . 8 94 . 5 93 . 3 Allowed 4 . 2 3 . 3 6 . 7 Outliers 0 2 . 2 0 Rotamer outliers ( % ) 32 . 3 0 < 1 Clashscore 100 . 8 2 . 7 5 . 6 C (cid:4) deviations 0 0 0 † No ankyrin domain . 3 For comparison of the CPU required by the two methods , we refer to Kim & Sanbonmatsu ( 2017 ) . reciprocal - space reﬁnement . The reﬁnement algorithm is robust , with no failures for any of the cryo - EM maps tested . For all test model reﬁnements improvements are observed ; in some cases these improvements are signiﬁcant . Future developments of the algorithms will include methods to account for local variation in map resolution and a fast and accurate calculation of ( 5 ) for the ﬁnal reﬁnement cycles and efﬁcient modeling of atomic displacements . APPENDIX A Real - space targets and convolution We show here that if the atoms all have the same shape , sampling a map at the positions of atomic centers , as in ( 7 ) , can be made equivalent to the correlation function obtained by integrating or summing over the product of calculated and target densities , as in ( 3 ) or ( 5 ) . Consider a simpliﬁed structure research papers 540 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Figure 8 Backbone of the 3j5p model before ( a ) and after ( b ) reﬁnement shown in black . The model before reﬁnement contains a substantial number of steric clashes ( indicated by red dots ) and many side - chain rotamer outliers ( blue side chains ) . Most clashes and rotamer outliers are resolved by phenix . real _ space _ reﬁne . The images were created using the KiNG program ( Chen et al . , 2009 ) from within PHENIX . Figure 9 ( a ) Ensemble of perturbed 3j5p models ; the r . m . s . deviation of each model from the initial model is 3 A˚ , showing chain A only . ( b ) Ensemble of reﬁned models in the experimental map . The largest variation is observed in regions that lack density . The images were created using the ChimeraX program ( Goddard et al . , 2018 ) . composed of a single atom . Looking for its best position according to ( 3 ) or ( 5 ) corresponds to seeking the position where the weighted average of the target map values ( weighted by the atomic shape ) inside a sphere centered at the trial atomic position is maximal . This calculation and check for the maximal value could be performed point by point . Alter - natively , one can ﬁrst calculate such averages for all grid points , replace the initial map values by these sums and then simply choose the maximum . From a mathematical point of view this averaging can be considered as a convolution and , if calculated simultaneously for the whole map , can be performed rapidly ( Leslie , 1987 ; Urzhumtsev et al . , 1989 ) . Checking the values of the averaged , i . e . blurred , map for their maximum corresponds to using targets ( 7 ) or ( 8 ) . Below , we give a formal interpretation of these real - space targets . Let Z 0 f 0 ( | s | ; B 0 ) be a scattering factor of some isotropic atom characterized by a B 0 value and the electron number Z 0 . Let Z 0 (cid:3) 0 ( r ; B 0 ) be an image of this atom in the corresponding model map if it is placed at the origin . Both Z 0 f 0 ( | s | ; B 0 ) and Z 0 (cid:3) 0 ( r ; B 0 ) are spherically symmetric and related by Fourier transformation . If a hypothetical structure is composed of a single atom positioned at r 0 , the corresponding model map is (cid:3) calc ; 0 ð r Þ ¼ Z 0 (cid:3) 0 ð r (cid:4) r 0 ; B 0 Þ ; ð 9 Þ which can be seen as a convolution of a point scatterer at position r 0 with the atomic shape . Owing to the spherical symmetry of (cid:3) 0 ( r ; B 0 ) , the target function ( 3 ) T data ¼ (cid:4) R V (cid:3) tar ð r Þ (cid:3) calc ; 0 ð r Þ d r ¼ (cid:4) Z 0 R V (cid:3) tar ð r Þ (cid:3) 0 ð r (cid:4) r 0 ; B 0 Þ d r ¼ (cid:4) Z 0 R V (cid:3) tar ð r Þ (cid:3) 0 ð r 0 (cid:4) r ; B 0 Þ d r ð 10 Þ can be interpreted as a convolution of the target map with (cid:3) 0 ( r ; B 0 ) taken at point r 0 . Let { F tar ( s ) } be the set of Fourier coefﬁcients corresponding to the target map (cid:3) tar ( r ) . By the convolution theorem , ( 10 ) is equal to the Fourier series of the corresponding Fourier coefﬁcients , (cid:4) Z 0 P s F tar ð s Þ f 0 ðj s j ; B 0 Þ exp ð(cid:4) 2 (cid:5) i r 0 s Þ ¼ (cid:4) Z 0 P s ½ F tar ð s Þ (cid:8) f o ðj s j ; B 0 Þ(cid:5) exp ð(cid:4) 2 (cid:5) i r 0 s Þ ¼ (cid:4) Z 0 (cid:3) tar 0 ð r 0 ; B 0 Þ : ð 11 Þ Here , the map (cid:3) tar _ 0 ( r ; B 0 ) is a Fourier series calculated with the coefﬁcients F tar ( s ) f 0 ( | s | ; B 0 ) . In other words , instead of blurring the model map with the atomic shape and calculating the point - by - point product of the two maps , one may blur the experimental map and leave the model map unblurred , i . e . as a point map . For a multi - atom model T data ¼ (cid:4) R V (cid:3) tar ð r Þ (cid:3) calc ð r Þ d r ¼ (cid:4) R V (cid:3) tar P M m ¼ 1 (cid:3) calc ; m ð r Þ (cid:2) (cid:3) d r ¼ (cid:4) P M m ¼ 1 R V (cid:3) tar ð r Þ (cid:3) calc ; m ð r Þ d r : ð 12 Þ At resolutions typical for bio - crystallography the shapes of macromolecular atoms are similar . If we additionally suppose that all of the atoms of the structure have the same ( or similar ) atomic displacement parameters B m = B 0 , then T data ’ (cid:4) P M m ¼ 1 Z m (cid:3) tar 0 ð r m ; B 0 Þ ð 13 Þ using the function (cid:3) tar _ 0 ( r ; B 0 ) calculated once in advance . This shows that in calculating ( 8 ) we in fact implicitly sharpen the target map using (cid:3) tar ( r ) instead of (cid:3) tar _ 0 ( r ; B 0 ) . Even when using ( 8 ) as the target , it is likely to be beneﬁcial to choose an optimal sharpening factor , just as the signal in map correla - tions can be improved . If the difference in atomic B values cannot be neglected , one can calculate in advance a few maps (cid:3) tar _ 0 ( r ; B k ) for a range of B - factor values B k , k = 1 , . . . , K , and use the appropriate (cid:3) tar _ 0 ( r m ; B k ) for a particular atom m , R Z - atoms ¼ (cid:4) P M m ¼ 1 Z m (cid:3) tar 0 ½ r m ; B k ð m Þ(cid:5) : ð 14 Þ If the atomic shapes are signiﬁcantly different , as is the case for H atoms in neutron maps or negatively charged side chains in cryo - EM maps at high resolution , the approximation ( 13 ) can be used with Z m being a negative value , or the target map can be convoluted with the respective atomic shape ( which can be negative ) before the sum over the relevant atoms is calculated . APPENDIX B Three - dimensional interpolation used B1 . General remarks Using the atom - centered targets ( 7 ) and ( 8 ) requires an efﬁcient and accurate interpolation of the maps calculated on three - dimensional regular grids . Not only the interpolated function values are needed but also the gradient . In this work , two options have been considered : trilinear ( https : / / en . wikipedia . org / wiki / Trilinear _ interpolation ) and tricubic ( https : / / en . wikipedia . org / wiki / Tricubic _ interpolation ) . Both interpolation procedures , including the gradient calculation , are available through the cctbx software library ( Grosse - Kunstleve et al . , 2002 ) . Trilinear interpolation is the simplest and the easiest to understand . Its major disadvantage is that , by construction , the minimum of the interpolated function is always at one of the corners of the box of interpolation . Since the map grid step is usually larger that the accuracy of atomic positions required , this can impact the optimization procedure and results . For this reason , the tricubic interpolation has been chosen as the default method . Other interpolations have also been tried but are not discussed in this work . In the following , we ﬁrst describe the interpolation procedures inside the unit cube and then adapt the results and the procedures to an arbitrary regular tridimensional grid . B2 . Tricubic interpolation inside a unit cube Let us consider an interpolation inside a unit cube , 0 (cid:9) x < 1 , 0 (cid:9) y < 1 , 0 (cid:9) z < 1 . We search for a function in the form research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 541 ~ ff ð x ; y ; z Þ ¼ P 3 k ; l ; m ¼ 0 a klm x k y l z m : ð 15 Þ This function is cubic with respect to any of its three variables , giving expressions for the partial derivatives @ ~ ff ð x ; y ; z Þ @ x ¼ P 3 l ; m ¼ 0 ; k ¼ 1 ka klm x k (cid:4) 1 y l z m ; @ ~ ff ð x ; y ; z Þ @ y ¼ P 3 k ; m ¼ 0 ; l ¼ 1 la klm x k y l (cid:4) 1 z m ; @ ~ ff ð x ; y ; z Þ @ z ¼ P 3 k ; l ¼ 0 ; m ¼ 1 ma klm x k y l z m (cid:4) 1 : ð 16 Þ One can calculate all 64 coefﬁcients in advance and use them for further calculations ( Lekien & Marsden , 2005 ) . Alter - natively , one can build an interpolation for the coordinate x , then for the coordinate y and ﬁnally for the coordinate z ( in any order of variables ) . To build interpolation ( 16 ) eight values from the cube corners are insufﬁcient and either values from the neighboring grid points ( the corners of the neigh - boring cubes ) or derivatives in the corners of the unit cube are required . In the following , f pqr with integers p , q , r stand for the grid function values f ( p , q , r ) . Firstly , we deﬁne a cubic interpolation ~ ff ð x Þ ¼ a 0 þ a 1 x þ a 2 x 2 þ a 3 x 3 ð 17 Þ of a function f ( x ) of one variable in the interval ( 0 , 1 ) for which its values are known in the integer grid nodes , f (cid:4) 1 = f ( (cid:4) 1 ) , f 0 = f ( 0 ) , f 1 = f ( 1 ) , f 2 = f ( 2 ) . We notate this interpolation by int3 ( x ; f (cid:4) 1 , f 0 , f 1 , f 2 ) and its derivative by gint3 ( x ; f (cid:4) 1 , f 0 , f 1 , f 2 ) , as they are called in cctbx : d ~ ff ð x Þ d x ¼ a 1 þ 2 a 2 x þ 3 a 3 x 2 : ð 18 Þ The coefﬁcients of this approximation are derived below . The procedure of the tricubic interpolation then becomes a suite of operations : ~ ff xpq ¼ int3 ½ x ; f ð(cid:4) 1 Þ pq ; f 0 pq ; f 1 pq ; f 2 pq (cid:5) ; ~ ff qyp ¼ int3 ½ y ; f q ð(cid:4) 1 Þ p ; f q 0 p ; f q 1 p ; f q 2 p (cid:5) ; ~ ff pqz ¼ int3 ½ z ; f pq ð(cid:4) 1 Þ ; f pq 0 ; f pq 1 ; f pq 2 (cid:5) ; ð 19 Þ where p and q are integers (cid:4) 1 , 0 , 1 or 2 , then ~ ff xyq ¼ int3 ½ y ; ~ ff x ð(cid:4) 1 Þ q ; ~ ff x 0 q ; ~ ff x 1 q ; ~ ff x 2 q (cid:5) ; ~ ff qyz ¼ int3 ½ z ; ~ ff qy ð(cid:4) 1 Þ ; ~ ff qy 0 ; ~ ff qy 1 ; ~ ff qy 2 (cid:5) ; ~ ff xqz ¼ int3 ½ x ; ~ ff ð(cid:4) 1 Þ qz ; ~ ff 0 qz ; ~ ff 1 qz ; ~ ff 2 qz (cid:5) ð 20 Þ and ﬁnally ~ ff xyz ¼ int3 ½ z ; ~ ff xy ð(cid:4) 1 Þ ; ~ ff xy 0 ; ~ ff xy 1 ; ~ ff xz 2 (cid:5) ; ~ ff xyz ¼ int3 ½ x ; ~ ff ð(cid:4) 1 Þ yz ; ~ ff 0 yz ; ~ ff 1 yz ; ~ ff 2 yz (cid:5) ; ~ ff xyz ¼ int3 ½ y ; ~ ff x ð(cid:4) 1 Þ z ; ~ ff x 0 z ; ~ ff x 1 z ; ~ ff x 2 z (cid:5) : ð 21 Þ The last three expressions are redundant and only one of them can be calculated . However , the expressions previous to them are necessary to calculate partial derivatives as @ ~ ff ð x ; y ; z Þ @ x ¼ gint3 ½ x ; ~ ff ð(cid:4) 1 Þ yz ; ~ ff 0 yz ; ~ ff 1 yz ; ~ ff 2 yz (cid:5) ; @ ~ ff ð x ; y ; z Þ @ y ¼ gint3 ½ y ; ~ ff x ð(cid:4) 1 Þ z ; ~ ff x 0 z ; ~ ff x 1 z ; ~ ff x 2 z (cid:5) ; @ ~ ff ð x ; y ; z Þ @ z ¼ gint3 ½ z ; ~ ff xy ð(cid:4) 1 Þ ; ~ ff xy 0 ; ~ ff xy 1 ; ~ ff xy 2 (cid:5) : ð 22 Þ The coefﬁcients of the one - dimensional cubic interpolation ( 17 ) can be chosen using various considerations . The possibi - lity taken as the default choice in the current software version is to build a cubic function ~ ff ð x Þ such that it and its ﬁrst deri - vative coincide with f ( x ) and with f 0 ( x ) , respectively , at points 0 and 1 . Since the f 0 ( 0 ) and f 0 ( 1 ) values are unknown , they are estimated as f 0 ð 0 Þ ’ 1 2 ð f 1 (cid:4) f (cid:4) 1 Þ ; f 0 ð 1 Þ ’ 1 2 ð f 2 (cid:4) f 0 Þ : ð 23 Þ This gives the coefﬁcients of ( 17 ) in the form a 0 ¼ f 0 ; a 1 ¼ 1 2 ð f 1 (cid:4) f (cid:4) 1 Þ ; a 2 ¼ 1 2 ð(cid:4) f 2 þ 4 f 1 (cid:4) 5 f 0 þ 2 f (cid:4) 1 Þ ; a 3 ¼ 1 2 ð f 2 (cid:4) 3 f 1 þ 3 f 0 (cid:4) f (cid:4) 1 Þ : ð 24 Þ B3 . Tricubic interpolation on a regular grid Now let a function f ( x , y , z ) be deﬁned in fractional coor - dinates on a grid with the step d x = N x (cid:4) 1 , d y = N y (cid:4) 1 , d z = N z (cid:4) 1 . Let us consider a point ( x g , y g , z g ) and a box of this grid that this point belongs to , n x d x (cid:9) x g < ð n x þ 1 Þ d x ; n y d y (cid:9) y g < ð n y þ 1 Þ d y ; n z d z (cid:9) z g < ð n z þ 1 Þ d z ð 25 Þ with n x , n y , n z being integer numbers . We introduce inter - mediate variables rescaling this ‘box’ to a unit cube as 0 (cid:9) x ¼ x g d (cid:4) 1 x (cid:4) n x < 1 ; 0 (cid:9) y ¼ y g d (cid:4) 1 y (cid:4) n y < 1 ; 0 (cid:9) z ¼ z g d (cid:4) 1 z (cid:4) n z < 1 ð 26 Þ and apply the procedure ( 19 ) – ( 21 ) described above . According to ( 26 ) , the respective derivatives are @ ~ ff ð x g ; y g ; z g Þ @ x g ¼ d (cid:4) 1 x @ ~ ff ð x ; y ; z Þ @ x ; @ ~ ff ð x g ; y g ; z g Þ @ y g ¼ d (cid:4) 1 y @ ~ ff ð x ; y ; z Þ @ y ; @ ~ ff ð x g ; y g ; z g Þ @ z g ¼ d (cid:4) 1 z @ ~ ff ð x ; y ; z Þ @ z : ð 27 Þ research papers 542 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Funding information This work was supported by the NIH ( grant GM063210 to PDA , RJR and TT ) and the PHENIX Industrial Consortium . This work was supported in part by the US Department of Energy under Contract No . DE - AC02 - 05CH11231 . AU acknowledges the support and the use of resources of the French Infrastructure for Integrated Structural Biology FRISBI ANR - 10 - INBS - 05 and of Instruct - ERIC . RJR is supported by a Principal Research Fellowship funded by the Wellcome Trust ( Grant 082961 / Z / 07 / Z ) . References Adams , P . D . et al . ( 2010 ) . Acta Cryst . D 66 , 213 – 221 . Afonine , P . V . , Grosse - Kunstleve , R . W . , Echols , N . , Headd , J . J . , Moriarty , N . W . , Mustyakimov , M . , Terwilliger , T . C . , Urzhumtsev , A . , Zwart , P . H . & Adams , P . D . ( 2012 ) . Acta Cryst . D 68 , 352 – 367 . Afonine , P . V . , Grosse - Kunstleve , R . W . , Urzhumtsev , A . & Adams , P . D . ( 2009 ) . J . Appl . Cryst . 42 , 607 – 615 . Afonine , P . V . , Headd , J . J . , Terwilliger , T . C . & Adams , P . D . ( 2013 ) . Comput . Crystallogr . Newsl . 4 , 43 – 44 . https : / / www . phenix - online . org / newsletter / CCN _ 2013 _ 07 . pdf . Afonine , P . V . , Klaholz , B . K . , Moriarty , N . W . , Poon , B . K . , Sobolev , O . V . , Terwilliger , T . C . , Adams , P . D . & Urzhumtsev , A . ( 2018 ) . bioRxiv . https : / / doi . org / 10 . 1101 / 249607 . Afonine , P . , Urzhumtsev , A . & Adams , P . D . ( 2015 ) . Arbor , 191 , a219 . https : / / doi . org / 10 . 3989 / arbor . 2015 . 772n2005 . Ahmed , T . , Shi , J . & Bhushan , S . ( 2017 ) . Nucleic Acids Res . 45 , 8581 – 8595 . Ahmed , T . , Yin , Z . & Bhushan , S . ( 2016 ) . Sci Rep . 6 , 35793 . Arnold , E . & Rossmann , M . G . ( 1988 ) . Acta Cryst . A 44 , 270 – 283 . Baker , M . L . , Hryc , C . F . , Zhang , Q . , Wu , W . , Jakana , J . , Haase - Pettingell , C . , Afonine , P . V . , Adams , P . D . , King , J . A . , Jiang , W . & Chiu , W . ( 2013 ) . Proc . Natl Acad . Sci . USA , 110 , 12301 – 12306 . Barad , B . A . , Echols , N . , Wang , R . Y . - R . , Cheng , Y . , DiMaio , F . , Adams , P . D . & Fraser , J . S . ( 2015 ) . Nature Methods , 12 , 943 – 946 . Berman , H . M . , Westbrook , J . , Feng , Z . , Gilliland , G . , Bhat , T . N . , Weissig , H . , Shindyalov , I . N . & Bourne , P . E . ( 2000 ) . Nucleic Acids Res . 28 , 235 – 242 . Bernstein , F . C . , Koetzle , T . F . , Williams , G . J . , Meyer , E . F . Jr , Brice , M . D . , Rodgers , J . R . , Kennard , O . , Shimanouchi , T . & Tasumi , M . ( 1977 ) . J . Mol . Biol . 112 , 535 – 542 . Bhardwaj , A . , Sankhala , R . S . , Olia , A . S . , Brooke , D . , Casjens , S . R . , Taylor , D . J . , Prevelige , P . E . Jr & Cingolani , G . ( 2016 ) . J . Biol . Chem . 291 , 215 – 226 . Bra¨nde´n , C . - I . & Jones , T . A . ( 1990 ) . Nature ( London ) , 343 , 687 – 689 . Brown , A . , Long , F . , Nicholls , R . A . , Toots , J . , Emsley , P . & Murshudov , G . ( 2015 ) . Acta Cryst . D 71 , 136 – 153 . Bru¨nger , A . T . ( 1992 ) . Nature ( London ) , 355 , 472 – 475 . Bru¨nger , A . T . , Adams , P . D . , Clore , G . M . , DeLano , W . L . , Gros , P . , Grosse - Kunstleve , R . W . , Jiang , J . - S . , Kuszewski , J . , Nilges , M . , Pannu , N . S . , Read , R . J . , Rice , L . M . , Simonson , T . & Warren , G . L . ( 1998 ) . Acta Cryst . D 54 , 905 – 921 . Bru¨nger , A . T . , Kuriyan , J . & Karplus , M . ( 1987 ) . Science , 235 , 458 – 460 . Chapman , M . S . ( 1995 ) . Acta Cryst . A 51 , 69 – 80 . Chen , V . B . , Arendall , W . B . , Headd , J . J . , Keedy , D . A . , Immormino , R . M . , Kapral , G . J . , Murray , L . W . , Richardson , J . S . & Richardson , D . C . ( 2010 ) . Acta Cryst . D 66 , 12 – 21 . Chen , V . B . , Davis , I . W . & Richardson , D . C . ( 2009 ) . Protein Sci . 18 , 2403 – 2409 . Chen , Y . et al . ( 2016 ) . Science , 353 , aad8266 . Cheng , L . , Sun , J . , Zhang , K . , Mou , Z . , Huang , X . , Ji , G . , Sun , F . , Zhang , J . & Zhu , P . ( 2011 ) . Proc . Natl Acad . Sci . USA , 108 , 1373 – 1378 . Chua , E . Y . D . , Vogirala , V . K . , Inian , O . , Wong , A . S . W . , Nordenskio¨ld , L . , Plitzko , J . M . , Danev , R . & Sandin , S . ( 2016 ) . Nucleic Acids Res . 44 , 8013 – 8019 . Demo , G . , Svidritskiy , E . , Madireddy , R . , Diaz - Avalos , R . , Grant , T . , Grigorieff , N . , Sousa , D . & Korostelev , A . A . ( 2017 ) . Elife , 6 , e23687 . Diamond , R . ( 1971 ) . Acta Cryst . A 27 , 436 – 452 . DiMaio , F . , Song , Y . , Li , X . , Brunner , M . J . , Xu , C . , Conticello , V . , Egelman , E . , Marlovits , T . , Cheng , Y . & Baker , D . ( 2015 ) . Nature Methods , 12 , 361 – 365 . Emsley , P . & Cowtan , K . ( 2004 ) . Acta Cryst . D 60 , 2126 – 2132 . Emsley , P . , Lohkamp , B . , Scott , W . G . & Cowtan , K . ( 2010 ) . Acta Cryst . D 66 , 486 – 501 . Fischer , N . , Neumann , P . , Konevega , A . L . , Bock , L . V . , Ficner , R . , Rodnina , M . V . & Stark , H . ( 2015 ) . Nature ( London ) , 520 , 567 – 570 . Frank , J . ( 2006 ) . Three - Dimensional Electron Microscopy of Macro - molecular Assemblies . Oxford University Press . Gao , Y . , Cao , E . , Julius , D . & Cheng , Y . ( 2016 ) . Nature ( London ) , 534 , 347 – 351 . Goddard , T . D . , Huang , C . C . , Meng , E . C . , Pettersen , E . F . , Couch , G . S . , Morris , J . H . & Ferrin , T . E . ( 2018 ) . Protein Sci . 27 , 14 – 25 . Gore , S . et al . ( 2017 ) . Structure , 25 , 1916 – 1927 . Grosse - Kunstleve , R . W . & Adams , P . D . ( 2004 ) . IUCr Comput . Comm . Newsl . 4 , 19 – 36 . https : / / www . iucr . org / resources / commissions / crystallographic - computing / newsletters / 4 . Grosse - Kunstleve , R . W . , Sauter , N . K . , Moriarty , N . W . & Adams , P . D . ( 2002 ) . J . Appl . Cryst . 35 , 126 – 136 . Grosse - Kunstleve , R . W . , Sauter , N . K . & Adams , P . D . ( 2004 ) . IUCr Comput . Comm . Newsl . 3 , 22 – 31 . https : / / www . iucr . org / resources / commissions / crystallographic - computing / newsletters / 3 . Headd , J . J . , Echols , N . , Afonine , P . V . , Grosse - Kunstleve , R . W . , Chen , V . B . , Moriarty , N . W . , Richardson , D . C . , Richardson , J . S . & Adams , P . D . ( 2012 ) . Acta Cryst . D 68 , 381 – 390 . Headd , J . J . , Echols , N . , Afonine , P . V . , Moriarty , N . W . , Gildea , R . J . & Adams , P . D . ( 2014 ) . Acta Cryst . D 70 , 1346 – 1356 . Henderson , R . et al . ( 2012 ) . Structure , 20 , 205 – 214 . Henrick , K . , Newman , R . , Tagari , M . & Chagoyen , M . ( 2003 ) . J . Struct . Biol . 144 , 228 – 237 . Hodel , A . , Kim , S . - H . & Bru¨nger , A . T . ( 1992 ) . Acta Cryst . A 48 , 851 – 858 . Hryc , C . F . , Chen , D . - H . , Afonine , P . V . , Jakana , J . , Wang , Z . , Haase - Pettingell , C . , Jiang , W . , Adams , P . D . , King , J . A . , Schmid , M . F . & Chiu , W . ( 2017 ) . Proc . Natl Acad . Sci . USA , 114 , 3103 – 3108 . Jones , T . A . ( 1978 ) . J . Appl . Cryst . 11 , 268 – 272 . Jones , T . A . , Zou , J . - Y . , Cowan , S . W . & Kjeldgaard , M . ( 1991 ) . Acta Cryst . A 47 , 110 – 119 . Joseph , A . P . , Lagerstedt , I . , Patwardhan , A . , Topf , M . & Winn , M . ( 2017 ) . J . Struct . Biol . 199 , 12 – 26 . Kim , D . N . & Sanbonmatsu , K . Y . ( 2017 ) . Biosci . Rep . 37 , BSR20170072 . Lagerstedt , I . , Moore , W . J . , Patwardhan , A . , Sanz - Garcı´a , E . , Best , C . , Swedlow , J . R . & Kleywegt , G . J . ( 2013 ) . J . Struct . Biol . 184 , 173 – 181 . Lekien , F . & Marsden , J . ( 2005 ) . Int . J . Numer . Methods Eng . 63 , 455 – 471 . Leslie , A . G . W . ( 1987 ) . Acta Cryst . A 43 , 134 – 136 . Liao , M . , Cao , E . , Julius , D . & Cheng , Y . ( 2013 ) . Nature ( London ) , 504 , 107 – 112 . Liu , D . C . & Nocedal , J . ( 1989 ) . Math . Program . 45 , 503 – 528 . Liu , Y . , Pan , J . , Jenni , S . , Raymond , D . D . , Caradonna , T . , Do , K . T . , Schmidt , A . G . , Harrison , S . C . & Grigorieff , N . ( 2017 ) . J . Mol . Biol . 429 , 1829 – 1839 . Lokareddy , R . K . , Sankhala , R . S . , Roy , A . , Afonine , P . V . , Motwani , T . , Teschke , C . M . , Parent , K . N . & Cingolani , G . ( 2017 ) . Nature Commun . 8 , 14310 . Lunin , V . Y . , Afonine , P . V . & Urzhumtsev , A . G . ( 2002 ) . Acta Cryst . A 58 , 270 – 282 . Lunin , V . Y . & Urzhumtsev , A . G . ( 1984 ) . Acta Cryst . A 40 , 269 – 277 . research papers Acta Cryst . ( 2018 ) . D 74 , 531 – 544 Afonine et al . (cid:2) Real - space refinement in PHENIX 543 Maslen , E . N . , Fox , A . G . & O’Keefe , M . A . ( 1992 ) . International Tables for Crystallography , Vol . C , edited by A . J . C . Wilson , pp . 476 – 516 . Dordrecht : Kluwer Academic Publishers . Mooij , W . T . M . , Hartshorn , M . J . , Tickle , I . J . , Sharff , A . J . , Verdonk , M . L . & Jhoti , H . ( 2006 ) . ChemMedChem , 1 , 827 – 838 . Oldﬁeld , T . J . ( 2001 ) . Acta Cryst . D 57 , 82 – 94 . Paulino , C . , Neldner , Y . , Lam , A . K . M . , Kalienkova , V . , Brunner , J . D . , Schenck , S . & Dutzler , R . ( 2017 ) . Elife , 6 , e26232 . Peng , L . - M . ( 1998 ) . Acta Cryst . A 54 , 481 – 485 . Peng , L . - M . , Ren , G . , Dudarev , S . L . & Whelan , M . J . ( 1996 ) . Acta Cryst . A 52 , 257 – 276 . Pintilie , G . , Chen , D . - H . , Haase - Pettingell , C . A . , King , J . A . & Chiu , W . ( 2016 ) . Biophys . J . 110 , 827 – 839 . Read , R . J . ( 1986 ) . Acta Cryst . A 42 , 140 – 149 . Read , R . J . et al . ( 2011 ) . Structure , 19 , 1395 – 1412 . Rossmann , M . G . ( 2000 ) . Acta Cryst . D 56 , 1341 – 1349 . Rossmann , M . G . , Bernal , R . & Pletnev , S . V . ( 2001 ) . J . Struct . Biol . 136 , 190 – 200 . Sears , V . F . ( 1992 ) . Neutron News , 3 ( 3 ) , 26 – 37 . Shalev - Benami , M . , Zhang , Y . , Matzov , D . , Halfon , Y . , Zackay , A . , Rozenberg , H . , Zimmerman , E . , Bashan , A . , Jaffe , C . L . , Yonath , A . & Skiniotis , G . ( 2016 ) . Cell . Rep . 16 , 288 – 294 . Sheldrick , G . M . & Schneider , T . R . ( 1997 ) . Methods Enzymol . 277 , 319 – 343 . Sobolev , O . V . , Afonine , P . V . , Adams , P . D . & Urzhumtsev , A . ( 2015 ) . J . Appl . Cryst . 48 , 1130 – 1141 . Sorzano , C . O . S . , Vargas , J . , Oto´n , J . , Abrishami , V . , de la Rosa - Trevı´n , J . M . , del Riego , S . , Ferna´ndez - Alderete , A . , Martı´nez - Rey , C . , Marabini , R . & Carazo , J . M . ( 2015 ) . AIMS Biophys . 2 , 8 – 20 . Terwilliger , T . C . , Adams , P . D . , Afonine , P . V . & Sobolev , O . V . ( 2018 ) . bioRxiv , 267138 . https : / / doi . org / 10 . 1101 / 267138 . Terwilliger , T . C . , Grosse - Kunstleve , R . W . , Afonine , P . V . , Adams , P . D . , Moriarty , N . W . , Zwart , P . , Read , R . J . , Turk , D . & Hung , L . - W . ( 2007 ) . Acta Cryst . D 63 , 597 – 610 . Terwilliger , T . C . , Read , R . J . , Adams , P . D . , Brunger , A . T . , Afonine , P . V . & Hung , L . - W . ( 2013 ) . Acta Cryst . D 69 , 2244 – 2250 . Terwilliger , T . C . , Sobolev , O . V . , Afonine , P . V . & Adams , P . D . ( 2018 ) . Acta Cryst . D 74 , 545 – 559 . Tickle , I . J . ( 2012 ) . Acta Cryst . D 68 , 454 – 467 . Tronrud , D . E . ( 2004 ) . Acta Cryst . D 60 , 2156 – 2168 . Turk , D . ( 2013 ) . Acta Cryst . D 69 , 1342 – 1357 . Urzhumtsev , A . , Afonine , P . V . , Lunin , V . Y . , Terwilliger , T . C . & Adams , P . D . ( 2014 ) . Acta Cryst . D 70 , 2593 – 2606 . Urzhumtsev , A . G . , Lunin , V . Y . & Luzyanina , T . B . ( 1989 ) . Acta Cryst . A 45 , 34 – 39 . Waasmaier , D . & Kirfel , A . ( 1995 ) . Acta Cryst . A 51 , 416 – 431 . Watkin , D . ( 2008 ) . J . Appl . Cryst . 41 , 491 – 522 . Williams , C . J . et al . ( 2018 ) . Protein Sci . 27 , 193 – 315 . Wlodawer , A . & Dauter , Z . ( 2017 ) . Acta Cryst . D 73 , 379 – 380 . Yang , H . , Wang , J . , Liu , M . , Chen , X . , Huang , M . , Tan , D . , Dong , M . - Q . , Wong , C . C . L . , Wang , J . , Xu , Y . & Wang , H . - W . ( 2016 ) . Protein Cell , 7 , 878 – 887 . research papers 544 Afonine et al . (cid:2) Real - space refinement in PHENIX Acta Cryst . ( 2018 ) . D 74 , 531 – 544