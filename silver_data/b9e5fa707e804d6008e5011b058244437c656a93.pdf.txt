184 VOLUME 34 NUMBER 2 FEBRUARY 2016 nature biotechnology A rt i c l e s The Cas9 protein , an RNA - directed DNA endonuclease , is a power - ful tool for manipulating the genome 1 – 4 . The ease of programming Cas9 ( CRISPR - associated protein 9 ) has enabled CRISPR ( clustered , regularly interspaced , short palindromic repeats ) - based genetic screens 5 , identifying well - established genes and providing novel insight into gene function for multiple phenotypes 6 – 8 . Initial libraries were designed with little knowledge of sgRNA activity rules , a critical design parameter , as interpreting screening data requires consistency among multiple sgRNAs targeting the same gene to distinguish true hits from false positives . Inactive and nonspecific sgRNAs reduce the effective gene coverage of the library and the accuracy of the hit list . Many studies indicate that Cas9 off - target activity depends on both sgRNA sequence and experimental conditions 9 – 13 . These studies have provided qualitative but incomplete understanding of specificity determinants . Finding generalizable patterns is quite challenging , requiring large data sets to adequately sample the vast number of pos - sible imperfect sgRNA - DNA interactions to reveal sequence features for prediction of off - target activity . Here , we present the design and characterization of human and mouse genome - wide sgRNA libraries based on our previously published rules for predicting on - target effi - ciency 14 . Building on screening data generated with the new libraries and large - scale assessment of off - target activity , we develop improved algorithms for on - and off - target activity prediction , allowing further optimization of our genome - wide libraries . RESULTSGenetic screens with the Avana and Asiago libraries Previously , we examined the activity of 1 , 841 sgRNAs to determine sequence features leading to increased efficacy , and developed rules for improved sgRNA design ( Rule Set 1 ) 14 . We implemented these rules in human and mouse genome - wide libraries , named Avana and Asiago , respectively , and tested their performance in phenotypic screens . We selected six sgRNAs per gene according to three criteria : Rule Set 1 score , specificity within protein - coding regions and the target site location within the gene ( Supplementary Tables 1 – 3 ) . The distribution of Rule Set 1 scores for the previously published GeCKO 6 , 15 and Koike - Yusa et al . 8 libraries resembles the null distribution , as these were not designed with on - target criteria ( Fig . 1a ) . The Wang et al . 7 library incorporated early rules for increas - ing sgRNA activity and has higher Rule Set 1 scores . The Avana and Asiago libraries are , by design , the most enriched for sgRNAs predicted to be active . We first tested our library using a well - established screening system , resistance to vemurafenib ( Zelboraf ) in A375 melanoma cells , which carry the BRAF V600E mutation and are sensitive to MAPK pathway inhibition ( Supplementary Figs . 1 and 2 ) 6 , 16 , 17 . We transduced each of the six Avana subpools , each containing 1 sgRNA per gene , in biological replicates at low multiplicity of infection and performed the same screen with the GeCKOv1 and GeCKOv2 libraries ; for cells infected with the Avana library , we also applied the MEK - inhibitor selumetinib 18 , 19 , another small molecule previously examined in this resistance model ( Supplementary Fig . 3 ) . We ranked sgRNAs by their log 2 fold - change relative to their abundance in the plasmid DNA pool and averaged ranks from the two replicates ( Supplementary Table 4 ) . We first used the RIGER algorithm to analyze the GeCKOv1 , GeCKOv2 and Avana screens ( Supplementary Table 5 and Supplementary Fig . 4 ) . The weighted sum option with RIGER , how - ever , incorporates information from only the top two perturbations Optimized sgrNA design to maximize activity and minimize off - target effects of crisPr - cas9 John G Doench 1 , 5 , Nicolo Fusi 2 , 5 , Meagan Sullender 1 , 5 , Mudra Hegde 1 , 5 , Emma W Vaimberg 1 , 5 , Katherine F Donovan 1 , Ian Smith 1 , Zuzana Tothova 1 , 3 , Craig Wilen 4 , Robert Orchard 4 , Herbert W Virgin 4 , Jennifer Listgarten 2 , 5 & David E Root 1 CRISPR - Cas9 – based genetic screens are a powerful new tool in biology . By simply altering the sequence of the single - guide RNA ( sgRNA ) , one can reprogram Cas9 to target different sites in the genome with relative ease , but the on - target activity and off - target effects of individual sgRNAs can vary widely . Here , we use recently devised sgRNA design rules to create human and mouse genome - wide libraries , perform positive and negative selection screens and observe that the use of these rules produced improved results . Additionally , we profile the off - target activity of thousands of sgRNAs and develop a metric to predict off - target sites . We incorporate these findings from large - scale , empirical data to improve our computational design rules and create optimized sgRNA libraries that maximize on - target activity and minimize off - target effects to enable more effective and efficient genetic screens and genome engineering . 1 Broad Institute of MIT and Harvard , Cambridge , Massachusetts , USA . 2 Microsoft Research New England , Cambridge , Massachusetts , USA . 3 Dana Farber Cancer Institute , Division of Hematologic Malignancies , Boston , Massachusetts , USA . 4 Department of Pathology and Immunology , Washington University School of Medicine , Washington University School of Medicine . , St . Louis , Missouri , USA . 5 These authors contributed equally to this work . Correspondence should be addressed to J . G . D . ( jdoench @ broadinstitute . org ) , N . F . ( fusi @ microsoft . com ) , J . L . ( jennl @ microsoft . com ) or D . E . R . ( droot @ broadinstitute . org ) . Received 7 May 2015 ; accepted 19 November 2015 ; published online 18 January 2016 ; doi : 10 . 1038 / nbt . 3437 n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology VOLUME 34 NUMBER 2 FEBRUARY 2016 185 A rt i c l e s targeting a gene , discarding additional evidence about specificity of the hit list provided by other sgRNAs . We thus developed STARS , an alternative gene - ranking system to generate false - discovery rates ( FDR ) 20 , rewarding genes where a high fraction of sgRNAs are active in the assay , similar to the MAGeCK algorithm 21 . Using STARS , we observed that six genes previously validated to confer vemurafenib resistance ( CUL3 , MED12 , NF1 , NF2 , TADA1 , TADA2B ) all score with FDR < 1 % ( Supplementary Table 6 ) . We directly compared the performance of the three libraries in the lentiGuide vector . At FDR < 10 % , 27 genes were nominated as hits with GeCKOv1 whereas 60 genes scored with GeCKOv2 ( Fig . 1b ) , an increase likely due to library size , as GeCKOv1 averages three to four sgRNAs per gene whereas GeCKOv2 contains six sgRNAs per gene . 92 genes scored at FDR < 10 % with Avana , which also con - tains six sgRNAs per gene . Similarly , 94 genes scored with the Avana library screened in the lentiCRISPRv2 vector , and 36 genes scored at FDR < 10 % across both vectors . We examined the data for new modulators of vemurafenib resistance . With the Avana library , the tumor suppressors PTEN , TP53 and RB1 scored with FDR < 1 % , whereas in the GeCKOv2 library , these genes scored with FDR of 78 % , 7 % and 2 % , respectively ( Supplementary Table 6 ) . We thus annotated the hit lists for PanCancer genes , a highly curated and validated set containing many genes whose loss may restore the MAPK pathway or activate alternative survival path - ways ( Supplementary Table 7 ) 22 . We observed that the Avana library identified more PanCancer genes than either version of GeCKO . At FDR < 10 % , we identified four PanCancer genes with GeCKOv1 ( P = 1 . 1 × 10 −5 , hypergeometric distribution ) , six genes with GeCKOv2 ( P = 2 . 2 × 10 −7 ) and ten with Avana ( P = 2 . 9 × 10 −11 ) . In the selumetinib screen , Avana identified 20 genes ( P = 4 . 6 × 10 −24 ) , including 9 of the 10 genes identified at the same threshold in the comparable vemurafenib data set ( Supplementary Tables 8 and 9 ) . We used a competition assay to validate a selection of newly identi - fied hits . Cells carrying a single sgRNA were mixed with EGFP - labeled cells ; if that sgRNA provided a selective growth advantage , then EGFP - negative cells would be enriched over time , as measured by flow cytometry . We tested this assay with nine positive - control sgRNAs targeting validated hits ( NF1 , NF2 , CUL3 ) ; ten negative - control sgRNAs with no known target ; and five sgRNAs to a new hit , TP53 . When grown without vemurafenib , the fraction of sgRNA - con - taining cells decreased slightly , on average 8 . 4 % across all sgRNAs ( Supplementary Fig . 5 ) . In the presence of vemurafenib , the popula - tions with negative - control sgRNAs died and could not be assessed by flow cytometry , whereas positive - control and TP53 sgRNAs came to represent an average of 93 % and 82 % of the population , respectively ( Supplementary Fig . 5 ) . In a similar competition assay for the six previously validated genes and nine newly identified genes , the average representation of sgRNA - containing cells after addition of vemuraf - enib ranged from 80 % to 90 % and 58 % to 84 % , respectively , validating the reproducibility of all nine selected hits identified by the Avana pri - mary screen ( Fig . 1c ) . Several of these newly validated hits represent additional members of complexes previously identified 23 , 24 . Although screening more sgRNAs per gene increases the power of a library to detect hits , larger libraries require larger - scale screening , reducing the number of conditions that could be screened and bar - ring models with limited cell numbers . We performed subsampling analysis to determine how decreasing the number of sgRNAs affected the hit list for the vemurafenib screen . The Avana library screened in the lentiGuide vector identified 92 hits at FDR < 10 % . For combinations of four one – sgRNA - per - gene subpools , on average 52 % of genes were recovered at the same FDR ( Fig . 1d ) . At a relaxed FDR threshold of < 75 % , 92 % of genes were recovered with four sgRNAs ; similar rates were seen for the Avana library screened in lentiCRISPRv2 ( 93 % ) and for the selumetinib screen in both lentiGuide ( 93 % ) and 0 50 100 10 – 5 10 – 4 10 – 3 10 – 2 10 – 1 1 Avana lentiCRISPRv2 Avana lentiGuide GeCKOv1 lentiCRISPRv1 GeCKOv1 lentiGuide GeCKOv2 lentiGuide F DR 0 50 100 P e r c en t age o f E G F P - nega t i v e c e ll s Vemurafenib ETP Gene ranks , vemurafenib resistance 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 R u l e S e t 1 sc o r e Human Mouse Validated genes , vemurafenib resistance N u ll A v ana G e C K O v 2 G e C K O v 1 W ang N u ll A s i ago K o i k e - Y u s a A R I H 2 C U L3 K I R R E L M E D 23 M E D 12 N F 1 N F 2 P D C D 10 P T E N S U P T20 H T A D A 1 T A D A 2 B T A F 6L T P 53 U B E 2 F a b c 0 50 100 LG 10 , 10 LG 10 , 75 LG 25 , 25 LC 10 , 10 LC 10 , 75 LC 25 , 25 2 3 4 5 6 Number of subpools P e r c en t age o f gene s r e t a i ned 0 20 40 60 80 100 0 0 . 2 0 . 4 0 . 6 0 . 8 1 . 0 GeCKOv1 lentiGuide ( 0 . 67 ) GeCKOv1 lentiCRISPRv1 ( 0 . 69 ) Avana lentiGuide ( 0 . 80 ) Avana lentiCRISPRv2 ( 0 . 77 ) GeCKOv2 lentiGuide ( 0 . 70 ) Percent - rank of core essential sgRNAs C u m u l a t i v e pe r c en t age e d Figure 1 Comparative performance of the Avana library . ( a ) Distribution of Rule Set 1 scores across libraries . The box represents the 25th , 50th and 75th percentiles ; whiskers show 5th and 95th percentiles . ( b ) Comparison of the FDR - corrected q - values determined by STARS for the top 100 ranked genes in the vemurafenib resistance assay in A375 cells . ( c ) Validation of individual sgRNAs for vemurafenib resistance in a competition assay in A375 cells . Horizontal bars represent the average of the individual sgRNAs for each gene . Previously validated genes are labeled in blue . ETP , early time point . ( d ) Subsampling analysis of the Avana library . Genes that passed at different FDR thresholds with STARS when all six subpools were analyzed ( first number in legend ) ; the average number of retained genes that score at different FDR thresholds following removal of subpools ( second number in legend ) . LG , lentiGuide vector ; LC , lentiCRISPRv2 vector . Errors bars , 1 s . d . from the mean of different combinations of subpools . ( e ) ROC - AUC analysis of individual sgRNAs targeting core essential genes in dropout screens in A375 cells . AUC values are indicated in parentheses . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . 186 VOLUME 34 NUMBER 2 FEBRUARY 2016 nature biotechnology A rt i c l e s lentiCRISPRv2 ( 93 % ) ( Supplementary Fig . 6 ) . This observation sug - gests a useful screening strategy , especially for arrayed screens or pooled models where scale - up is costly or prohibitive : perform a primary screen with a small number of sgRNAs at genome - scale , use a relatively relaxed cut - off for hit selection , then perform a secondary screen on hundreds of primary screen hits using additional sgRNAs per gene . We next examined library performance for negative selection , depletion of sgRNAs targeting proliferation - essential genes . Unlike positive selection , where small fractions of cells can be strongly enriched , dropout screens represent a more challenging screening modality , as large fractions of cells receiving perturbations must show the phenotype in order to score . We performed a viability screen using the Avana , GeCKOv1 and GeCKOv2 libraries in A375 cells ( Supplementary Fig . 7 and Supplementary Tables 10 and 11 ) and analyzed sgRNAs targeting a curated set of 291 core essential genes ( Supplementary Table 11 ) 25 . To enable comparison across libraries of different sizes , we performed receiver operating characteristic – area under the curve ( ROC - AUC ) analysis of individual sgRNAs . The Avana library performed significantly better than either version of the GeCKO library , producing AUC values of 0 . 77 and 0 . 80 , versus GeCKO AUC values of 0 . 67 to 0 . 70 ( Fig . 1e ) . Using STARS , Avana identified 171 of the 291 genes ( 59 % ) , whereas GeCKOv2 identified 76 ( 29 % ) at FDR < 10 % ( Supplementary Fig . 8 and Supplementary Table 12 ) . Similarly , using Gene Set Enrichment Analysis 26 , the Avana library identified essential cellular complexes and processes with greater statistical confidence than GeCKOv2 ( Supplementary Fig . 9 ) . Combining data from the Avana and GeCKO libraries followed by STARS analysis identified 1 , 545 and 1 , 952 essential genes in A375 cells at FDR < 10 % and < 25 % , respectively , a range consistent with a recent report ( Supplementary Table 13 ) 27 . We confirmed the improved negative - selection screen performance of the Avana library in HT29 cells , a colon cancer line ( Supplementary Tables 10 and 11 and Supplementary Fig . 10 ) . Here , we screened the first four subpools of the Avana library and observed a significant improve - ment in depletion of core essential genes , despite employing fewer sgRNAs : Avana with 4 sgRNAs identified 161 genes , whereas GeCKOv2 with 6 sgRNAs identified 92 genes ( Supplementary Table 12 ) . To further test the Avana library in different assays , we screened for resistance to the purine analog 6 - thioguanine in three different cell lines . In A375 cells , single sgRNAs dominated each of the six subpools , and all six targeted HPRT1 , a gene well - established in this assay ( Fig . 2a and Supplementary Table 14 ) 28 . The HPRT1 sgRNA in each subpool was enriched at least 700 - fold more than the second - ranked sgRNA , suggesting that none of the other ~ 110 , 000 sgRNAs in this library led to significant off - target activity at the HPRT1 locus . In HT29 and 293T cells , HPRT1 sgRNAs were highly enriched , but targeting of NUDT5 also produced 6 - thioguanine resistance ( Fig . 2a ) . We validated these observations by individual infections in these three cell types with two sgRNAs each against HPRT1 and NUDT5 ( Supplementary Fig . 11 ) . To understand the differential enrichment of NUDT5 sgRNAs among cell lines , we examined genomic DNA by the TIDE technique 29 . Both sgRNAs led to modification of NUDT5 in all three cell lines in the absence of selection ( Fig . 2b ) , suggesting that observed phenotypic differences between cell lines were not due to ineffective gene editing . 6 - thioguanine is a substrate for HPRT1 in the purine salvage pathway , substituting for hypoxanthine and thereby causing toxicity ( Fig . 2c ) . NUDT5 plays an earlier role in purine synthesis , ultimately leading to production of 5 - phosphoribosyl diphosphate ( PRPP ) , another substrate for HPRT1 - catalyzed production of inosine mono - phosphate 30 . Depletion of NUDT5 thus may prevent the toxic effects of 6 - thioguanine incorporation ( Fig . 2c ) 31 . Differences in phenotypic severity between A375 and HT29 cells might relate to the fact that A375 cells have lost one allele of the NUDT5 gene 32 and may have upregulated alternative means of producing PRPP . Finally , we tested the Asiago mouse library in a model of inter - feron signaling in which BV2 cells were challenged with interferon gamma and STARS analysis of surviving cells revealed enrichment of well - established mediators of interferon signaling ( Table 1 and Supplementary Table 15 ) . Nine of the ten most - enriched sgRNAs tar - geted Jak1 , Stat1 , Ifngr1 or Ifngr2 , and all four sgRNAs for each of these genes scored in the top 25 of the 79 , 641 sgRNAs screened . Interestingly , query of the Molecular Signatures Database 33 with human homologs for the genes identified at FDR < 50 % identified a significant enrich - ment for mitochondrial genes ( FDR = 8 . 99 × 10 −12 , hypergeometric test ) not previously implicated in interferon signaling . Rule Set 2 for sgRNA on - target activity We originally modeled on - target activity with 1 , 841 sgRNAs target - ing three human and six mouse genes assayed by flow cytometry ( FC data set ) 14 . To improve predictions , we designed a tiling library targeting all possible NGG protospacer - adjacent motif ( PAM ) - containing sites in 15 genes known to confer resistance to vemuraf - enib , selumetinib , 6 - thioguanine or etoposide . In A375 cells , several genes that were reported as hits for resistance to etoposide ( TOP2A , CDK6 ) 7 and 6 - thioguanine ( MLH1 , MSH2 , MSH6 and PMS2 ) 8 failed , in other cell types , to show significant enrichment under the condi - tions tested here . For small molecules that yielded resistant cells , we examined sgRNA enrichment ( Fig . 3a and Supplementary Table 16 ) . As expected , the activity of individual sgRNAs correlated well between vemurafenib and selumetinib ( Fig . 3b ) . These 2 , 549 sgRNAs , target - ing eight genes , comprise the RES ( resistance ) data set . With combined data for over 4 , 000 sgRNAs targeting 17 genes , we examined the efficacy of each sgRNA versus its position in the protein coding region ( Supplementary Fig . 12 ) . Initial design guide - lines recommended targeting close to the N terminus . Alternatively , Vakoc and colleagues recently reported on improved generation of loss - of - function alleles when targeting specific domains of several well - characterized proteins 34 . For the 17 genes under consideration here , however , we did not observe discrete regions of the protein - coding sequence that were obviously more productive target sites for gene inactivation ( Supplementary Fig . 12 ) . Overall , we observed that only the C - terminal 10 % of the protein - coding region showed a statisti - cally significant reduction in activity ( P < 0 . 02 ) ( Fig . 3c ) . An expanded target site window allows more flexibility in sgRNA selection , both to optimize for on - target efficacy and to minimize off - target potential . Previously , to generate Rule Set 1 , we treated the top 20 % of sgRNAs for each gene as highly active and trained on a 20 % versus 80 % classification model to identify predictive features 14 . We compared the performance of this model , which used support vector machine ( SVM ) with logistic regression , to other classification - based approaches applied to sgRNA activity predictions , SVM 7 , 35 and L1 logistic regression 36 , evaluating performance with a leave - one - gene - out approach . Assessing the FC , RES and combined data sets , we observed the best performance from SVM plus logistic regression ( Fig . 4a and Supplementary Fig . 13 ) . The SVM - alone or L1 logistic regression models augmented with dinucleotide features , previously found to be informative , performed worse than SVM plus logistic regression on these data sets ( Fig . 4a ) . Discretizing sgRNA activity into 20 % versus 80 % classes , although convenient , likely resulted in considerable information loss , and thus we explored regression models using normalized sgRNA ranks . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology VOLUME 34 NUMBER 2 FEBRUARY 2016 187 A rt i c l e s We initially retained the same evaluation metric used in the derivation of Rule Set 1 , AUC , and observed that L1 - regularized linear regression ( a continuous regression model ) outperformed L1 - regularized logistic regression ( a discrete classification model ) when trained on the same FC data with the same features ; we observed a similar result with Spearman correlation , a more suitable metric for regression models ( Supplementary Fig . 14 ) . These results suggested further exploration of linear regression models . Another important factor besides the modeling approach for predicting activity is the feature set . Previously , we used single and dinucleotide position - specific nucleotides , and the GC count of the sgRNA 14 . We hypothesized that additional features , such as position - independent nucleotide counts and the location of the sgRNA target site within the gene , could improve predictions . Biochemical and structural studies indicate that the sgRNA participates in step - wise association with DNA , suggesting that localized thermodynamic properties may also be useful 37 , 38 . These additional features improved the L1 regression model for all data sets ( Fig . 4b ) . Microhomology features , suggested to improve sgRNA activity 39 , were predictive on their own but did not improve performance when added to our final model . Because regression models and additional features gave improved results , we investigated the performance of five different regression models . On the RES data and the combined data set , the gradient - boosted regression trees model exhibited better Spearman correlation than all others , whereas for the FC data set , it performed comparably to L1 - and L2 - regression models ( Fig . 4c ) . We conclude that the gradient - boosted regression trees model was the best among those compared here . In this model , dinucleotide and single - nucleotide identities at each position of the sgRNA continued to contribute most to activity predictions , representing a total of 58 % of the Gini impor - tance , a measure of the weight each feature contributes to the overall model ( Supplementary Fig . 15 and Supplementary Table 17 ) . New features contributed substantially : position - independent counts of single and dinucleotides , location of the sgRNA within the protein and melting temperatures of different regions gave Gini importance values of 16 % , 13 % and 11 % , respectively . To gauge if the amount of data had saturated the model , we systematically added genes to the training set , assessed performance , and observed a plateau in per - formance with the combined data set ( Fig . 4d ) . Furthermore , when trained and tested on all pairwise combinations of data sets , the model trained with the combined data set produced the best results across all test sets ( Supplementary Fig . 16 ) . We refer to the gradient - bossed regression trees model with the augmented feature set trained on the combined data set as Rule Set 2 . For further validation of Rule Set 2 , we assessed performance on independent negative selection data sets not used in the construction or evaluation of the final model , from two human cell lines 7 and mouse embryonic stem cells 8 , curated by Xu and colleagues 7 , 8 , 36 . Rule Set 1 scores clearly distinguished sgRNAs classified as effective versus ineffective in all three data sets , with P - values of 1 . 4 × 10 −32 , 1 . 8 × 10 −16 and 1 . 1 × 10 −11 ( two - sample Kolmogorov - Smirnov test ; Supplementary Fig . 17 ) . With Rule Set 2 , we observed even more sig - nificant distinctions between effective and ineffective sgRNAs , with respective P - values of 5 . 9 × 10 −80 , 2 . 1 × 10 −24 and 3 . 9 × 10 −35 ( Fig . 4e ) , illustrating the generalizability of our modeling approach . We next examined curated data sets from screens that used CRISPR activation ( CRISPRa ) and CRISPR interference ( CRISPRi ) technology 36 , 40 . In the largest CRISPRi data set , comprising over 5 , 000 sgRNAs in a negative selection screen , Rule Set 2 exhibited the greatest difference in the distributions of scores for sgRNAs classi - fied as effective versus ineffective ( P - value = 1 . 8 × 10 −40 , two - sample Kolmogorov - Smirnov test ; Fig . 4f ) . A smaller positive - selection screen with 571 sgRNAs gave a P - value of 1 . 1 × 10 −4 . In the smallest data set , 532 sgRNAs from a positive - selection CRISPRa screen , Rule Set 2 again favored effective sgRNAs but with a higher P - value ( 0 . 14 ) . Together , these observations suggest that commonalities between CRISPR knockout and CRISPRa / i , such as the interactions between the sgRNA and Cas9 , and the sgRNA and DNA , represent meaningful components of the predictive power of Rule Set 2 . CFD score to predict sgRNA off - target effects The off - target effects of sgRNAs have been extensively investigated across many experimental systems , and conclusions regarding the extent of off - target activity have varied widely 5 . We sought to under - stand off - target effects under typical pooled - screening conditions in mammalian cells using a library targeting the coding sequence of human CD33 with all possible sgRNAs , regardless of PAM . For all sites with the canonical NGG PAM , in addition to the perfect - match sgRNAs , we introduced three types of sgRNA mutations : first , all 1 - nucleotide deletions ; second , all 1 - nucleotide insertions ; third , all 1 - nucleotide mismatches to the target DNA , generating a library with 27 , 897 unique sgRNAs . To these we added 10 , 618 sgRNAs targeting the mouse Thy1 locus to serve as negative controls . We infected MOLM13 cells and performed flow cytometry to isolate CD33 - negative cells ( Supplementary Fig . 18 and Supplementary Table 18 ) . 293T HT29 A375 HPRT1 NUDT5 10 5 10 4 10 3 10 2 10 1 0 0 . 5 1 . 0 P e r c en t age ed i t ed a ll e l e s 6 - thioguanine No drug 4 4 4 6 6 6 A375 HT29 293T F o l d en r i c h m en t 1 1 2 3 4 5 6 1 2 3 4 5 6 PRPS1 HPRT1 NUDT5 ADP - ribose Ribose - 5 - phosphate PRPP Hypoxanthine 6 - thioguanine Inosine monophosphate Cell death a b c * N N O N NH NH N S NH 2 N NH H Figure 2 HPRT1 and NUDT5 confer 6 - thioguanine resistance . ( a ) For each of six sgRNAs targeting these genes , fold - enrichment for the indicated sgRNA after 2 weeks of selection with 6 - thioguanine , relative to its starting abundance , assayed in three different cell lines . ( b ) TIDE analysis of indels for sgRNAs number 4 and 6 from a targeting NUDT5 tested in three cell lines . Asterisk indicates a sample where no cells survived . ( c ) Schematic of purine metabolism . Proteins are shown in blue circles , small molecules in italics . PRPS1 is also known as PRPP synthetase ; PRPP is phosphoribosyl pyrophosphate . Table 1 Screening results for mediators of interferon - gamma signaling using the mouse genome - wide Asiago library Gene symbol sgRNA ranks STARS score P - value FDR Jak1 4 ; 5 ; 10 ; 13 15 . 15 < 3 . 66 × 10 −6 < 2 . 61 × 10 −4 Ifngr2 7 ; 11 ; 12 ; 15 14 . 90 < 3 . 66 × 10 −6 < 2 . 61 × 10 −4 Stat1 1 ; 2 ; 9 ; 16 14 . 79 < 3 . 66 × 10 −6 < 2 . 61 × 10 −4 Ifngr1 3 ; 6 ; 14 ; 22 14 . 23 < 3 . 66 × 10 −6 < 2 . 61 × 10 −4 Jak2 18 ; 20 ; 55 ; 178 10 . 60 < 3 . 66 × 10 −6 < 2 . 61 × 10 −4 Ifnar1 131 ; 145 ; 273 ; 1176 7 . 32 1 . 10 × 10 −5 6 . 53 × 10 −4 Irf9 71 ; 74 ; 196 ; 56950 7 . 23 1 . 10 × 10 −5 5 . 60 × 10 −4 Ifnar2 37 ; 137 ; 348 ; 8433 6 . 48 7 . 68 × 10 −5 3 . 43 × 10 −3 Full results are provided in Supplementary Table 15 . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . 188 VOLUME 34 NUMBER 2 FEBRUARY 2016 nature biotechnology A rt i c l e s We examined the activity profile of perfect match sgRNAs with an NGG PAM to identify CD33 target sites that led to robust loss of function , and subsequent analyses examined sgRNAs only in this region ( Supplementary Fig . 19 ) . Using negative control sgRNAs to define inactivity , we compared the activities of sgRNAs with different PAM sequences . As expected , sgRNAs with an NGG PAM had the highest proportion of active sgRNAs , 91 % ( Fig . 5a ) . Some alternative PAM sequences led to notable but smaller rates of sgRNA activity : NAG ( 26 % ) , NCG ( 11 % ) and NGA ( 7 % ) . Although alternative PAMs should be avoided to maximize on - target activity , they must be considered as potential off - target sites 13 . To examine sgRNAs with mismatches , deletions or insertions to their target DNA , we identified 65 perfect - match sgRNAs that produced > 4 . 8 - fold enrichment for a CD33 knockout , two s . d . above the mean of the negative control sgRNAs ( Fig . 5b ) , and their 9 , 914 associated variant sgRNAs . The activity distribution of these variants was bimodal , providing a clear threshold to classify each as active or inactive . We then calculated the percent - activity for sgRNAs sharing the same nucleotide mutation at the same position , that is , the fraction of individual sgRNA - DNA interactions that led to activity , a calculation enabled by sampling from large numbers of sgRNAs ( Supplementary Table 19 and Supplementary Fig . 20 ) . We also calculated the delta - log - fold - change ( dLFC ) to quantify the decrease in activity for each variant sgRNA relative to its perfect match sgRNA ( Supplementary Table 19 ) . The two metrics for assessment of mismatch variants , percent - activity and dLFC , were highly correlated ( R = −0 . 97 , Pearson correlation coefficient , Supplementary Fig . 21 ) . We next examined the changes in activity produced by the three different types of variants . Deletions in the RNA , which created a single bulged DNA base , seldom led to activity ( Fig . 5c ) . Of the 76 nucleotide and position combinations ( we did not assess nucleotide l og 2 f o l d - c hange 6 - thioguanineSelumetinibVemurafenib – 4 – 4 – 2 – 2 0 0 2 2 4 4 l og 2 f o l d - c hange : v e m u r a f en i b −6 −4 −2 0 2 4 6 log 2 fold - change : selumetinib 0 – 1010 – 2020 – 3030 – 4040 – 5050 – 6060 – 7070 – 8080 – 90 90 – 100 0 0 . 2 0 . 4 0 . 6 0 . 8 Protein target site A v e r age pe r c en t r an k * C C D C 101 C U L3 H P R T 1 M E D 12 N F 1 N F 2 T A D A 1 T A D A 2 B a b c Figure 3 Tiled library screen for resistance genes . ( a ) Performance of sgRNAs by gene for each of three small - molecule challenges . The box represents the 25th , 50th and 75th percentiles , whiskers show 5th and 95th percentiles , and outliers are shown as individual dots . ( b ) For sgRNAs targeting MED12 , comparison of the log2 fold - change when challenged with vemurafenib and selumetinib . ( c ) Activity of sgRNAs as a function of target site within the protein , divided by deciles , for 17 proteins . The box represents the 25th , 50th and 75th percentiles ; whiskers show 10th and 90th percentiles . Asterisk indicates statistically significant difference in activity ( adjusted P - values < 0 . 02 , one - way ANOVA with repeated measures , with Tukey’s correction for multiple comparisons ) . 0 0 . 1 0 . 2 0 . 3 0 . 4 0 . 5 0 . 6 0 . 7 S pea r m an c o rr e l a t i on SVM + LogReg ( Doench , RS1 ) L1 class . , 1 & 2 nts L1 class . , 1 nt only ( Xu ) SVM , 1 & 2 nts SVM , 1 nt only ( Wang ) Train : Test : FC FC RES RES FC + RES FC + RES 0 0 . 1 0 . 2 0 . 3 0 . 4 0 . 5 0 . 6 0 . 7 S pea r m an c o rr e l a t i on 0 0 . 1 0 . 2 0 . 3 0 . 4 0 . 5 0 . 6 0 . 7 Original + new features Original features S pea r m an c o rr e l a t i on Train : Test : FC FC RES RES FC + RES FC + RES Train : Test : FC FC RES RES FC + RES FC + RES Train : Test : FC FC RES RES FC + RES FC + RES * * * * * * * * * * * * * * * * * * * * * n . s . 0 . 2 0 . 4 0 . 6 0 . 8 CRISPRi CRISPRa Eff Ineff Eff Ineff Eff Ineff Positive Positive Negative R u l e S e t 2 sc o r e 3 , 817 2 , 795 351 220 213 319 n : Activity : Selection : Cas9 type : CRISPRi R u l e S e t 2 sc o r e 0 . 2 0 . 4 0 . 6 0 . 8 Eff Ineff Ineff Eff Eff Ineff Mouse Human Human n : Activity : Species : 731 438 671 237 830 234 All essential Non - Ribo Ribosomal Dataset : * * * * * * * * * * * * * * * * * * * n . s . 0 0 . 2 0 . 4 0 . 6 S pea r m an c o rr e l a t i on e f Boosted RT ( RS2 ) L1 regression L2 regression Random forest SVM + LogReg ( RS1 ) Linear regression a b c d * * * * * * * Figure 4 Development of Rule Set 2 for prediction of sgRNA on - target activity . ( a ) Comparison of classification models . Spearman correlation between measured activity and predicted activity score is plotted . Error bars show the s . d . across genes with a leave - one - gene - out approach . SVM + LogReg ( Rule Set 1 ) performs better than the next - best model for all three data sets ( left to right , P = 1 . 8 × 10 −8 , 5 . 2 × 10 −13 and P < 10 −16 , using the statistical test for differences in Spearman correlation ) 48 . ( b ) Addition of new features improves performance using L1 linear regression . Significance determined as in a ; * * P = 4 . 2 × 10 −3 ; * * * P = 2 . 32 × 10 −4 ; * * * * P < 10 −16 . ( c ) Comparison of regression models , as well as the best - performing classification model , SVM + LogReg . Significance values are shown for the comparison between gradient - boosted regression trees ( Boosted RT ) and L1 regression , using the same measure of significance as in a ; P = 0 . 054 ( n . s . , not significant ) ; * * * P = 4 . 9 × 10 −4 ; * * * * P = 5 . 3 × 10 −5 . ( d ) Assessment of modeling performance with increasing number of genes used in each training set . Error bars indicate one s . d . across genes with a leave - one - gene - out approach . ( e ) Rule Set 2 performance on independently generated negative selection data sets . From left to right , for the three comparisons P = 5 . 9 × 10 −80 , 2 . 1 × 10 −24 and 3 . 9 × 10 −35 ( two - sample Kolmogorov - Smirnov test ) . ( f ) Rule Set 2 performance on independently generated CRISPRa / i data sets . From left to right , for the three comparisons * * * * P = 1 . 8 × 10 −40 , * * * P = 1 . 1 × 10 −4 and P = 0 . 14 ( n . s . ) ( two - sample Kolmogorov - Smirnov test ) . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology VOLUME 34 NUMBER 2 FEBRUARY 2016 189 A rt i c l e s number 1 ) , only 14 of these types of deletions retained high levels of cleavage using the dLFC metric ( P > 10 −4 ) , 13 of which occurred at positions 2 , 3 , 19 and 20 . Notably , at positions 19 and 20 we observed that deletion of cytidine in the RNA to create a bulged guanine in the DNA was poorly tolerated , with only 4 % of sgRNAs showing activity , whereas deletion of other nucleotides led to an average of 44 % of active sgRNAs . Likewise , an extra base in the sgRNA sequence rarely preserved activity ; only positions 2 and 3 gave rise to high levels of activity at the same P - value threshold ( Fig . 5d ) . Asymmetric sgRNA - DNA interactions that lead to bulged RNA or DNA bases have been examined for a small number of examples , and our results are qualitatively consistent 41 . Finally , we examined single - base mismatches between the sgRNA and DNA . Overall , both the position and identities of mismatched nucleotides played major roles in determining activity ( Fig . 5e ) . For example , rG - dT mismatches were generally tolerated even in the PAM - proximal region : across all positions , 256 of 289 ( 89 % ) of these interactions were active . Conversely , only 37 % of rC - dC interactions preserved sgRNA activity . Other nucleotide mismatches , however , had quite different effects at different positions . For example , 0 of 46 purine - purine mismatches at position 16 were active , compared to 30 of 31 mismatches with a thymidine in the DNA . By contrast , at position 19 , 41 % of purine - purine mismatches and 48 % of mispaired thymidines led to active sgRNAs . These results suggest that each type of mismatch must be evaluated individually and that metrics to score off - target sites must incorporate both the position and identity of imperfectly matched RNA - DNA interactions . Using these data , we propose the cutting frequency determination ( CFD ) score to calculate the off - target potential of sgRNA - DNA interactions . We tested the ability of the CFD score to predict off - target , imperfect - match activity for an independent data set of 89 sgRNAs designed to target H2 - D ( also known as , ) some of which were previously shown to produce effective protein knockout of H2 - K ( also known as ) , a gene with highly similar sequence 14 . We compared the CFD score to two previously described off - target scoring metrics , the CCtop 42 and Hsu - Zhang 13 scores , both of which consider the position and number , but not identity , of mismatches between the RNA and DNA . The CFD score correlated best with the measured activity of these 89 off - target sgRNAs ( Supplementary Table 20 ) . Dividing the data set by number of mismatches , the CFD score per - formed best in each subset ; with two or more mismatches , both the Hsu - Zhang and CCtop scores showed poor correlation to measured activity ( Fig . 5f ) . To further evaluate the CFD score , we examined results obtained with GUIDE - seq , an experimental approach for detection of sgRNA target sites 43 . In those data , nine sgRNA sequences produced a total of 402 off - target sites . We compared the number of GUIDE - seq reads , a measure of sgRNA activity , to the calculated off - target scores and observed the best Pearson correlation with the CFD score ( R = 0 . 40 ) , followed by CCtop ( 0 . 31 ) and Hsu - Zhang ( 0 . 26 ) . As GUIDE - seq is an A UGC UGC DN A bu l ge ( de l e t i on ) 4 2 0 – 2 – 4 A Position in sgRNA PAM dinucleotides C t r l s AA A C A G A T C A C C C G C T G A G C G G G T T A T C T G TT 2 3 4 5 6 7 8 9 1011121314151617181920 RN A bu l ge ( i n s e r t i on ) 1 . 4 1 . 2 1 . 0 0 . 8 0 . 6 0 . 4 0 . 2 0 log 2 fold - change D en s i t y Negative controls Variants of perfect match Perfect match – 6 – 4 – 2 0 2 4 6 l og 2 f o l d - c hange a b c d M i s m a t c h rU : dT rU : dG rU : dC rG : dT rG : dG rG : dA rC : dT rC : dC rC : dA rA : dG rA : dC rA : dA P e r c en t - a c t i v e sc a l e e 0 CFD Hsu - Zhang Number of mismatches P ea r s on c o rr e l a t i on 2 3 4 5 6 7 8 9 1011121314151617181920 1 0 10 20 30 40 50 60 70 80 90 100 Position in sgRNA – 0 . 2 0 . 6 0 . 4 0 . 2 3 + ( n = 29 ) 2 ( n = 23 ) 1 ( n = 37 ) 2 3 4 5 6 A UC Number of mismatches 1 . 0 0 . 9 0 . 8 0 . 7 0 . 6 0 . 5 f g 128 64 32 16 8 4 2 1 0 . 5 P r o t e i n - c od i ng o ff - t a r ge t s i t e s w i t h C F D sc o r e s > 0 . 2 700 600 500 400 300 200 100 C oun t o f s g RN A s t a r ge t i ng none ss en t i a l gene s * * * * 90 – 100 80 – 90 70 – 80 60 – 70 50 – 60 40 – 50 30 – 40 20 – 30 10 – 20 0 – 10 sgRNA depletion rank , binned by decile h i CCTop 0 Figure 5 CFD score for assessing off - target activity of sgRNAs . ( a ) Activity of sgRNAs as a function of the final two nucleotides of the PAM . The box represents the 25th , 50th and 75th percentiles , whiskers show 5th and 95th percentiles , and outliers are shown as individual dots . ( b ) Distribution of log 2 fold - change values for three classifications of sgRNAs assessed by flow cytometry for activity against CD33 . ( c ) Heat - map of the percent - active values for all sgRNA - DNA interactions where one nucleotide was removed from the sgRNA , creating a bulged DNA base . ( d ) Same as in c but with an insertion of nucleotide in the sgRNA to create a bulged RNA base . ( e ) Same as in c and d but with symmetric mismatches . Grayscale is the same for c – e . ( f ) Comparison of the correlation of three off - target scoring metrics to measured off - target activity of 89 sgRNAs with mismatches to the cell surface receptor H2 - K . ( g ) AUC values for GUIDE - seq reads as a function of number of mismatches assessed by three scoring metrics ; same color scheme as in f . ( h ) Distribution of sgRNAs targeting nonessential genes in a dropout screen in A375 cells . All 109 , 463 sgRNAs in the Avana library screened in A375 cells were ranked by their depletion , binned by decile , and the count of 4 , 950 sgRNAs targeting the set of nonessential genes in each bin is plotted . ( i ) For the sgRNAs targeting nonessential genes plotted in h , the distribution of the number of off - target sites in protein - coding regions with CFD scores > 0 . 2 . The box represents the 25th , 50th and 75th percentiles , whiskers show 10th and 90th percentiles . * * * * P < 10 −4 , Kruskal - Wallis test ; the most - depleted sgRNAs . The x - axis is the same for panels h and i . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . 190 VOLUME 34 NUMBER 2 FEBRUARY 2016 nature biotechnology A rt i c l e s ostensibly unbiased method to detect off - target sites , it is noteworthy that only 11 ( 2 . 5 % ) of the observed sites received CFD scores < 0 . 05 and were among the weakest , averaging 100 - fold fewer reads than the perfect - match sgRNAs . We next examined the specificity of these off - target scoring metrics . Importantly , we observed that the alignment tool Bowtie2 ( ref . 44 ) , used by the E - CRISP portal 45 , does not return all possible mismatched sites , especially as the number of mismatches increases ( Supplementary Fig . 22 ) . Thus , the poor performance of the E - CRISP and Zhang portals in identifying off - target sites documented by Joung and colleagues 43 may be partly a failure to identify all high - homology candidate sites rather than the scoring of the sites once found . We therefore used Cas - OFFinder 46 , a comparatively slow but compre - hensive tool , to identify all possible sites with six or fewer mismatches to the nine sgRNAs examined by GUIDE - seq and scored them with the various metrics . As the number of potential off - target sites increases exponentially with the number of mismatches , we examined each separately ( excluding sites with one mismatch , as there were no such sites with zero GUIDE - seq reads , precluding a determination of sensitivity ) . We observed that the CFD score performed best , with AUC values ranging from 0 . 82 – 0 . 98 , whereas the Hsu - Zhang scores ranged from 0 . 61 to 0 . 87 and CCtop’s ranged from 0 . 64 to 0 . 77 ( Fig . 5g ) . We conclude that the CFD score will enable avoidance of the majority of high - frequency off - target effects . To determine the impact of off - target activity on screening results , we used a curated set of 927 nonessential genes 25 . The Avana library contains 4 , 950 sgRNAs targeting these genes , and we examined their behavior in the viability screen in A375 cells described above . As expected , proportionally far fewer of these sgRNAs showed evidence of strong depletion ( Fig . 5h ) . Using the CFD score , there was a statisti - cally significant increase in the number of off - target sites predicted for the most lethal of these sgRNAs ( Fig . 5i ) . This observation suggests that sgRNAs with more predicted off - target sites are more frequently errone - ously depleted in a negative selection screen , and thus avoidance of such promiscuous sgRNAs will lead to improved library performance . Optimized sgRNA libraries : Brunello and Brie Finally , we incorporated our improved on - target activity predictions , Rule Set 2 , with our off - target avoidance metric , the CFD score , to design fully optimized libraries for the human and mouse genomes , named Brunello and Brie , respectively ( Supplementary Tables 21 and 22 ) . These new libraries are designed to maximize Rule Set 2 scores and minimize off - target sites with high CFD scores ( Fig . 6a – c ) . Brunello and Brie thus likely represent a clear improvement over existing libraries ; they are available via Addgene . Our web portals incorporate Rule Set 2 and CFD models ( http : / / www . broadinstitute . org / rnai / public / analysis - tools / sgrna - design and http : / / research . microsoft . com / en - us / projects / azimuth / ) and provide code for incorporation of these scores into existing tools ( Supplementary Code ) . DISCUSSION Using our previous rules for rational design of sgRNAs , Rule Set 1 , we created human and mouse genome - wide libraries and performed genetic screens . In both positive and negative selection screens with the Avana library , expected hits ( e . g . , PanCancer genes 22 , core essentials 25 and previously validated targets 6 ) scored as strong hits with multiple sgRNAs , and the screens produced a greater number of statistically significant genes compared to existing libraries , allowing the identification and confirmation of new genes in these phenotypic assays . Predictions of sgRNA activity with Rule Set 1 were imperfect , however , leaving opportunity for further improvements in library design . By doubling the size of the sgRNA activity data set and iden - tifying a more effective modeling approach , we developed Rule Set 2 , which shows demonstrably improved performance versus Rule Set 1 across multiple data sets from multiple laboratories . Notably , the ability of Rule Set 2 to predict performance extends to CRISPRa and CRISPRi screens . Thus , sgRNA designs based on Rule Set 2 ( such as our Brunello and Brie libraries ) should deliver substantial additional improvements in library performance . Another major factor driving library performance is specifi - city . Joung and colleagues compared their experimentally detected off - target sites to those found by two common off - target prediction algorithms and noted that “neither program identified the vast majority of off - target sites found by GUIDE - seq” 43 . Whereas Rule Sets 1 and 2 represent data - driven , quantitative models of on - target sgRNA effec - tiveness , a quantitative analysis of off - target interactions based on similarly large - scale data has been lacking , and the ability to predict off - target effects therefore quite limited . Our analysis of 9 , 914 sgRNA variants that represent all single - base mismatches and indels for 65 DNA targets revealed that the pattern of activity effects is complex , and would not be fully apparent by examining smaller numbers of sgRNA - DNA interactions . We used these data to derive the CFD score to predict the likelihood of off - target cutting and showed that it out - performed other off - target scoring metrics . Together , these results provided direction for the creation of even more active and specific libraries for the human and mouse genomes . The current work provides a resource for the design of improved sgRNA reagents for large - scale screens and small - scale gene editing experiments . As one of the biggest challenges for screens is iden - tifying faithful models for the biology of interest , confirming the Human Mouse R u l e S e t 2 sc o r e 0 . 8 0 . 7 0 . 6 0 . 5 0 . 4 0 . 3 0 . 2 B r i e N u ll G e C K O v 1 G e C K O v 2 W ang A v ana B r une ll o N u ll K o i k e - Y u s a A s i ago c 0 5 10 15 20 C u m u l a t i v e p e r c en t age 0 1 . 0 0 . 5 0 5 10 15 20 GeCKOv2GeCKOv1Avana C u m u l a t i v e p e r c en t age 0 1 . 0 0 . 5 Number of protein - coding off - target sites with CFD score > 0 . 2 Brunello All sgRNAs Wang All sgRNAs Koike - Yusa AsiagoBrie a b Number of protein - coding off - target sites with CFD score > 0 . 2 Figure 6 On - target and off - target properties of the Brunello and Brie libraries . ( a ) Distribution of Rule Set 2 on - target activity scores across libraries . The box represents the 25th , 50th and 75th percentiles , whiskers show 5th and 95th percentiles . ( b , c ) Cumulative distribution of the number of off - target sites with CFD scores > 0 . 2 in protein - coding regions across human libraries ( b ) and mouse libraries ( c ) . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology VOLUME 34 NUMBER 2 FEBRUARY 2016 191 A rt i c l e s generalizability of a finding may require examination of multiple cellular models . Smaller libraries with a high fraction of active and specific sgRNAs , enabled by better on - and off - target activity predic - tions , will facilitate cost - effective screening across a range of model systems . Directly comparing the effectiveness of CRISPR knockout libraries to other gene - depletion approaches , such as state - of - the - art RNA interference ( RNAi ) 47 and CRISPRi 40 libraries , will likely reveal different strengths , and thus complete assessment of model systems will benefit from screening with multiple modalities . Additionally , future work will determine if the results obtained using Streptococcus pyogenes Cas9 provide useful lessons regarding the activity of other Cas9 proteins . The experimental and analytical approaches described here illustrate a method to uncover factors contributing to sgRNA activity and specificity and to optimize reagent design for large - scale functional genomics . METHODS Methods and any associated references are available in the online version of the paper . Accession codes . SRA : SRP063278 . Note : Any Supplementary Information and Source Data files are available in the online version of the paper . ACKNOWLEDGMENTS We thank M . Tomko , M . Greene , A . Brown , D . Alan and T . Green for software engineering support , and T . Nguyen , N . Tran and X . Yang for library production support ( Broad Institute ) . Z . T . is funded by NIH 5K12CA087723 - 12 , ASCO Young Investigator Award , LLS Special Fellow Award . J . G . D . is a Merkin Institute Fellow and is supported by the Next Generation Fund at the Broad Institute of MIT and Harvard . AUTHOR CONTRIBUTIONS J . G . D . , M . S . , E . W . V . , Z . T . , C . W . and R . O . designed experiments ; M . S . , E . W . V . , K . F . D . , Z . T . , C . W . and R . O . performed experiments ; J . G . D . , M . H . and I . S . analyzed experiments ; N . F . and J . L . performed the computational modeling ; J . G . D . , N . F . , J . L . and D . E . R . wrote the manuscript with assistance from other authors ; J . G . D . , H . W . V . and D . E . R . supervised the research . COMPETING FINANCIAL INTERESTS The authors declare competing financial interests : details are available in the online version of the paper . reprints and permissions information is available online at http : / / www . nature . com / reprints / index . html . 1 . Jinek , M . et al . A programmable dual - RNA - guided DNA endonuclease in adaptive bacterial immunity . Science 337 , 816 – 821 ( 2012 ) . 2 . Mali , P . et al . RNA - guided human genome engineering via Cas9 . Science 339 , 823 – 826 ( 2013 ) . 3 . Cong , L . et al . Multiplex genome engineering using CRISPR / Cas systems . Science 339 , 819 – 823 ( 2013 ) . 4 . Jinek , M . et al . RNA - programmed genome editing in human cells . eLife 2 , e00471 ( 2013 ) . 5 . Hartenian , E . & Doench , J . G . Genetic screens and functional genomics using CRISPR / Cas9 technology . FEBS J . 282 , 1383 – 1393 ( 2015 ) . 6 . Shalem , O . et al . Genome - scale CRISPR - Cas9 knockout screening in human cells . Science 343 , 84 – 87 ( 2014 ) . 7 . Wang , T . , Wei , J . J . , Sabatini , D . M . & Lander , E . S . Genetic screens in human cells using the CRISPR - Cas9 system . Science 343 , 80 – 84 ( 2014 ) . 8 . Koike - Yusa , H . , Li , Y . , Tan , E . - P . , Velasco - Herrera , Mdel . C . & Yusa , K . Genome - wide recessive genetic screening in mammalian cells with a lentiviral CRISPR - guide RNA library . Nat . Biotechnol . 32 , 267 – 273 ( 2014 ) . 9 . Fu , Y . et al . High - frequency off - target mutagenesis induced by CRISPR - Cas nucleases in human cells . Nat . Biotechnol . 31 , 822 – 826 ( 2013 ) . 10 . Veres , A . et al . Low incidence of off - target mutations in individual CRISPR - Cas9 and TALEN targeted human stem cell clones detected by whole - genome sequencing . Cell Stem Cell 15 , 27 – 30 ( 2014 ) . 11 . Ran , F . A . et al . Double nicking by RNA - guided CRISPR Cas9 for enhanced genome editing specificity . Cell 154 , 1380 – 1389 ( 2013 ) . 12 . Guilinger , J . P . , Thompson , D . B . & Liu , D . R . Fusion of catalytically inactive Cas9 to FokI nuclease improves the specificity of genome modification . Nat . Biotechnol . 32 , 577 – 582 ( 2014 ) . 13 . Hsu , P . D . et al . DNA targeting specificity of RNA - guided Cas9 nucleases . Nat . Biotechnol . 31 , 827 – 832 ( 2013 ) . 14 . Doench , J . G . et al . Rational design of highly active sgRNAs for CRISPR - Cas9 - mediated gene inactivation . Nat . Biotechnol . 32 , 1262 – 1267 ( 2014 ) . 15 . Sanjana , N . E . , Shalem , O . & Zhang , F . Improved vectors and genome - wide libraries for CRISPR screening . Nat . Methods 11 , 783 – 784 ( 2014 ) . 16 . Whittaker , S . R . et al . A genome - scale RNA interference screen implicates NF1 loss in resistance to RAF inhibition . Cancer Discov . 3 , 350 – 362 ( 2013 ) . 17 . Bollag , G . et al . Clinical efficacy of a RAF inhibitor needs broad target blockade in BRAF - mutant melanoma . Nature 467 , 596 – 599 ( 2010 ) . 18 . Johannessen , C . M . et al . COT drives resistance to RAF inhibition through MAP kinase pathway reactivation . Nature 468 , 968 – 972 ( 2010 ) . 19 . Davies , B . R . et al . AZD6244 ( ARRY - 142886 ) , a potent inhibitor of mitogen - activated protein kinase / extracellular signal - regulated kinase kinase 1 / 2 kinases : mechanism of action in vivo , pharmacokinetic / pharmacodynamic relationship , and potential for combination in preclinical models . Mol . Cancer Ther . 6 , 2209 – 2219 ( 2007 ) . 20 . Storey , J . D . & Tibshirani , R . Statistical significance for genomewide studies . Proc . Natl . Acad . Sci . USA 100 , 9440 – 9445 ( 2003 ) . 21 . Li , W . et al . MAGeCK enables robust identification of essential genes from genome - scale CRISPR / Cas9 knockout screens . Genome Biol . 15 , 554 ( 2014 ) . 22 . Lawrence , M . S . et al . Discovery and saturation analysis of cancer genes across 21 tumour types . Nature 505 , 495 – 501 ( 2014 ) . 23 . Bae , S . et al . TRIAD1 inhibits MDM2 - mediated p53 ubiquitination and degradation . FEBS Lett . 586 , 3057 – 3063 ( 2012 ) . 24 . Gamper , A . M . & Roeder , R . G . Multivalent binding of p53 to the STAGA complex mediates coactivator recruitment after UV damage . Mol . Cell . Biol . 28 , 2517 – 2527 ( 2008 ) . 25 . Hart , T . , Brown , K . R . , Sircoulomb , F . , Rottapel , R . & Moffat , J . Measuring error rates in genomic perturbation screens : gold standards for human functional genomics . Mol . Syst . Biol . 10 , 733 ( 2014 ) . 26 . Subramanian , A . et al . Gene set enrichment analysis : a knowledge - based approach for interpreting genome - wide expression profiles . Proc . Natl . Acad . Sci . USA 102 , 15545 – 15550 ( 2005 ) . 27 . Wang , T . et al . Identification and characterization of essential genes in the human genome . Science 350 , 1096 – 1101 ( 2015 ) . 28 . Caskey , C . T . & Kruh , G . D . The HPRT locus . Cell 16 , 1 – 9 ( 1979 ) . 29 . Brinkman , E . K . , Chen , T . , Amendola , M . & van Steensel , B . Easy quantitative assessment of genome editing by sequence trace decomposition . Nucleic Acids Res . 42 , e168 ( 2014 ) . 30 . Zha , M . et al . Molecular mechanism of ADP - ribose hydrolysis by human NUDT5 from structural and kinetic studies . J . Mol . Biol . 379 , 568 – 578 ( 2008 ) . 31 . Cheok , M . H . & Evans , W . E . Acute lymphoblastic leukaemia : a model for the pharmacogenomics of cancer therapy . Nat . Rev . Cancer 6 , 117 – 129 ( 2006 ) . 32 . Barretina , J . et al . The Cancer Cell Line Encyclopedia enables predictive modelling of anticancer drug sensitivity . Nature 483 , 603 – 607 ( 2012 ) . 33 . Liberzon , A . et al . Molecular signatures database ( MSigDB ) 3 . 0 . Bioinformatics 27 , 1739 – 1740 ( 2011 ) . 34 . Shi , J . et al . Discovery of cancer drug targets by CRISPR - Cas9 screening of protein domains . Nat . Biotechnol . 33 , 661 – 667 ( 2015 ) . 35 . Chari , R . , Mali , P . , Moosburner , M . & Church , G . M . Unraveling CRISPR - Cas9 genome engineering parameters via a library - on - library approach . Nat . Methods 12 , 823 – 826 ( 2015 ) . 36 . Xu , H . et al . Sequence determinants of improved CRISPR sgRNA design . Genome Res . 25 , 1147 – 1157 ( 2015 ) . 37 . Jinek , M . et al . Structures of Cas9 endonucleases reveal RNA - mediated conformational activation . Science 343 , 1247997 ( 2014 ) . 38 . Sternberg , S . H . , Redding , S . , Jinek , M . , Greene , E . C . & Doudna , J . A . DNA interrogation by the CRISPR RNA - guided endonuclease Cas9 . Nature 507 , 62 – 67 ( 2014 ) . 39 . Bae , S . , Kweon , J . , Kim , H . S . & Kim , J . - S . Microhomology - based choice of Cas9 nuclease target sites . Nat . Methods 11 , 705 – 706 ( 2014 ) . 40 . Gilbert , L . A . et al . Genome - scale CRISPR - mediated control of gene repression and activation . Cell 159 , 647 – 661 ( 2014 ) . 41 . Lin , Y . et al . CRISPR / Cas9 systems have off - target activity with insertions or deletions between target DNA and guide RNA sequences . Nucleic Acids Res . 42 , 7473 – 7485 ( 2014 ) . 42 . Stemmer , M . , Thumberger , T . , Del Sol Keyer , M . , Wittbrodt , J . & Mateo , J . L . CCTop : an intuitive , flexible and reliable CRISPR / Cas9 target prediction tool . PLoS One 10 , e0124633 – e11 ( 2015 ) . 43 . Tsai , S . Q . et al . GUIDE - seq enables genome - wide profiling of off - target cleavage by CRISPR - Cas nucleases . Nat . Biotechnol . 33 , 187 – 197 ( 2015 ) . 44 . Langmead , B . & Salzberg , S . L . Fast gapped - read alignment with Bowtie 2 . Nat . Methods 9 , 357 – 359 ( 2012 ) . 45 . Heigwer , F . , Kerr , G . & Boutros , M . E - CRISP : fast CRISPR target site identification . Nat . Methods 11 , 122 – 123 ( 2014 ) . 46 . Bae , S . , Park , J . , Kim , J . S . & Kim , J . S . Cas - OFFinder : a fast and versatile algorithm that searches for potential off - target sites of Cas9 RNA - guided endonucleases . Bioinformatics 30 , 1473 – 1475 ( 2 014 ) . 47 . Kampmann , M . et al . Next - generation libraries for robust RNA interference - based genome - wide screens . Proc . Natl . Acad . Sci . USA 112 , E3384 – E3391 ( 2015 ) . 48 . Steiger , J . H . Tests for comparing elements of a correlation matrix . Psychol . Bull . 87 , 245 – 251 ( 1980 ) . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology doi : 10 . 1038 / nbt . 3437 ONLINE METHODS Avana and Asiago libraries . To design these libraries , we targeted protein - coding transcripts annotated by the Consensus Coding Sequence Database ( CCDS ) , totaling 18 , 675 genes for the human genome and 20 , 077 genes for the mouse genome . When a gene had more than one CCDS ID , we picked the shortest transcript per gene . We annotated NGG protospacer adjacent motifs ( PAMs ) on both the plus and minus strands and then selected sgRNAs for inclusion in the library on the basis of three criteria , and divided these criteria into tiers . A most - preferred sgRNA would fulfill the first tier of all three criteria . However , not all sgRNAs can have these properties , and thus to reach a quota of six sgRNAs per gene , step - wise relaxation of tiers across criteria was necessary , and the properties of each step - wise round of relaxa - tion are given in Supplementary Table 1 . Additionally , we excluded sgRNAs with a BsmBI site in their sequence or with a run of four or more thymidines . We selected up to six sgRNAs per gene , and this resulted in a human library ( Avana ) of 110 , 257 sgRNAs and a mouse library ( Asiago ) of 120 , 453 sgRNAs ( Supplementary Tables 2 and 3 ) . The final distributions of sgRNAs across these criteria within each tier chosen for inclusion in the Avana and Asiago libraries are provided . Criterion A : location of the target site in the protein coding sequence , with the four tiers divided by quartiles of the target : ( i ) 0 – 25 % of the protein coding region , ( ii ) 25 – 50 % , ( iii ) 50 – 75 % , ( iv ) 75 – 100 % . The following list gives final distributions of sgRNAs chosen for inclusion in Avana and Asiago libraries per tier , respectively : i ; 57 % ; 57 % ii ; 43 % ; 43 % iii ; 0 . 06 % ; 0 . 04 % iv ; 0 . 02 % ; 0 . 01 % Criterion B : to mitigate off - target effects , sequence uniqueness of various lengths , counting from the 3 ′ end of the sgRNA , for example , of all possible sgRNAs targeting protein coding genes , the PAM - proximal ( i ) 13 nts are unique , ( ii ) 17 nts are unique , ( iii ) 20 nts are unique or ( iv ) the sgRNA sequence is not unique . The following list gives final distributions of sgRNAs chosen for inclusion in Avana and Asiago libraries per tier , respectively : i ; 84 % ; 83 % ii ; 13 % ; 13 % iii ; 0 . 2 % ; 0 . 4 % iv ; 3 % ; 4 % Criterion C : Rule Set 1 on - target score to maximize gene - knockout efficacy , divided into deciles ; for example , ( i ) score of 0 . 9 – 1 . 0 , ( ii ) score of 0 . 8 – 0 . 9 , etc . The following list gives the on - target scores and final distributions of sgRNAs chosen for inclusion in Avana and Asiago libraries per tier , respectively : i ; 0 . 9 – 1 . 0 ; 3 % ; 3 % ii ; 0 . 8 – 0 . 9 ; 14 % ; 15 % iii ; 0 . 7 – 0 . 8 ; 22 % ; 23 % iv ; 0 . 6 – 0 . 7 ; 23 % ; 22 % v ; 0 . 5 – 0 . 6 ; 17 % ; 16 % vi ; 0 . 4 – 0 . 5 ; 10 % ; 10 % vii ; 0 . 3 – 0 . 4 ; 6 % ; 6 % viii ; 0 . 2 – 0 . 3 ; 3 % ; 3 % ix ; 0 – 0 . 2 ; 1 % ; 1 % Library creation . Oligonucleotides were synthesized at the Broad Technology Laboratory ( BTL ) on a B3 Synthesizer ( CustomArray ) . To each sgRNA sequence , BsmBI recognition sites were appended along with the appropriate overhang sequences ( underlined ) for cloning into sgRNA expression plasmids . Additional primer sites were appended to allow differential amplification of subsets from the same synthesis pool . The final oligonucleotide sequence was thus : 5 ′ - ( Forward Primer ) CGTCTCACACCG ( sgRNA , 20 nt ) GTTTCGAGACG ( Reverse Primer ) . Unique primer sets were used to amplify individual subpools using 25 µ l 2× NEBnext PCR master mix ( New England BioLabs ) , 2 µ l of oligonucleotide pool ( ~ 40 ng ) , 5 µ l of primer mix at a final concentration of 0 . 5 µ M , and 18 µ l water . PCR cycling conditions : 30 s at 98 °C , 30 s at 53 °C , 30 s at 72 °C , for 24 cycles . Primer Forward primer , 5 ′ – 3 ′ Reverse primer , 5 ′ – 3 ′ set 1 AGGCACTTGCTCGTACGACG ATGTGGGCCCGGCACCTTAA 2 GTGTAACCCGTAGGGCACCT GTCGAGAGCAGTCCTTCGAC 3 CAGCGCCAATGGGCTTTCGA AGCCGCTTAAGAGCCTGTCG 4 CTACAGGTACCGGTCCTGAG GTACCTAGCGTGACGATCCG 5 CATGTTGCCCTGAGGCACAG CCGTTAGGTCCCGAAAGGCT 6 GGTCGTCGCATCACAATGCG TCTCGAGCGCCAATGTGACG The resulting amplicons were PCR - purified ( Qiagen ) , digested with Esp3I ( Fisher Scientific ) and cloned into either the lentiGuide ( pXPR _ 003 , Addgene 52963 ) or the lentiCRISPRv2 ( pXPR _ 023 , Addgene 52961 ) vectors . The ligation product was isopropanol precipitated and electroporated into Stbl4 electro - competent cells ( Life Technologies ) and grown at 30 °C for 16 h on agar with 100 µ g / ml carbenicillin . Colonies were scraped and plasmid DNA ( pDNA ) was prepared ( HiSpeed Plasmid Maxi , Qiagen ) . To confirm library representa - tion and distribution , the pDNA was sequenced by Illumina . After mapping of Illumina reads ( see below ) we calculated the overall fraction of reads that contained intended sgRNAs , which serves as a surrogate for the quality of the oligonucleotide synthesis . By this cloning scheme , only 21 nts of the synthe - sized oligonucleotide , the prepended G and the 20 nt variable sequence , become incorporated in the final library , in contrast to ligation - independent cloning schemes ( e . g . , Gibson ) in which both the sgRNA and flanking sequences are derived from synthesis . We deem a library to have passed quality control if > 85 % of the sequencing reads map to an intended sgRNA , which corresponds to an oligonucleotide synthesis error rate of 0 . 75 % per base or lower ( 85 % = 21 1 - 0 . 0075 ) . A distribution of sgRNA abundance for the subpools , as well as GeCKOv2 for comparison , is given in Supplementary Figure 2 . Cell culture . Stock cell lines were maintained without added antibiotics and supplemented with 1 % penicillin / streptomycin during screens . A375 , HT29 and MOLM13 cells were obtained from the Cancer Cell Line Encyclopedia 32 . 293T cells were obtained from ATCC ( CRL - 3216 ) . BV2 cells are a mouse microglial cell line that has been described 49 , 50 . All cells tested negative for mycoplasma contamination and their identity was confirmed by fingerprinting . Cas9 derivatives were made by introducing the lentivector pLX _ 311 - Cas9 , which expresses blasticidin resistance from the SV40 promoter and Cas9 from the EF1a promoter , as described 14 . The following list includes , respectively , cell line , media , and amount of puromycin , blasticidin and polybrene added : A375 ; RPMI + 10 % FBS ; 1 µ g / ml ; 5 µ g / ml ; 1 µ g / ml . 293T ; DMEM + 10 % FBS ; 1 µ g / ml ; 5 µ g / ml ; 1 µ g / ml . HT29 ; DMEM + 10 % FBS ; 1 µ g / ml ; 5 µ g / ml ; 1 µ g / ml . MOLM13 ; RPMI + 10 % FBS ; 2 µ g / ml ; 5 µ g / ml ; 4 µ g / ml . BV2 ; DMEM + 10 % FBS + 1 % HEPES ; 2 . 5 µ g / ml ; 4 µ g / ml ; 0 . Virus production . 293T cells were plated at a density of 1 . 5e6 cells per well ( 2 ml volume ) 24 h pre - transfection in a 6 - well dish . Transfection was performed using TransIT - LT1 Transfection Reagent ( Mirus ) according to the manufacturer’s protocol . Briefly , two solutions were prepared for each well . One solution contained 8 . 25 µ l of LT1 diluted in 66 . 75 µ l of Opti - MEM ( Corning ) and incubated at room temperature for 5 min . The second solution contained 250 ng pCMV - VSVG ( Addgene 8454 ) , 1 , 250 ng psPAX2 ( Addgene 12260 ) , and 1250 ng transfer vector ( e . g . , lentiGuide ) in a final volume of 75 µ L with Opti - MEM . The two solutions were combined and incubated at room temperature for 20 – 30 min . During this incubation period , the media on the 293T cells was changed . The transfection mixture was added dropwise to the cells , and then plates were centrifuged at room temperature at 1 , 000 g for 30 min and returned to 37 °C . 6 – 8 h post - centrifugation , transfection media was removed , leaving ~ 0 . 5 ml in each well , and replaced with 5 . 5 ml n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology doi : 10 . 1038 / nbt . 3437 viral harvest media ( DMEM + 10 % FBS + 1 % BSA ) . Virus was harvested 24 h post - transfection , the media was replenished , and a second harvest occurred at 48 h post - transfection . Determination of infection conditions for pooled screens . Optimal infection conditions were determined for each batch of virus prep in each cell line in order to achieve 30 – 50 % infection efficiency , corresponding to a multiplicity of infec - tion ( MOI ) of ~ 0 . 5 – 1 . Infections were performed in 12 - well plate format with 3 . 0 × 10 6 cells per well for adherent lines and 2 . 5 × 10 6 cells per well for suspen - sion lines . Optimal conditions were determined by infecting cells with different virus volumes ( 0 , 50 , 100 , 300 and 500 µ l for lentiGuide virus ; 0 , 100 , 200 , 400 and 600 µ l for lentiCRISPRv2 virus ) followed by trypsinization and replating equal numbers of cells per each virus volume into 2 wells of a 6 - well plate , each with complete medium , one supplemented with the appropriate concentration of puromycin . Cells were counted 3 – 5 d post selection to determine the infection efficiency , comparing survival with and without puromycin selection . Volumes of virus that yielded ~ 30 – 50 % infection efficiency were used for screening . Screening . Screening - scale infections were performed with the pre - determined volume of virus in the same 12 - well format as the viral titration described above , and pooled 4 – 6 h post - centrifugation . Based on library size , infections were performed with enough cells to achieve a representation of ~ 400 cells per sgRNA in the library following puromycin selection , unless otherwise noted . Cells were selected with puromycin for 5 – 7 d following infection to remove uninfected cells . A flowchart demonstrates the experi - mental timeline ( Supplementary Fig . 3 ) . Vemurafenib and selumetinib resistance screens . Cas9 - containing cells were infected in two biological replicates with the Avana and GeCKO libraries in len - tiGuide ; unmodified , parental cells were infected in two biological replicates with the Avana library in lentiCRISPRv2 . Small molecules were added to puromycin - selected cells 7 d post - infection . Cells either received a media change or were passaged every 2 or 3 d over the course of the screen in complete media supple - mented with 1 % penicillin / streptomycin . Vemurafenib ( PLX - 4032 , Selleckchem , S1267 ) was screened at a final concentration of 2 µ M . Selumetinib ( AZD - 6244 , Selleckchem , S1008 ) was screened at a final concentration of 200 nM . Surviving cells were harvested after 14 d of small molecule treatment . For analysis , the log 2 fold - change of each sgRNA was determined relative to the starting plasmid DNA ( pDNA ) pool for each biological replicate , which we have previously validated as representative of an early time point in pooled screens 6 . 6 - thiogunaine resistance screens , Avana library . Cas9 - containing cells were infected in two biological replicates with the Avana library in lentiGuide . 6 - thioguanine ( 2 µ g / ml final concentration , Sigma A4660 ) was added to puro - mycin - selected cells 7 d post - infection . Cells either received a media change or were passaged every 2 or 3 d over the course of the screen in complete media supplemented with 1 % penicillin / streptomycin . Surviving cells were harvested after 14 d of small - molecule treatment . For analysis , the log 2 fold - change of each sgRNA was determined relative to the starting plasmid DNA ( pDNA ) pool for each biological replicate . Interferon - gamma resistance screen , Asiago library . BV2 - Cas9 cells were infected in a single biological replicate with four different subpools of the Asiago library in lentiGuide . Cells were challenged with interferon gamma ( R & D systems , 485 - MI - 100 ) at a final concentration of 10 units / ml 8 d post - infection . Two days after interferon gamma treatment , surviving cells were harvested . For analysis , the log 2 fold - change of each sgRNA was determined relative to mock - challenged cells . Resistance screens , tiling library for further on - target activity modeling . A375 - Cas9 cells were infected in four biological replicates . Small molecules were added to puromycin - selected cells 7 d post - infection . Cells either received a media change or were passaged every 2 or 3 d over the course of the screen in complete media supplemented with 1 % penicillin / streptomycin . Vemurafenib ( PLX - 4032 , Selleckchem , S1267 ) was screened at a final concentration of 2 µ M . Selumetinib ( AZD - 6244 , Selleckchem , S1008 ) was screened at a final concentration of 200 nM . 6 - thioguanine ( Sigma A4660 ) was screened at a final concentration of 2 µ g / ml . Etoposide ( Sigma E1383 ) was screened at a final concentration of 1 µ g / ml . Surviving cells were harvested after 14 d of small - molecule treatment . For analysis , the log 2 fold - change of each sgRNA was determined relative to control cells treated with DMSO . Off - target library screen . MOLM13 - Cas9 cells were infected in one biologi - cal replicate at 1 , 000 cells per sgRNA , and were selected with puromycin in complete media supplemented with 1 % penicillin / streptomycin for the length of the screen . 21 d post - infection , cells were co - stained with phycoerythrin ( PE ) - conjugated anti - CD33 ( Miltenyi Biotec # 130 - 091 - 732 ) and DAPI , and then sorted on a BD - FACS Aria II . Gates were set on the BD FACSDiVa soft - ware using a CD - 33 DAPI - positive control and a DAPI - only negative control . The cell population was first gated to exclude debris ; two additional gates were applied to select singlets and a fourth to select viable cells via DAPI . Finally , the population was gated in order to sort for PE - negative cells ( Supplementary Fig . 18 ) . For analysis , the log 2 fold - change of each sgRNA was determined relative to the pDNA . Dropout screens , Avana and GeCKOv2 libraries . Cas9 - containing cells were infected in two or three biological replicates per cell line per library in lentiGuide , and selected with puromycin . Cells were passaged every 2 or 3 d for 3 weeks in complete media supplemented with 1 % penicillin / streptomycin . For analysis , the log 2 fold - change of each sgRNA was determined relative to the starting plasmid DNA ( pDNA ) pool for each biological replicate . Screen analysis . For analysis , the log 2 fold - change of each sgRNA was determined relative to the starting plasmid DNA ( pDNA ) pool for each biological replicate unless otherwise stated . The pDNA has been shown to serve as a good surrogate for an early time point , and its use is more cost effective when performing many screens 6 . We then determined the percent - rank of each sgRNA : each sgRNA was ranked by log 2 fold - change , and this number was then divided by the total number of sgRNAs in the pool to determine a percent - rank . These percent - rank values were then averaged across biological replicates . For performing RIGER and STARS analysis , the percent - rank values across subpools were merged . In the small number of cases where an sgRNA sequence was present in more than one subpool , the average of the percent - rank values was used . An exception to the above analysis method is subpool 5 in the selumetinib screen , where one replicate each of lentiGuide and lentiCRISPRv2 was not completed , and thus a single biologi - cal replicate was used for analysis . For the GeCKOv1 - lentiCRISPRv1 library , we re - analyzed the previously published data and normalized them against the pDNA pool rather than the DMSO treatment group , to be consistent with the analysis of the Avana and GeCKOv2 data 6 . Validation of hits . Validation assays were performed in an arrayed format with infection conditions of 1 × 10 6 cells per well of a 24 - well plate . Cells were selected with puromycin for 5 – 7 d following infection to remove uninfected cells , and were treated according to the methods of their respective resistance screen . Sequences of sgRNAs and primers are included in Supplementary Table 23 . Vemurafenib resistance assay . A375 - Cas9 cells were infected with sgRNAs cloned into lentiGuide and selected with puromycin for 1 week . Cells were mixed ~ 1 : 1 ( Supplementary Fig . 5 ) or 1 : 9 ( Fig . 1c ) with A375 - Cas9 cells expressing EGFP but with no sgRNA , and vemurafenib was added to the cell mixture . Flow cytometry was performed in 96 - well - plate format on a BDAccuri C6 Sampler system to measure the EGFP - negative fraction of sam - ples at the day of initial mixing of cells and then again 10 – 12 d after addition of vemurafenib . Gates were set on the cytometer software using EGFP positive and negative controls ; the cell populations were first gated by forward and side scatter to exclude debris , and a second gate was applied to measure the EGFP fluorescence . 6 - thiogunaine resistance assay . Cas9 - containing cells were infected in two biological replicates with lentiGuide constructs , two targeting HPRT1 , two targeting NUDT5 , and one control sgRNA targeting EGFP . Cells were infected in arrayed format in a 24 - well plate with 1 × 10 6 cells per well . Cells were divided into small - molecule and no - selection conditions , cell counts were taken at each passage to determine population doublings , and pellets were collected at day 0 and day 14 of 6 - thioguanine treatment for analysis of indels using the TIDE web portal 29 . Genomic DNA preparation and sequencing . Genomic DNA ( gDNA ) was isolated using Maxi ( 3 × 10 7 – 1 × 10 8 cells ) , Midi ( 5 × 10 6 – 3 × 10 7 cells ) , and Mini ( < 5 × 10 6 cells ) kits according to the manufacturer’s protocol ( Qiagen ) . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology doi : 10 . 1038 / nbt . 3437 Illumina sequencing . PCR of gDNA and pDNA was performed to attach sequencing adaptors and barcode samples , which were divided into multiple 100 µ l reactions ( total volume ) containing a maximum of 10 µ g gDNA . Per 96 - well plate , a master mix consisted of 75 µ l ExTaq DNA Polymerase ( Clontech ) , 1 , 000 µ l of 10× Ex Taq buffer , 800 µ l of dNTP provided with the enzyme , 50 µ l of P5 stagger primer mix ( stock at 100 µ M concentration ) , and 2 , 075 µ l water . Each well consisted of 50 µ l gDNA plus water , 40 µ l PCR master mix , and 10 µ l of a uniquely barcoded P7 primer ( stock at 5 µ M concentration ) . PCR cycling conditions : an initial 1 min at 95 °C ; followed by 30 s at 94 °C , 30 s at 52 . 5 °C , 30 s at 72 °C , for 28 cycles ; and a final 10 min extension at 72 °C . P5 / P7 prim - ers were synthesized at Integrated DNA Technologies ( IDT ) . Samples were purified with Agencourt AMPure XP SPRI beads according to manufactur - er’s instructions ( Beckman Coulter , A63880 ) . Samples were sequenced on a HiSeq2000 ( Illumina ) . Reads were counted by first searching for the CACCG sequence in the primary read file that appears in the vector 5 ′ to all sgRNA inserts . The next 20 nts are the sgRNA insert , which was then mapped to a reference file of all possible sgRNAs present in the library . The read was then assigned to a condition ( e . g . , a well on the PCR plate ) on the basis of the 8 - nt barcode included in the P7 primer . The resulting matrix of read counts was first normalized to reads per million within each condition by the following formula : reads per sgRNA / total reads per condition × 10 6 . Reads per million was then log 2 - transformed by first adding 1 to all values , which is necessary in order to take the log of sgRNAs with zero reads . STARS . STARS is a gene - ranking algorithm for genetic perturbation screens . This algorithm takes a ranked list of perturbations as input . The algorithm computes a score for genes using the probability mass function of a binomial distribution : Pr x k n k p p k n k ( ) ( ) = =     − − 1 where n is the total number of perturbations targeting a gene , k is the within - gene rank of the perturbation , and p is the ratio of the rank of the k th perturbation over the total number of perturbations in the experiment . This calculation is performed for all sgRNAs that rank above a user - defined threshold , for example , the top x % of sgRNAs from a ranked list . The value of the least probable perturbation for each gene is then assigned to the gene as the STARS Score . To avoid single sgRNA hits , we required that at least two perturbations rank above the user - defined threshold for a gene to receive a STARS Score . Permutation testing is also performed on the list of perturbations used in the experiment to generate the null distribution , allowing the calcula - tion of P - values , FDR and q - value ( corrected FDR ) for hit genes . STARS is written in Python , and is available on our website : http : / / www . broadinstitute . org / rnai / public / software / index . Development of Rule Set 2 . Data processing for on - target prediction . For each sgRNA targeting a given gene , the log 2 fold - change ( LFC ) in abundance , as judged from read - counts was computed . Next , normalized ranks were obtained for sgRNAs within each gene by assigning ranks to each guide , and then rescal - ing them to lie between 0 and 1 . If more than one cell type was available , these normalized ranks were averaged across cell types . Thus , a final sgRNA score for a given sgRNA and gene was in [ 0 , 1 ] , where 1 was indicative of a successful knockout . Note that normalized ranks were used instead of raw LFC because the LFC has a different maximum for genes that have more sgRNAs , suggesting that the LFC across different genes would not be comparable . Predictive models . We used the following statistical models in our experi - ments : ( i ) linear regression , ( ii ) L1 - regularized linear regression , ( iii ) L2 - regularized linear regression , ( iv ) the hybrid SVM plus logistic regression approach used previously 14 , ( v ) Random Forest , ( vi ) Gradient - boosted regres - sion tree , ( vii ) L1 logistic regression ( a classifier ) , ( viii ) SVM Classification . Implementations for each of these used scikit - learn package in python . For ( ii ) and ( iii ) , we set the regularization parameter range to search over 100 points evenly spaced in log space , with a minimum of 10 – 6 and a maximum of 1 . 5 × 10 5 . Random Forest used the default setting , as did the Gradient - boosted regression trees ( learning rate of 0 . 1 , and 100 base estimators each with a maximum depth of three ) . For the SVM , we used a linear kernel with default L2 regularization unless otherwise noted . Featurization . A “one - hot” encoding of the nucleotide sequences refers to taking a single categorical variable and converting it to more variables each of which can take on the value 0 or 1 , with , at most , one of them being “hot , ” or on . For example , position 1 of the 30 - mer target site plus context can take on A / C / T / G , and it gets converted to four binary variables , one for each possible nucleotide . These are “order 1” features . For “order 2” features , we looked at all adjacent pairwise nucleotides as features , such as AA / AT / AG / etc . There are 4 × 4 = 16 such pairs , thus a single variable representing one such pair gets one - hot encoded into 16 binary variables . Previously , only “position - specific” nucleotide features were used in this manner , meaning that for each position on the sgRNA , a different one - hot - encoded feature was used . Here , however , taking inspiration from some of the string kernel literature , we augmented these features sets by also including “position - independent” features , where , for order 1 features , for example , this would mean a feature for how many A’s and how many T’s , etc . were in the sgRNA , ignoring their position , and similarly for order 2 ( ref . 51 ) . Therefore , for a 30 mer ( 20 - mer sgRNA plus context ) , we obtained 80 order 1 and 320 order 2 position - specific features , and 4 order 1 and 16 order 2 position - independent features . GC counts features were computed as before , that is , the number of Gs and Cs in the 20 mer were counted , yielding one feature , and then another feature with count > 10 was also used . The two nucleotides in the N and N positions relative to the PAM “NGGN” were one - hot encoded yielding 16 features , one for each NN possibility ( e . g . , AT ) . Thermodynamic features were computed from the melting temperatures of the DNA version of the RNA guide sequence , or portions thereof , using the Biopython Tm _ staluc function 52 , 53 . In addition to using the melting temperature of the entire 30 - mer target site plus context , we also separated the thermodynamic features into three further features corresponding to the melt - ing temperature of three distinct parts of the sgRNA—in particular , the five nucleotides immediately proximal to the PAM , the eight nucleotides adjacent to that ( away from the PAM ) , and then the five nucleotides in turn adjacent to the 8 mer ( again , away from the PAM ) . Guide positional features such as amino acid cut position and percent peptide correspond to how far from the start of the protein coding region of the gene the cut site of the sgRNA was positioned . We also trained a version of Rule Set 2 without features that relate to protein information , as not all potential targets are protein - coding . Not all features will appear in Supplementary Table 17 , as features that did not vary at all were removed from all computations . Stratification / cross - validation . Unless otherwise noted , cross - validation was always performed by leaving out all sgRNAs for one gene at a time . For the inner cross - validation in the required nested cross - validation used to set the regularization weights for L1 / L2 , we also used leave - one - gene - out cross - validation . When examining feature importance , we averaged either the Gini importance ( for gradient - boosted regression trees ) , or the weights ( for L1 - regularized regression ) across genes . Statistical significance . The only test of statistical significance used was to compare the Spearman correlation prediction measure between two approaches when using exactly the same test data and cross - validation . To do so , we used three sets of numbers : ( i ) the Spearman correlation perform - ance measure for one approach , ( ii ) the Spearman correlation performance measure for the other approach and ( iii ) the Spearman correlation between the predictions from each approach . These values were used in conjunction with a method to test dependent measures of correlations ( here they are depend - ent because each approach uses the same ground truth ) 54 . The precision of the implementation for this method resulted in the occasional P - value of 0 . 0 . In such cases , we instead report P < 10 −16 , the smallest P - value that we observed the method reporting ( strictly speaking this depends on the number of samples , and correlation between predictions , but it seemed a reasonably prac - tical placeholder ) . Also of note is that this measure of statistical significance does not give equal weight to each gene , rather , each gene is represented in proportion to its number of sgRNAs . Off - target scoring . The CCtop scoring algorithm was implemented as described 42 . Because the CCtop score is in the opposite direction of the Hsu - Zhang 13 and CFD score , ranks of the CCtop scores were sorted in the opposite direction for AUC calculation , and we report the negative of the calculated n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d . nature biotechnology doi : 10 . 1038 / nbt . 3437 correlation values . In other words , for the CFD score , a value of 0 indicates no predicted off - target activity whereas a value of 1 indicates a perfect match ; in contrast , a low CCtop score indicates a high likelihood of off - target activity whereas a high CCtop score predicts no off - target activity . The scoring algorithm that derives from data published by Hsu et al . is described on the MIT CRISPR design server ( http : / / crispr . mit . edu / about ) 13 . The Cutting Frequency Determination ( CFD ) score is calculated by using the percent activity values provided in Supplementary Table 19 . For example , if the interaction between the sgRNA and DNA has a single rG - dA mismatch in position 6 , then that interaction receives a score of 0 . 67 . If there are two or more mismatches , then individual mismatch values are multiplied together . For example , an rG - dA mismatch at position 7 coupled with an rC - dT mis - match at position 10 receives a CFD score of 0 . 57 × 0 . 87 = 0 . 50 . Evaluation of Bowtie2 performance . We initially attempted to use Bowtie2 to find off - target sites . This approach was successful and relatively straight - forward for returning all perfect matches as well as those sites with only one mismatch to the query sequence . However , as the Bowtie2 algorithm is opti - mized for longer query sequences , we were unable to discover a set of options that would reliably find multi - mismatch sites ( such as many of those identified by GUIDE - seq ) for our relatively short sgRNA query sequences in a single search invocation . Moreover , the runtime performance of Bowtie2 degraded significantly as we adjusted its options for greater multi - mismatch recall . One common workaround for tools with poorly performing fuzzy search is to convert the single query sequence into a list of relevant variants , perform a “less fuzzy” search on each variant , and accumulate the results . Employing this technique , we arrived at an “optimized Bowtie2” method . Specifically , we performed a systematic exploration of the Bowtie2 parameter space to find the combination of the amount and type of pre - permutation and parameter settings that yielded the highest average recall while still maintaining search time of ~ 1 s on standard computing hardware . This optimized Bowtie strategy scaled reasonably to whole - genome batches , but still did not identify all sites found by GUIDE - seq or Cas - OFFinder . GUIDE - seq analysis . The sites identified by GUIDE - seq were available as a supplementary table in that publication 43 . Cas - OFFinder was used to find all off - target sites with up to six mismatches in the human genome for the ten sgRNAs assayed with GUIDE - seq 46 . To make the fairest comparison between off - target scoring algorithms , we only scored off - target sites with NRG PAMs , as required by CCtop and the Hsu et al . algorithms , which meant excluding 38 sites . Design of Brunello and Brie libraries . To design these libraries , we targeted protein - coding transcripts annotated by the GENCODE database ( http : / / www . gencodegenes . org / ) . GENCODE annotation is created by merging the Havana manual annotation and Ensembl automated gene annotation . We picked a transcript for each gene based on three tags defined by GENCODE : ( i ) APPRIS ( http : / / appris . bioinfo . cnio . es ) annotations , which prioritize transcripts based on protein structural information , functionally important residues and evi - dence from cross - species alignments ; ( ii ) level of confidence on the transcript , such as whether the transcript was a verified loci , manually annotated loci or automatically annotated loci ; and ( iii ) transcript level support in GENCODE , which is based on how well mRNA and EST alignments match over the full length of the transcript . We annotated all possible sgRNAs targeting each transcript for its Rule Set 2 score , and used these scores to rank , per transcript , the on - target activity of sgRNAs . In this implementation , we used the version of Rule Set 2 that does not incorporate protein target site information , as that criterion was used later in picking sgRNAs . Likewise , we annotated each sgRNA by the number of potential off - target sites within various tiers of CFD scores : ( i ) 1 . 0 ; ( ii ) 0 . 2 – 1 . 0 ; ( iii ) 0 . 05 – 0 . 2 ; ( iv ) < 0 . 05 . We then ranked , per transcript , each sgRNA by the fewest number of off - target sites in tier ( i ) , using the additional tiers as tiebreakers . To break ties within a tier , we prioritized sgRNAs with the fewest off - target sites in protein - coding regions . The on - target and off - target ranks of each sgRNA were then combined at equal weight to provide a final rank for each sgRNA targeting a particular transcript . To pick sgRNAs for each transcript , we first chose the best - ranked sgRNA that targeted within the 5 – 65 % of the protein - coding region of the target gene . We then selected additional sgRNAs per transcript , requiring that the next - picked sgRNA targets a site at least 5 % away , from a protein - coding standpoint , from previously picked sgRNAs . This ensures diversity in target space , espe - cially useful due to the potential for exons that are present in the reference transcript not to be included in any particular cellular model to which the library is applied . We selected up to 4 sgRNAs per gene using this heuristic . In order to meet quota for some genes , we eliminated the 5 – 65 % protein - coding region and 5 % spacing criteria . 49 . Blasi , E . , Radzioch , D . , Durum , S . K . & Varesio , L . A murine macrophage cell line , immortalized by v - raf and v - myc oncogenes , exhibits normal macrophage functions . Eur . J . Immunol . 17 , 1491 – 1498 ( 1987 ) . 50 . Stansley , B . , Post , J . & Hensley , K . A comparative review of cell culture systems for the study of microglial biology in Alzheimer’s disease . J . Neuroinflammation 9 , 115 ( 2012 ) . 51 . Ben - Hur , A . , Ong , C . S . , Sonnenburg , S . , Schölkopf , B . & Rätsch , G . Support vector machines and kernels for computational biology . PLoS Comput . Biol . 4 , e1000173 ( 2008 ) . 52 . Cock , P . J . A . et al . Biopython : freely available Python tools for computational molecular biology and bioinformatics . Bioinformatics 25 , 1422 – 1423 ( 2009 ) . 53 . Le Novère , N . MELTING , computing the melting temperature of nucleic acid duplex . Bioinformatics 17 , 1226 – 1227 ( 2001 ) . 54 . Steiger , J . H . Tests for comparing elements of a correlation matrix . Psychol . Bull . 87 , 245 – 251 ( 1980 ) . n p g © 201 6 N a t u r e A m e r i ca , I n c . A ll r i gh t s r ese r ve d .