2906 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 SmartPDR : Smartphone - Based Pedestrian Dead Reckoning for Indoor Localization Wonho Kang and Youngnam Han Abstract —Indoor pedestrian tracking extends location - based services to indoor environments where GPS signal is rarely detected . Typical indoor localization method is Wi - Fi - based positioning system , which is practical showing accuracy and extending coverage . However , it involves signiﬁcant costs of installing and managing wireless access points . A practical indoor pedestrian - tracking approach should consider the absence of any infrastructure or pretrained database . In this paper , we present a smartphone - based pedestrian dead reckoning , SmartPDR , which tracks pedestrians through typical dead reckoning approach using data from inertial sensors embedded in smartphones . SmartPDR does not require any complex and expensive additional device or infrastructure that most existing pedestrian tracking systems rely on . The proposed system was implemented on off - the - shelf smartphones and the performance was evaluated in several buildings . Despite inherent localization errors from low - cost noisy sensors and complicated human movements , SmartPDR successfully tracks indoor user’s location , which is conﬁrmed from the experimental results with reasonable location accuracy . Indoor pedestrian tracking system using smartphone inertial sensors can be a promising methodology validating its practical usage through real deployment . Index Terms —Indoor pedestrian tracking , pedestrian dead reckoning , smartphone inertial sensor . I . I NTRODUCTION L OCATION - BASED services ( LBS ) rely on accurate and continuous localization of users . Typical LBS applica - tions , such as navigation and content sharing , provide services based on user’s current location . Thus , localization is essential function needed by location - aware applications in pervasive computing environments [ 1 ] , [ 2 ] . Global Positioning System ( GPS ) has been contributing in this aspect by providing real - time location information . GPS is commonly used in outdoor environments and widely adopted in modern mobile devices such as smartphones [ 3 ] , [ 4 ] . People spend most of their time indoors ; therefore indoor pedestrian tracking becomes key technique required for indoor LBS in smartphone application market . Since the accuracy of GPS is degraded in indoor environments , active research has recently been done on indoor localization . However , no Manuscript received November 9 , 2013 ; accepted November 29 , 2014 . Date of publication December 18 , 2014 ; date of current version April 1 , 2015 . The associate editor coordinating the review of this paper and approving it for publication was Prof . Subhas C . Mukhopadhyay . The authors are with the Department of Electrical Engineering , Korea Advanced Institute of Science and Technology , Daejeon 305 - 701 , Korea ( e - mail : wonhoz @ kaist . ac . kr ; ynhan @ kaist . ac . kr ) . Color versions of one or more of the ﬁgures in this paper are available online at http : / / ieeexplore . ieee . org . Digital Object Identiﬁer 10 . 1109 / JSEN . 2014 . 2382568 outstanding solution has been found due to practical issues that are related to complicated infrastructure requirements . Conventional techniques for indoor localization are based on various types of infrastructure support , which include infrared , narrowband radio , ultrasound , ultra - wideband ( UWB ) , wireless ﬁdelity ( Wi - Fi ) signal strength , radio - frequency identiﬁcation ( RFID ) , inertial measurement unit ( IMU ) , vision , etc [ 1 ] , [ 5 ] , [ 6 ] . While the aforementioned methods are feasible in terms of locating accuracy , the implementation of most existing localization systems is based on infrastructure which is often difﬁcult , if not impossible . For instance , the active badge location system [ 7 ] employed infrared beacons to ﬁnd user location , but the limited range of infrared restricts localization in wide area . The Cricket system [ 8 ] and Active Bat system [ 9 ] were based on the use of costly ultrasonic devices for indoor localization in a limited space . Ubitag [ 10 ] , [ 11 ] achieved reasonable localization accuracy by integrating time difference of arrival ( TDoA ) and angle of arrival ( AoA ) methods in UWB network , but the system requires high - cost UWB tag . Further - more , signal interference problem must be solved to coexist with existing narrow band systems . Employing Wi - Fi signals has been widely adopted as estimating indoor location without expensive infrastructure cost [ 12 ] . However , Wi - Fi positioning system ( WPS ) requires signal training or indoor map . The training process should be performed by experts , which is time consuming and requires periodic management . An indoor map or ﬂoor plan is essential to create the database , but it does not typically exist or is not available to users for security reasons . There are also still many places having no or few Wi - Fi access points ( APs ) , which makes localization difﬁcult and becomes critical problem for WPS . Thus , a practical indoor pedestrian tracking method should consider indoor environments where pretrained database or ﬂoor plan is not available . This is the key reason to develop a system to locate indoor user effectively . In this paper , we present SmartPDR , a smartphone - based pedestrian dead reckoning that tracks indoor user’s loca - tion . SmartPDR employs typical dead reckoning approach , which is widely developed in localization industry to solve locating problems for anonymous places speciﬁcally indoor environments . SmartPDR is based on the use of accelerometer , magnetometer , and gyroscope in a smartphone , which are able to observe the pedestrian movement . SmartPDR provides an indoor localization model that computes the displacement through step event detection , heading direction estimation , and step length estimation . The main difﬁculty of this work 1530 - 437X © 2014 IEEE . Personal use is permitted , but republication / redistribution requires IEEE permission . See http : / / www . ieee . org / publications _ standards / publications / rights / index . html for more information . KANG AND HAN : SMARTPHONE - BASED PDR FOR INDOOR LOCALIZATION 2907 is coping with situations that the map database is unknown in advance , and available sensors are inaccurate . SmartPDR overcomes these issues of limited resources and inaccurate sensing capabilities and presents a lightweight localization model . In comparison with previous scheme that used laptops , PDAs , or cell phones , our system is implemented on the latest smartphones that are equipped with inertial sensors . Our technique is feasible since the number of smartphones in use is increasing , and the devices are commonly equipped with various sensors . The proposed system can easily be used at any site because the system does not require any anchor or physical map information . Many indoor localization systems assume the availability of site map with which the location accuracy is improved by making use of a priori knowledge on paths and walls in the building . Obtaining a map for an anonymous building is , however , not always possible . We believe any realistic and generalized indoor localization system should be freed from this fundamental restriction . The rest of the paper is organized as follow : In section II , we discuss previous works and related approaches on pedes - trian dead reckoning which is considered as a candidate for indoor localization . Section III presents system archi - tecture and core algorithms of SmartPDR for improving accuracy of pedestrian tracking . Novel methods are proposed while some existing methods are adopted . In section IV , the implementation of the proposed system is detailed , and the results of experiments are demonstrated to evaluate the performance of the proposed scheme . Finally , Section V concludes the paper to the latest research achievement and discusses future work to be conducted in the near future . II . P EDESTRIAN D EAD R ECKONING Recent development of microelectromechanical systems ( MEMS ) allows of integrating multiple sensors , including accelerometer , magnetometer , and gyroscope in a compact inertial sensor module . The technology is becoming cheaper and thus affordable for more applications . All the information needed for the detection of human movement is in the signals generated by accelerometer , magnetometer and gyroscope . This fact is employed in extensive research on pedestrian dead reckoning ( PDR ) and its applications [ 13 ] – [ 16 ] . Most PDR systems detect the number of step events using pedometer or accelerometer and move the location forward by the step length in the direction that is determined by magnetometer or gyroscope [ 17 ] – [ 19 ] . The average step length is adjusted for the walking speed and then used to calculate the user’s location . More sophisticated systems analyze accelerometer signals to estimate step lengths . PDR can be treated as an application of inertial navigation technology . Limited by the size and weight , the gimbaled inertial navigation system is not suitable for applications like pedestrian tracking . Instead , the strapdown inertial navigation system ( INS ) using inertial measurement unit ( IMU ) becomes a proper candidate for the applications that require mobility . A . IMU - Based Localization Many IMU - based localization systems have been developed , especially in robotics area , to track the locations of mobile robots . Applying these techniques to human tracking poses a new challenge because human behavior , compared to robots , is dynamic . Moreover , a subtle motion of human movement should be carefully considered to obtain reasonable tracking accuracy . Godha and Lachapelle [ 20 ] proposed a pedestrian navigation system that achieves reasonable accuracy in both indoor and outdoor environments by integrating GPS and IMU . Klingbeil and Wark [ 21 ] proposed a Monte - Carlo - based local - ization system that uses accelerometer for step event detection and magnetometer to track heading direction , however , the system exploits physical map information with anchors at known locations . IMU - based pedestrian tracking can be divided into acceler - ation integration approach and step counting approach . The acceleration integration method ﬁrst subtracts the gravity component , and the location is then estimated by integrating remaining acceleration . This scheme is , however , difﬁcult to implement on smartphones because the performance of accelerometers in smartphones is limited . The step counting method detects step events directly with acceleration . Steps are recognized by reading the inertial force , and a periodically observed series of signal patterns on inertial force trigger step events . This approach is appropriate for smartphone usage since it does not require high accuracy or precision of accelerometers . B . Smartphone - Based Pedestrian Dead Reckoning Sensors in smartphones have been used to understand the status of users , such as activity and location . Many context - aware applications have been developed in diverse ﬁelds , such as healthcare , dietary monitoring , social networking , and education . These applications monitor individuals’ contexts to understand users’ activity , such as running , walking , or sitting [ 22 ] , [ 23 ] . Strapdown usage of accelerometer has been studied to track users , and foot - mounted inertial sensors have been used to detect step event [ 24 ] , [ 25 ] . CompAcc [ 24 ] intro - duced a practical system that tracks pedestrian course without relying on Wi - Fi infrastructure . CompAcc records pedestrian walking pattern using accelerometer and magnetometer in a smartphone and matches it to a possible path from a map . Although CompAcc provides human - scale localization , the system is designed for outdoor environments , and it employs map information . The Wi - Fi - based positioning technique allows new opportu - nities for location - aware services , and research on ﬁngerprint - ing methods has proved their accuracy and robustness using correlations between locations and radio - signal patterns [ 26 ] . The approach constructs a database that associates ambient radio signals ( ﬁngerprints ) with physical locations in ofﬂine training phase and searches the current location through ﬁnd - ing the received ﬁngerprint in the database most similar to that which a device currently observes in positioning phase . This method provides indoor localization within a few meters of accuracy with wide coverage . However , the training process 2908 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 Fig . 1 . Overall system architecture of SmartPDR . should be performed by experts , which is time consuming and requires periodic management . Furthermore , a map or ﬂoor plan is necessary to create the database where an indoor map typically does not exist or is not available to users for security reasons . There are also still many places having no or few Wi - Fi APs , which makes localization difﬁcult . While the abovementioned approaches are feasible in terms of localization accuracy , the critical problem is that they are not practical due to the requirement of additional infrastructure such as foot - mounted inertial sensors , wireless APs , pretrained database , map information , etc . Since the realization of self - contained , stand - alone localization is the main goal of our research , we speciﬁcally propose a practical indoor pedestrian tracking system for smartphones . It will be discussed how to solve the problem of tracking complicated human walking in the following section . III . SmartPDR : S MARTPHONE - B ASED P EDESTRIAN D EAD R ECKONING FOR I NDOOR L OCALIZATION SmartPDR is a solution to pedestrian dead reckoning prob - lem . Speciﬁcally designed for smartphones , it tracks the user’s movement with inertial sensors embedded in smartphones . We ﬁrst describe the system architecture of SmartPDR and then describe the details of each core algorithm . A . System Architecture SmartPDR is a middleware for mobile application that tracks pedestrian movement . We previously conducted studies about detecting step event as well as estimating heading direction in [ 27 ] . In this work , we extend the previous idea and enhance the system performance through improvement of each algorithm . Fig . 1 illustrates the overall structure of the proposed system . To estimate the movement of the user , SmartPDR reads step event and calculates step length with three - axis accelerometer , and determines heading direction with both three - axis magnetometer and three - axis gyroscope . This approach is practical since recent smartphones are usually equipped with accelerometer , magnetometer , and gyroscope . The system estimates the next possible location by adding step length to previous location in the direction of heading at the stepping point of time . The core process of SmartPDR repeats four steps : step event detection , heading direction estimation , step length estimation , and location estimation . In the follow - ing , the procedures of these processes are explained in detail . B . Transformation of Coordinate Systems In order to describe the components of a vector of arbi - trary orientation in the global coordinate system ( GCS ) with respect to the local coordinate system ( LCS ) , a coordinate transformation must be performed . The transformation from LCS to GCS is accomplished by sequential rotations about three axes where these angular rotations can be represented as Euler angles . A convenient way of describing these rotations is using a rotation matrix . The rotation matrices along each of the three axes at time t are mentioned below : R φ , t = ⎡ ⎣ cos φ t , 0 , sin φ t 0 , 1 , 0 − sin φ t , 0 , cos φ t ⎤ ⎦ ( 1a ) R θ , t = ⎡ ⎣ 1 , 0 , 0 0 , − cos θ t , sin θ t 0 , sin θ t , cos θ t ⎤ ⎦ ( 1b ) R ψ , t = ⎡ ⎣ cos ψ t , sin ψ t , 0 − sin ψ t , cos ψ t , 0 0 , 0 , 1 ⎤ ⎦ ( 1c ) where the rotations are performed by φ t rotation about y - axis denoted as R φ , t , θ t rotation about x - axis as R θ , t , and ψ t rotation about z - axis as R ψ , t . These rotated angles that are a speciﬁc kind of Euler angles are called roll φ t , pitch θ t , and yaw ψ t , respectively . The rows of rotation matrices are actually the projections of GCS on LCS , and the columns are those of LCS on GCS . One of the key properties of the rotation matrices is orthogonality . The orthogonality of the rotation matrices in mathematical term means that any pair of columns ( or rows ) of the matrices are perpendicular , and that the sum of the squares of the elements in each column ( or row ) is equal to one . The ﬁnal rotation matrix R t that transforms a vector from LCS to GCS is simply obtained by multiplying the above three rotation matrices sequentially , resulting R t = R ψ , t R θ , t R φ , t = ⎡ ⎣ c ψ c φ − s ψ s θ s φ , − s ψ c θ , c ψ s φ + s ψ s θ c φ − s ψ c φ − c ψ s θ s φ , − c ψ c θ , − s ψ s φ + c ψ s θ c φ − c θ s φ , s θ , c θ c φ ⎤ ⎦ ( 2 ) where c stands for cos and s does for sin functions . Note that φ , θ , and ψ are the short terms of φ t , θ t , and ψ t , respectively . C . Step Event Detection Pedestrian distance traveled is represented by the number of step event , therefore it is necessary to detect step event accu - rately in order to get better estimation . To detect step event , we use accelerometer sensor that actually indicates three - axis acceleration relative to the smartphone itself . A user’s steps are counted by reading the inertial force , and a periodically KANG AND HAN : SMARTPHONE - BASED PDR FOR INDOOR LOCALIZATION 2909 observed series of signal patterns on inertial force trigger step events . Basically , the strongest indication of the step speciﬁc peak signature is featured on the vertical axis relative to ground . However , the vertical signal component may be distributed among all three accelerometer axes depending on the present orientation and attitude of a smartphone . Therefore , the acceleration in LCS is projected to GCS to obtain the acceleration values in vertical axis by multiplying the rotation matrix R t as a GCSt = R t a LCSt ( 3 ) where a GCSt and a LCSt are the acceleration in GCS and LCS , respectively . This process is usually performed to resolve the arbitrary placement of smartphone . The acceleration is then ﬁltered to remove the inﬂuence of the Earth’s gravity . Because it is a low - frequency component causing an offset about 9 . 8 m / s 2 , a simple high - pass ﬁlter ( HPF ) is applied to the acceleration on z - axis in GCS , which is implemented with the following equations [ 28 ] : g z , t = α g z , t − 1 + ( 1 − α ) a GCSz , t ( 4 ) a HPFt = a GCSz , t − g z , t ( 5 ) where g z , t is the gravity component , and α is the parameter for HPF . Note that the common value used for α is in the range of 0 . 9 ≤ α ≤ 1 . 0 . The resulting output a HPFt only contains high - frequency components with zero mean . To reduce random noise , low - pass ﬁltering ( LPF ) is then processed by a moving average ﬁlter as a stept = a LPFt = 1 W W − 1 2 (cid:6) i = − W − 1 2 a HPFt + i ( 6 ) where average - ﬁltered output a LPFt is used as step acceleration a stept in the next step counting procedure . W is moving window ( W = 2 j − 1 , j ∈ N ) , which is the number of points used in moving average . In this way , most of high - frequency noise is ﬁltered out , but the signal retains its low - frequency attributes . A peak step counting algorithm is then applied to mark the candidate stepping points of time that have the possibility of user walking . We employ three conditions on step acceleration to detect a valid step event as following sets : t peak = (cid:7) t (cid:8)(cid:8)(cid:8)(cid:8) a stept > a stept + i , a stept > a peak τ , | i | ≤ N 2 , i (cid:4) = 0 (cid:9) ( 7a ) t pp = (cid:7) t (cid:8)(cid:8)(cid:8)(cid:8) max (cid:10) a stept − a stept − i (cid:11) > a pp τ , max (cid:10) a stept − a stept + i (cid:11) > a pp τ , 1 ≤ i ≤ N 2 (cid:9) ( 7b ) t slope = ⎧ ⎪ ⎨ ⎪⎩ t (cid:8) (cid:8)(cid:8)(cid:8)(cid:8)(cid:8)(cid:8) 2 N t − 1 (cid:6) i = t − N 2 (cid:10) a stepi + 1 − a stepi (cid:11) > 0 , 2 N t + N 2 (cid:6) i = t + 1 (cid:10) a step i − a step i − 1 (cid:11) < 0 ⎫⎪⎬ ⎪⎭ ( 7c ) Fig . 2 . Peak step event detection in step acceleration through the intersection of three time point sets at the example of 15 steps . where N is the total number of samples for the comparison ( N = 2 j , j ∈ N ) . t peak is the peak point of time exceeding the threshold a peak τ . t pp is the set of time point that the largest difference between the current peak and both of previous and next valley ( peak - to - peak ) is greater than the threshold a pp τ . t slope is the point of time that shows increment ( positive slope ) on the frontside and decrement ( negative slope ) on the backside . In this paper , we set the thresholds a peak τ to be 0 . 5 m / s 2 and a pp τ to be 1 . 0 m / s 2 . The resulting step event time t step is obtained from the intersection of above three sets of time points as t step = t peak ∩ t pp ∩ t slope ( 8 ) where the k th step event time t stepk is the k th smallest element in the set t step . Fig . 2 shows the step event time t step and three sets of time point , t peak , t pp , and t slope , which are marked with red circles at the example of 15 steps . Through the proposed approach , we eliminated insigniﬁcant peaks and generated rightful step event time free from random noise as conﬁrmed in the ﬁgure . D . Heading Direction Estimation Now , we discuss issues with regard to how to obtain walking direction information . Once a step is detected , it is important to know which direction the step was taken because the major source of location error is the distortion of heading direction . Unlike foot - mounted IMU , the placement of smartphone is unstable and this results in practical difﬁculty in ﬁnding the heading direction of user movement . The tilt of axes are always changing , and smartphone cannot stay horizontal . Errors caused by tilt angles could be large if not compensated . To handle the tilts of smartphone when it is in an arbitrary position , LCS is transformed into GCS through the rotation matrix provided in equation ( 2 ) . Magnetometer can provide the heading direction of pedes - trian h magt using the x - axis and y - axis components of the 2910 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 Earth’s magnetic ﬁeld outputs in GCS as following equations : m GCSt = R t m LCSt ( 9 ) h magt = atan2 (cid:10) − m GCSy , t , m GCSx , t (cid:11) ( 10 ) where m GCSx , t and m GCSy , t are the magnetic measurements on x - axis and y - axis in GCS . The function atan2 ( y , x ) is deﬁned in mathematical term as atan2 ( y , x ) = 2tan − 1 (cid:19) y (cid:20) x 2 + y 2 + x (cid:21) . ( 11 ) The angle calculated in equation ( 10 ) is actually a compass reading , i . e . , the azimuth relative to magnetic north . To get the value of true north , the magnetic declination must be deduced from the compass reading as h magt = atan2 (cid:10) − m GCSy , t , m GCSx , t (cid:11) − h decline (cid:7) ( 12 ) where h decline (cid:7) is the difference between magnetic north and true north . This difference is caused by the tilt of the Earth’s magnetic ﬁeld generator relative to the Earth’s spin axis . The gyroscope gives angular velocity outputs of pitch θ , roll φ , and yaw ψ which are the rotations on x - axis , y - axis , and z - axis , respectively . There exists a drift offset error of gyroscope in each of the axes . The accuracy of heading direction will decay with time if this error is not removed . Therefore , the drift caused by gyroscope bias should be compensated as ˆ ω i , t = ω LCSi , t − b gyroi , i ∈ { x , y , z } ( 13 ) where ˆ ω i , t is corrected angular velocity , ω LCSi , t is the raw value obtained from gyroscope , and b gyroi is the angular drift correction on i - axis . The angular velocities acquired from equation ( 13 ) are the representations of LCS , which should be transformed to GCS . To obtain angular velocity on z - axis in GCS ω GCSz , t , the transformation from LCS to GCS is performed through the scalar projection of angular velocity vector ˆ ω t onto gravity vector g t as ω GCSz , t = ˆ ω t · g t | g t | = ˆ ω Tt g t | g t | ( 14 ) where the gravity vector g t can be obtained by g t = R − 1 t ⎡ ⎣ 00 g z , t ⎤ ⎦ = R Tt ⎡ ⎣ 00 g z , t ⎤ ⎦ , ( 15 ) and ˆ ω t = (cid:22) ˆ ω x , t ˆ ω y , t ˆ ω z , t (cid:23) T . The pedestrian heading direction from gyroscope can be determined through the integration . Since the sampling intervals for the sensors in smartphone are discrete , we treat this integration as its equivalent summation . The corresponding heading direction of pedestrian movement by gyroscope h gyrot is obtained as h gyrot = (cid:6) t − ω GCSz , t ( 16 ) where the negative sign of ω GCSz , t arises because the positive measurement of gyroscope indicates negative angular change by axial deﬁnition . Fig . 3 . The heading direction estimation algorithm that selects heading direction sources based on the correlation and the variation of the sources . The heading directions determined from magnetometer and gyroscope are noisy due to sensing capability , user move - ment , magnetic disturbance , etc . Deciding appropriate heading direction from these noisy values is crucial to enhance the localization accuracy . Therefore , we establish a new algorithm that uses measurements from magnetometer and gyroscope together to ﬁnd the reasonable heading direction h t of a user . The key concept of algorithm is to select reliable heading direction sources among previous estimate , magnetometer , and gyroscope based on the variation of magnetometer as well as the correlation between magnetometer and gyroscope . The proposed algorithm is visualized in Fig . 3 and expressed in the following equation : w pmg (cid:24) w pre v h t − 1 + w mag h magt + w gyro h gyrot (cid:25) , for h cor (cid:7) ≤ h cor τ , h mag (cid:7) ≤ h mag τ ( 17a ) w mg (cid:24) w mag h magt + w gyro h gyrot (cid:25) , h t = ⎧⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎨ ⎪⎪⎪⎪⎪⎪⎪⎪ ⎪ ⎪⎪ ⎪ ⎩ for h cor (cid:7) ≤ h cor τ , h mag (cid:7) > h mag τ ( 17b ) h t − 1 , for h cor (cid:7) > h cor τ , h mag (cid:7) ≤ h mag τ ( 17c ) w pg (cid:24) w pre v h t − 1 + w gyro h gyrot (cid:25) , for h cor (cid:7) > h cor τ , h mag (cid:7) > h mag τ ( 17d ) where w pmg = (cid:24) w pre v + w mag + w gyro (cid:25) − 1 ( 18a ) w mg = (cid:24) w mag + w gyro (cid:25) − 1 ( 18b ) w pg = (cid:24) w pre v + w gyro (cid:25) − 1 ( 18c ) h cor (cid:7) = (cid:8)(cid:8) h magt − h gyrot (cid:8)(cid:8) ( 19a ) h mag (cid:7) = (cid:8)(cid:8) h magt − h magt − 1 (cid:8)(cid:8) ( 19b ) Note that w pre v , w mag , and w gyro are weighting parameters on previous heading direction estimate , current magnetometer - based direction , and current gyroscope - based output , respec - tively . In this paper , the ratio of weighting parameters are set to w pre v : w mag : w gyro = 2 : 1 : 2 . The threshold h cor τ and h mag τ are used to determine the correlation h cor (cid:7) and magnetometer variation h mag (cid:7) , respectively . The values used in this paper are KANG AND HAN : SMARTPHONE - BASED PDR FOR INDOOR LOCALIZATION 2911 Fig . 4 . The result of turning at a 90 - degree corner having magnetic disturbances which shows each corresponding condition of heading direction source selection . h cor τ = 5 degrees and h mag τ = 2 degrees . As inferred from the equation and the ﬁgure , the proposed algorithm employs magnetometer and gyroscope together when they have similar outputs ( Case I is for going straight , and Case II is for turning ) . In contrast , when they show different values , the algorithm uses previous estimate only ( Case IV is for going straight because magnetometer is stable ) , or with gyroscope ( Case III is for turning because magnetometer changes ) . The effectiveness of the proposed algorithm is conﬁrmed at the example of turning at a 90 - degree corner suffering magnetic disturbances where the result is depicted in Fig . 4 . In the ﬁgure , the proposed novel algorithm successfully estimates heading direction with four categorized conditions resolving the drawbacks of magnetometer and gyroscope . We then focus on the fact that the heading direction is usually determined between two consecutive steps . Upon each detected step event and estimated heading direction , we try to ﬁnd which point of time represents the direction of current user movement . In other words , we selects the most likelihood time for each heading direction where the likelihood heading direction time for the k th step event t head k is t headk = argmin t stepk − 1 < t < t stepk a stept ( 20 ) where it is equivalent to the point of time that has valley acceleration as described in Fig . 5 . The corresponding heading direction at the k th step event h k is h k = h t | t = t headk . ( 21 ) E . Step Length Estimation Total traveled distance can be calculated by estimating step length in every valid step event . Generally , there are two approaches for estimating step length : static model and dynamic model . Static model assumes that any valid step has the same length . The k th step length l k in static model can be determined through the following equation : l k = l , ∀ k ( 22 ) Fig . 5 . The likelihood heading direction time from step event detection time which is equivalent to the valley point of time on step acceleration at the example of 15 steps . where the constant l depends on the users using the system . In contrary , dynamic model assumes any valid step has different length because step length varies from step to step even for the same person . As mentioned before , the performance of accelerometer in smartphones is not enough to calculate the displacement through the integration of accel - eration . To overcome this problem , the step length should be estimated using certain approach , such as one proposed in [ 29 ] . It assumes that vertical impact occurred from walking activity is proportional to step length . The vertical impact , which is the difference between the current peak and the previous valley of step acceleration in a step event interval a steppp , t , is obtained as a steppp , t = a steppeak , t − a step v alley , t ( 23 ) where a steppeak , t = a stept (cid:8)(cid:8)(cid:8) t = t stepk ( 24 ) and a step v alley , t = a stept (cid:8)(cid:8)(cid:8) t = t headk . ( 25 ) The k th step length l k is then calculated through the vertical impact as following equation : l k = β 4 (cid:26) a steppp , t + γ ( 26 ) where β is a scale factor , and γ is an offset . By the way , we consider employing logarithm instead of principal fourth root as l k = β log (cid:10) a steppp (cid:11) + γ . ( 27 ) We conducted a simulation to compare two step length estimation algorithms , and the estimated step length of each algorithm is displayed in Fig . 6 with respect to reference step length from 0 . 4 meter to 1 . 0 meter and corresponding peak - to - peak step acceleration . 2912 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 Fig . 6 . Step length comparison estimated based on principal fourth root and logarithm with respect to the reference step length and peak - to - peak acceleration . Fig . 7 . Fundamental step length estimation error from the slopes of principal fourth root and logarithm functions . The results of these two algorithms are almost same , but the difference is found in Fig . 7 , which depicts fundamental estimation error of each algorithm . The error comes from the slopes of the two functions that are slightly different . It is observed from the ﬁgure that logarithm - based step length estimation is a little more accurate than principal fourth root - based one as reference step length becomes larger . For this reason , we combine two equations as l k = ⎧⎨ ⎩ β 4 (cid:26) a steppp , t + γ , for a steppp < a step τ β log (cid:10) a steppp (cid:11) + γ , for a steppp ≥ a step τ ( 28 ) which is proposed for step length estimation in this paper . The threshold a step τ is used to select estimation algorithm , which is 3 . 230 m / s 2 in the paper . In the above equations , the parameters β and γ for each function are β = 1 . 479 and γ = − 1 . 259 for principal fourth root , and β = 1 . 131 and γ = 0 . 159 for logarithm . F . Location Estimation The pedestrian movement is represented as indoor loca - tion on a two - dimensional plane . The movement consists of Fig . 8 . Indoor layout of testbed building with walking path . walking distance and heading direction . Thus , the current user position at the k th step s userk is computed by adding the estimated current step length l k to the previous location s userk − 1 in the estimated heading direction h k at the k th step event time t stepk according to s userk = (cid:27) x GCSk y GCSk (cid:28) = (cid:27) x GCSk − 1 y GCSk − 1 (cid:28) (cid:29) (cid:30)(cid:31) s userk − 1 + l k ! sin ( h k ) cos ( h k ) " ( 29 ) where x GCSk and y GCSk represent the displacement on x - axis ( East ) and that on y - axis ( North ) in GCS at the k th step , respectively . The localization error in this paper is deﬁned as the Euclidean norm of the difference between user location and reference location in two dimension deﬁned as d errork = # # # s refk − s userk # # # ( 30 ) where s refk is the reference location point at the k th step . As a result , we simpliﬁed the localization problem to be deterministic such that pedestrian movement is modeled as step event detection , heading direction estimation , and step length estimation . IV . E XPERIMENTS AND E VALUATION We ﬁrst describe the platform design and experimental environments . The performance of the proposed system is then compared with the ground - truth reference path as well as conventional pedestrian dead reckoning approaches . A . Experimental Setup To evaluate the proposed scheme in real environments , we implemented the proposed system on Google Android platform . Our system was tested on Samsung Galaxy Note and Note II smartphones equipped with accelerometer , magnetometer , and gyroscope where the sampling rate of each inertial sensor was 20 Hz . The experiments were con - ducted in Creative Learning Hall ( CLH ) at Korea Advanced Institute of Science and Technology ( KAIST ) , the indoor layout of which is shown in Fig . 8 . To evaluate the quality of path estimation , we tracked a walking path with a step counter . We explored the corridors of our testbed building KANG AND HAN : SMARTPHONE - BASED PDR FOR INDOOR LOCALIZATION 2913 Fig . 9 . Heading direction estimation with respect to the ground - truth reference heading direction . ( i . e . , the two closed rectangles in Fig . 8 ) multiple times . The testbed consisted of eight - shaped path in an ofﬁce environment with total length of 168 . 55 m . It took about two minutes to walk along under normal walking speed with around 215 steps . The experiment was run for 50 times with 5 participants , and the average results are presented . The actual distance covered and time taken for walking varies across different trials . In the experiments , a smartphone is held on hand , in front along the corridor . This hand - held position of smartphone is reasonable because the user who wants to know current location should regularly check the information on the screen of smartphone . In this position , the direction of smartphone is almost same as that of the user even though there is some trembling . We also performed simulations to understand the signal characteristics of inertial sensors generated in different walking styles of users and to quantify the performance of the proposed system with various parameters . We logged steps and the observation with smartphones and simulated the log . The simulation was conducted on Matlab computer program with exactly the same operating systems that run on smartphones . We also run the realtime application on each smartphone . The main goal of the experiment was to verify the accuracy of indoor localization by applying the proposed algorithm . B . Experimental Results The proposed system estimates a pedestrian path from measured sensor data . We identiﬁed an acceleration signature by human walking steps and measured the magnetic azimuth as well as angular rate for heading direction . We conﬁgured the parameters of the system based on our previous work [ 27 ] . Fig . 9 shows the estimated heading direction of pedestrian from magnetometer , gyroscope , and the proposed algorithm . The changes of direction with 90 degree explain the turnings at corners . It is inferred from the wavy direction of magnetometer in the ﬁgure that magnetic distortion is found at many points . The magnetic ﬁeld is inﬂuenced , for example , by working machines and a metal gate in Fig . 10 . The cumulative occurred number of heading direction estimation conditions . the vicinity . Unstable placement of the device also affects the measurement of the magnetic force such that a smartphone held in a hand is easily shaken during walking . The direction of gyroscope is almost same with the reference direction ; however the accumulated bias error arises after few turns . The proposed heading estimation algorithm utilizes the correlation between magnetometer and gyroscope as well as the variation of magnetometer . The obtained heading direction is almost same with the ground - truth reference heading direction . It means that the reliable heading direction is obtained with the proposed algorithm resolving the drawback of each sensor . Fig . 10 describes how the heading direction of the pro - posed algorithm is calculated with the cumulative occurred number of each condition of heading direction estimation . In the ﬁgure , the case III and case IV mostly happened with 58 . 01 % and 24 . 23 % while the case I and case II rarely happened with 12 . 11 % and 5 . 65 % , respectively . Note that the sum probability of four cases equals to 100 % . The result from the ﬁgure explains that heading direction outputs of magnetometer and gyroscope are mostly different , and this is conﬁrmed by the condition of the case III and case IV with the total probability of 82 . 24 % . Furthermore , the variation of magnetometer can be effectively utilized which is supported by the case I and case III with the sum probability of 70 . 12 % . In the proposed algorithm , the previous estimate , magnetometer , and gyroscope are used for heading direction estimation as 94 . 35 % , 17 . 76 % , and 41 . 99 % , respectively . Fig . 11 displays the measurement error on heading direction estimation when the heading direction of likelihood heading time is employed . Because the user rarely turns 90 - degree corner at once , the peaks arise on the ﬁgure at the time of turning . It is cleared from the ﬁgure that there is magnetic distortion at many points in this experiment environment , and the accumulated error of gyroscope caused bias offset after few turns . The heading direction error of the proposed algorithm is almost less than 5 degrees in the whole experimental period . Speciﬁcally , the average heading direction error of the 2914 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 Fig . 11 . Heading direction estimation error with respect to the ground - truth reference heading direction where the data of the likelihood heading direction time is applied . Fig . 12 . Cumulative heading direction error distribution with respect to the ground - truth reference heading direction . proposed algorithm is 2 . 28 degrees with the standard deviation of 3 . 63 degrees . The result of measurement error on heading direction estimation is summarized as the cumulative distribution in Fig . 12 . As expected , the proposed heading direction esti - mation algorithm shows the best performance utilizing the advantages of magnetometer and gyroscope . The result of heading direction estimation will be conﬁrmed in localization process showing that errors in degrees could cause errors in meters . Fig . 13 is the screenshots of the proposed localization system , SmartPDR on Galaxy Note which is an Android appli - cation containing proposed algorithms . The ﬁgure explains the installation of application on smartphone and the result of pedestrian tracking . The trajectory is displayed on Google Maps by converting displacement into latitude and longitude information . All the sensor values used for algorithm and the localization result outputs are logged , and the performance of the proposed algorithm is evaluated on Matlab computer program . Fig . 13 . The screenshots of SmartPDR on Galaxy Note from installation to localization where the proposed algorithms are built in . Fig . 14 . Localization trajectories with respect to the ground - truth reference path that are constructed on Matlab computer program with logged data ﬁle from the smartphone . Fig . 14 depicts the trajectories built with the logged data ﬁle from smartphone application . The trajectory of the pro - posed system is compared with magnetometer - based PDR and gyroscope - based PDR where the heading direction of likelihood heading direction time is employed . In the ﬁgures , we see the detected steps and their location corresponding to each heading direction estimation where starting and ﬁnishing points are remarked as circles and squares for each scheme . It is proved from Figs . 13 and 14 that the proposed Smart - PDR successfully draws the corridors of the building that is almost same with ground - truth reference path . In contrast , the movement path of magnetometer - based PDR was twisted due to the magnetic distortion in this indoor environment , and that of gyroscope - based PDR became inaccurate with accumulated error of drift bias in gyroscope readings . Fig . 15 shows the localization error with respect to the walking distance . In the ﬁgure , the locating error of SmartPDR was less than 2 meters in the whole experimental period . Speciﬁcally , the average location error of SmartPDR was 1 . 35 meters . The localization error generally increases as the walked distance increases due to the cumulative error on step KANG AND HAN : SMARTPHONE - BASED PDR FOR INDOOR LOCALIZATION 2915 Fig . 15 . Localization error with respect to the ground - truth reference path . Fig . 16 . Localization error CDF with respect to the ground - truth reference path . event detection and heading direction estimation . However , the error in our experiment did not always increase and even decreased at some points of the path . This is because the walking path has many turning points and has the shape of closed loop in our experiment setup . The result of localization error is summarized as the cumula - tive distribution in Fig . 16 . The proposed SmartPDR gives the best performance with the largest locating error of 1 . 62 meters . In our experiment analysis , we used only two types of smartphones , Samsung Galaxy Note and Note II . However , diverse types of smartphones would have different perfor - mance characteristics on inertial sensors that may inﬂuence the performance of the proposed system . Especially , different inertial chipsets can cause localization error due to the gap of sensor values . We plan to consider this kind of problem to apply our system in the future work . V . C ONCLUSION SmartPDR is a smartphone - based pedestrian dead reckoning solution that tracks users in anonymous buildings . By explor - ing the inside of a building with a smartphone , SmartPDR estimates the current location of the user on Google Maps . In the experiment , the system successfully draws the corridor outline of the building . Our work makes two important contributions to the research on indoor localization . First , we extended the ﬁeld of pedestrian tracking systems to indoor environments . SmartPDR introduces a method to track users with pervasive mobile devices . Second , we designed a complete system that runs on the smartphone device and veriﬁed its robustness . We implemented all the components of PDR in a real device and veriﬁed the robustness of the proposed scheme . It is important to note that SmartPDR is a PDR technology on a smartphone without any other infrastructure . These contri - butions validate that self - contained pedestrian tracking system based on smartphone inertial sensors , instead of wireless or other technologies , can indeed be achievable , which is the key for the success of such a system . Our system can be used to enable the deployment of various location - based applications such as indoor navigation system in a large shopping center . For the future work , we plan to improve the proposed system in several aspects . The current experiment with SmartPDR represents a method to track a pedestrian in indoor environment with inaccurate sensors in a smartphone . Based on experiments done to date , the accuracy of the system is acceptable in measuring displacement of a pedestrian . Now , we will study a complete system including ﬂoor recognition . A further set of large - scale experiments in diverse indoor environments is planned to understand the practical usage of the system . Finally , we plan to implement a seamless localization system by detecting the precise entrance position of the building , which was assumed to be known in the current work . This is beyond the scope of this paper at this stage of development . R EFERENCES [ 1 ] J . Hightower and G . Borriello , “Location systems for ubiquitous com - puting , ” Computer , vol . 34 , no . 8 , pp . 57 – 66 , Aug . 2001 . [ 2 ] M . Satyanarayanan , “Pervasive computing : Vision and challenges , ” IEEE Pers . Commun . , vol . 8 , no . 4 , pp . 10 – 17 , Aug . 2001 . [ 3 ] B . Hofmann - Wellenhof , H . Lichtenegger , and J . Collins , Global Positioning System : Theory and Practice , vol . 1 . Wien , Austria : Springer - Verlag , 1993 . [ 4 ] E . D . Kaplan and C . Hegarty , Understanding GPS : Principles and Applications . Norwood , MA , USA : Artech House , 2006 . [ 5 ] H . Liu , H . Darabi , P . Banerjee , and J . Liu , “Survey of wireless indoor positioning techniques and systems , ” IEEE Trans . Syst . , Man , Cybern . C , Appl . Rev . , vol . 37 , no . 6 , pp . 1067 – 1080 , Nov . 2007 . [ 6 ] R . Challamel , P . Tome , D . Harmer , and S . Beauregard , “Perfor - mance assessment of indoor location technologies , ” in Proc . IEEE / ION Position , Location Navigat . Symp . , May 2008 , pp . 624 – 632 . [ 7 ] R . Want , A . Hopper , V . Falcão , and J . Gibbons , “The active badge location system , ” ACM Trans . Inf . Syst . , vol . 10 , no . 1 , pp . 91 – 102 , Jan . 1992 . [ 8 ] N . B . Priyantha , A . Chakraborty , and H . Balakrishnan , “The cricket location - support system , ” in Proc . 6th Annu . Int . Conf . Mobile Comput . Netw . , 2000 , pp . 32 – 43 . [ 9 ] M . Addlesee et al . , “Implementing a sentient computing system , ” Computer , vol . 34 , no . 8 , pp . 50 – 56 , 2001 . [ 10 ] P . Steggles and S . Gschwind , “The ubisense smart space platform , ” in Proc . Adjunct 3rd Int . Conf . Pervasive Comput . , vol . 191 , 2005 , pp . 73 – 76 . [ 11 ] M . A . Stelios , A . D . Nick , M . T . Efﬁe , K . M . Dimitris , and S . C . A . Thomopoulos , “An indoor localization platform for ambient assisted living using UWB , ” in Proc . 6th Int . Conf . Adv . Mobile Comput . Multimedia , 2008 , pp . 178 – 182 . 2916 IEEE SENSORS JOURNAL , VOL . 15 , NO . 5 , MAY 2015 [ 12 ] V . Honkavirta , T . Perala , S . Ali - Loytty , and R . Piché , “A compar - ative survey of WLAN location ﬁngerprinting methods , ” in Proc . 6th Workshop Positioning , Navigation Commun . ( WPNC ) , Mar . 2009 , pp . 243 – 251 . [ 13 ] Q . Ladetto , V . Gabaglio , B . Merminod , P . Terrier , and Y . Schutz , Human Walking Analysis Assisted by DGPS . Edinburgh , Scotland : GNSS , 2000 , pp . 1 – 4 . [ 14 ] Q . Ladetto , “On foot navigation : Continuous step calibration using both complementary recursive prediction and adaptive Kalman ﬁltering , ” in Proc . ION GPS , 2000 , pp . 1735 – 1740 . [ 15 ] Q . Ladetto and B . Merminod , “An alternative approach to vision tech - niques : Pedestrian navigation system based on digital magnetic compass and gyroscope integration , ” in Proc . 6th World Multiconf . Syst . , Cybern . Inf . , 2002 . [ 16 ] O . Mezentsev , J . Collin , and G . Lachapelle , “Pedestrian dead reckoning—A solution to navigation in GPS signal degraded areas ? ” Geomatica , vol . 59 , no . 2 , pp . 175 – 182 , 2005 . [ 17 ] L . Fang et al . , “Design of a wireless assisted pedestrian dead reckon - ing system—The NavMote experience , ” IEEE Trans . Instrum . Meas . , vol . 54 , no . 6 , pp . 2342 – 2358 , Dec . 2005 . [ 18 ] T . Judd , “A personal dead reckoning module , ” in Proc . ION GPS , vol . 97 . 1997 , pp . 47 – 51 . [ 19 ] R . Jirawimut , P . Ptasinski , V . Garaj , F . Cecelja , and W . Balachandran , “A method for dead reckoning parameter correction in pedestrian navi - gation system , ” IEEE Trans . Instrum . Meas . , vol . 52 , no . 1 , pp . 209 – 215 , Feb . 2003 . [ 20 ] S . Godha and G . Lachapelle , “Foot mounted inertial system for pedes - trian navigation , ” Meas . Sci . Technol . , vol . 19 , no . 7 , p . 075202 , May 2008 . [ 21 ] L . Klingbeil and T . Wark , “A wireless sensor network for real - time indoor localisation and motion monitoring , ” in Proc . Int . Conf . Inf . Process . Sensor Netw . ( IPSN ) , Apr . 2008 , pp . 39 – 50 . [ 22 ] L . Bao and S . S . Intille , “Activity recognition from user - annotated acceleration data , ” in Pervasive Computing . Berlin , Germany : Springer - Verlag , 2004 , pp . 1 – 17 . [ 23 ] J . Lester , T . Choudhury , and G . Borriello , “A practical approach to recog - nizing physical activities , ” in Pervasive Computing . Berlin , Germany : Springer - Verlag , 2006 , pp . 1 – 16 . [ 24 ] I . Constandache , R . R . Choudhury , and I . Rhee , “Towards mobile phone localization without war - driving , ” in Proc . IEEE INFOCOM , Mar . 2010 , pp . 1 – 9 . [ 25 ] E . Foxlin , “Pedestrian tracking with shoe - mounted inertial sensors , ” IEEE Comput . Graph . Appl . , vol . 25 , no . 6 , pp . 38 – 46 , Nov . / Dec . 2005 . [ 26 ] W . M . Yeung , J . Zhou , and J . K . Ng , “Enhanced ﬁngerprint - based location estimation system in wireless LAN environment , ” in Emerging Directions in Embedded and Ubiquitous Computing . Berlin , Germany : Springer - Verlag , 2007 , pp . 273 – 284 . [ 27 ] W . Kang , S . Nam , Y . Han , and S . Lee , “Improved heading estimation for smartphone - based indoor positioning systems , ” in Proc . IEEE 23rd Int . Symp . Pers . Indoor Mobile Radio Commun . ( PIMRC ) , Sep . 2012 , pp . 2449 – 2453 . [ 28 ] T . Gallagher , E . Wise , B . Li , A . G . Dempster , C . Rizos , and E . Ramsey - Stewart , “Indoor positioning system based on sensor fusion for the blind and visually impaired , ” in Proc . Int . Conf . Indoor Positioning Indoor Navigat . ( IPIN ) , Nov . 2012 , pp . 1 – 9 . [ 29 ] H . Weinberg , Using the ADXL202 in Pedometer and Personal Navigation Applications . Norwood , MA , USA : Analog Devices , 2002 . Wonho Kang received the B . S . degree from Dongguk University , Seoul , Korea , in 2010 , and the M . S . degree from the Korea Advanced Institute of Science and Technology , Daejeon , Korea , in 2012 , where he is currently pursuing the Ph . D . degree , all in electrical engineering . His current research interests include wireless communication , mobile computing , and network optimization . Youngnam Han ( SM’99 ) received the B . S . and M . S . degrees in electrical engineering from Seoul National University , Seoul , Korea , in 1978 and 1980 , respectively , and the Ph . D . degree from the University of Massachusetts , Amherst , MA , USA , in 1992 . He was a Principal Engineer with the Electronics and Telecommunications Research Insti - tute , Daejeon , Korea , from 1992 to 1997 , managing the project of design and performance analysis of radio transmission technology for DCN , PCS , and IMT - 2000 . He was actively involved in research and development for IS - 95 digital cellular system in Korea deployed nationwide in 1995 and for IMT - 2000 standards activities as a Delegate at ITU - R representing Korea . He has been with Information and Communications University , Daejeon , as a Faculty Member , since 1998 , where he served as the Dean of Engineering and Dean of Academic and Student Affairs . He was a Principal Engineer with Qualcomm , Inc . , San Diego , CA , USA , from 2001 to 2002 , where he was involved in the 3G standards , CDMA2000 1xEV . He served on many conferences as a TPC member and the Organizing Chair , including the TPC Chair for VTC 2003 ( Spring ) . He was the Chairman of BoG and the IEEE VTS Asia Paciﬁc Wireless Communication Symposium from 2009 to 2010 . He served as the General Chair of VTC 2014 ( Spring ) in Seoul . Since 2009 , he has been with the Department of Electrical Engineering , Korea Advanced Institute of Science and Technology , Daejeon , as a Professor . He is currently the Chair on the 5G Forum Steering Committee in Korea and leading research and development activities on 5G . His research interests include performance evaluation of mobile communication systems , radio resource management , and optimization of mobile systems operations . He was a recipient of the Best Paper Award at the IEEE VTC 2000 in Tokyo . He is a life - long member of the Korea Information and Communications Society .