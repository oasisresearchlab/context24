RESEARCH ARTICLE Application of referenced thermodynamic integration to Bayesian model selection Iwona Hawryluk ID 1 ☯ , Swapnil Mishra ID 2 , Seth Flaxman 3 , Samir Bhatt 1 , 4 * , Thomas A . Mellan 1 ☯ 1 MRC Centre for Global InfectiousDisease Analysis , School of PublicHealth , Imperial CollegeLondon , London , United Kingdom , 2 Saw Swee Hock Schoolof Public Health and Institute of Data Science , National Universityof Singaporeand NationalUniversity Health System , Singapore , Singapore , 3 Departmentof Computer Science , University of Oxford , Oxford , United Kingdom , 4 Departmentof Public Health , Section of Epidemiology , Universityof Copenhagen , Copenhagen , Denmark ☯ These authors contributed equallyto this work . * samir . bhatt @ sund . ku . dk Abstract Evaluating normalising constants is important across a range of topics in statistical learning , notably Bayesian model selection . However , in many realistic problems this involves the integration of analytically intractable , high - dimensional distributions , and therefore requires the use of stochastic methods such as thermodynamic integration ( TI ) . In this paper we apply a simple but under - appreciated variation of the TI method , here referred to as referenced TI , which computes a single model’s normalising constant in an efficient way by using a judiciously chosen reference density . The advantages of the approach and theoretical considerations are set out , along with pedagogical 1 and 2D examples . The approach is shown to be useful in practice when applied to a real problem —to perform model selection for a semi - mechanistic hierarchical Bayesian model of COVID - 19 transmission in South Korea involving the integration of a 200D density . Introduction The marginalised likelihood , or normalising constant of a model , is a feature central to the principles and pathology of Bayesian statistics . For example —given two models representing two competing hypotheses , the ratio of the normalising constants ( known as the Bayes factor ) , describes the relative probability of the data having been generated by one hypothesis com - pared to the other . Consequently , at a practical level the estimation of normalising constants is an important topic for model selection in the Bayesian setting [ 1 ] . In practice , estimating a normalising constant relies on “integrating out” or marginalis - ing the parameters of the model to get the probability the associated hypothesis produced the data . But in general this is difficult , because we cannot easily integrate arbitrary high - dimensional distributions —certainly analytical or quadrature - based methods are of little help directly . As a result , practitioners turn to a range of approaches , typically based on sta - tistical sampling . Specific examples include bridge sampling [ 2 , 3 ] , stochastic density of PLOS ONE PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 1 / 16 a1111111111a1111111111a1111111111a1111111111a1111111111 OPEN ACCESS Citation : Hawryluk I , Mishra S , FlaxmanS , Bhatt S , Mellan TA ( 2023 ) Applicationof referenced thermodynamic integrationto Bayesian model selection . PLoS ONE18 ( 8 ) : e0289889 . https : / / doi . org / 10 . 1371 / journal . pone . 0289889 Editor : Mohammadreza Hadizadeh , CentralState University , UNITED STATES Received : June 6 , 2023 Accepted : July 27 , 2023 Published : August14 , 2023 Copyright : © 2023Hawryluk et al . This is an open access article distributedunder the terms of the Creative CommonsAttribution License , which permits unrestricted use , distribution , and reproductionin any medium , provided the original authorand source are credited . Data Availability Statement : All data generated and used in this project canbe foundin the Github repository ( https : / / github . com / mrc - ide / referenced - TI ) . Funding : SB and IH acknowledgesupport fromthe MRCCentre for Global Infectious DiseaseAnalysis ( MR / R015600 / 1 ) , jointly funded by the UK Medical Research Council ( MRC ) and the UK Foreign , Commonwealth \ & Development Office ( FCDO ) , underthe MRC / FCDOConcordat agreement , and also part of the EDCTP2 programme supported by the European Union . SB is funded by the National states based methods [ 4 , 5 ] and thermodynamic integration [ 6 – 9 ] . This work focuses on the latter —thermodynamic integration —in particular on the development of the practical details for efficient application for Bayesian model selection . By way of introduction for researchers unfamiliar with thermodynamic integration ( TI ) , it allows us to estimate the ratio of two normalising constants in a general and asymptotically exact way . Instead of marginalising the associated densities explicitly in terms of the high - dimensional integrals , using TI we only have to evaluate a 1 - dimensional integral , where the integrand can easily be sampled with Markov Chain Monte Carlo ( MCMC ) . To see how this works , consider two models labelled 1 and 2 with normalising constants z 1 and z 2 . Each z is given by z i ¼ Z q i ð θ Þ d θ ; i 2 f 1 ; 2 g ; ð 1 Þ where q i is a density for model M i with parameters θ , that gives the model’s Bayesian posterior density as p i ð θ Þ ¼ q i ð θ Þ z i ; i 2 f 1 ; 2 g : To apply thermodynamic integration we introduce the concept of a path between q 1 ( θ ) and q 2 ( θ ) , linking the two densities via a series of intermediate ones . This family of densities , parameterised by the path coordinate λ , is denoted by q ( λ ; θ ) . An example path in λ is shown in Fig 1A . The density q ( λ ; θ ) , linking q 1 to q 2 and defining the intermediate densities , can be chosen to have an optimal or in some way convenient path . A common choice based on convenience is the geometric one q ð l ; θ Þ ¼ q l 2 ð θ Þ q 1 (cid:0) l 1 ð θ Þ ; l 2 ½ 0 ; 1 � : The important point to note is that for λ = 0 , q ( λ ; θ ) returns the first density q ( 0 ; θ ) = q 1 ( θ ) , for λ = 1 it gives q ( 1 ; θ ) = q 2 ( θ ) , and for in - between λ values a log - linear mixture of the end - point densities . Just as we have defined a family of densities , there is an associated normalising constant for any point along the path , that for any value of λ is given by z ð l Þ ¼ Z O ð l Þ q ð l ; θ Þ d θ : A further small but important point to avoid complications is to have densities with com - mon support , for example O ( λ = 1 ) = O ( λ = 0 ) . Hereafter support is denoted by O . Having set up the definitions of q ( λ ; θ ) and z ( λ ) , the TI expression can be derived , to com - pute the log - ratio of z 1 = z ( λ = 0 ) and z 2 = z ( λ = 1 ) , while avoiding explicit integrals over the PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 2 / 16 Institute for Health Research ( NIHR ) Health ProtectionResearch Unit in Modellingand Health Economics , a partnershipbetweenthe UK Health Security Agency , Imperial College Londonand LSHTM ( grant code NIHR200908 ) . Disclaimer : “The views expressed are those ofthe author ( s ) and not necessarily thoseof the NIHR , UK Health Security Agencyor the DepartmentofHealth and Social Care . ” S . B . acknowledges supportfrom the Novo Nordisk Foundationvia The Novo Nordisk YoungInvestigatorAward ( NNF20OC0059309 ) . SB acknowledges supportfromthe DanishNational Research Foundationvia a chair grant . S . B . acknowledges supportfromThe Eric and Wendy SchmidtFund For Strategic Innovation via the SchmidtPolymathAward ( G - 22 - 63345 ) . IH was funded by a MRCPhD studentship ( MR / S502388 / 1 ) . SMacknowledges supportfrom National Research Foundationvia The NRF Fellowship Class of 2023Award ( NRF - NRFF15 - 2023 - 0010 ) . SF acknowledges supportfromthe EPSRC ( EP / V002910 / 2 ) . The funders had no rolein study design , data collection and analysis , decision to publish , or preparationof the manuscript . Competinginterests : The authorshave declared that no competinginterestsexist . models’ parameters θ . This is laid out as follows : log z 2 z 1 ¼ Z 1 0 @ l log z ð l Þ d l ¼ Z 1 0 1 z ð l Þ @ l z ð l Þ d l ¼ Z 1 0 1 z ð l Þ @ l Z O q ð l ; θ Þ d θ d l ¼ Z 1 0 1 z ð l Þ Z O @ l log q ð l ; θ Þ ð Þ q ð l ; θ Þ d θ d l ¼ Z 1 0 E p ð l ; θ Þ ½ @ l log q ð l ; θ Þ� d l ¼ Z 1 0 E p ð l ; θ Þ log q 2 ð θ Þ q 1 ð θ Þ � � d l ¼ Z 1 0 E q ð l ; θ Þ log q 2 ð θ Þ q 1 ð θ Þ � � d l ; ð 2 Þ Here we started with the fundamental theorem of calculus ( first step ) , rules of differentiating logs ( second step ) , definition of z ( λ ) ( third step ) , assumed exchangeability of @ λ and R d θ and Fig 1 . Illustration of steps from the 1D pedagogical example . A ) q l q ð 1 (cid:0) l Þ ref for the 1d example density in parameter θ ( Eq 9 ) at selected λ values along the path . B ) Expectation E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i vs MCMC iteration , shown at each value of λ sampled . C ) λ - dependence of E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i , the TI contribution to the log - evidence . D ) Convergence of the evidence z , with 1 % convergence after 500 iterations and 0 . 1 % after 17 , 000 iterations per λ . https : / / doi . org / 10 . 1371 / journal . pone . 0289889 . g001 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 3 / 16 log differentiation rules again ( fourth step ) , identifying the expectation E q ð l ; θ Þ from sampling distribution q ( λ ; θ ) ( fifth step ) , differentiation of the geometric path for q ( λ ) ( sixth step ) , and finally equivalence of sampling from q and p . The final line in the expression summarises the usefulness of TI . Instead of having to work with the complicated high - dimensional integrals of Eq 1 to find the log - Bayes factor log z 2 z 1 , which measures the relative probability of getting the data from one hypothesis compared to another , we only need to consider a 1 - dimensional inte - gral of an expectation , and that expectation can be readily produced by MCMC . In our paper we examine the details of a referenced TI approach , which is a variation on the TI theme that we find useful to enable fast and accurate normalising constant calculations . Our main contributions are as follows : • We show how to generate a reference normalising constant from an exactly - integratable ref - erence density , through sampling or gradients , and with parameter constraints . And we present how to use this reference in the TI method to efficiently estimate a normalising con - stant of an arbitrary high - dimensional density . • We discuss performance benchmarks for a well - known problem in the statistical literature [ 10 ] , which shows the method performs favourably in terms of accuracy and the number of iterations to convergence . • Finally the technique is applied to a hierarchical Bayesian time - series model describing the COVID - 19 epidemic in South Korea . In relation to other work , we recognise using a reference for thermodynamic integration is a topic that has been raised , especially in early theoretically - oriented literature [ 11 – 13 ] . Our additional contribution is to bridge the gap from theory and simple examples to application , which includes choosing the reference using MCMC samples or gradients , examination of ref - erence support , comparisons of convergence , and illustration of the approach for a non - trivial real - world problem . Methods Referenced TI Introducing a reference density and associated normalising constant as z ¼ z ref z z ref ¼ z ref exp Z 1 0 E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ � � d l ; ð 3 Þ yields an efficient approach to compute Bayes factors , or more generally to marginalise an arbitrary density for any application . To clarify notation , here z is the normalising constant of interest with density q , z ref is a reference normalising constant with associated density q ref . In the second line the ratio z / z ref is straightforwardly given by the thermodynamic integral iden - tity in Eq 2 . While the Eq 2 can be directly applied to conduct a pairwise model comparison between two hypotheses , by introducing a reference we can naturally marginalise the density of a single model [ 11 , 12 ] . This is useful when comparing multiple models as n > n 2 (cid:0) � for n > 3 . Another motivation to reference the TI is the MCMC computational efficiency of converging the TI expectation . In Eq 3 , with judicious choice of q ref , the reference normalising constant z ref can be evaluated analytically and account for most of z . In this case log q ð θ Þ q ref ð θ Þ tends to have a small expectation and variance and converges quickly . PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 4 / 16 This idea of using an exactly solvable reference , to aid in the solution of an otherwise intrac - table problem , has been a recurrent theme in the computational and mathematical sciences in general [ 14 – 17 ] , and variations on this approach have been used to compute normalising con - stants in various guises in the statistical literature [ 8 , 9 , 11 , 18 – 24 ] . For example , in the general - ised stepping stone method a reference is introduced to speed up convergence of the importance sampling at each temperature rung [ 23 , 24 ] . In the work of [ 22 ] a theoretical discus - sion has been presented that shows the error budget of thermodynamic integration depends on the J - divergence of the densities being marginalised . Noting this , [ 19 ] provide an illustration for a 2 - dimensional example in their work on recursive pathways to marginal likelihood estima - tion . And in the power posteriors method , a reference is used but the reference is a prior density and thus z ref = 1 [ 20 ] . This approach is elegant as the reference need not be chosen —it is simply the prior —however the downside is that for poorly chosen or uninformative priors , the ther - modynamic integral will be slow to converge and susceptible to instability . In particular for complex hierarchical models with weakly informative priors this is found to be an issue . For referenced TI as presented here , the reference density in Eq 3 can be chosen at conve - nience , but the main desirable features are that it should be easily formed without special con - sideration or adjustments and that z ref should be analytically integratable and account for as much of z as possible . Such a choice of z ref ensures the part with expensive sampling is small and converges quickly . An obvious choice in this regard is the Laplace - type reference , where the log - density is approximated with a second - order one , for example a multivariate Gaussian . For densities with a single concentration , Laplace - type approximations are ubiquitous , and an excellent natural choice for many problems . In the following section we consider approaches that can be used to formulate a reference normalising constant z ref from a second - order log - density ( though more generally other tractable references are possible ) . In each referenced TI scenario , we note that even if the reference approximation is poor , the estimate of the normal - ising constant based on Eq 3 remains asymptotically exact—only the speed of convergence is affected ( subject to the assumptions of matching support for end - point densities ) . Taylor expansion at the mode Laplace reference The most straightforward way to generate a reference density is to Taylor expand the log - den - sity to second order about a mode . Noting no linear term is present , we see the reference den - sity is q ref ð θ Þ ¼ exp log q ð θ 0 Þ þ 1 2 ð θ (cid:0) θ 0 Þ T H ð θ (cid:0) θ 0 Þ � � ; ð 4 Þ where H is the Hessian matrix and θ 0 is the vector of mode parameters . The associated nor - malising constant is z ref ¼ Z 1 (cid:0) 1 q ref ð θ Þ d θ ¼ Z 1 (cid:0) 1 exp log q ð θ 0 Þ þ 1 2 ð θ (cid:0) θ 0 Þ T H θ (cid:0) θ 0 ð Þ � � d θ ¼ q ð θ 0 Þ Z 1 (cid:0) 1 exp 1 2 ð θ (cid:0) θ 0 Þ T H θ (cid:0) θ 0 ð Þ � � d θ ¼ q ð θ 0 Þ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi det ð 2 p H (cid:0) 1 Þ p : ð 5 Þ This approach to yield a reference density , using either analytic or finite difference gradients at mode , tends to produce a density close to the true one in the neighbourhood of θ 0 . But this is PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 5 / 16 far from guaranteed , particularly if the density is asymmetric , or has non - negligible high - order moments , or is discontinuous for example exhibiting cusps . In many instances a more reliable choice of reference can be found by using MCMC samples from the whole posterior density . Sampled covariance Laplace reference A second straightforward approach to form a reference density , that’s often more robust , is by drawing samples from the true density q ( θ ) to estimate the mean parameters ^ θ and covariance matrix ^ Σ , such that q ref ð θ Þ ¼ q ð ^ θ Þ exp (cid:0) 1 2 ð θ (cid:0) ^ θ Þ T ^ Σ (cid:0) 1 ð θ (cid:0) ^ θ Þ � � ð 6 Þ Then the reference normalising constant is z ref ¼ q ð ^ θ Þ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi det ð 2 p ^ Σ Þ q : ð 7 Þ This method of generating a reference is simple and reliable . It requires sampling from the posterior q ( θ ) so is more expensive than gradient - based methods , but the cost associated with drawing enough samples to generate a sufficiently good reference tends to be quite low . In the primary application discussed later , regarding structured high - dimensional Bayesian hierar - chical models , we use this approach to generate a reference density and normalising constant . Though the sampled covariance reference is typically a good approach , it is not in general optimal within the Laplace - type family of approaches —typically another Gaussian reference exists with different parameters that can generate a normalising constant closer to the true one , thus potentially leading to overall faster convergence of the thermodynamic integral to the exact value . Such an optimal reference can be identified variationally , as we show in S1 Appendix Reference support If a model involves a bounded parameter space , for example θ 1 2 [ 0 , 1 ) , θ 2 2 ( − 1 , 1 ) etc . as commonly arise in structured Bayesian models , in referenced TI the exact analytic integration for the reference density should be commensurately limited . This is necessary not only so the reference is closer to the true density to speed up convergence , but also so MCMC samples from both densities can be drawn on the same parameter space , as is required for the thermo - dynamic integrand in Eq 3 to be well - defined . However , the calculation of arbitrary probability density function orthants ( an orthant is a specific region in a multi - dimensional space or more precisely a bounded n - dimensional space ) , even for well - known analytic functions such as the multivariate Gaussian , is in general a difficult problem . High - dimensional orthant computa - tions usually require advanced techniques , the use of approximations , or sampling methods [ 25 – 30 ] . Fortunately , we can simplify our reference density to create a reference with tractable analytic integration for limits by using a diagonal approximation to the sampled covariance or Hessian matrix . For example the orthant of a diagonal multivariate Gaussian can be given in terms of the error function [ 31 ] , z ref ¼ q ð ^ θ Þ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi det ð 2 p Σ diag Þ q Y i 2 K 1 þ erf ^ y i (cid:0) a i ffiffiffiffiffiffiffiffiffiffiffi 2 Σ diag i q 0 B @ 1 C A 0 B @ 1 C A ; ð 8 Þ where K denotes the set of indices of the parameters with lower limits a i . S diag is a diagonal PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 6 / 16 covariance matrix , that is one containing only the variance of each of the parameters , without the covariance terms and Σ diag i denotes the i th element of the diagonal . Restricting our density to a diagonal one is a poorer approximation than using the full covariance matrix . In practice however this has not been a substantial drawback to the convergence of the thermodynamic integral—and again we state that the quality of the reference affects only convergence rather than eventual accuracy of the normalising constant . This behaviour is observed in the practical examples later considered , though we do recognise the distinction between accuracy and con - vergence and matters of asymptotic consistency using an MCMC estimator with finite itera - tions are not clear cut . Technical implementation Referenced TI was implemented in Python and Stan programming languages . Using Stan enables fast MCMC simulations with Hamiltonian Monte Carlo and No - U - Turn algorithm [ 32 , 33 ] , and portability between other statistical languages . We also provide an example of carrying out referenced - TI in NumPyro [ 34 ] . The code for all examples shown in this paper is available at https : / / github . com / mrc - ide / referenced - TI . In the examples shown in Section Applications , we used 4 chains with 20 , 000 iterations per chain for the pedagogical exam - ples , and 4 chains with 2 , 000 iterations for the other applications . In all cases , half of the iter - ations were used for the burn - in ( alternatively warm - up [ 33 ] ) . Mixing of the chains and the sampling convergence was checked in each case , by ensuring that the ^ R value was � 1 . 05 and investigating the trace plots . The ^ R is a standard MCMC diagnostic that assesses the conver - gence of multiple parallel chains running in an MCMC simulation . It is computed by com - paring the variance between chains to the variance within each chain . If chains have not fully converged , their variances will be larger compared to when they have reached conver - gence [ 35 ] . In all examples , the integral given in Eq 2 was discretised to allow computer simulations . Each expectation E q ð l ; y Þ log q 1 ð y Þ q 0 ð y Þ h i was evaluated at λ = 0 . 0 , 0 . 1 , 0 . 2 , . . . . , 0 . 9 , 1 . 0 , unless stated otherwise . To obtain the value of the integral in Eq 2 , we interpolated a curve linking the expectations using a cubic spline , which was then integrated numerically . The pseudo - code of the algorithm with sampled covariance Laplace reference is shown in Algorithm 1 . Algorithm 1 Referenced thermodynamic integration algorithm Input q —un - normalised density , q ref —un - normalised reference density , Λ —set of cou - pling parameters λ , N —number of MCMC iterations Output z —normalising constant of the density q 1 : Define un - normalised density q and the reference density q ref 2 : Calculate z ref analytically by using the determinant of the covari - ance matrix , as per Eqs 5 or 6 from the main text . 3 : for λ 2 Λ do 4 : Sample N values θ n from q l q 1 (cid:0) l ref 5 : for n = 1 , 2 , . . . , N do 6 : Calculate log q ð y n Þ q ref ð y n Þ 7 : end for 8 : Compute the mean , E l ¼ 1 N Σ Nn ¼ 1 log q ð y n Þ q ref ð y n Þ 9 : end for 10 : Interpolate between the consecutive E l values to obtain a curve @ λ log ( z ( λ ) ) 11 : Integrate @ λ log ( z ( λ ) ) over λ 2 [ 0 , 1 ] to get log zz ref 12 : Calculate z = z ref � exp log zz ref � � PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 7 / 16 Applications In this section we present applications of the referenced TI approach . In 1D Pedagogical Example and 2D Pedagogical Example with Constrained Parameters we give 1 - and 2 - dimen - sional pedagogical introductions to the approach . In Benchmarks— Radiata Pine we select a linear regression model for a well - known problem in the statistical literature , and finally in in Model Selection for the COVID - 19 Epidemic in South Korea we consider a challenging model selection task for a structured Bayesian model of the COVID - 19 epidemic in South Korea . 1D pedagogical example To illustrate the technique we consider the 1 - dimensional density q ð y Þ ¼ exp (cid:0) 1 2 ffiffiffiffiffiffiffiffiffiffiffiffiffiffi j y (cid:0) 4 j p (cid:0) 1 2 ð y (cid:0) 4 Þ 4 � � ; y 2 R ; ð 9 Þ with normalising constant z ¼ R 1 (cid:0) 1 q ð y Þ d y . This density has a cusp and it does not have an analytical integral that easily generalises to multiple dimensions . In this instance the Laplace approximation based on the second - order Taylor expansion at the mode will fail due to the cusp , so we use the more robust covariance sampling method . Sampling from the 1D density q ( θ ) we find a variance of ^ s 2 ¼ 0 : 424 , giving a Gaussian refer - ence density q ref ( θ ) with normalising constant of z ref = 1 . 559 . The full normalising constant , z ¼ z ref zz ref , is evaluated by Eq 3 , by setting up a thermodynamic integration along the sampling path q l q ð 1 (cid:0) l Þ ref . The expectation , E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i , is evaluated at 5 points along the coupling parameter path λ = 0 . 0 , 0 . 2 , 0 . 5 , 0 . 8 , 1 . 0 , shown in Fig 1 . In this simple example , the integral can be easily evaluated to high accuracy using quadrature [ 36 , 37 ] , giving a value of 1 . 523 . Ref - erenced TI reproduces this value , with convergence of z shown in Fig 1 , converging to 1 % of z with 500 iterations and 0 . 1 % within 17 , 000 iterations . This example illustrates notable characteristic features of referenced TI . Here the reference q ref ( θ ) is a good approximation to q ( θ ) , with z ref accounting for most of z ( z ref = 1 . 02 z ) . Conse - quently zz ref is close to 1 , and the expectations , E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i , evaluated by MCMC for the remaining part of the integral are small . For the same reasons the variance at each λ is small , leading to favourable convergence within a small number of iterations . And finally E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i weakly depends on λ , so there is no need to use a very fine grid of λ values or consider optimal paths—satisfactory convergence is easily achieved using a simple geometric path with 4 λ - intervals . 2D pedagogical example with constrained parameters As a second example , consider a 2 - dimensional unnormalised density function with a con - strained parameter space : q ð y 1 ; y 2 Þ ¼ exp ð(cid:0) Y Þ ; ð 10 Þ with Y ¼ 1 4 X i ; j 2f 1 ; 2 g y i þ 1 2 � � 2 j þ 1 8 y 1 y 22 ; ð 11 Þ PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 8 / 16 and y 1 2 ½ 0 ; þ1Þ and y 2 2 ð(cid:0) 1 ; þ1Þ : A reference density q ref ( θ ) can be constructed from the Hessian at the mode of q ( θ ) . To marginalise it on a parameter space with restricted support , we use a reference density q diagref ð y Þ based on a diagonal Hessian , that has an exact and easy to calculate orthant . All densities are shown in Fig 2 . To obtain the log - evidence of the model , we calculated the exact value numerically [ 36 , 37 ] , and using a sampled diagonal covariance matrix , as per Eq 8 , to account for the lower bound of the parameter θ 1 . Without this restriction the final normalising constant is overestimated— if the support of the parameters in the MCMC is not the same as for the analytic z ref calcula - tion , z ref as shown in Eq 3 does not cancel with the TI reference . Numerical comparison of the referenced TI to quadrature is presented in the S2 Appendix . Benchmarks— Radiata Pine To benchmark the application of the referenced TI in the model selection task , two non - nested linear regression models are compared for the radiata pine data set [ 10 ] . This example has been widely used for testing normalising constant calculating methods , since in this instance the exact value of the model evidence can be computed . The data consists of 42 3 - dimensional data - points , expressed as y i —maximum compression strength , x i —density and z i —density adjusted for resin content . In this example , we follow the approach of [ 21 ] , using the priors from therein , and test which of the two models M 1 and M 2 provides better predictions for the compression strength : M 1 : y i ¼ a þ b ð x i (cid:0) � x Þ þ � i ; � i � N ð 0 ; t (cid:0) 1 Þ ; i ¼ 1 ; : : : ; n ; M 2 : y i ¼ g þ d ð z i (cid:0) � z Þ þ Z i ; Z i � N ð 0 ; r (cid:0) 1 Þ ; i ¼ 1 ; : : : ; n : Five methods of estimating the model evidence were used in this example : Laplace approxi - mation using a sampled covariance matrix , model switch TI along a path directly connecting the models [ 8 , 38 ] , referenced TI , power posteriors with equidistant 11 λ - placements ( labelled Fig 2 . Contour plots of un - normalised densities . Contour plots of the un - normalised density q and its two reference densities q ref , one using a full covariance matrix and another using a diagonal covariance matrix that can be easily marginalised . The red line shows the lower boundary θ 1 = 0 and the shaded θ 1 < 0 region to the left of the line is outside of the support of the density q . https : / / doi . org / 10 . 1371 / journal . pone . 0289889 . g002 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 9 / 16 here as PP 11 ) and power posteriors with 100 λ - s ( PP 100 ) , following the example from [ 21 ] . For the model switch TI , referenced TI and PP 11 we used λ 2 { 0 . 0 , 0 . 1 , . . . , 1 . 0 } . The expectation from MCMC sampling per each λ for model switch TI , referenced TI , PP 11 and PP 100 and fitted cubic splines between the expectations are shown in the S2 Appendix . Both reference and model switch TI methods eliminate the problem of divergence of expecta - tion for λ = 0 , which is observed with the power posteriors , where samples for λ = 0 come from the prior density function . And both reference and model switch have smaller residuals for splines in λ fitted to E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i than power posteriors . For each approach , the splines fitted to E q ð l ; θ Þ log q ð θ Þ q ref ð θ Þ h i were integrated to obtain the log - evidence for models M 1 and M 2 , and the log - ratio of the two models’ evidences for the model switch TI . The rolling means of the integral over 1500 iterations for referenced TI and PP 100 for M 2 are shown in Fig 3A . We can see from the plot , that referenced TI presents favourable convergence to the exact value , whereas PP 100 oscillates around it . Fig 3B shows the distribu - tion of log - evidence for the same model generated by 15 runs of the three algorithms : Laplace approximation with sampled covariance matrix , referenced TI and PP 100 . Similar figures for model M 1 are given in the S2 Appendix . Although all three methods resulted in a log - evidence satisfactorily close to the exact solution , referenced TI was the most accurate and importantly , converged fastest ( 308 MCMC draws compared to 55 , 000 draws needed for the power poste - rior method to achieve standard error of 0 . 5 % , excluding burn - in , see S2 Appendix ) . Model selection for the COVID - 19 epidemic in South Korea The final example of using referenced TI for calculating model evidence is fitting a renewal model to COVID - 19 case data from South Korea . The data were obtained from opendata . ecdc . europa . eu / covid19 / casedistribution / csv . The model is based on a statistical representation of a stochastic branching process whose expectation mechanistically follows a renewal - type equa - tion . Its derivation and details are explained in [ 39 ] and a short explanation of the model is provided in the S2 Appendix . Briefly , the model is fitted to the time - series case data and esti - mates a number of parameters , including serial interval and the effective reproduction Fig 3 . The estimated log - evidence of M 2 from the Radiata Pine benchmark problem . The log - evidence of M 2 from the Radiata Pine benchmark problem is shown estimated using three approaches . ( A ) shows the rolling mean of log - evidence of M 2 over 1500 iterations per λ obtained by referenced TI ( blue line ) and PP 100 ( orange line ) methods . The exact value is shown with red dashed line . ( B ) shows the mean log - evidence of the model M 2 evaluated over 15 runs of the three algorithms . The exact value of the log - evidence is shown with the dotted line . https : / / doi . org / 10 . 1371 / journal . pone . 0289889 . g003 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 10 / 16 number , R t . The number of cases for each day are modelled by a negative binomial likelihood , with location parameter estimated by a renewal equation . Three modifications of the original model are tested here : • variation of the infection generation interval for values GI = 5 , 6 , 7 , 8 , 9 , 10 , 20—where GI denotes the mean of Rayleigh - distributed generation interval , • changing the order of the autoregressive model for the reproduction number , for AR ( k ) with k = 2 , 3 , 4 lags , • varying the length of the sliding window for estimating the reproduction number for values in W = 1 , 2 , 3 , 4 , 7 days . Within each group of models , GI , AR and W , we want to select the best model through the highest evidence method . The dimension of each model was dependent on the modifications applied , but in all the cases the normalising constant was a 40 - to 200 - dimensional integral . The log - evidence of each model was calculated using the Laplace approximation with a sam - pled covariance matrix , and then correction to the estimate was obtained using referenced TI method . Values of the log - evidence for each model calculated by both Laplace and referenced TI methods are given in Table 1 . Interestingly , the favoured model in each group , that is the model with the highest log - evidence , was different when the evidence was evaluated using the Laplace approximation than when it was evaluated with referenced TI . For example , using the Laplace method , sliding window of length 7 was incorrectly identified as the best model , whereas with referenced TI window of length 2 was chosen to be the best among the tested sliding windows models , which agrees with the previous studies of the window - length selec - tion in H1N1 influenza and SARS outbreaks [ 40 ] . This exposes how essential it is to accurately determine the evidence , even good approximations can result in misleading results . Bayes fac - tors for all model pairs are shown in the S2 Appendix . Table 1 . Log - evidence estimated by Laplace and referenced TI approximations . In each section , model with the highest log - evidence estimated by Laplace or referenced TI method is indicated in bold . The credible intervals for log - evidence comes from calculating the quantiles of the integral from Eq 2 , where the integral values were obtained from the spline interpolated using running means of the expecations per λ over all iterations . Model Log - evidence Laplace Log - evidence ref TI [ 95 % CrI ] GI = 5 - 1274 - 716 [ - 715 . 6 , - 715 . 2 ] GI = 6 - 1274 - 703 [ - 703 . 3 , - 702 . 7 ] GI = 7 - 1255 - 732 [ - 732 . 4 , - 731 . 8 ] GI = 8 - 1245 - 685 [ - 685 . 5 , - 684 . 7 ] GI = 9 - 1310 - 803 [ - 802 . 8 , - 802 . 3 ] GI = 10 - 1313 - 805 [ - 805 . 1 , - 805 . 3 ] GI = 20 - 1170 - 796 [ - 796 . 3 , - 795 . 5 ] AR ( 2 ) - 1207 - 711 [ - 711 . 2 , - 710 . 6 ] AR ( 3 ) - 1293 - 704 [ - 704 . 7 , - 703 . 7 ] AR ( 4 ) - 2166 - 821 [ - 820 . 6 , - 819 . 2 . ] W = 1 - 1260 - 802 [ - 802 . 1 , - 801 . 6 ] W = 2 - 1069 - 791 [ - 791 . 2 , - 790 . 7 ] W = 3 - 1003 - 807 [ - 807 . 5 , - 807 . 2 ] W = 4 - 940 - 811 [ - 811 . 1 , - 810 . 7 ] W = 7 - 875 - 814 [ - 813 . 7 , - 813 . 5 ] https : / / doi . org / 10 . 1371 / journal . pone . 0289889 . t001 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 11 / 16 Interpretation of the COVID - 19 model selection The importance of performing model selection in a rigorous way is clear from Fig 4 , where the generated R t time - series are plotted for the models favoured by Laplace and referenced TI methods ( additional posterior densities are shown in the S2 Appendix . The differences in the R t time - series show the pitfalls of selecting an incorrect model . The differences between the two favoured models were most extreme for the GI = 8 and GI = 20 models . While a GI = 8 is plausible , even likely for COVID - 19 , GI = 20 is implausible given observed data [ 41 ] . This is further supported by observing that for GI = 20 , favoured by the Laplace method , R t reached the value of over 125 in the first peak—around 100 more than for the GI = 8 . The second peak was also largely overestimated , where R t reached a value of 75 . We find it interesting to note that all models present a similar fit to the confirmed COVID - 19 cases data ( see S2 Appendix ) . This makes it impossible to select the best model through visual inspection and comparison of the model fits , or by using model selection methods that do not take the full posterior distributions into account . Although the models might fit the data well , other quantities generated , which are often of interest to the modeller , might be completely incorrect . Moreover , it emphasises the need to test multiple models before any con - clusion or inference is undertaken , especially with the complex , hierarchical models . Although often the Laplace approximation of the normalising constant is sufficient to pick the best model , it was not the case in this epidemiological model selection problem . We can see in Table 1 that the evidence was the highest for the “boundary” models when Laplace approximation was applied . For example , for the sliding window length models , when the Gaussian approximation was applied , the log - evidence was monotonically increasing with the value of W within the range of values that seem reasonable ( W = 1 to 7 ) . In contrast , with refer - enced TI , the log - evidence geometry is concave within the range of a priori reasonable parameters . Discussion The examples shown in Section Applications illustrate the applicability of the referenced TI approach for calculating model evidence . In the radiata pine example , referenced TI per - formed better than the other tested methods in terms of accuracy and speed . When using ref - erenced TI , at λ = 0 values are sampled from the reference density rather than the prior as in the power posterior method , which should be closer to the original density ( in the sense of Fig 4 . Time - dependent reproduction number . Time - dependent reproduction number generated by models with the highest evidence calculated using the Laplace approximation ( orange lines ) and referenced TI ( blue lines ) . Note , the fitting data in this example contains superspreading events ( which leads to very high values of R t on certain days ) so is not representative of SARS - CoV - 2 transmission generally . https : / / doi . org / 10 . 1371 / journal . pone . 0289889 . g004 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 12 / 16 Kullback – Leibler or Jensen - Shannon divergence ) . This leads not only to a more accurate esti - mate of the normalising constant , but also much faster convergence of the MCMC samples . A detailed theoretical characterisation of rates of convergence is beyond the scope of this article , nonetheless the empirical tests presented consistently show faster convergence than with com - parative approaches . This is useful especially for evaluating model evidence in complex hierar - chical models where each MCMC iteration is computationally demanding . Although referenced thermodynamic integration and other methods using path - sampling have theoretical asymptotically exact Monte Carlo estimator limits , in practice a number of considerations affect accuracy . For example , biases will be introduced to the referenced TI esti - mate if one endpoint density substantially differs from another . An example of this and expla - nation is included in the S3 Appendix . Furthermore , the discretisation of the coupling parameter path in λ can introduce a discre - tisation bias . For the power posteriors method , [ 9 ] propose an iterative way of selecting the λ - placements to reduce the discretisation error . [ 42 ] test multiple λ - placements for 2 - and 20D regression models , and report relative bias for each tested scenario . In the referenced TI algo - rithm discretisation bias is however negligible —the use of the reference density results in TI expectations that are both small and have low variance , and therefore curvature with respect to λ . In our framework we use geometric paths with equidistant coupling parameters λ between the un - normalised posterior densities , but there are other possible choices of the path con - structions , for example a harmonic [ 7 ] or hypergeometric path [ 38 ] . This optimisation might be worth exploring , however , as illustrated in Fig 3B , the expectations evaluated vs λ are typi - cally near - linear with referenced TI suggesting limited gains , although the extent of this will differ from problem to problem . In the application to the renewal model for the COVID - 19 epidemic in South Korea , we showed that for a complex structured model , hypothesis selection by Laplace approximation of the normalising constant can give misleading results . Using referenced TI , we calculated model evidence for 16 models , which enabled a quick comparison between chosen pairs of competing models . Importantly , the evidence given by the referenced TI was not monotonic with the increase of one of the parameters , which was the case for the Laplace approximation . The referenced TI presented here will similarly be useful in other situations particularly where the high - dimensional posterior distribution is uni - modal but non - Gaussian . Conclusions Normalising constants are fundamental in Bayesian statistics . In this paper we give an account of referenced thermodynamic integration ( TI ) , in terms of theoretical consideration regarding the choice of reference , and show how it can be applied to realistic practical problems . We show how referenced TI allows efficient calculation of a single model’s evidence by sampling from geometric paths between the un - normalised density of the model and a judiciously cho - sen reference density —here , a sampled multivariate normal that can be generated and inte - grated with ease . Referenced TI method has practical utility for substantially challenging problems of model selection in epidemiology and we suggest it has applicability in other fields of applied machine learning that rely on high - dimensional Bayesian models . Supporting information S1 Appendix . Variational Laplace reference . ( PDF ) PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 13 / 16 S2 Appendix . Applications . ( PDF ) S3 Appendix . Bias and variance . ( PDF ) Acknowledgments The authors would like to thank Microsoft Research for the donated cloud compute time , and the Stan Forums community for maintaining the space for collaborative and helpful discussions . Author Contributions Conceptualization : Iwona Hawryluk , Swapnil Mishra , Samir Bhatt . Formal analysis : Iwona Hawryluk . Funding acquisition : Samir Bhatt . Investigation : Iwona Hawryluk , Samir Bhatt . Methodology : Iwona Hawryluk , Swapnil Mishra , Seth Flaxman , Samir Bhatt . Project administration : Samir Bhatt . Software : Iwona Hawryluk , Swapnil Mishra , Samir Bhatt . Supervision : Swapnil Mishra , Samir Bhatt . Visualization : Iwona Hawryluk . Writing – original draft : Iwona Hawryluk . Writing – review & editing : Iwona Hawryluk , Swapnil Mishra , Seth Flaxman , Samir Bhatt . References 1 . Kass RE , Raftery AE . Bayes Factors . Journalof the American Statistical Association . 1995 ; 90 ( 430 ) : 773 – 795 . https : / / doi . org / 10 . 1080 / 01621459 . 1995 . 10476572 2 . Bennett CH . Efficient estimationof free energy differences from Monte Carlo data . Journal of Computa - tional Physics . 1976 ; 22 ( 2 ) : 245 – 268 . https : / / doi . org / 10 . 1016 / 0021 - 9991 ( 76 ) 90078 - 4 3 . Meng XL , Wong WH . Simulating rations of normalising constants via a simple identity : a theoretical exploration . Statistica Sinica . 1996 ; 6 ( 4 ) : 831 – 860 . 4 . SkillingJ . Nested Samplingfor GeneralBayesianComputation . BayesianAnalysis . 2006 ; 1 ( 4 ) : 833 – 860 . https : / / doi . org / 10 . 1214 / 06 - BA127 5 . Habeck M . Evaluation of marginallikelihoodsvia the density of states . In : Proceedingsof the Fifteenth InternationalConference on Artificial Intelligenceand Statistics . vol . 22 of Proceedingsof Machine LearningResearch . La Palma , Canary Islands : PMLR ; 2012 . p . 486 – 494 . Availablefrom : https : / / proceedings . mlr . press / v22 / habeck12 . html . 6 . KirkwoodJG . Statistical Mechanicsof Fluid Mixtures . The Journal of Chemical Physics . 1935 ; 3 ( 5 ) : 300 – 313 . https : / / doi . org / 10 . 1063 / 1 . 1749657 7 . Gelman A , Meng XL . Simulating normalizingconstants : from importance samplingto bridgesampling to path sampling . Statistical Science . 1998 ; 13 ( 2 ) : 163 – 185 . https : / / doi . org / 10 . 1214 / ss / 1028905934 8 . Lartillot N , PhilippeH . Computing Bayes Factors Using Thermodynamic Integration . Systematic Biol - ogy . 2006 ; 55 ( 2 ) : 195 – 207 . https : / / doi . org / 10 . 1080 / 10635150500433722PMID : 16522570 9 . Friel N , Hurn M , Wyse J . Improvingpower posterior estimationof statistical evidence . Statistics and Computing . 2017 ; p . 1165 – 1180 . https : / / doi . org / 10 . 1007 / s11222 - 016 - 9678 - 6 10 . Williams EJ . Regression Analysis . Wiley ; 1959 . 11 . Neal RM . ProbabilisticInference Using Markov ChainMonte Carlo Methods . 1993 ; . PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 14 / 16 12 . DiciccioTJ , Kass RE , Raftery A , Wasserman L . Computing Bayes Factors by CombiningSimulation and Asymptotic Approximations . Journalof the American Statistical Association . 1997 ; 92 ( 439 ) : 903 – 915 . https : / / doi . org / 10 . 1080 / 01621459 . 1997 . 10474045 13 . Grosse RB , MaddisonCJ , Salakhutdinov RR . Annealingbetweendistributions by averagingmoments . In : Advancesin NeuralInformation Processing Systems . vol . 26 ; 2013 . Availablefrom : https : / / proceedings . neurips . cc / paper / 2013 / file / fb60d411a5c5b72b2e7d3527cfc84fd0 - Paper . pdf . 14 . Dirac PAM , Bohr NHD . The quantumtheory of the emissionand absorption of radiation . Proceedingsof the Royal Society of LondonSeries A , Containing Papers of a Mathematicaland Physical Character . 1927 ; 114 ( 767 ) : 243 – 265 . https : / / doi . org / 10 . 1098 / rspa . 1927 . 0039 15 . Gell - MannM , Brueckner KA . Correlation energy of an electron gas at high density . Physical Review . 1957 ; 106 ( 2 ) : 364 – 368 . https : / / doi . org / 10 . 1103 / PhysRev . 106 . 369 16 . Vo č adloL , Alf è D . Ab initio meltingcurve of the fcc phase of aluminum . Phys Rev B . 2002 ; 65 . https : / / doi . org / 10 . 1103 / PhysRevB . 65 . 214105 17 . Duff AI , Davey T , Korbmacher D , Glensk A , GrabowskiB , Neugebauer J , et al . Improved method of cal - culatingab initio high - temperature thermodynamic propertieswith applicationto ZrC . Physical Review B . 2015 ; 91 ( 21 ) : 214311 . https : / / doi . org / 10 . 1103 / PhysRevB . 91 . 214311 18 . Xie W , Lewis PO , Fan Y , Kuo L , Chen MH . ImprovingMarginal LikelihoodEstimation for BayesianPhy - logeneticModel Selection . Systematic Biology . 2010 ; 60 ( 2 ) : 150 – 160 . https : / / doi . org / 10 . 1093 / sysbio / syq085 PMID : 21187451 19 . CameronE , Pettitt A . RecursivePathwaysto MarginalLikelihoodEstimation with Prior - Sensitivity Anal - ysis . Statistical Science . 2014 ; 29 ( 3 ) : 397 – 419 . https : / / doi . org / 10 . 1214 / 13 - STS465 20 . Friel N , Pettitt AN . Marginallikelihoodestimationvia power posteriors . Journal of the Royal Statistical Society : Series B ( Statistical Methodology ) . 2008 ; 70 ( 3 ) : 589 – 607 . https : / / doi . org / 10 . 1111 / j . 1467 - 9868 . 2007 . 00650 . x 21 . Friel N , Wyse J . Estimating the evidence : a review . Statistica Neerlandica . 2012 ; 66 ( 3 ) : 288 – 308 . https : / / doi . org / 10 . 1111 / j . 1467 - 9574 . 2011 . 00515 . x 22 . LefebvreG , Steele R , VandalAC . A path samplingidentity for computing the Kullback – Leibler and J divergences . Computational Statistics & Data Analysis . 2010 ; 54 ( 7 ) : 1719 – 1731 . https : / / doi . org / 10 . 1016 / j . csda . 2010 . 01 . 018 23 . Fan Y , Wu R , Chen MH , Kuo L , LewisPO . Choosingamongpartitionmodelsin Bayesianphylogenetics . MolecularBiology and Evolution . 2011 ; 28 ( 1 ) : 523 – 532 . https : / / doi . org / 10 . 1093 / molbev / msq224 PMID : 20801907 24 . Baele G , Lemey P , Suchard MA . Genealogical Working Distributions for BayesianModel Testing with Phylogenetic Uncertainty . Systematic Biology . 2016 ; 65 ( 2 ) : 250 – 264 . https : / / doi . org / 10 . 1093 / sysbio / syv083 PMID : 26526428 25 . RidgwayJ . Computation of Gaussian orthant probabilities in high dimension . Statistics and computing . 2016 ; 26 ( 4 ) : 899 – 916 . https : / / doi . org / 10 . 1007 / s11222 - 015 - 9578 - 1 26 . Azzimonti D , Ginsbourger D . Estimating Orthant Probabilitiesof High - Dimensional Gaussian Vectors with An Applicationto Set Estimation . Journalof Computational and Graphical Statistics . 2016 ; 27 : 255 – 267 . https : / / doi . org / 10 . 1080 / 10618600 . 2017 . 1360781 27 . Owen DB . Orthant Probabilities . Wiley StatsRef : Statistics ReferenceOnline . 2014 . https : / / doi . org / 10 . 1002 / 9781118445112 . stat01097 28 . Miwa T , Hayter AJ , Kuriki S . The evaluation of generalnon - centredorthant probabilities . Journal of the Royal Statistical Society : Series B ( Statistical Methodology ) . 2003 ; 65 ( 1 ) : 223 – 234 . https : / / doi . org / 10 . 1111 / 1467 - 9868 . 00382 29 . Curnow RN , Dunnett CW . The Numerical Evaluation of Certain Multivariate Normal Integrals . The Annals of Mathematical Statistics . 1962 ; 33 ( 2 ) : 571 – 579 . https : / / doi . org / 10 . 1214 / aoms / 1177704581 30 . RubenH . An asymptotic expansionfor the multivariate normaldistributionand Mills’ ratio . Journal of Researchof the NationalBureau of Standards Section B Mathematics and Mathematical Physics . 1964 ; p . 3 . https : / / doi . org / 10 . 1017 / S1446788700026872 31 . Brown M . A generalizederror function in n dimensions . US Naval Missile Center , Theorethical Analysis Division . 1963 ; . 32 . Hoffman MD , Gelman A . The No - U - Turnsampler : adaptively setting path lengthsin HamiltonianMonte Carlo . J Mach Learn Res . 2014 ; 15 ( 1 ) : 1593 – 1623 . 33 . Carpenter B , Gelman A , Hoffman M , Lee D , GoodrichB , Betancourt M , et al . Stan : A Probabilistic Pro - grammingLanguage . Journalof Statistical Software , Articles . 2017 ; 76 ( 1 ) : 1 – 32 . https : / / doi . org / 10 . 18637 / jss . v076 . i01 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 15 / 16 34 . Phan D , PradhanN , Jankowiak M . ComposableEffects for Flexibleand Accelerated ProbabilisticPro - grammingin NumPyro . arXiv preprint . 2019 . https : / / doi . org / 10 . 48550 / arXiv . 1912 . 11554 35 . GelmanA , RubinDB . Inference from IterativeSimulationUsingMultipleSequences . StatisticalScience . 1992 ; 7 ( 4 ) : 457 – 472 . https : / / doi . org / 10 . 1214 / ss / 1177011136 36 . PiessensR , deDonckerKapengaE , Ueberhuber C , Kahaner D . QUADPACK : A Subroutine Package for Automatic Integration . Springer ; 1983 . 37 . VirtanenP , Gommers R , OliphantTE , Haberland M , Reddy T , CournapeauD , et al . SciPy 1 . 0 : Funda - mental Algorithms for Scientific Computing in Python . Nature Methods . 2020 ; 17 : 261 – 272 . https : / / doi . org / 10 . 1038 / s41592 - 019 - 0686 - 2PMID : 32015543 38 . Vitoratou S , Ntzoufras I . Thermodynamic Bayesianmodel comparison . Statistics and Computing . 2017 ; p . 1165 – 1180 . https : / / doi . org / 10 . 1007 / s11222 - 016 - 9678 - 6 39 . Berah T , MellanTA , Miscouridou X , Mishra S , Parag KV , PakkanenMS , et al . Unifyingthe effective reproductionnumber , incidence , and prevalence under a stochastic age - dependent branchingprocess . arXiv preprint . 2021 . https : / / doi . org / 10 . 48550 / arXiv . 2107 . 05579 40 . Parag KV , DonnellyCA . Using information theory to optimise epidemicmodels for real - time prediction and estimation . PLOS Computational Biology . 2020 ; 16 ( 7 ) : 1 – 20 . https : / / doi . org / 10 . 1371 / journal . pcbi . 1007990PMID : 32609732 41 . Bi Q , Wu Y , Mei S , Ye C , Zou X , Zhang Z , et al . Epidemiologyand transmission of COVID - 19 in 391 cases and 1286 of their close contacts in Shenzhen , China : a retrospective cohort study . The Lancet Infectious Disease . 2020 ; 20 : 911 – 919 . https : / / doi . org / 10 . 1016 / S1473 - 3099 ( 20 ) 30287 - 5 PMID : 32353347 42 . Calderhead B , Girolami M . Estimating Bayes factors via thermodynamic integrationand population MCMC . Computational Statistics & Data Analysis . 2009 ; 53 ( 12 ) : 4028 – 4045 . https : / / doi . org / 10 . 1016 / j . csda . 2009 . 07 . 025 PLOS ONE Application of referencedthermodynamic integrationto Bayesian model selection PLOS ONE | https : / / doi . org / 10 . 1371 / journal . pone . 0289889 August 14 , 2023 16 / 16