a r X i v : 2202 . 03909v1 [ q - b i o . Q M ] 6 F e b 2022 Optimal vaccination at high reproductive numbers : sharp transitions and counter - intuitive allocations Nir Gavish * a and Guy Katriel b a Faculty of Mathematics , Technion - IIT , Haifa 32000 , Israel b Department of Applied Mathematics , ORT Braude College of Engineering , Karmiel 216100 , Israel February 2022 Abstract Optimization of vaccine allocations among different segments of a heterogeneous population is important for enhancing the effectiveness of vaccination campaigns in reducing the burden of epidemics . Intuitively , it would seem that allocations designed to minimize infections should prioritize those with the highest risk of being infected and infecting others . This prescription is well supported by vaccination theory , e . g . , when the vaccination campaign aims to reach herd immunity . In this work , we show , however , that for vaccines providing partial protection ( leaky vaccines ) and for sufﬁciently high values of the basic reproduction number , intuition is overturned : the optimal allocation for minimizing the number of infections prioritizes the vaccination of those who are least likely to be infected . Furthermore , we show that this phenomenon occurs at a range of basic reproduction numbers relevant for the currently circulating strains of SARS - CoV - 19 . The work combines numerical investigations , asymptotic analysis for a general model , and complete mathematical analysis in a simple two - group model . The results point to important considerations in managing vaccination campaigns for infections with high transmissibility . 1 Introduction Vaccination is the foremost tool for reducing the burden of contagious diseases . Mathematical models describing the spread of epidemics are widely used to explore the effect of vaccination on transmission dynamics and epidemic outcomes [ 1 – 4 ] . Heterogeneity of the population along various dimensions plays a vital role in shaping transmis - sion dynamics . Different sub - populations , such as age groups or occupational groups , have different levels of contact among themselves and with others and may vary in their intrinsic susceptibility to being infected due to biological factors . Heterogeneity provides important opportunities for enhancing the effectiveness of vaccination campaigns by prioritizing the vaccination of some sub - populations [ 5 ] . This has led to a vast literature addressing the question of optimal vaccination in heterogeneous populations , under constraints on the number of vaccines that can be adminis - tered , with various aims , such as achieving herd immunity [ 6 – 9 ] , minimizing the initial growth rate of an emerging epidemic [ 10 ] or minimizing epidemic outcomes - the total number of infections , morbidity or mortality [ 11 – 15 ] . These efforts have naturally received widespread attention in the wake of the COVID - 19 pandemic [ 16 – 21 ] . Yet , while most studies of optimal vaccination have involved transmission at relatively low reproduction numbers , e . g . , associated with Inﬂuenza , often within the range of values for which herd immunity can be achieved , recent lineages of SARS - CoV - 19 are associated with high reproduction numbers ( R 0 ) [ 22 – 24 ] . In this work , we show that high R 0 can lead to a dramatic and surprising change in the optimal allocation of vaccines . We consider here the problem of optimal distribution of a leaky vaccine - one providing partial protection - to a heterogeneous population , to minimize the total number of infections during an epidemic . * Corresponding author : ngavish @ technion . ac . il 1 Figure 1 : Example with three groups . Individuals of each of the groups interact with those of all other groups ( random mixing ) , but members of group 2 ( 50 % of the population ) have twice as many daily interactions as members of group 1 ( 25 % of the population ) , and members of group 3 ( 25 % of the population ) have twice as many interactions as members of group 2 . We consider the optimal allocation of vaccine to 40 % of the population , where vaccine efﬁcacy in blocking transmission is 80 % . Graph presents the optimal vaccine allocations as a function of R 0 . At sufﬁcienly high R 0 it is optimal to vaccinate the entire low - contact group , with the remaining vaccines allocated to the medium contact group so that the high contact group is left entirely non - vaccinated . We ﬁrst demonstrate this claim using a simple example that considers a population subdivided into three sub - populations differing by their number of daily contacts : low - contact , medium - contact , and high - contact groups , but with homogeneous mixing among all individuals . Figure 1 shows the optimal allocation for minimizing the number of infections for a given vaccine coverage 1 , in dependence on the reproductive number R 0 . As expected , for lower values of R 0 ( R 0 < 4 . 7 ) , the optimal allocation covers the entire high - contact group , with the remaining vaccines allocated to the medium - contact group . However , for R 0 > 5 . 8 it is optimal to vaccinate the entire low - contact group , with the remaining vaccines allocated to the medium contact group so that the high contact group is left entirely non - vaccinated ! This ‘paradoxical’ effect , whereby it is sometimes optimal to vaccinate those less prone to infection while leaving those more prone to infection unprotected , is the focus of this work . At an intuitive level , the seemingly paradoxical optimal allocation of vaccines to those who are at lower risk of being infected can be understood as follows : for sufﬁciently high R 0 , breakthrough infections among those who are more prone to infection become so common that it becomes inefﬁcient to allocate vaccines to those groups . Instead , the optimal strategy is to move to a second line of defense and vaccinate sub - populations that are less prone to infection . We further claim that the transition to infections - minimizing allocations which prioritize those who are least prone to infection occurs for values of the parameter R 0 which are relevant to SARS - CoV - 19 . To demonstrate this point , we present a more realistic example computed using an age - structured transmission model with the estimated contact matrix for the USA . We assume that the susceptibility of children younger than 10 is 50 % lower than that of older individuals , following estimates for SARS - Cov - 19 [ 25 – 27 ] . In this case , we observe that for values of R 0 > 6 , it becomes optimal to allocate vaccines to those of age 60 and older , despite their lower number of contacts , and to children under 10 , despite their lower susceptibility , at the expense of vaccine allocation to those who contribute most to the spread of disease , see Figure 2 . We have considered various scenarios in eight other countries and observed similar results . The analytical results presented in this work rigorously characterize the phenomenon illustrated by the above examples and show that it is generic . Our key result considers the general case of a population divided into n groups , with a general structure of contacts among the groups , and uses asymptotic analysis to obtain an explicit vaccine allocation which is nearly optimal for large R 0 . The nearly - optimal allocation ( i . e . , optimal up to an exponentially small error ) is to administer vaccines to those who are least prone to infection , as determined by an exposure index 1 See the ﬁgure’s caption for details on the parameters in this example 2 Infections minimizing vaccine allocations - USA example 10 - 19 ( 71 . 2 % ) 20 - 29 ( 95 % ) 30 - 39 ( 100 % ) 40 - 49 ( 100 % ) 50 - 59 ( 54 . 9 % ) 0 - 9 ( 100 % ) 10 - 19 ( 100 % ) 40 - 49 ( 100 % ) 60 - 69 ( 58 . 3 % ) 70 - 79 ( 100 % ) 80 + ( 100 % ) 2 . 6 3 4 5 6 7 8 9 10 R 0 0 % 10 % 20 % 30 % 40 % 50 % a ll o c a t i on o f v a cc i ne s Figure 2 : Example using the USA demographic and social structure . Optimal vaccine allocations for minimizing the overall number of infections for vaccine coverage of 55 % of the population with vaccine efﬁcacy of 80 % in blocking transmission . For low values of R 0 , vaccination of spreaders is the best way to minimize the overall number of infections . However , for R 0 > 6 , it becomes optimal to allocate vaccines to the elderly , at the expense of vaccine allocation to those who contribute most to spreading . which is computed for each group as a weighted sum of the number of interactions made by members of that group . In the example presented in Figure 2 , the theoretical ‘nearly - optimal’ allocation in fact coincides with the optimal allocation for R 0 > 7 . 5 . To obtain a more reﬁned theoretical understanding of the phenomena of interest , we also consider a minimal case of two groups with different susceptibilities , which is amenable to complete mathematical analysis . In this case , we prove the existence of a critical threshold R ∗ 0 at which a sharp transition occurs in the optimal allocation , from vaccinating those who are more susceptible to an allocation which prioritizes those who are less susceptible . 2 Vaccine allocation at high reproductive number We consider optimal allocation of vaccines , using a standard SIR model ( 7 ) - ( 10 ) , in which the population is subdivided into n groups , with N j the fraction of population in group j . Thus , P n j = 1 N j = 1 . The asymptotic analysis of vaccine allocations at high R 0 gives rise to a quantity e j associated to each group j , which we refer to as the exposure index of members of the group : e j = σ j n X k = 1 C jk η k . ( 1 ) Here , C jk is the mean number of contacts of a single member of group j with members of group k per unit time , σ j is the susceptibility of members of group j relative to those of group 1 , and η j is the infectivity of members of group j relative to those of group 1 ( thus σ 1 = η 1 = 1 ) . We remark that the quantities e j can be interpreted as proportional to the probabilities per unit time of an individual of group j to be infected , assuming this individual is placed in a population all of whose members are infected . We assume a vaccine provides imperfect leaky protection [ 28 ] , reducing susceptibility by a factor ε ∈ ( 0 , 1 ) ( thus 1 − ε is the vaccine efﬁcacy ) . Vaccination is performed before the introduction of the pathogen . Vaccine allocation is deﬁned by a vector ~ v whose components 0 ≤ v j ≤ N j , are the fractions of the population in groups j = 1 , · · · , n which are vaccinated . The ﬁnal size of the epidemic is computed as the solution of a standard ﬁnal size equation ( FSE ) system , see ( 12 ) . We control the reproductive number R 0 by varying the transmission parameter β , keeping all other 3 parameters ﬁxed , and denote the ﬁnal size by Z ( R 0 , ~ v ) . To ﬁnd the allocation minimizing the ﬁnal size , given the total coverage v , we solve the optimization problem minimize Z ( R 0 , ~ v ) , 0 ≤ v j ≤ N j , n X j = 1 v j = v . ( 2 ) The following result shows that for sufﬁciently high values of R 0 , prioritizing the vaccination of the groups with lowest exposure index provides a nearly - optimal vaccine allocation . Theorem 1 . Assume , without loss of generality , that the groups are ordered in non - decreasing order of their exposure indices given by ( 1 ) , e 1 ≤ e 2 ≤ · · · ≤ e n . Then , for given vaccine coverage v , the vaccine allocation ~ v ∗ =   N 1 , N 2 , · · · , N j ∗ , v − j ∗ X k = 1 N k , 0 , · · · , 0   ( 3 ) where j ∗ is the maximal index for which P j ∗ k = 1 N j ≤ v , gives rise to a nearly minimal ﬁnal size ( overall number of infections ) in the sense that , deﬁning ~ v optimal to be a minimizer of ( 2 ) , we have , for some c > 0 , E = Z ( R 0 , ~ v ∗ ) − Z ( R 0 , ~ v optimal ) 1 − Z ( R 0 , ~ v optimal ) = O ( e − cR 0 ) , as R 0 → ∞ . ( 4 ) Proof : See Section 5 . 3 and Appendix A . (cid:3) The example given in Figure 2 illustrates the results of Theorem 1 , using parameters corresponding to the USA demography and contact structure [ 29 ] with nine 10 - year age groups , and with an age - dependent susceptibility proﬁle for SARS - CoV - 19 in which the susceptibility of children is reduced [ 25 ] . Under these conditions , age group 0 - 9 has the smallest exposure index , followed by , with increasing exposure index , age groups 70 - 79 , 80 + , 10 - 19 , 40 - 49 , 60 - 69 , 50 - 59 , and 20 - 29 . Finally , the age group 30 - 39 has the largest exposure index . Accordingly , in this case , by Theorem 1 , for sufﬁciently high R 0 , it is ( essentially ) optimal to ﬁrst allocate all vaccines to age group 0 - 9 , and then , based on the availability of supply , v , to extend coverage to age groups 70 - 79 , 80 + , 10 - 19 , 40 - 49 , 60 - 69 , and so on . Figure 2 presents the optimal infection minimizing vaccine allocations as a function of R 0 in the case vaccine efﬁcacy in preventing infections is 80 % . For R 0 & 7 . 5 , we observe that the computed optimal allocation coincides with the asymptotic allocation ~ v ∗ , deﬁned in ( 3 ) in Theorem 1 . Among the age groups included in this vaccine allocation , age group 60 - 69 has the highest exposure index . Therefore , by Theorem 1 , a gradual decrease of the overall vaccine coverage will lead to a reduction in vaccines allocated to age group 60 - 69 until this age group is completely removed from the optimal allocation ( data not shown ) . Figure 3 presents the attack rates corresponding to different allocations of vaccines , in dependence on R 0 , for the same example as in Figure 2 . It is interesting to observe that although the asymptotic allocation ~ v ∗ given by ( 3 ) coin - cides with the optimal allocation only for R 0 & 7 . 5 , see Figure 2 , already for R 0 > 5 . 7 the attack rate correspondingto the asymptotic allocation is very close to the attack rate corresponding to the optimal allocation . Indeed , for R 0 > 5 . 7 the relative error E deﬁned by ( 4 ) is less than 1 % . Furthermore , in this regime of R 0 , the asymptotic allocation ~ v ∗ performs much better than common allocations considered in the literature such as the uniform allocation or allocation of vaccines to those which are most prone to become infected . We have performed similar computations using contact matrices estimated for different countries , different levels of vaccine efﬁcacy and coverage , ﬁnding that the minimal values of R 0 for which the relative error E is less than % 1 fall in the range 4 < R 0 < 10 with mean R 0 ≈ 6 , see Appendix C . We therefore conclude that the asymptotic allocation given by Theorem 1 is nearly optimal for parameter values which are relevant to some lineages of SARS - CoV - 19 . 3 A two - group example In this section , we consider a minimal model allowing us to study how optimal vaccine allocations change with the reproductive number - the simplicity of the model enables us to obtain a complete mathematical analysis of the 4 2 . 6 3 4 5 6 7 8 9 10 R 0 0 % 20 % 40 % 60 % 80 % 100 % a tt a ck r a t e Attack rate - USA example Vaccination of spreaders Asymptotic allocation Optimal vaccine allocation Uniform vaccination Figure 3 : Attack rate as a function of R 0 for different allocations . The attack rate ( percent of those infected among the population ) as a function of R 0 for the example presented in Figure 2 . Dashed - dotted blue curve corresponds to the optimal allocation at R 0 = 2 . 6 , see Figure 2 , which prioritizes those who contribute to the spread of the disease . The solid red curve corresponds to the asymptotic allocation ~ v ∗ , see ( 3 ) , dashed black curve corresponds to the optimal vaccine allocation for minimizing infections , and dotted green curve corresponds to a uniform allocation of vaccines . phenomena of interest . In this model , the population is composed of two sub - populations ( e . g . , age groups ) with fractions N 1 , N 2 ( N 1 + N 2 = 1 ) , which differ only in their susceptibility to infection , with the susceptibility of group 2 to infection higher than that of group 1 by a factor σ > 1 . Homogeneous mixing among all individuals is assumed . Accordingly , the exposure index of group 1 equals e 1 = 1 , and it is smaller than the exposure index e 2 = σ > 1 . We assume a vaccine provides partial leaky protection with efﬁcacy 1 − ε . The dynamics of spread is described by the two - group SIR model S ′ 1 = − βS 1 I , V ′ 1 = − βεV 1 I , S ′ 2 = − σβS 2 I , V ′ 2 = − σβεV 2 I I ′ = β [ S 1 + σS 2 + εV 1 + σεV 2 ] I − γI , where S i ( t ) , V i ( t ) denote the size of the non - vaccinated and vaccinated parts of the population with lower ( i = 1 ) and higher ( i = 2 ) susceptibility ( exposure index ) , and I ( t ) denotes the size of the population infected at time t , all as fractions of the total population , β is the transmission rate , and γ − 1 is the duration of infectivity . We assume that the amount of available vaccine is sufﬁcient to vaccinate a fraction v of the population prior to the start of an epidemic . We divide this fraction into two parts v 1 , v 2 with v 1 + v 2 = v , to be administered to each of the groups . For conciseness , we will assume below that v < min ( N 1 , N 2 ) , that is the amount available vaccine is insufﬁcient to vaccinate any of the two groups entirely - analogous results can be proved in the cases in which it is possible to fully vaccinate one of the two groups . Our initial conditions are thus S j ( 0 ) = N j − v j − I j ( 0 ) , V j ( 0 ) = v j , I ( 0 ) = I 1 ( 0 ) + I 2 ( 0 ) . The basic reproductive number ( in the absence of vaccination ) is R 0 = βγ ( N 1 + σN 2 ) . Our aim is to choose v 1 , v 2 so as to minimize the fraction of population Z = Z ( v 1 , v 2 ) which will be infected during the epidemic . This fraction is given ( in the limit of a small initial fraction of infected individuals , I 1 ( 0 ) , I 2 ( 0 ) → 0 ) as the solution Z of the ﬁnal size equation 1 − ( N 1 − v 1 ) e − βγ Z − ( N 2 − v 2 ) e − σ βγ Z − v 1 e − ε βγ Z − v 2 e − σε βγ Z = Z , ( 5 ) and our optimal allocation problem is minimize Z ( v 1 , v 2 ) v 1 , v 2 ≥ 0 , v 1 + v 2 = v . ( 6 ) 5 Analyzing the above problem , we obtain Theorem 2 . Assuming v < min ( N 1 , N 2 ) , there exists a value R ∗ 0 such that ( i ) If R 0 < R ∗ 0 then the optimal solution of ( 6 ) is given by ( v 1 , v 2 ) = ( 0 , v ) . ( ii ) If R > R ∗ 0 then the optimal solution of ( 6 ) is given by ( v 1 , v 2 ) = ( v , 0 ) . The transition value R ∗ 0 is given explicitly by the formula R ∗ 0 = ( N 1 + N 2 σ ) ln ( 1 α ) 1 − N 1 α − N 2 α σ − v ( α ε − α ) , where α is the unique solution of the equation α − α σ − α ε + α σε = 0 , α ∈ ( 0 , 1 ) . Proof : See Appendix B . (cid:3) Thus it is always optimal to allocate the entire stock of vaccines to only one of the groups , but there is a switch between vaccinating the more susceptible population , i . e . , group 2 , when R 0 is low to vaccinating the less susceptible population , i . e . , group 1 , when R 0 is high . A numerical example illustrating the contents of Theorem 2 is given in Figure 4 . This ﬁgure reveals why the op - 1 2 3 4 5 R 0 0 % 20 % 40 % 60 % 80 % 100 % a tt a ck r a t e attack rate - two groups example Vaccination of the more susceptible ( spreaders ) Vaccination of the less susceptible ( asymptotic allocation ) Optimal vaccine allocation Figure 4 : Example of two groups with different susceptibilities . The two groups are of equal size , one of which is 50 % as susceptible as the other . 40 % of the population can be vaccinated , with a vaccine that is 80 % effective in blocking transmission . The graph presents ﬁnal sizes as a function of the basic reproduction number resulting from the allocation of vaccines to those of higher susceptibility ( red curve ) , lower susceptibility ( blue curve ) , and the optimal allocation ( black dashed curve ) . timal vaccine allocation changes abruptly from allocations prioritizing the more susceptible to allocations prioritizing the less susceptible . Indeed , at low values of R 0 , the epidemic ﬁnal size resulting from allocations prioritizing the more susceptible is lower than that resulting from vaccinating the less susceptible . However the ﬁnal size curves intersect at the point R crit0 , which is the point at which optimal allocation shifts to the more susceptible group . To prove Theorem 2 one must also show that allocating some of the vaccine to each of the groups is always inferior to one of the extreme allocations reserving the entire stock of vaccines to only one group , see Appendix B . 3 . 4 Discussion The results in this work reveal phenomena that have not been described in previous literature , to the best of our knowledge . These phenomena are relevant to circulating and plausibly to future lineages of SARS - CoV - 19 . They 6 are also of theoretical importance , allowing us to reﬁne our intuitions in thinking about the allocation of vaccines . Therefore , we believe the results should be of interest to researchers and public health experts involved in vaccination policies . We have considered vaccination of a heterogeneous population , employing a vaccine that reduces the risk of infection ( leaky vaccine ) , with the aim of minimizing the number of infections , and have shown that the optimal allocation of vaccines displays a quite complicated dependence on the reproductive number R 0 , with continuously varying rates in some intervals , constant allocation in others , and discontinuous shifts . In particular , for sufﬁciently large R 0 the optimal vaccine allocation has the counter - intuitive feature of favoring allocation of vaccines to the groups which are less prone to infection , as measured by the exposure indices . We have justiﬁed this result analytically , by means of an asymptotic approximation which shows that for sufﬁciently large values of R 0 the allocation of vaccines to the groups with lower exposure indices result in a nearly - optimal allocation . Moreover , strongly supported by numerical results , we make the following Conjecture 1 . For sufﬁciently large R 0 the optimal allocation ~ v optimal solving ( 2 ) coincides with the asymptotic allocation ~ v ∗ given by ( 3 ) . We have rigorously proved this conjecture in the two - group case considered in Theorem 2 . The proof of this conjecture in the general case remains an interesting challenge . We note that our results hinge on the leaky nature of vaccines . For example , in the explicit two - group example , the transition value R ∗ 0 , at which it becomes advantageous to vaccinate the less susceptible group , goes to inﬁnity in the limit ε → 0 of perfect vaccine protection . Therefore , optimal allocations of perfect vaccines or of all - or - none vaccines will not undergo sharp transitions at high R 0 . It should be stressed that the phenomena which have been revealed are not merely theoretical curiosities , as our numerical examples show they occur for realistic parameter values , in particular for basic reproductive numbers , vaccine efﬁcacy , and coverage values which are in the ranges relevant for the currently circulating strains of SARS - CoV - 19 . A salient characteristic of the epidemiology of COVID - 19 and other infectious diseases is the fact that the risk of severe disease and mortality is strongly age - dependent . In considering the allocation of vaccines , this fact has led to an apparent trade - off between minimizing mortality by direct protection of older age groups which are at higher risk of severe outcomes and minimizing the number of infections by vaccinating younger age groups who play a larger role in the spread of infection [ 30 – 32 ] . An interesting consequence of the results presented here is that , for sufﬁciently high values of R 0 , such a trade - off does not exist , since the optimal allocation for minimizing infections , covers the older age groups , because of the fact that they are less prone to infection . Under such conditions , prioritizing older age groups is optimal both for minimizing mortality and for minimizing the number of infections . While the focus here on prophylactic vaccine allocations that are optimal with respect to the overall number of infections , the methods , and the results can be modiﬁed to address optimization of other outcomes , such as severe cases and mortality , by weighing the infections in different age groups and according to vaccination status with appropriate rates of severe disease and mortality . In a different direction , it is also of interest to consider measures such as the peak number of daily cases during the epidemic , as this measure relates directly to the load on healthcare providers . We have found parameter regimes with high basic reproduction numbers for which vaccination of sub - populations that are least prone to infection gives rise to a lower peak number of cases compared to vaccine allocations prioritizing sub - populations that drive the epidemic spread . These results will be presented elsewhere . From a public health point of view , the sharp transition in optimal vaccine allocation to prioritization of sub - populations that are least prone to infection stems from the fact that breakthrough infections among those who are more prone to infection become so common that it becomes less effective to allocate vaccines to those groups . There - fore , the sharp transition reﬂects a withdrawal to a second line of defense . We stress that an alternative policy to be considered is to apply non - pharmaceutical interventions to reduce the effective reproduction number to a level that enables avoiding such a withdrawal . More generally , it is important to be aware of the fact that the most effective allo - cation of public health resources to alleviating the burden of epidemics , e . g . , quarantine policy , green passes , screening tests , and messaging to the public , may vary with the reproductive number , so that emergence of a variant with higher transmissibility requires a re - evaluation of existing policies . 7 Table 1 : Model parameters Parameter Description N j Fraction of the population in group j . C jk The mean number of contacts of a single member of group j with members of group k per unit time . We denote by C the n × n matrix with elements C = { C jk } nj , k = 1 . σ j The susceptibility of members of group j relative to those of group 1 ( thus σ 1 = 1 ) . η j The infectivity of members of group j relative to those of group 1 ( thus η 1 = 1 ) . β Transmission parameter : the probability of infection of a non - vaccinated indi - vidual in group 1 upon contact with a member of group 1 . γ The recovery rate so that 1 γ is the mean duration of infectivity . v j ∈ [ 0 , 1 ] The fraction of the population in group j which is vaccinated . 1 − ε Vaccine efﬁcacy against infection , so that ε is the factor by which the probability of infection upon contact is reduced for those vaccinated . Data availability All relevant data are within the manuscript , or on Zenodo at https : / / doi . org / 10 . 5281 / zenodo . 5984404 . The source code is available on GitHub at https : / / github . com / NGavish / HighR0 . Acknowledgements The research of N . G . was supported by the ISRAEL SCIENCE FOUNDATION ( grant No . 3730 / 20 ) within the KillCorona – Curbing Coronavirus Research Program . 5 Materials and methods 5 . 1 Model We consider an SIR model in which the population is subdivided into n groups . The dynamic variables S j , I j , R j and V j are the fractions of the total population consisting of susceptible , infected , recovered , and vaccinated individuals in group j , respectively . Model parameters are summarized in Table 1 . The dynamics is described by the differential equation system S ′ j ( t ) = − βS j ( t ) n X k = 1 D jk · I k ( t ) , ( 7 ) V ′ j ( t ) = − εβV j ( t ) n X k = 1 D jk · I k ( t ) , ( 8 ) I ′ j ( t ) = β ( S j ( t ) + εV j ( t ) ) n X k = 1 D jk · I k ( t ) − γI j , ( 9 ) R ′ j ( t ) = γI j ( t ) , ( 10 ) where D jk = σ j η k · C jk N k . Since a proportion v j of group j is vaccinated , we have V j ( 0 ) = v j , S j ( 0 ) = N j − I j ( 0 ) − R j ( 0 ) . ( 11 ) The basic reproductive number R 0 is equal to the spectral radius of M = βγ D [ 33 , 34 ] . 8 5 . 2 Final size equations We will denote the attack rate by Z = P mj = 1 z j , where z j is the fraction of the total population which consisting of individuals of group j who become infected . The quantities z j ( 1 ≤ j ≤ n ) are obtained as solutions of a system of ﬁnal size equations N j − z j = ( N j − v j ) exp " − β γ n X k = 1 D jk · z k # + v j exp " − εβγ n X k = 1 D jk · z k # , 1 ≤ j ≤ n . ( 12 ) 5 . 3 Large R 0 asymptotics Our asymptotic analysis yields the following Lemma 1 . We have , for some c > 0 , 1 − Z ( β , ~ v ) P nj = 1 v j exp h − ε βγ · e j i = 1 + O ( e − cβ ) as , β → ∞ , where e j ( 1 ≤ j ≤ n ) are the exposure indices deﬁned by ( 1 ) . This approximation suggests the consideration of the following optimization problem maximize n X j = 1 v j exp (cid:20) − εβγ · e j (cid:21) , 0 ≤ v j ≤ N j , n X j = 1 v j = v , ( 13 ) as an approximation to the problem ( 2 ) . The advantage of ( 13 ) is that it is a simple linear optimization problem . Indeed , it is immediate that to maximize ( 13 ) we need to allocate as much of the total vaccine available to those groups j for which the coefﬁcients are largest , which are precisely those for which the exposure indices e j is lowest , leading to the allocation ( 3 ) . Lemma 1 then leads to the conclusion that the allocation ( 3 ) is indeed nearly optimal , as expressed by ( 4 ) , see Appendix A . 4 . 5 . 4 Numerical computation of optimal vaccine allocations We solve the optimization problem deﬁned in ( 2 ) using Matlabs’ fmincon nonlinear programming solver . The examples presented in the manuscript involve a computation of solutions of the optimization problem for a range of basic reproduction numbers R 0 . To do so , R 0 is gradually increased , so that the initial guess used for basic reproduction number R 0 + δR is the optimal allocation computed for the basic reproduction number R 0 . To reduce the probability of convergence to a local minimum , we also repeatedly randomized the initial allocation provided to the iterative algorithm and veriﬁed that it converges to the same minimum so , that we are reasonably conﬁdent that we have found the global minima . 5 . 5 Parameters used in examples In all example presented in the manuscript , we consider 80 % vaccine efﬁcacy against infections , i . e . , ε = 0 . 2 , and a uniform infectivity proﬁle η i = 1 for all groups . We note that the expressions for the reproductive number , as well as in the ﬁnal size equations , depend on β / γ . Therefore we do not need to ﬁx a value for the parameters β and γ separately , but rather adjust the value of β / γ to achieve the desired value of R 0 . The three group example presented in Figure 1 considers a case in which individuals of group 1 ( 25 % of the population ) interact half as frequently as those in group 2 , and individuals of group 3 ( another 25 % of the population ) interact twice as frequently as those in group 2 . Therefore , the group size parameters are N = ( 0 . 25 , 0 . 5 , 0 . 25 ) , the corresponding contact matrix is C =   1 4 4 2 8 8 4 16 16   , and the susceptibility proﬁle is σ i = 1 for groups i = 1 , 2 , 3 . The example using the USA demography and social structure presented in Figure 2 uses the following parameters : 9 • Age Demographics were taken from the UN World Population Prospects 2019 for each country [ 35 ] , using n = 9 age groups , of sizes N j ( 1 ≤ j ≤ 9 ) corresponding to 10 - year increments , with the last group comprising those of age 80 and older . • Contact matrix C = { C jk } nj , k = 1 was taken from [ 29 ] . Age bins in each case were originally provided in a 5 - year increment , where the last age bin corresponds to ages 75 and older . We follow the procedure as in [ 18 ] to adapt the matrices into 10 - year increments . • Relative susceptibility parameters σ i are taken from the age dependent relative susceptibility proﬁle for SARS - CoV - 19 from [ 25 ] : ( σ 1 , · · · , σ 9 ) = ( 1 , 0 . 95 , 1 . 975 , 2 . 15 , 2 , 2 . 05 , 2 . 2 , 1 . 85 , 1 . 85 ) , in which the relative susceptibility of age group 0 - 19 is roughly half those of older age groups . The parameters used in the two group example presented in Figure 4 are N 1 = N 2 = 0 . 5 , σ = 2 . A Vaccination at high R 0 : proofs A . 1 Final size formula The ﬁnal - size formula yields the overall number of infections in each group in terms of the model parameters [ 33 , 34 ] . We derive the ﬁnal size formula corresponding to the above model . From ( 7 ) and ( 8 ) we have S ′ j ( t ) S j ( t ) = − β n X k = 1 D jk · I k ( t ) , V ′ j ( t ) V j ( t ) = − βε n X k = 1 D jk · I k ( t ) , which upon integration yields log S j ( ∞ ) S j ( 0 ) = − β n X k = 1 D jk · Z ∞ 0 I k ( s ) ds , log V j ( ∞ ) V j ( 0 ) = − βε n X k = 1 D jk · Z ∞ 0 I k ( s ) ds , or S j ( ∞ ) = S j ( 0 ) exp " − β n X k = 1 D jk · Z ∞ 0 I k ( s ) ds # , V j ( ∞ ) = V j ( 0 ) exp " − βε n X k = 1 D jk · Z ∞ 0 I k ( s ) ds # . ( 14 ) Summing ( 7 ) - ( 9 ) , we have I ′ j ( t ) = − S ′ j ( t ) − V ′ j ( t ) − γI j ( t ) , which , upon integration , gives ✘✘✘ I j ( ∞ ) − I j ( 0 ) = S j ( 0 ) − S j ( ∞ ) + V j ( 0 ) − V j ( ∞ ) − γ Z ∞ 0 I j ( t ) , or Z ∞ 0 I j ( t ) = 1 γ [ S j ( 0 ) − S j ( ∞ ) + V j ( 0 ) − V j ( ∞ ) + I j ( 0 ) ] . ( 15 ) Since S j ( t ) + V j ( t ) + I j ( t ) + R j ( t ) = N j for all t , and I j ( ∞ ) = 0 , we have S j ( 0 ) + V j ( 0 ) + I j ( 0 ) = N j − R j ( 0 ) , S j ( ∞ ) + V j ( ∞ ) = N j − R j ( ∞ ) , ( 16 ) and can write ( 15 ) as Z ∞ 0 I j ( t ) = 1 γ [ R j ( ∞ ) − R j ( 0 ) ] , so that ( 14 ) yields S j ( ∞ ) = S j ( 0 ) exp " − β γ n X k = 1 D jk · [ R k ( ∞ ) − R k ( 0 ) ] # , ( 17a ) V j ( ∞ ) = V j ( 0 ) exp " − εβγ n X k = 1 D jk · [ R k ( ∞ ) − R k ( 0 ) ] # . ( 17b ) 10 Combining ( 16 ) and ( 17 ) yields N j − R j ( ∞ ) = S j ( 0 ) exp " − β γ n X k = 1 D jk · [ R k ( ∞ ) − R k ( 0 ) ] # + V j ( 0 ) exp " − εβγ n X k = 1 D jk · [ R k ( ∞ ) − R k ( 0 ) ] # , or , deﬁning z j = R j ( ∞ ) − R j ( 0 ) to be fraction of the population consisting of individuals of group j infected throughout the post - vaccination period : N j − R j ( 0 ) − z j = S j ( 0 ) exp " − β γ n X k = 1 D jk · z k # + V j ( 0 ) exp " − εβγ n X k = 1 D jk · z k # , 1 ≤ j ≤ n . ( 18 ) Assuming that R j ( 0 ) = 0 ( no unvaccinated individuals are initially immune ) , I j ( 0 ) = 0 ( the initial fraction of infected individuals is very small ) and setting V j ( 0 ) = v j , we have N j − z j = ( N j − v j ) exp " − β γ n X k = 1 D jk · z k # + v j exp " − εβγ n X k = 1 D jk · z k # , 1 ≤ j ≤ n . ( 19 ) The total number fraction of the population infected is then Z = n X j = 1 z j . We note that in the particular case of homogeneous mixing and identical infectivity of all groups , we have C jk = σ j cN k , where c is the average number of contacts per individual , and summing the n equations ( 18 ) , we obtain 1 − Z = n X j = 1 (cid:20) ( N j − v j ) exp (cid:20) − cβσ j γ Z (cid:21) + v j exp (cid:20) − εcβσ j γ Z (cid:21)(cid:21) , ( 20 ) This gives in particular the ﬁnal - size equation ( 5 ) for two groups with varying susceptibility , used in section B , where c is absorbed into β . A . 2 Asymptotics of the ﬁnal size for high transmission rate We consider the ﬁnal size Z = P nj = 1 z j , where z j are given as the solutions of system of ﬁnal size equations given by ( 19 ) . Although our main interest is to study behavior of ( 19 ) in the regime of large basic reproduction numbers , the ﬁnal size equations are not unique functions of R 0 . Instead , we choose to study the asymptotics of the ﬁnal size for high transmission rate β since the transmission rate is proportional to the basic reproduction number and since the dependence of ( 19 ) on β is explicit . To emphasize the dependence of the ﬁnal size on the transmission rate β and the vaccine allocation ~ v = ( v 1 , · · · , v n ) , ﬁxing all other parameters , we write Z = Z ( β , ~ v ) . We denote the set of possible allocations by V = n ~ v (cid:12)(cid:12)(cid:12) 0 ≤ v j ≤ N j , n X j = 1 v j = v o . ( 21 ) The following asymptotic result ( Lemma 1 in the main text ) is the key to obtaining an approximately optimal allocation for large R 0 . Lemma 2 . We have , for some c > 0 , 1 − Z ( β , ~ v ) P nj = 1 v j exp h − ε βγ · e j i = 1 + O ( e − cβ ) as β → ∞ , ( 22 ) uniformly in ~ v ∈ V , where e j ( 1 ≤ j ≤ n ) are the exposure indices deﬁned by e j = σ j n X k = 1 C jk η k . ( 23 ) 11 To prove this lemma we consider the solution z j = z j ( β ) ( 1 ≤ j ≤ n ) of the system ( 19 ) as functions of the transmission parameter β , ﬁxing all other parameters : N j − z j ( β ) = ( N j − v j ) exp " − β γ n X k = 1 D jk · z k ( β ) # + v j exp " − εβγ n X k = 1 D jk · z k ( β ) # , 1 ≤ j ≤ n . ( 24 ) Since z k ( β ) → N j as β → ∞ , the right - hand side is exponentially small in β , hence , setting w j ( β ) = β ( N j − z j ( β ) ) we have , for some c > 0 , w j ( β ) = O ( e − cβ ) as β → ∞ . ( 25 ) We re - write ( 24 ) in the form w j ( β ) = β ( N j − v j ) exp " − β γ n X k = 1 N k D jk # exp " 1 γ n X k = 1 D jk · w k ( β ) # + βv j exp " − εβγ n X k = 1 N k D jk # exp " − ε 1 γ n X k = 1 D jk · w k ( β ) # , 1 ≤ j ≤ n . ( 26 ) By ( 25 ) , ( 26 ) we have , as β → ∞ , w j ( β ) = β ( N j − v j ) exp " − β γ n X k = 1 N k D jk # + βv j exp " − εβγ n X k = 1 N k D jk # ! ( 1 + O ( e − cβ ) ) = βv j exp " − εβγ n X k = 1 N k D jk # ( 1 + O ( e − cβ ) ) , 1 ≤ j ≤ n . ( 27 ) Therefore , z j ( β ) = N j − w j ( β ) β = N j − v j exp " − εβγ n X k = 1 N k D jk # ( 1 + O ( e − cβ ) ) , so that 1 − Z ( β ) = n X j = 1 ( N j − z j ( β ) ) = ( 1 + O ( e − cβ ) ) n X j = 1 v j exp " − εβγ n X k = 1 N k D jk # which is the result of lemma 2 . A . 3 The approximately optimal allocation for large R 0 Our optimization problem is to minimize the number infections by allocating vaccines to a given fraction v of the population : minimize Z ( β , ~ v ) , ~ v ∈ V . ( 28 ) where V is given by ( 21 ) . Motivated by Lemma 2 , we introduce the approximate optimization problem maximize Ψ ( β , ~ v ) = n X j = 1 v j exp (cid:20) − εβγ · e j (cid:21) , ~ v ∈ V . ( 29 ) This is a linear optimization problem whose solution is immediate : assuming , without loss of generality , that the groups are ordered in non - decreasing order of their exposure index e 1 ≤ e 2 ≤ · · · ≤ e n , the solution ~ v ∗ of ( 29 ) prioritises groups with low exposure index , that is ~ v ∗ =   N 1 , N 2 , · · · , N j ∗ , v − j ∗ X k = 1 N k , 0 , · · · , 0   ( 30 ) 12 where j ∗ is the maximal index for which P j ∗ k = 1 N j ≤ v . Theorem 1 in the main text justiﬁes the claim that v ∗ is a nearly - optimal solution of ( 28 ) . We now prove this theorem . Assuming ~ v optimal is a minimizer of ( 28 ) , we have , substituting ~ v = ~ v optimal into ( 22 ) , and using the fact that ~ v ∗ is the maximizer of ( 29 ) , 1 − Z ( β , ~ v optimal ) = (cid:16) 1 + O ( e − cβ ) (cid:17) n X j = 1 v optimal , j exp (cid:20) − εβγ · e j (cid:21) ≤ (cid:16) 1 + O ( e − cβ ) (cid:17) n X j = 1 v ∗ j exp (cid:20) − εβγ · e j (cid:21) . ( 31 ) Substituting ~ v = ~ v ∗ into ( 22 ) we have 1 − Z ( β , ~ v ∗ ) = (cid:16) 1 + O ( e − cβ ) (cid:17) n X j = 1 v ∗ j exp (cid:20) − εβγ · e j (cid:21) ⇒ n X j = 1 v ∗ j exp (cid:20) − εβγ · e j (cid:21) = (cid:16) 1 + O ( e − cβ ) (cid:17) [ 1 − Z ( β , ~ v ∗ ) ] . ( 32 ) Combining ( 31 ) , ( 32 ) we have 1 − Z ( β , ~ v optimal ) ≤ (cid:16) 1 + O ( e − cβ ) (cid:17) [ 1 − Z ( β , ~ v ∗ ) ] . ( 33 ) On the other hand , by the deﬁnition of ~ v optimal we certainly have 1 − Z ( β , ~ v optimal ) ≥ 1 − Z ( β , ~ v ∗ ) , which combined with ( 33 ) , yields 1 − Z ( β , ~ v optimal ) 1 − Z ( β , ~ v ∗ ) = 1 + O ( e − cβ ) ⇒ 1 − Z ( β , ~ v ∗ ) 1 − Z ( β , ~ v optimal ) = 1 + O ( e − cβ ) , ( 34 ) which is equivalent to Eq . 4 in Theorem 1 of the main text . B The two - group example : proofs B . 1 The two - group model In this section we consider the two - group example S ′ 1 = − βS 1 I , V ′ 1 = − βεV 1 I , S ′ 2 = − σβS 2 I , V ′ 2 = − σβεV 2 I I ′ = β [ S 1 + σS 2 + εV 1 + σεV 2 ] I − γI with σ > 1 ( group 2 is more susceptible ) , and initial conditions S j ( 0 ) = N j − v j − I j ( 0 ) , V j ( 0 ) = v j , I ( 0 ) = I 1 ( 0 ) + I 2 ( 0 ) , where N 1 + N 2 = 1 . Setting r = β γ , ( 35 ) the reproductive number corresponding to this model ( without vaccination ) is R 0 = r ( N 1 + σN 2 ) . The post - vaccination reproduction number is then R vac = β γ [ ( N 1 − v 1 ) + ( N 2 − v 2 ) σ + v 1 ε + v 2 σε ] = R 0 (cid:18) 1 − ( v 1 + v 2 σ ) ( 1 − ε ) N 1 + σN 2 (cid:19) , so that herd immunity can be achieved and the epidemic can be prevented if R vac ≤ 1 . It is immediate from the above expression that the lowest value of R vac will be achieved if all vaccines are allocated to the more susceptible group : v 1 = 0 , v 2 = v , giving R vac = R 0 (cid:16) 1 − · vσ ( 1 − ε ) N 1 + σN 2 (cid:17) , so that herd immunity will be achieved if R 0 (cid:18) 1 − vσ ( 1 − ε ) N 1 + N 2 σ (cid:19) ≤ 1 ⇔ R 0 ≤ R crit 0 . = (cid:18) 1 − vσ ( 1 − ε ) N 1 + N 2 σ (cid:19) − 1 . ( 36 ) 13 In case herd immunity cannot be achieved , our aim is to chose v 1 , v 2 so as to minimize the fraction of population Z = Z ( v 1 , v 2 ) which will be infected during the epidemic . This fraction is given by the ﬁnal size equation 1 − ( N 1 − v 1 ) e − rZ − ( N 2 − v 2 ) e − σrZ − v 1 e − εrZ − v 2 e − σεrZ = Z , ( 37 ) This is a special case of the ﬁnal size equation for n groups , see ( 20 ) . We consider the problem of minimizing the ﬁnal size , minimize Z ( v 1 , v 2 ) ( 38 ) subject to v 1 , v 2 ≥ 0 , v 1 + v 2 = v . In this case we can perform a complete analysis of the problem , to show how the optimal allocation shifts from the more susceptible to the less susceptible group as R 0 crosses a threshold , as described in ( Theorem 2 of the main text ) : Theorem 3 . Assuming v < min ( N 1 , N 2 ) , there exists a value R ∗ 0 such that ( i ) If R 0 < R ∗ 0 then the optimal solution of ( 38 ) is given by ( v 1 , v 2 ) = ( 0 , v ) . ( ii ) If R > R ∗ 0 then the optimal solution of ( 38 ) is given by ( v 1 , v 2 ) = ( v , 0 ) . The transition value R ∗ 0 is given explicitly by the formula R ∗ 0 = ( N 1 + N 2 σ ) ln ( 1 α ) 1 − N 1 α − N 2 α σ − v ( α ε − α ) , ( 39 ) where α is the unique solution of the equation α − α σ − α ε + α σε = 0 , α ∈ ( 0 , 1 ) . ( 40 ) This section is devoted to the proof of this theorem 3 . B . 2 Comparing single - group vaccination schedules We will ﬁrst compare the two options in which the entire supply of vaccine is allocated to one of the groups , showing that allocating all the vaccine to the more susceptible group is the superior option when R 0 < R ∗ 0 and the inferior option when R 0 > R ∗ 0 . Later , in Section B . 3 , we will show that no mixed option is better than these two extreme options . For i = 1 , 2 , let Z i ( r ) be the attack rate in case all the vaccine is allocated to group i , in dependence on r , and assuming all other parameters are ﬁxed . Then , using ( 37 ) with ( v 1 , v 2 ) = ( v , 0 ) and ( v 1 , v 2 ) = ( 0 , v ) , respectively , we have f 1 ( Z 1 ( r ) ) = Z 1 ( r ) , ( 41 ) f 2 ( Z 2 ( r ) ) = Z 2 ( r ) , ( 42 ) where f 1 ( Z ) = 1 − ( N 1 − v ) e − rZ − N 2 e − σrZ − ve − εrZ , f 2 ( Z ) = 1 − N 1 e − rZ − ( N 2 − v ) e − σrZ − ve − σεrZ . We note some basic properties of the functions f 1 , f 2 , to be used below . Lemma 3 . ( i ) ( 41 ) has a unique nontrivial solution Z 1 ( r ) ∈ ( 0 , 1 ) iff r > r 1 = 1 ( N 1 − v ) + σN 2 + εv . ( ii ) ( 42 ) has a unique nontrivial solution Z 2 ( r ) ∈ ( 0 , 1 ) iff r > r 2 = 1 N 1 + σ ( N 2 − v ) + σεv . ( iii ) For i = 1 , 2 : when r > r i we have 0 < Z < Z i ( r ) ⇔ Z < f i ( Z ) ( 43 ) Z i ( r ) < Z ≤ 1 ⇔ Z > f i ( Z ) ( 44 ) ( iv ) r 1 < r 2 . Proof . Deﬁne h i ( Z ) = f i ( Z ) − Z ( i = 1 , 2 ) . h i ( Z ) is concave and satisﬁes h i ( 0 ) = 0 , h i ( 1 ) < 0 , so that h i ( Z ) = 0 has a unique solution Z i ( r ) ∈ ( 0 , 1 ) if and only if h ′ i ( 0 ) > 0 , which is equivalent to the condition r > r i . To obtain ( iii ) note that when r > r i , h i ( Z ) is positive for Z > 0 small , while h i ( 1 ) < 0 . Since the only point in ( 0 , 1 ) at which h i vanishes is Z = Z i ( r ) we conclude that h i ( Z ) > 0 for Z ∈ ( 0 , Z 1 ( r ) ) and h i ( Z ) < 0 for Z ∈ ( Z 1 ( r ) , 1 ) , which gives ( 43 ) . Finally , ( iv ) follows by direct calculation , using the deﬁnitions of r 1 , r 2 and the assumption that σ > 1 . 14 Note that when r ≤ r i , we have Z i ( r ) = 0 , that is an epidemic is averted by allocating the vaccine to group i . Thus if r ≤ r 1 then Z 1 ( r ) = Z 2 ( r ) = 0 , hence herd immunity can be reached by allocating the vaccine to either one of the two groups , and when r 1 < r ≤ r 2 we have Z 1 ( r ) > 0 , Z 2 ( r ) = 0 , hence for r in this range one should certainly vaccinate the more susceptible group 2 , and thus attain herd immunity . We are interested in the case r > r 2 , which is equivalent to R 0 > R crit 0 ( see ( 36 ) above ) , so this will condition will be assumed below . Lemma 4 . Assume r > r 2 . Deﬁne κ = κ ( σ , ε ) by κ = ln (cid:0) 1 α (cid:1) where α is the ( unique ) solution of ( 40 ) . Then f 1 ( Z ) > f 2 ( Z ) when 0 < Z < κr and f 2 ( Z ) > f 1 ( Z ) when Z > κr . Proof . Deﬁne g ( x ) = x − x σ − x ε + x σε . ( 45 ) We ﬁrst prove that the equation g ( x ) = 0 has a unique solution α ∈ ( 0 , 1 ) , and that 0 < x < α ⇒ g ( α ) < 0 , α < x < 1 ⇒ g ( x ) > 0 . ( 46 ) We have g ( 0 ) = g ( 1 ) = 0 and , since lim x → 0 + g ( x ) x = lim x → 0 + h ( 1 − x σ − 1 ) + x ε − 1 ( x ( σ − 1 ) ε − 1 ) i = −∞ we have g ( x ) < 0 for x > 0 sufﬁciently small . g ′ ( x ) = 1 − σx σ − 1 − εx ε − 1 + σεx σε − 1 ⇒ g ′ ( 1 ) = ( 1 − σ ) ( 1 − ε ) < 0 implies g ( x ) > 0 for x < 1 sufﬁciently close to 1 . Therefore there exists α ∈ ( 0 , 1 ) with g ( α ) = 0 , that is a solution of ( 40 ) . We now show that this solution is unique , and hence that ( 46 ) holds . Note that ( 40 ) is equivalent to h ( x ) = x σ − 1 + x ε − 1 − x σε − 1 = 1 . Assume by way of contradiction that h ( x ) = 1 has two solutions in ( 0 , 1 ) , in addition to the solution x = 1 . Then , by Rolle’s theorem , the function h ′ ( x ) = ( σ − 1 ) x σ − 2 + ( ε − 1 ) x ε − 2 − ( σε − 1 ) x σε − 2 has at least two zeros in ( 0 , 1 ) , and multiplying both sides by x 2 − σε , the function x 2 − σε h ′ ( x ) = ( σ − 1 ) + ( ε − 1 ) x ε − σ − ( σε − 1 ) x σ ( ε − 1 ) has at least two zeros in ( 0 , 1 ) , hence , again by Rolle’s theorem , the function [ x 2 − σε h ′ ( x ) ] ′ = ( ε − 1 ) ( ε − σ ) x ε − σ − 1 − ( σε − 1 ) σ ( ε − 1 ) x σ ( ε − 1 ) − 1 has at least one zero x ∈ ( 0 , 1 ) . But this implies x ( σ − 1 ) ε = σ − ε ( 1 − σε ) σ , hence , in view of the assumptions σ > 1 , ε ∈ ( 0 , 1 ) , 0 < σ − ε ( 1 − σε ) σ < 1 ⇒ σ − ε < ( 1 − σε ) σ ⇒ σ 2 < 1 , contradicting the assumption σ > 1 . Noting now that we have f 1 ( Z ) > f 2 ( Z ) ⇔ e − rZ − e − σrZ − e − εrZ + e − σεrZ < 0 ⇔ g (cid:16) e − rZ (cid:17) > 0 , ( 46 ) implies rZ < κ = − ln ( α ) ⇒ e − rZ > α ⇒ g ( e − rZ ) > 0 ⇒ f 1 ( Z ) > f 2 ( Z ) , and similarly rZ > κ implies f 1 ( Z ) < f 2 ( Z ) . 15 Lemma 5 . Let α be the unique solution of ( 40 ) , κ = ln (cid:0) 1 α (cid:1) , and r ∗ = κ 1 − ( N 1 − v ) α − N 2 α σ − vα ε . ( 47 ) Then we have : r 2 < r < r ∗ ⇒ Z 2 ( r ) < Z 1 ( r ) r > r ∗ ⇒ Z 1 ( r ) < Z 2 ( r ) Proof . We claim that r 1 < r < r ∗ ⇒ Z 1 ( r ) < κ r , r > r ∗ ⇒ Z 1 ( r ) > κ r . ( 48 ) To see this , consider the function φ ( r ) = rZ 1 ( r ) . Since Z 1 ( r ) is increasing in r , φ ( r ) is also increasing , and we have φ ( r 1 ) = 0 and φ ( r ) → ∞ as r → ∞ . Therefore there is a unique ¯ r > r 1 satisfying ¯ rZ 1 ( ¯ r ) = κ . ( 49 ) Since f 1 ( Z 1 ( ¯ r ) ) = Z 1 ( ¯ r ) we have 1 − ( N 1 − v ) e − ¯ rZ 1 ( ¯ r ) − N 2 e − σ ¯ rZ 1 ( ¯ r ) − ve − ε ¯ rZ 1 ( ¯ r ) = Z 1 ( ¯ r ) . ( 50 ) Substituting ( 49 ) in ( 50 ) gives 1 − ( N 1 − v ) e − κ − N 2 e − σκ − ve − εκ = κ ¯ r ⇒ ¯ r = κ 1 − ( N 1 − v ) e − κ − N 2 e − σκ − ve − εκ , so we have that ¯ r = r ∗ as deﬁned by ( 47 ) . We have thus shown that φ ( r ∗ ) = κ , and by monotonicity of φ ( r ) , we obtain ( 48 ) . Now if r 2 < r < r ∗ then Z 1 ( r ) < κr , so by Lemma 4 we have Z 1 ( r ) = f 1 ( Z 1 ( r ) ) > f 2 ( Z 1 ( r ) ) , which , by Lemma 3 ( iii ) , implies Z 2 ( r ) < Z 1 ( r ) . Similarly if r > r ∗ we get Z 2 ( r ) > Z 1 ( r ) . In view of Lemma 5 we have , deﬁning R ∗ 0 = ( N 1 + N 2 σ ) r ∗ = ( N 1 + N 2 σ ) ln ( 1 α ) 1 − ( N 1 − v ) α − N 2 α σ − vα ε , that vaccinating the more susceptible group 2 is preferable if R 0 < R ∗ 0 , while vaccinating group 1 is preferable if R 0 > R ∗ 0 . Using ( 40 ) , R ∗ 0 can also be written as R ∗ 0 = ( N 1 + N 2 σ ) ln ( 1 α ) 1 − N 1 α − N 2 α σ − v ( α ε − α ) . The proof of Theorem 3 will be completed by showing that no mixed vaccination schedule outperforms the two possibilities considered above . B . 3 Optimality of vaccinating one group We now analyze the optimization problem deﬁned in ( 38 ) and show that the solution is necessarily a boundary solution : either ( v 1 , v 2 ) = ( v , 0 ) or ( v 1 , v 2 ) = ( 0 , v ) . We reformulate the problem as a one - dimensional problem by setting ζ ( v 1 ) = Z ( v 1 , v − v 1 ) , and we wish to show that ζ ( v 1 ) is maximized either at v 1 = 0 or at v 1 = v . We will in fact prove : Lemma 6 . Let r ∗ be deﬁned by ( 47 ) . Assume r > r 2 . Then : ( i ) If r 6 = r ∗ then ζ ′ ( v 1 ) 6 = 0 for all v 1 ∈ ( 0 , v ) , so that ζ ( v 1 ) is maximized either at v = 0 or at v = v 1 . ( ii ) If r = r ∗ then ζ ( v ) = κr ∗ for all v ∈ [ 0 , v ] , that is ζ ( v ) a constant function . 16 Proof . Note that the assumption r > r 2 implies that ζ ( v 1 ) ∈ ( 0 , 1 ) for all v 1 ∈ [ 0 , v ] ( herd immunit cannot be achieved ) . ( i ) Let us assume , that ζ ′ ( v ∗ 1 ) = 0 for some v ∗ 1 ∈ ( 0 , v ) , and show that r = r ∗ . Substituting v 2 = v − v 1 in ( 37 ) we have , for v 1 ∈ [ 0 , v ] , 1 − ( N 1 − v 1 ) e − rζ ( v 1 ) − ( N 2 − v + v 1 ) e − σrζ ( v 1 ) − v 1 e − εrζ ( v 1 ) − ( v − v 1 ) e − σεrζ ( v 1 ) = ζ ( v 1 ) , ( 51 ) and differentiating this relation with respect to v 1 leads to r h ( N 1 − v 1 ) e − rζ ( v 1 ) + σ ( N 2 − v + v 1 ) e − σrζ ( v 1 ) + εv 1 e − εrζ ( v 1 ) + σε ( v − v 1 ) e − σεrζ ( v 1 ) i ζ ′ ( v 1 ) + e − rζ ( v 1 ) − e − σrζ ( v 1 ) − e − εrζ ( v 1 ) + e − σεrζ ( v 1 ) = ζ ′ ( v 1 ) . Thus , for v ∗ 1 satisfying ζ ′ ( v ∗ 1 ) = 0 we obtain e − rζ ( v ∗ 1 ) − e − σrζ ( v ∗ 1 ) − e − εrζ ( v ∗ 1 ) + e − σεrζ ( v ∗ 1 ) = 0 . ( 52 ) On the other hand , substituting v 1 = v ∗ 1 in ( 51 ) , we have 1 − ( N 1 − v ∗ 1 ) e − rζ ( v ∗ 1 ) − ( N 2 − v + v ∗ 1 ) e − σrζ ( v ∗ 1 ) − v ∗ 1 e − εrζ ( v ∗ 1 ) − ( v − v ∗ 1 ) e − σεrζ ( v ∗ 1 ) = ζ ( v ∗ 1 ) , which , together with ( 52 ) gives 1 − ( N 1 − v ) e − rζ ( v ∗ 1 ) − N 2 e − σrζ ( v ∗ 1 ) − ve − εrζ ( v ∗ 1 ) = ζ ( v ∗ 1 ) , ( 53 ) Note that ( 52 ) is equivalent to g (cid:16) e − rζ ( v ∗ 1 ) (cid:17) = 0 , where g ( x ) is deﬁned in ( 45 ) . Since in the proof of Lemma 4 we obtained that g has a unique root α = e − κ ( σ , ε ) , we see that for ζ ′ ( v ∗ 1 ) to hold , we need rζ ( v ∗ 1 ) = κ ( σ , ε ) . ( 54 ) Substituting ( 54 ) into ( 53 ) gives 1 − ( N 1 − v ) e − κ − N 2 e − σκ − ve − εκ = 1 r κ , ⇒ r = κ 1 − ( N 1 − v ) e − κ − N 2 e − σκ − ve − εκ = r ∗ , so we have shown that r = r ∗ is the unique value of r of which ζ ( v 1 ) can have a critical point v ∗ 1 ∈ ( 0 , 1 ) . ( ii ) Now we assume that r = r ∗ and will show that ζ ( v 1 ) = κr ∗ for all v 1 ∈ ( 0 , v ) . Indeed , by ( 51 ) , ζ ( v 1 ) is the unique solution of 1 − ( N 1 − v 1 ) e − r ∗ ζ ( v 1 ) − ( N 2 − v + v 1 ) e − σr ∗ ζ ( v 1 ) − v 1 e − εr ∗ ζ ( v 1 ) − ( v − v 1 ) e − σεr ∗ ζ ( v 1 ) = ζ ( v 1 ) , ( 55 ) so it sufﬁces to show that ( 55 ) holds identically when we substitute ζ ( v 1 ) = κr ∗ , that is to show 1 − ( N 1 − v 1 ) e − κ − ( N 2 − v + v 1 ) e − σκ − v 1 e − εκ − ( v − v 1 ) e − σεκ = κ r ∗ . ( 56 ) By ( 47 ) we have κ r ∗ = 1 − ( N 1 − v ) e − κ − N 2 e − σκ − ve − εκ , so ( 56 ) is equivalent , after some simpliﬁcation , to e − κ − e − σκ − e − εκ + e − σεκ = 0 , ( 57 ) which holds due to the fact that α = e − κ is the solution of ( 40 ) . We have therefore proved ( 55 ) , ﬁnishing the proof of ( ii ) . Our proof of Theorem 3 is thus complete . 17 C Dependence of the threshold reproduction number on parameters We deﬁne the threshold value R threshold as the minimal value of R 0 at which the relative error in the number of survivors ( those not infected ) , E = Z ( R 0 , ~ v ∗ ) − Z ( R 0 , ~ v optimal ) 1 − Z ( R 0 , ~ v optimal ) ( 58 ) resulting from the asymptotic allocation ~ v ∗ , see ( 30 ) , and the computed optimal allocation ~ v optimal is smaller than 1 % . In the two group example considered in Theorem 3 , the transition value R ∗ 0 which is closely related to R threshold is given explicitly by ( 39 ) . ( 39 ) implies that R ∗ 0 increases both with vaccine efﬁcacy and with vaccine coverage , see also Fig 5 . In Fig 6 we consider more general cases and compute R threshold for various countries . As in the example of the USA in the main text ( Fig 2 ) , age demographics for each country were taken from the UN World Population Prospects 2019 [ 35 ] , using nine age groups , of sizes N j ( 1 ≤ j ≤ 9 ) corresponding to 10 - year increments , with the last group comprising those of age 80 and older . The contact matrices were taken from [ 29 ] and adapted to 10 - year increments [ 18 ] . In all cases , we used the age dependent relative susceptibility proﬁle for SARS - CoV - 19 from [ 25 ] . In the USA example presented in Fig 2 of the main text with vaccine of efﬁcacy of 80 % and vaccine coverage of 55 % , R threshold ≈ 5 . 7 . For this choice of parameters , we observe quite small variability of R threshold among different countries with values ranging from 5 to 5 . 75 and a mean of 5 . 4 . Fig 6A presents R threshold also for vaccine efﬁcacy of 70 % and 90 % . As expected , R threshold increases with an increase in vaccine efﬁcacy : The average R threshold changes from 5 . 4 at a vaccine efﬁcacy of 80 % to R threshold ≈ 4 . 3 when vaccine efﬁcacy is 70 % , and to R threshold ≈ 8 when vaccine efﬁcacy is 90 % . We again observe quite small variability of R threshold among different countries . We further consider the dependence of R threshold on vaccine coverage . We ﬁnd that the mean value of R threshold for a range of vaccine coverage values between 40 % to 70 % is R threshold ≈ 6 where most values lie in the range 4 . 25 < R threshold < 9 . 5 . In addition , outliers with R threshold ≈ 12 are observed , see Fig 6B . Contrary to the behavior of R ∗ 0 in the two group example , we ﬁnd only weak correlation between R threshold and vaccine coverage values . This points to the complexity of the solution structure . 18 Figure 5 : R ∗ 0 as function of vaccine coverage and vaccine efﬁcacy . Graph of ( 39 ) for N 1 = N 2 = 0 . 5 , v = 0 . 4 , σ = 2 . Note that the surface is plotted in a regime ε > 0 . 025 avoiding values closer to zero since lim ε → 0 R ∗ 0 = ∞ 19 Belgium USA India Spain Zimbabwe Brazil China South Africa Poland 2 4 6 8 10 R t h r e s ho l d R threshold in various countries for different vaccine efficacies ( VE ) A 90 % vaccine efficacy ( VE ) 80 % VE 70 % VE Belgium USA India Spain Zimbabwe Brazil China South Africa Poland 2 4 6 8 10 12 R t h r e s ho l d R threshold in various countries for different vaccine coverage ( VC ) B 70 % vaccine coverage ( VC ) 60 % VC 55 % VC 50 % VC 40 % VC Figure 6 : The threshold value R threshold at which the relative error in the number of survivors reduces below 1 % computed for parameters corresponding to various countries and for A : different values of vaccine efﬁcacy . B : different values of vaccine coverage . References [ 1 ] Almut Scherer and Angela McLean . Mathematical models of vaccination . British medical bulletin . , 62 ( 1 ) , 2002 - 07 - 01 . [ 2 ] John P Fox , Lila Elveback , William Scott , LAEL Gatewood , and Eugene Ackerman . Herd immunity : basic concept and relevance to public health immunization practices . American journal of epidemiology , 94 ( 3 ) : 179 – 189 , 1971 . [ 3 ] Paul EM Fine . Herd immunity : history , theory , practice . Epidemiologic reviews , 15 ( 2 ) : 265 – 302 , 1993 . [ 4 ] Roy M Anderson and Robert M May . Infectious diseases of humans : dynamics and control . Oxford university press , 1992 . [ 5 ] Herbert W Hethcote and James W Van Ark . Epidemiological models for heterogeneous populations : proportionate mixing , parameter estimation , and immunization programs . Mathematical Biosciences , 84 ( 1 ) : 85 – 118 , 1987 . [ 6 ] Frank Ball , Tom Britton , and Owen Lyne . Stochastic multitype epidemics in a community of households : estimation and form of optimal vaccination schemes . Mathematical biosciences , 191 ( 1 ) : 19 – 40 , 2004 . [ 7 ] Andrew N Hill and Ira M Longini Jr . The critical vaccination fraction for heterogeneous epidemic models . Mathematical biosciences , 181 ( 1 ) : 85 – 106 , 2003 . [ 8 ] Evelot Duijzer , Willem van Jaarsveld , Jacco Wallinga , and Rommert Dekker . The most efﬁcient critical vaccination coverage and its equivalence with maximizing the herd effect . Mathematical biosciences , 282 : 68 – 81 , 2016 . [ 9 ] Fan Bai . Effect of population heterogeneity on herd immunity and on vaccination decision making process . Journal of theoretical biology . , 526 , 2021 - 10 . [ 10 ] Jacco Wallinga , Michiel van Boven , and Marc Lipsitch . Optimizing infectious disease interventions during an emerging epidemic . Proceedings of the National Academy of Sciences , 107 ( 2 ) : 923 – 928 , 2010 . [ 11 ] Matt J Keeling and Andrew Shattock . Optimal but unequitable prophylactic distribution of vaccine . Epidemics , 4 ( 2 ) : 78 – 85 , 2012 . [ 12 ] Md Abdul Kuddus , M Mohiuddin , and Azizur Rahman . Mathematical analysis of a measles transmission dynamics model in bangladesh with double dose vaccination . Scientiﬁc Reports , 11 ( 1 ) : 1 – 16 , 2021 . 20 [ 13 ] Jan Medlock and Alison P Galvani . Optimizing inﬂuenza vaccine distribution . Science , 325 ( 5948 ) : 1705 – 1708 , 2009 . [ 14 ] Shweta Bansal , Babak Pourbohloul , and Lauren Ancel Meyers . A comparative analysis of inﬂuenza vaccination programs . PLoS medicine , 3 ( 10 ) : e387 , 2006 . [ 15 ] Rami Yaari , Guy Katriel , Lewi Stone , Ella Mendelson , Michal Mandelboim , and Amit Huppert . Model - based reconstruction of an epidemic using multiple datasets : understanding inﬂuenza a / h1n1 pandemic dynamics in israel . Journal of The Royal Society Interface , 13 ( 116 ) : 20160099 , 2016 . [ 16 ] Laura Matrajt , Julia Eaton , Tiffany Leung , and Elizabeth R . Brown . Vaccine optimization for covid - 19 : Who to vaccinate ﬁrst ? Science Advances , 7 ( 6 ) , 2020 . [ 17 ] Michael T Meehan , Daniel G Cocks , Jamie M Caldwell , James M Trauer , Adeshina I Adekunle , Romain R Ragonnet , and Emma S McBryde . Age - targeted dose allocation can halve covid - 19 vaccine requirements . medRxiv , 2020 . [ 18 ] Kate M . Bubar , Kyle Reinholt , Stephen M . Kissler , Marc Lipsitch , Sarah Cobey , Yonatan H . Grad , and Daniel B . Larremore . Model - informed covid - 19 vaccine prioritization strategies by age and serostatus . Science , 371 ( 6532 ) : 916 – 921 , 2021 . [ 19 ] Md Raﬁul Islam , Tamer Oraby , Audrey McCombs , Mohammad Mihrab Chowdhury , Mohammad Al - Mamun , Michael G Tyshenko , and Claus Kadelka . Evaluation of the united states covid - 19 vaccine allocation strategy . PloS one , 16 ( 11 ) : e0259700 , 2021 . [ 20 ] Sam Moore , Edward M Hill , Michael J Tildesley , Louise Dyson , and Matt J Keeling . Vaccination and non - pharmaceutical interventions for covid - 19 : a mathematical modelling study . The Lancet Infectious Diseases , 2021 . [ 21 ] Nir Gavish and Guy Katriel . The role of childrens’ vaccination for covid - 19 - pareto - optimal allocations of vaccines . Accepted for publication in PLOS computational biology . , 2022 . [ 22 ] Talha Khan Burki . Omicron variant and booster covid - 19 vaccines . The Lancet Respiratory Medicine , 2021 . [ 23 ] Ying Liu and Joacim Rockl¨ov . The reproductive number of the delta variant of sars - cov - 2 is far higher compared to the ancestral sars - cov - 2 virus . Journal of travel medicine , 2021 . [ 24 ] Ruian Ke , Ethan Romero - Severson , Steven Sanche , and Nick Hengartner . Estimating the reproductive number r0 of sars - cov - 2 in the united states and eight european countries and implications for vaccination . Journal of theoretical biology , 517 : 110621 , 2021 . [ 25 ] Nicholas G Davies , Petra Klepac , Yang Liu , Kiesha Prem , Mark Jit , and Rosalind M Eggo . Age - dependent effects in the transmission and control of covid - 19 epidemics . Nature medicine , 26 ( 8 ) : 1205 – 1211 , 2020 . [ 26 ] Itai Dattner , Yair Goldberg , Guy Katriel , Rami Yaari , Nurit Gal , Yoav Miron , Arnona Ziv , Rivka Sheffer , Yoram Hamo , and Amit Huppert . The role of children in the spread of covid - 19 : Using household data from bnei brak , israel , to estimate the relative susceptibility and infectivity of children . PLoS computational biology , 17 ( 2 ) : e1008559 , 2021 . [ 27 ] Edward Goldstein , Marc Lipsitch , and Muge Cevik . On the effect of age on the transmission of sars - cov - 2 in households , schools , and the community . The Journal of infectious diseases , 223 ( 3 ) : 362 – 369 , 2021 . [ 28 ] M Elizabeth Halloran , Ira M Longini , Claudio J Struchiner , and Ira M Longini . Design and analysis of vaccine studies , volume 18 . Springer , 2010 . [ 29 ] Kiesha Prem , Kevin van Zandvoort , Petra Klepac , Rosalind M Eggo , Nicholas G Davies , Centre for the Mathematical Mod - elling of Infectious Diseases COVID - 19 Working Group , Alex R Cook , and Mark Jit . Projecting contact matrices in 177 geographical regions : an update and comparison with empirical data for the covid - 19 era . PLoS computational biology , 17 ( 7 ) : e1009098 , 2021 . [ 30 ] Joshua R Goldstein , Thomas Cassidy , and Kenneth W Wachter . Vaccinating the oldest against covid - 19 saves both the most lives and most years of life . Proceedings of the National Academy of Sciences , 118 ( 11 ) , 2021 . [ 31 ] Jonathan Dushoff , Caroline Colijn , David JD Earn , and Benjamin M Bolker . Transmission dynamics are crucial to covid - 19 vaccination policy . Proceedings of the National Academy of Sciences of the United States of America , 118 ( 29 ) , 2021 . [ 32 ] Joshua R . Goldstein , Thomas Cassidy , and Kenneth W . Wachter . Reply to dushoff et al . and pifarr´e i arolas et al . : Age prioritization for covid - 19 vaccination does save lives and years of life . Proceedings of the National Academy of Sciences , 118 ( 29 ) , 2021 . [ 33 ] Odo Diekmann and Johan Andre Peter Heesterbeek . Mathematical epidemiology of infectious diseases : model building , analysis and interpretation , volume 5 . John Wiley & Sons , 2000 . [ 34 ] Matt J Keeling and Pejman Rohani . Modeling infectious diseases in humans and animals . Princeton university press , 2011 . [ 35 ] United nations department of economic and social affairs population division , world population prospects . https : / / population . un . org / wpp , 2019 . 21