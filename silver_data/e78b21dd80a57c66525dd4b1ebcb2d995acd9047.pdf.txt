A Bayesian approach to single - particle electron cryo - tomography in RELION - 4 . 0 Jasenko Zivanov ∗ 1 , 2 , 3 , Joaqu´ın Ot´on * 1 , 4 , Zunlong Ke 1 , 5 , Andriko von K¨ugelgen 1 , 6 , Euan Pyle 8 , Kun Qu 1 , Dustin Morado 1 , 5 , Daniel Casta˜no - D´ıez 3 , 7 , Giulia Zanetti 8 , Tanmay A . M . Bharat 1 , 6 , John A . G . Briggs 1 , 5 , and Sjors H . W . Scheres 1 1 MRC Laboratory of Molecular Biology , Cambridge , United Kingdom 2 Laboratory of Biomedical Imaging ( LIB ) , EPFL , Lausanne , Switzerland 3 BioEM lab , Biozentrum , University of Basel , Switzerland 4 ALBA Synchrotron , Barcelona , Spain 5 Max Planck Institute of Biochemistry , Martinsried , Germany 6 Sir William Dunn School of Pathology , University of Oxford , Oxford , United Kingdom 7 Instituto Bioﬁsika ( CSIC - UPV / EHU ) , Leioa , Spain 8 Institute of Structural and Molecular Biology , Birkbeck College , London , United Kingdom September 26 , 2022 Abstract We present a new approach for macromolecular structure determination from multiple particles in electron cryo - tomography ( cryo - ET ) data sets . Whereas existing subtomogram averaging approaches are based on 3D data models , we propose to optimise a regularised likelihood target that approximates a function of the 2D experimental images . In addition , analogous to Bayesian polishing and contrast transfer function ( CTF ) reﬁnement in single - particle analysis , we describe approaches that exploit the increased signal - to - noise ratio in the averaged structure to optimise tilt series alignments , beam - induced motions of the particles throughout the tilt series acquisition , defoci of the individual particles , as well as higher - order optical aberrations of the microscope . Implementation of our approaches in the open - source software package RELION aims to facilitate their general use , in particular for those researchers who are already familiar with its single - particle analysis tools . We illustrate for three applications that our approaches allow structure determination from cryo - ET data to resolutions suﬃcient for de novo atomic modelling . 1 Introduction In recent years , electron cryo - microscopy ( cryo - EM ) has allowed the 3D imaging of an increasing number of biological macromolecules at resolutions suﬃcient for de novo atomic modelling . This development , orig - inally driven by advances in detector technology , was further facilitated by novel , robust image processing algorithms . In single - particle analysis , images of mul - tiple copies of isolated macromolecular complexes , or particles , that are suspended in random orientations in a thin layer of vitreous water are combined in a 3D reconstruction . Nowadays , many aspects of single - particle analysis workﬂows can be performed with only minimal human supervision , e . g . the detection , extrac - tion and initial classiﬁcation of particles in the images [ 30 , 2 , 27 ] , 3D reconstruction [ 30 , 17 ] , as well as re - ﬁnement of the optical parameters [ 30 , 32 , 17 , 24 ] and per - particle tracking of electron beam - induced motion [ 29 , 31 ] . Many of the algorithms that underlie these modern methods are built on solid statistical founda - tions that require few tuneable parameters . This de - creases the need for operator expertise and provides objectivity , as well as robustness , in obtaining optimal structures . The single - particle approach is , however , limited to investigating isolated protein complexes that are puriﬁed to relative homogeneity . To examine these complexes in their crowded physiological environment , electron cryo - tomography ( cryo - ET ) may be used in - stead . In the tomographic approach , the sample is tilted multiple times during image acquisition , yielding a so - called tilt series of images from which a 3D tomo - gram can be computed . In the same manner as single - particle analysis , repeated occurrences of particles in those tomograms can then be aligned and averaged to obtain higher - resolution reconstructions . This process is referred to as subtomogram averaging . Unlike the ﬁeld of single - particle analysis , many of the tools used for subtomogram averaging still require considerable ∗ These authors contributed equally 1 levels of expertise from the operator , often in order to tune parameters that arise from heuristics in the un - derlying algorithms . This not only provides a barrier for new scientists entering the ﬁeld , but can also lead to the calculation of suboptimal structures . Compared to single - particle analysis , subtomogram averaging faces several unique challenges . In addition to estimating the position and orientation of each par - ticle , the algorithm also has to consider the geometry of the tilt series . Typically , this is solved through a set of pre - processing steps that include estimation of contrast transfer function ( CTF ) parameters and alignment of the tilt series , followed by the reconstruction of , often inconveniently large , tomograms for the entire ﬁeld of view . Smaller subtomograms , centred around selected particles , are then extracted from the tomograms and used in a separate process of subtomogram alignment and averaging . The separation between tomogram re - construction and subtomogram averaging can lead to an accumulation of errors , as errors in the CTF es - timation or tilt series alignments are hard to correct . In addition , because the sample cannot be rotated 180 degrees within the microscope , the subtomograms con - tain empty regions in Fourier space , the so - called miss - ing wedge , which are diﬃcult to deal with in subtomo - gram averaging . A fundamental problem with subtomogram averag - ing as described above is that it transforms the original 2D image data into 3D subtomograms , which are then used as a substitute for experimental data in the align - ment algorithm . RELION - 2 introduced the concept of a 3D CTF to describe the transfer of information from the 2D images to the subtomograms , which dealt to some extent with the missing wedge and the loss of in - formation through interpolations in the reconstruction algorithm [ 4 ] . A drawback of the 3D CTF approach is that it does not deal correctly with the lower resolu - tion regions of Fourier space , where information from diﬀerent tilt images overlaps . A statistically more at - tractive approach would be to formulate the optimisa - tion target function directly as a function of the actual 2D images that are measured in the microscope . This has been proposed in an approach called constrained single - particle cryo - ET [ 1 ] , where individually boxed particles from the tilt series images are processed as in single - particle analysis , but their relative orientations are kept ﬁxed . To deal with unknowns in the relative orientations of the particles from the tilt series images , as well as their CTFs , the program M recently intro - duced new optimisation approaches that compare ref - erence projections against the 2D particle images [ 24 ] . M relies on RELION for alignment and classiﬁcation of 3D subtomograms that are recalculated from the op - timised parameters in M . Nevertheless , this iterative approach allows subtomogram averaging to resolutions that approach those observed for single - particle analy - sis , even for particles in complex cellular environments [ 24 ] . Here , we describe a new approach to subtomogram averaging in RELION - 4 . 0 that optimises a regularised likelihood function that approximates the direct use of the 2D images of the tilt series . In order to do so at ac - ceptable computational and implementation costs , we have altered the main reﬁnement program in RELION - 4 . 0 to work with so - called pseudo subtomograms : ex - plicitly constructed sets of 3D data arrays that con - tain sums of CTF pre - multiplied 2D tilt series images , together with auxiliary arrays that contain the corre - sponding sum of squared CTFs and how often each 3D voxel has been observed . Pseudo subtomograms no longer aim to represent the actual scattering potential of the underlying particles , in the way that conven - tional subtomograms would . Instead , they represent a convenient way to implement an approximation to the 2D approach within the existing RELION code . Evalu - ation of the pseudo subtomograms by RELION - 4 . 0 ap - proximates the likelihood of observing a hypothetical particle in the images of the entire tilt series , given the current model . Using that likelihood as a metric , oper - ations equivalent to those in single - particle analysis can now be performed on tomographic data , e . g . 3D initial model generation , 3D classiﬁcation or high - resolution reﬁnement . In addition , we describe new methods for optimising parameters of the tilt series that exploit the increased signal - to - noise ratio in the average structure . Besides optimisation of the tilt series alignment itself , we also describe methods analogous to CTF reﬁnement [ 30 , 32 ] for reﬁning descriptors of the optical prop - erties ( defocus , astigmatism and higher - order aberra - tions ) and a method akin to Bayesian Polishing [ 31 ] to model beam - induced particle motion throughout the tilt series . Once all these parameters have been opti - mised , new pseudo subtomograms can be constructed and the alignment can be repeated . The resulting iter - ative image processing workﬂow is similar to existing approaches for single - particle analysis in RELION . 2 Methods 2 . 1 Particle alignment and averaging RELION performs maximum - a - posteriori estimation to ﬁnd the set of model parameters Θ that maximise the probability of observing the experimental images X . Using Bayes’ theorem , we deﬁne a regularised like - lihood optimisation target function as : P ( Θ | X ) = P ( X | Θ ) P ( Θ ) , ( 1 ) where P ( Θ ) expresses prior information about the model , i . e . that the reconstructed map has limited power in Fourier space , and P ( X | Θ ) is the likelihood of observing the data given the model . A marginalised likelihood function is used , where one integrates over the unknown alignments φ of each individual particle . For simplicity , these integrals are omitted from the no - tations used in this paper . The data model assumes independent Gaussian noise on the Fourier components of the cryo - EM im - ages of individual particles p . We therefore write the negative log - likelihood of observing a particle p in a hypothetical alignment φ as a sum over a grid of 2D 2 Fourier pixels j ∈ R 2 : − log (cid:0) P ( X p | φ ) (cid:1) ∝ X j | X p j − CTF p ( j ) V ( p ) j | 2 σ 2 j , ( 2 ) where X p is the Fourier transform of the experimen - tal particle image , CTF p its contrast - transfer function , V ( p ) j denotes the 2D slice out of the 3D Fourier trans - form of the known map V into the view of the particle , and σ 2 j is the noise variance of the frequency band of j . V ( p ) j is given by V ( p ) j = exp ( i t p · j ) V ( A p j ) ( 3 ) for a 2D vector t p and a 2 × 3 matrix A p that respec - tively encapsulate the particle’s position and orienta - tion , and the evaluation of V ( A p j ) is achieved through linear interpolation . In tomography , our aim is to approximate that same likelihood on tilt - series data . The equivalent is a sum over the pixels of the relevant regions of all images f from the tilt series : − log (cid:0) P ( X p | φ ) (cid:1) ∝ X f , j | X p f j − CTF p f ( j ) V ( p ) f j | 2 σ 2 j . ( 4 ) We model the shifts and rotations as compositions of per - particle and per - image components : t pf = A ⊺ f T pf + t f ( 5 ) A pf = R p A f , ( 6 ) where we keep the per - particle rotation component , R p , identical for all images in the tilt series , and only vary A f , the rotational alignment of the tilt series im - ages . In turn , the tilt - series alignment A f is shared among all particles in a given tilt image . The per - particle part of the translation is modelled as a 3D vec - tor , T pf ∈ R 3 that can vary over diﬀerent tilt images f . This contrasts with single - particle analysis , where beam - induced motion of the particle can be corrected for as a preprocessing step [ 15 , 20 , 29 , 31 ] , so that each particle is associated with a single 2D translation in a motion - corrected image . For our pseudo - subtomogram approach , we now ap - proximate the sum over 2D pixels j and tilt images f in Eq . 4 by a sum over 3D voxels k in the pseudo - subtomogram : − log (cid:0) P ( X | φ ) (cid:1) ∝ X k | D p k − W p k V ( R p k ) | 2 M p σ 2 k . ( 7 ) Here , the data term D p , the weight term W p , and the multiplicity term M p are 3D arrays in the Fourier do - main . Together , they constitute a pseudo subtomo - gram . They are constructed as follows . D p k = X f , j l ( A pf j − k ) CTF p f ( j ) X p f j ( 8 ) W p k = X f , j l ( A pf j − k ) | CTF pf ( j ) | 2 ( 9 ) M p k = X f , j l ( A pf j − k ) , ( 10 ) where l ( · ) represents linear interpolation with forward mapping , i . e . each 2D Fourier pixel j is projected into 3D Fourier space , updating the 8 closest voxels . Ignoring the diﬀerence of pre - multiplying the im - ages with their CTFs , Eq ( 7 ) aims to be equivalent of Eq ( 4 ) . The variance σ 2 k is equivalent to σ 2 j , the power of the noise in the individual Fourier components in the 2D images . We then optimise Eq ( 1 ) by expectation - maximization [ 7 ] , using Eq ( 7 ) to construct the likeli - hood function and using a prior P ( Θ ) ∝ exp P k | V k | 2 − 2 τ 2 k , based on the expected frequency - dependent power of the signal τ 2 k . This leads to the following iterative al - gorithm : V ( n + 1 ) k = P p D ( R ⊺ p k ) / σ 2 k ( n + 1 ) P p W ( R ⊺ p k ) / σ 2 k ( n + 1 ) + 1 / τ 2 k ( n + 1 ) ( 11 ) σ 2 k ( n + 1 ) = P p P k ∈ S k | D k − W k V ( R p k ) | 2 2 P p P k ∈ S k M k , ( 12 ) τ 2 k ( n + 1 ) = | V k | 2 2 P p P k ∈ S k W k P p P k ∈ S k M k ( 13 ) where ( n ) denotes the iteration ; the divisions by τ 2 k and σ 2 k in Eq ( 11 ) are evaluated element - wise ; and τ 2 k and σ 2 k are calculated by averaging over τ 2 k and σ 2 k , respec - tively , in hollow spheres of radius k and thickness 1 , described by S k . The ratio of the terms containing W k and M k in Eq ( 13 ) corrects the estimate for the power of the signal from the CTF - corrected map V by the average CTF 2 , to account for the fact that the likeli - hood in Eq ( 7 ) was calculated for CTF pre - multiplied images . 2 . 2 Orientational priors One advantage of the approach to align pseudo subto - mograms is that the coordinate system of the pseudo subtomograms themselves can be chosen arbitrarily . By default , the pseudo subtomograms are created in the same orientation as the tomogram , but the user can chose to align them in a more meaningful way . This is useful , as many proteins are organised in 2D arrays inside the tomograms , for example inside mem - branes or as part of capsid - like structures . Often , the individual protein molecules inside these arrays exhibit limited rotational freedom with respect to the surface normal of the array , although they may be able to ro - tate freely around that normal . By constructing the pseudo subtomograms with their Z axis parallel to the normal of the 2D array , using a rotational prior on the tilt angle will limit the amount of rocking of the par - ticles inside the array . Rotational priors may be used to constrain the orientational searches . This not only accelerates the reﬁnement , as fewer orientations need to be evaluated , it also makes it possible to solve more challenging structures because fewer solutions are al - lowed . 3 2 . 3 Tilt series reﬁnement Averaging over multiple particles leads to an increased signal - to - noise ratio in the estimated density map V . We also implemented procedures that exploit V for subsequent re - estimation of parameters that describe the tilt series . These procedures do not require pseudo subtomograms , but are performed by comparing pro - jections of the density maps directly with the ( Fourier ) pixels of 2D boxes that are extracted from the tilt se - ries images , with a suﬃcient size to hold the CTF - delocalised signal . The various tilt series parameters are then estimated by minimising the negative log - likelihood as deﬁned in Eq . 4 , i . e . the sum over noise - weighted square diﬀerences between the prediction and the observation . The tilt - series properties that can be reﬁned fall into two broad categories : optical and geometrical . The optical reﬁnement concerns the diﬀerent parame - ters of the CTF , while the geometrical reﬁnement aims to optimise the alignment of the tilt series , as well as the beam - induced motion of the individual parti - cles . Both sets of algorithms are closely related to the corresponding single - particle algorithms in RELION : optical - aberration reﬁnement [ 30 , 32 ] and Bayesian Polishing [ 31 ] , respectively . In spite of the similarity between the algorithms , the models that are optimised diﬀer signiﬁcantly from single - particle analysis . Details of the implementation of the optical and geometrical reﬁnement algorithms are given in the Appendix . CTF reﬁnement for tomographic data in RELION - 4 . 0 includes optimisation of scale factors that model frequency - dependent radiation damage , defocus , astig - matism , and higher - order symmetrical and antisym - metrical aberrations . Although individual particles within a ﬁeld of view are at distinct defoci in the tilt series images , their relative defoci are known from the geometry of the tilt series and the known 3D positions of the particles in the tomogram . Therefore , one can eﬃciently perform defocus estimation in a single pass , considering all particles in a tilt series image simulta - neously . In order to do so , we modiﬁed procedures that were developed for higher - order aberration estimation in single - particle analysis [ 32 ] , where the information from all particles in each tilt series image is condensed into two images that are used to estimate a common phase shift ( see Appendix ) . Similar procedures can also be used to model higher - order symmetrical and antisymmetrical aber - rations in the tomographic data . Analogously to our single - particle approach , they are modeled using Zernike polynomials and estimated in the same way . Because the higher - order aberrations are often only a limiting factor at relatively high spatial frequencies , a large number of particles are needed to estimate them reliably . Optimally , higher - order aberrations would thus be estimated globally , over the entire data set , and only for cases that yield high - resolution averages . If aberrations change during data collection , data sets may be split into optics groups , for which aberrations are estimated separately . Typically , the third - order antisymmetrical aberrations are the most important ones , i . e . trefoil and axial coma , which can both be caused by a tilted beam . The resolution gains that these optimisations will yield depend on the microscope ( mis ) alignment . Provided alignment has been per - formed reasonably well , higher - order aberration cor - rection will probably be most useful for reconstructions that extend beyond 3 ˚A resolution . The geometric alignment includes both the ( rigid ) rotational and translational re - alignment of the tilt se - ries images , as well as the modelling of beam - induced motion of individual particles throughout the tilt se - ries . For the latter , we neglect rotations of the par - ticles , and only model beam - induced translations . By doing so , we can precompute the likelihood of each par - ticle being in each position around its original one , and then look for an alignment that simultaneously max - imises the sum of those likelihoods over all tilt series images and all particles , as well as a prior that ensures spatially coherent motion . This allows us to evalu - ate the likelihood of a hypothetical particle - position by looking up a single interpolated value in an image . In this formulation , the problem becomes equivalent to the Bayesian Polishing approach that we originally developed for single - particle analysis , except for the in - clusion of a third spatial dimension for the motion . 3 Results 3 . 1 HIV immature capsid We tested the workﬂow above on the cryo - ET dataset that was used to determine the structure of the im - mature capsid lattice and spacer peptide 1 ( CA - SP1 ) regions of the Gag polyprotein from human immuno - deﬁciency virus 1 ( HIV - 1 ) [ 21 ] ( EMPIAR - 10164 ) . We used the same subset of 5 tomograms that were also used to assess the NovaCTF [ 25 ] and Warp [ 23 ] pro - grams . Introducing 3D CTF correction , and using the alignment parameters from the original analysis by Schur et al , NovaCTF reported a resolution of 3 . 9 ˚A [ 25 ] . The Warp program introduced local and global motion correction in the tilt series images , as well as optimisation of CTF parameters . The combination of Warp and subtomogram alignment and averaging in RELION - 3 led to a resolution of 3 . 8 ˚A . We used tilt series projections after movie frame alignment from the original analysis [ 21 ] , without any other preprocessing step , along with the tilt series alignment data , performed with IMOD package [ 14 ] , and CTF parameters estimation using CTFFIND4 [ 18 ] . We used 13 , 320 particles from the 5 tomograms subset , reconstructed an initial reference map using the original published particle alignment and ﬁltered it to 5 ˚A . A ﬁrst alignment in 3D auto - reﬁne , followed by averaging of the initial pseudo subtomograms , led to a resolution of 3 . 6 ˚A . This average was then used for a full cycle of pseudo - subtomogram improvement and realignment . We ﬁrst applied CTF reﬁnement to optimise the defoci of all particles . This improved 4 the resolution only marginally . Subsequent optimisa - tion of the tilt series geometry , including modelling lo - cal particle motion , improved the resolution to 3 . 5 ˚A . And ﬁnally , re - alignment of newly generated pseudo - subtomograms led to a resolution of 3 . 4 ˚A . A sec - ond cycle of these three steps provided 3 . 3 ˚A , while a third cycle converged to 3 . 2 ˚A ( Figure 1a ) . Geomet - rical reﬁnement was performed estimating local par - ticle motion . Considering deformations did not show additional improvement . In the ﬁrst cycle , where im - provements in both CTFs and geometry are most ob - vious , the order of applying those optimisations did not alter the ﬁnal result for this data set . These data and results are also distributed as part of the subtomogram tutorial in RELION - 4 . 0 , as described on https : / / relion . readthedocs . io / en / release - 4 . 0 / . Analysis of the complete dataset generated a struc - ture at 3 . 0 ˚A resolution ( not shown ) , which is the same resolution obtained using the M and RELION - 3 work - ﬂow [ 24 ] , and is likely limited by ﬂexibility and asym - metry in the CA hexamer . 3 . 2 Caulobacter crescentus S - layer We also applied our approach to thin cellular ap - pendages of C . crescentus bacteria known as stalks , which have previously been imaged using cryo - ET [ 3 ] . The cell body and cell stalks of C . crescentus cells are covered by a nearly hexagonal , paracrystalline array known as the surface layer ( S - layer ) [ 22 ] . The struc - ture of the S - layer was solved using a combination of X - ray crystallography , cryo - EM single particle analy - sis and subtomogram averaging , revealing how the S - layer is attached to bacterial cells by an abundant gly - colipid called lipopolysaccharide ( LPS ) [ 3 , 26 ] . Previ - ously , cryo - ET of the S - layer , using 110 tilt series col - lected with a dose - symmetric scheme , yielded 51 , 866 hexamers of the S - layer . This study used a subto - mogram averaging approach that is based on a con - strained cross - correlation approach implemented in the AV3 Matlab suite [ 9 ] , and which was speciﬁcally opti - mised for the analysis of macromolecules arranged in a lattice [ 28 ] . A 7 . 4 ˚A reconstruction of the S - layer was obtained , in which alpha - helices were resolved [ 3 ] . This reconstruction was improved by application of No - vaCTF [ 25 ] , leading to a 4 . 8 ˚A reconstruction , in which large amino acid residue side chains were resolved [ 26 ] . Moreover , density for an LPS molecule was observed near the putative LPS - binding residues of the S - layer , in agreement with a cryo - EM single particle structure of an in vitro reconstituted complex [ 26 ] . We used the tilt series after movie frame alignment from the initial analysis [ 3 ] , along with the tilt series alignments performed within IMOD [ 14 ] , CTF parame - ters from CTFFIND4 [ 18 ] , and the Euler angle assign - ments and subtomogram co - ordinates from the orig - inal analysis . These parameters were imported into RELION - 4 . 0 , followed by multiple cycles of pseudo - subtomogram generation and reﬁnement , analogous to the immature HIV dataset described above , leading to a 5 . 6 ˚A reconstruction of the S - layer hexamer ( Figure 2a ) . Next , we deﬁned a mask around the central pore of the S - layer , corresponding to the inner domain bound to LPS , to perform focused reﬁnements . Another cycle of pseudo - subtomogram reconstruction , CTF reﬁne - ment and reﬁnement within the new mask improved the resolution to 4 . 4 ˚A . Accounting for per - particle motions with additional cycles of pseudo - subtomogram improvements and reﬁnements increased the resolution of the central pore to 4 . 0 ˚A , and the inner domain of the S - layer to 3 . 7 ˚A . Further 3D classiﬁcation without alignments identiﬁed a subset of 42 , 990 subtomograms that gave a 3 . 5 ˚A resolution reconstruction of the inner S - layer . The 3 . 5 ˚A map is in excellent agreement with the single particle structure of the in vitro reconstituted complex , including the LPS binding site [ 26 ] . Further - more , divalent metal ions , known to be tightly bound to the inner S - layer [ 11 ] , are resolved ( Figure 2b ) . Sur - prisingly , at lower isosurface contour levels , we also ob - served a second LPS binding site ( Figure 2c - d ) . The size and shape of this density agrees with the struc - ture of the LPS O - antigen , illustrating how improved subtomogram averaging in RELION - 4 . 0 can help un - cover new biology . 3 . 3 Coat Protein Complex II Finally , we applied our approach to the Saccharomyces cerevisiae Coat Protein Complex II ( COPII ) , which mediates the transport of newly synthesised proteins from the endoplasmic reticulum ( ER ) to the Golgi ap - paratus as part of the secretory pathway . COPII is formed by ﬁve proteins that assemble sequentially on the ER membrane to induce remodelling of the bilayer into coated carriers in a process known as COPII bud - ding , while simultaneously selectively recruiting cargo into these budding membrane carriers . COPII budding can be reconstituted in vitro from puriﬁed proteins and artiﬁcial membranes , to form small , spherical vesicles , or long , straight tubes . Cryo - ET has previously been used to visualise the architecture of COPII on recon - stituted tubules [ 12 , 13 ] . The coat assembles into two concentric layers ; the inner layer forms a pseudo helical lattice , which has previously been solved to 4 . 6 ˚A res - olution using Dynamo - based subtomogram averaging protocols [ 5 ] . We used the tilt series after movie alignment from the initial analysis [ 13 ] , along with the tilt series align - ments performed in IMOD [ 14 ] and CTF parameters from CTFFIND4 [ 18 ] . COPII - coated tubes were man - ually traced in the resulting tomograms , and particles were extracted by randomly oversampling their surface , with approximate initial orientations assigned based on the cylindrical geometry . Dynamo was used for initial alignment of 8x binned subtomograms to deﬁne the centre of the particles and the directionality of individ - ual tubes . We then imported the particle coordinates for processing in RELION - 4 . 0 using 3D reﬁnement at 4x and 2x binning . Since we expect inner coat sub - units to arrange in a lattice , we cleaned the dataset by excluding any subtomograms that did not conform to 5 the expected geometrical relationship with their neigh - bouring particles . A ﬁrst 3D reﬁnement of the un - binned dataset gave a map at 4 . 4 ˚A resolution , which was further improved to 4 . 2 ˚A and 4 . 0 ˚A by frame align - ment and CTF reﬁnement , respectively . Two further rounds of 3D reﬁnement , followed by frame alignment and CTF reﬁnement , yielded a ﬁnal map with a reso - lution of 3 . 8 ˚A . At this resolution , most side chains are visible in the map , enabling us to build and reﬁne an atomic model . The improved model will allow the design of point mutants to precisely disrupt interfaces between coat subunits and test their eﬀects in COPII budding . 4 Discussion We formulate the problem of averaging over multi - ple identical particles in tomographic tilt series in an empirical Bayesian framework that is based on a statistical model that approximates one for two - dimensional experimental data . The Bayesian frame - work has proven eﬀective in reducing the number of tunable parameters and in obtaining high - quality re - constructions from single - particle data [ 8 ] . The two - dimensional data model describes the experimental im - ages better than alternative approaches that use 3D reconstructed subtomograms as an intermediate . One example of a problem with the intermediate 3D data model is the need for missing wedge correction , which arises from the observation that the experimental im - ages were acquired , incompletely , in three dimensions . Artifacts related to suboptimal missing wedge correc - tion may aﬀect both alignment and classiﬁcation of particles . By using an approximation to the 2D data model , missing wedge correction is no longer required . Instead , the problem approaches that of single - particle analysis , where projections from diﬀerent orientations and of diﬀerent structural states are sorted out simulta - neously . Provided the 3D Fourier transform of the dis - tinct classes is fully sampled through the orientation distribution of the raw particles , likelihood optimisa - tion techniques have been highly successful in tackling this problem in single - particle analysis [ 19 , 8 ] . In practice , the implementation in RELION - 4 . 0 does not use stacks of 2D projection images as input for the reﬁnement program that performs alignment and classiﬁcation . Instead , the concept of 3D pseudo - subtomograms is introduced , where the tilt series im - ages are Fourier transformed , pre - multiplied with their CTF , and inserted as a slice into a 3D Fourier volume according to the best current estimates for the tilt se - ries geometry . In order to approach the likelihood of observing the individual 2D tilt series images , the like - lihood calculation from the 3D pseudo subtomogram requires separate storage of the accumulated squares of the CTFs , as well as a multiplicity term that keeps track how often each pixel in Fourier space is sampled . The use of pseudo subtomograms allowed re - using ex - isting code for subtomogram averaging in RELION , while input stacks of 2D images would have required signiﬁcant software development eﬀorts . Nevertheless , in the future one might still choose to implement a true 2D version of the code , as the number of Fourier pixels to examine , and hence the computational cost , will decrease under the currently common tomography setups . Speciﬁcally , a 2D implementation is more eﬃ - cient when the number of tilt images is small in com - parison to the particle size measured in pixels . For example , the current implementation could be used to process pairs of tilted images , but a 2D implementa - tion would be more eﬃcient . However , if one were to collect tilt series in a continuous manner [ 6 ] , then the current implementation is preferable . Besides the alignment and classiﬁcation of individ - ual particles , the methods described here also deal with re - estimation of parameters that describe the optical and geometrical features of the tilt series . As soon as an initial average structure has been obtained , its increased signal - to - noise ratio can be exploited to de - termine these parameters more accurately than what is possible from the raw tilt series images alone . The im - plementations in RELION - 4 . 0 again follow those pre - viously implemented for single - particle analysis , where CTF reﬁnement is used for re - estimation of the tilt series images CTFs , and algorithms akin to Bayesian polishing are used to re - estimate the tilt - series align - ment , as well as the movement of individual parti - cles throughout the tilt series acquisition process . As better tilt series parameters will allow better pseudo - subtomograms , particle alignment and classiﬁcation are iterated with the optimisation of the tilt series pa - rameters . Similar tilt series and CTF optimisation approaches have been implemented in the program M [ 24 ] . Com - pared to M , RELION - 4 . 0 uses computationally more eﬃcient algorithms that do not require the computa - tional power of a GPU . However , both in tomography and in SPA , RELION - 4 . 0 only models beam - induced translations of the particles , whereas M also models beam - induced rotations . Since SPA routinely reaches 2 ˚A resolutions without modelling beam - induced ro - tations , we assumed that the eﬀect of rotations of individual particles throughout the tilt series is not large enough to warrant their correction at typical to - mography resolutions . In cases where the data do allow for better than 2 ˚A resolutions , M could still be used to correct for beam - induced rotations in a postprocessing step , following alignment and classi - ﬁcation of the individual particles in RELION . It is likely that adaptation of M , in order to func - tion with the pseudo - subtomograms proposed here , would lead to increased synergy between the two pro - grams . In the meantime , external tools to convert from M parameters to RELION - 4 . 0 are already available ( https : / / github . com / joton / reliontomotools ) . Besides the reduction in tunable parameters that is characteristic of the Bayesian approach , its uptake by researchers that are new to the ﬁeld is further fa - cilitated through the implementation of a graphical user - interface . This interface is already widely used for single - particle analysis , and has been extended for 6 the processing of tomographic data in RELION - 4 . 0 . Apart from the calculations that will be familiar to users of single - particle analysis , e . g . 3D classiﬁcation , 3D initial model generation , 3D auto - reﬁnement , the new interface also provides convenient access to the tomography - speciﬁc versions for CTF reﬁnement and Bayesian polishing , as well as pre - processing operations to calculate the pseudo - subtomograms and to import data and metadata from pre - processing operations in IMOD [ 14 ] . To further facilitate the uptake of this new software by the community , we have provided an online tutorial that uses the publicly available HIV immature capsid data set to describe and illustrate all steps nec - essary to obtain the results described in Figure 1 . In summary , we introduce new methods for subto - mogram averaging to resolutions that are suﬃcient for de novo atomic modelling , and increase the accessibil - ity of this emerging technique . We envision that our methods will allow more researchers to calculate bet - ter structures from tomographic data , which will aid the next revolution in structural biology , where macro - molecular complexes are imaged , not in isolation , but in their biologically relevant environment . Acknowledgements We are grateful to the MRC - LMB EM facil - ity for help with data acquisition ; and to Jake Grimmett and Toby Darling for help with high - performance computing . This work was funded by the UK Research and Innovation ( UKRI ) Medical Research Council ( MC UP A025 1013 to S . H . W . S . ; and MC UP 1201 / 16 to J . A . G . B . ) , the European Re - search Council ( ERC ) under the European Union’s Horizon 2020 research and innovation program ( ERC - CoG - 2014 , grant 648432 , MEMBRANEFUSION to J . A . G . B . and ERC StG - 2019 , grant 852915 CRYTO - COP to G . Z . ) ; the Swiss National Science Founda - tion ( grant 205321 179041 / 1 to D . C . - D . ) , the Max Planck Society ( to J . A . G . B . ) and the UKRI Biotech - nology and Biological Sciences Research Council ( grant BB / T002670 / 1 to G . Z . ) . T . A . M . B . is a recipient of a Sir Henry Dale Fellowship , jointly funded by the Well - come Trust and the Royal Society ( 202231 / Z / 16 / Z ) . J . Z . was partially funded by the European Union’s Horizon 2020 research and innovation program ( ERC - ADG - 2015 , grant 692726 , GlobalBioIm to Michael Unser ) . T . A . M . B . thanks the Vallee Research Foun - dation , the Leverhulme Trust and the Lister Institute of Preventative Medicine for support . Appendix CTF Reﬁnement CTF reﬁnement in RELION - 4 . 0 optimises the fol - lowing parameters : scale , defocus , astigmatism and higher - order ( even and odd ) optical aberrations . Since , save for the diﬀerence in defocus , the same CTF needs to be valid for an entire micrograph of particles , similar optimisations can be applied as in our single - particle algorithms . All the relevant information is ﬁrst con - solidated into a minimal form using linear transforma - tions , and the ﬁnal , typically non - linear , optimisation is then performed on that minimal form . We formulate the CTF for frame f of particle p as follows : CTF pf ( j ) = − α f τ f ( j ) sin ( γ pf ( j ) ) exp ( iρ f ( j ) ) , ( 14 ) where α f describes the overall scaling factor , τ f ( j ) the empirical radiation - damage model as deﬁned by Grant and Grigorieﬀ [ 10 ] , γ pf j the symmetrical phase delay component and ρ f j the antisymmetrical one . Note that only γ varies between particles . This is because it contains the quadratic defocus term that depends on the position of the particle . The phase delays are parametrised the same way as in single - particle analy - sis in RELION - 3 – as a combination of explicitly named low - order terms and higher - order Zernike polynomials : γ pf ( j ) = πλ j ⊺ D pf j + π 2 C s λ 3 | j | 4 − χ f + X Z m n ( j ) , ( 15 ) D pf = (cid:20) δz p + a 1 a 2 a 2 δz p − a 1 (cid:21) . ( 16 ) As before , the astigmatic - defocus matrix D pf is decom - posed into a defocus term δz p and two linear astigma - tism terms , a 1 and a 2 , while C s describes the spherical aberration of the microscope , χ f a constant phase oﬀ - set ( owing to amplitude contrast and a phase plate , if one is used ) , λ is the wavelength of the electron and Z mn are the higher - order even Zernike terms . One key diﬀerence to single - particle analysis is that the defocus term δz p is no longer a free parameter for each parti - cle , but it instead depends on the already known 3D position of the particle . Therefore , in tomography , the defocus term is only estimated once per tilt - image , and all the particles contribute to that estimate . The scaling factor α f is estimated by computing the following two sums for each micrograph and dividing them ( the † symbol indicates complex conjugation ) : α f = G f H f ( 17 ) G f = X p , j 1 σ 2 | j | Re ( X pf j ( CTF ′ pf ( j ) V ( p ) pf j ) † ) ( 18 ) H f = X p , j 1 σ 2 | j | | CTF ′ pf ( j ) V ( p ) pf j | 2 . ( 19 ) Note that the CTF ′ used in Eq . 19 is missing its scale factor : CTF ′ pf ( j ) = − τ f ( j ) sin ( γ pf ( j ) ) exp ( iρ f ( j ) ) . ( 20 ) Alternatively , we also allow the user to ﬁt the pa - rameters of Lambert’s extinction model to the data instead , assuming perfectly ﬂat samples of constant thickness . In that case , the CTF scale in image f of tomogram t is expressed as a function of the beam 7 luminance α 0 , sample normal n t and optical sample thickness κ t : α tf ( α 0 , κ t , n t ) = α 0 κ 1 | n t · z f | t ( 21 ) If this option is used , then the CTF scales of all the tilt series in the data set are estimated together . The beam luminance α 0 is modeled globally , while the sam - ple thickness and normal are allowed to diﬀer among tomograms , but not between the images of a tilt series . The vector z f points in viewing direction of tilt image f . Note that this model does not allow for separat - ing the geometrical sample - thickness from its extinc - tion factor , so we can only estimate the product of the two . Also , the ice normal is required to be perpendic - ular to the estimated tilt axis of the tilt series , since its component pointing in the direction of the axis is indistinguishable from an increase in ice thickness or opacity . This global optimisation is performed using the sums G tf and H tf computed in Eqs . 18 and 19 , where the subscript t indicates tilt series t . This is done by ﬁnding a global value of α 0 and values of κ t and n t ∈ S 2 for all tomograms that produce α tf which minimise the following quantity and thus maximise the overall likelihood in Eq . 4 : X t , f ( H tf α tf ( α 0 , κ t , n t ) − G tf ) 2 . ( 22 ) To perform defocus estimation eﬃciently , we apply the optimisations we originally developed for the es - timation of higher - order aberrations in single - particle analysis [ 32 ] . It allows us to determine a collective oﬀ - set to γ for a large set of particles that all have diﬀerent values of γ . Speciﬁcally , it allows the change to the log - likelihood arising from changing the value of γ at any Fourier pixel to be expressed as a pair of 2D images , independently of the number of particles . Therefore , each pixel of each particle only needs to be considered once . After that , the log - likelihood can be evaluated by iterating over the pixels of a single image . In single - particle analysis , this approach is used to estimate the higher - order aberrations that are shared among all the particles in a data set . In tomography , we also use this approach to condense the information from all the particles in a tilt image ( all of which ex - hibit slightly diﬀerent defoci ) , into two such images , and to then determine the optimal change to γ very eﬃciently using a nonlinear algorithm . The two condensed images R and b t that we com - pute are the same as the ones in single - particle analysis , except for the inclusion of the noise power σ 2 . The def - initions are repeated here for the sake of completeness . Note that each pixel j of R contains a real symmetrical 2 × 2 matrix and each pixel of b t a C 2 vector : R f j = X p 1 σ 2 j | e V ( p ) f j | 2 d pf j d ⊺ pf j ( 23 ) b t f j = − R − 1 f j X p 1 σ 2 j Re ( X † pf j e V ( p ) f j ) d pf j , ( 24 ) where d pf j ∈ R 2 describes the point on the unit circle corresponding to the initial phase angle γ ( 0 ) , which is given by the initial CTF parameters : d pf j = " cos ( γ ( 0 ) pf ( j ) ) sin ( γ ( 0 ) pf ( j ) ) # . ( 25 ) The predicted 2D images e V ( p ) f contain the eﬀect of the initial CTFs , except for the symmetrical aberration : e V ( p ) f j = − α f τ f ( j ) exp ( iρ f ( j ) ) V ( p ) f j . ( 26 ) The vector - valued condensed image b t f describes the most likely phase shift γ for each pixel j , expressed as a point on a circle , while the matrix - valued one , R f , describes the anisotropic weight of that information . With these two condensed images computed for a given tilt image f , the change to the likelihood deﬁned in Eq . 4 resulting from the change to the phase delay γ at any pixel can be expressed as a quadratic form . Therefore , we look for a change δD to the astigmatic - defocus ma - trices D pf which produces phase delays that minimise that quadratic form : C f = X j e ⊺ j ( δD ) R j e j ( δD ) , ( 27 ) where the per - pixel error e j ( δD ) is given by the devia - tion from the optimal phase shift b t j : e j ( δD ) = (cid:20) cos ( δγ ) − Re ( b t j ) sin ( δγ ) − Im ( b t j ) (cid:21) ( 28 ) δγ = j ⊺ δD j ( 29 ) As an alternative to ﬁtting D independently for each tilt image , our program also allows the user to apply an L 2 regulariser to the δD f of the diﬀerent tilt im - ages in the same series . In that case , the sum in Eq . 27 runs over all the pixels j of all the frames f . This helps to stabilise the CTFs of the higher tilts , but it risks impairing the estimates of the CTFs of the more important lower tilts . Formally , this is done by min - imising the following cost : C glob = X f , j e ⊺ f j ( D f ) R f j e f j ( D f ) + λ X f | D f − b D | 2 , ( 30 ) Since the early frames carry more information than the later ones , their values in R are typically signiﬁ - cantly greater . Therefore , using this formulation , they automatically assume a greater weight in the estima - tion . The optimal weight for the regulariser itself , λ , depends on the speciﬁc hardware setup and cannot be measured from the data , however . Geometric Reﬁnement Analogously to Bayesian Polishing , the log likelihood of a particle being observed at a position s is given by 8 twice its cross correlation with the predicted image : log ( P ( X | s ) ) = 2CC ( s ) ( 31 ) CC = IFT ( wXV ( p ) † ) ( 32 ) w j = 1 σ 2 j . ( 33 ) To keep the problem diﬀerentiable , the cross correla - tion CC is always accessed using cubic interpolation . After the inverse Fourier transformation , each such cross - correlation table is cropped to a smaller size to make storing many such tables feasible , and the mem - ory throughput eﬃcient . The size of the tables can be controlled by the user , and should be set to the maxi - mal positional error expected in the data set . The geometrical model that is optimised this way projects points s ∈ R 3 in the tomogram to 2D positions p f ∈ R 2 in each tilt image : p f = W ( l f ) ( 34 ) l f = J f (cid:20) s 1 (cid:21) . ( 35 ) The initial linear projection l f is obtained by multi - plying s with a 2 × 4 matrix J f , and then optionally shifted by the non - linear image distortion W . The cost C align that is being minimised consists of the sum over all ( negative ) cross - correlation values of all particles in all images plus all regularisers for all regularised pa - rameters : C align = − X p , f CC ( p f − p ( 0 ) f ) + R ( 36 ) Although our framework supports arbitrary projec - tion matrices J f , our optimisation algorithm only looks for orthogonal rotations to the initial projection ma - trix . This is achieved by parametrising that rotation using Tait - Bryan angles , not Euler angles . The disad - vantage of Euler angles is that they are gimbal locked in the initial conﬁguration where all three angles are zero , i . e . the ﬁrst and third angle refer to the same axis . The rigid alignment of the tilt image is never reg - ularised , because we do not assume to have any prior information on it . The distortion ﬁeld W can take diﬀerent forms . We have implemented models that express the distortion using the Fourier basis , a cubic spline basis and an aﬃne linear one . The intended purpose of these defor - mations is to model distortions of the image that arise at the image forming lenses at the bottom of the op - tical system . An imperfect calibration of these lenses is likely to go unnoticed as long as the microscope is only used for single - particle analysis , because the same particle is never observed at starkly diﬀerent positions during the collection of a single - particle movie . In to - mography , a given particle may appear at any image position in any tilt image , so arbitrary deformations to the 2D image become relevant . We expect these defor - mations to be stable over time , so the intended purpose of the deformation ﬁeld W is to model only one such deformation per tilt series . Optionally , we also allow the user to instead model a diﬀerent deformation for each tilt image , but we have not encountered any data sets where this has produced an improvement . The deformation ﬁelds are optionally regularised by penal - ising the squared coeﬃcients of the respective model . This limits the extent of deformation , and it forces the system to explain changes in position through particle motion , rather than image deformations . The quantity that we do expect to change during the collection of the tilt series is instead the 3D position of the particle , s f . Analogously to Bayesian Polishing , we model this change as motion over time . The posi - tion in image f is given by the sum over its per - frame velocities v f ∈ R 3 up to that point . Note that the ve - locity vector v f refers to the motion between images f and f + 1 : s f = s 0 + f ′ < f X f ′ = 0 v f . ( 37 ) It is important to note that the tilt images are implic - itly assumed to be ordered chronologically . In practice , this is usually not given , so the images are reordered by the program based on the cumulative radiation dose of each image . As in Bayesian Polishing , the motion vectors them - selves are expressed in a collective coordinate sytem for all the particles . This allows the spatial smoothness of a hypothetical motion ﬁeld to be evaluated and used as a prior . For a more detailed derivation , we refer to the paper on Bayesian Polishing for single - particle analysis [ 31 ] . The formal details will be given in the following for the sake of completeness and to highlight diﬀerences to the original formulation . The collective coordinate system for particle mo - tion is obtained through a low - rank approximation of a Gaussian Process . This is done by constructing and then diagonalising the P × P covariance matrix S for a set of initial particle positions ( where P is the num - ber of particles ) . The entries of S contain the value of the following square - exponential covariance function for each pair of particles p and q : S p , q = σ 2 V exp ( − | s p − s q | 2 / σ D ) . ( 38 ) Optionally , the user can instead also use the original formulation without the square inside the exponential : S ′ p , q = σ 2 V exp ( − | s p − s q | / σ D ) . ( 39 ) The former option forces particles in immediate prox - imity to move more similarly , but it allows for a greater discrepancy at greater distances . Both the single - particle and the tomography implementations allow the user to choose either function , but the default has changed from the latter to the former in tomography . This choice was motivated by both empirical observa - tions and the fact that the square - exponential kernel produces fewer meaningful deformation components , which speeds up the optimisation for tomograms with very large numbers of particles . 9 We perform a singular - value decomposition of the covariance matrix S , S = U Λ W ⊺ , ( 40 ) which allows us to construct the coordinate system as follows : b i = p λ i w i , ( 41 ) where λ i ∈ R is the i th singular value and w i ∈ R P the corresponding singular vector . Basis vectors with very small λ i are discarded here to speed up the op - timisation . Let P ′ represent the number of remaining basis vectors . In this coordinate system , the set of all particle velocities in a tilt image V f ∈ ( R 3 ) P can be ex - pressed as V f = BQ f , where Q f is a P ′ × 3 coeﬃcient matrix that encodes the velocity in three spatial dimen - sions . Note that the same basis B is shared between all three dimensions and all frames . In this coordinate system , the negative log - likelihood of a conﬁguration of particle velocities is given by the Frobenius norm of the coeﬃcient vector , | | Q f | | , i . e . the sum of the squares of its entries . Therefore , the motion regulariser takes a very simple form : R motion = X f | | Q f | | . ( 42 ) The acceleration regulariser that would penalise changes in velocity from one frame to the next in single - particle analysis has been omitted from tomography . This is because , unlike a single - particle movie , the tilt images are not collected in one continuous exposure . Since they are being exposed individually , there is no reason to assume that the particle velocities will be continuous between them . Two further diﬀerences to the original Bayesian Polishing are hidden in the nota - tion : the covariance is now based on the 3D distances between the particles , and the coeﬃcient matrix Q con - tains three columns instead of two . As in the original Bayesian Polishing approach , the complete alignment of the tilt series is performed by ﬁnding parameters that minimise C align from Eq . 36 using L - BFGS [ 16 ] . The set of parameters that are being optimised always includes the three Tait - Bryan angles for each tilt image and the set of initial particle positions . The latter are essential , because all the in - formation we have about their 3D positions is derived from the tilt images themselves , so changing the align - ment requires the particles to be able to shift to more likely positions . Estimating the image deformations and particle motion is optional . If they are being es - timated , then a set of deformation coeﬃcients is ﬁtted either to each tilt image or to each tilt series , while a set of motion coeﬃcients is ﬁtted to each image transition . In addition to this local , L - BFGS based reﬁnement , we also oﬀer two methods to align only the 2D shifts of all tilt images globally . This means that instead of trying to obtain the optimal alignment through small changes to the initial one , we instead look for the best possible image shift overall , keeping all other param - eters constant . This is helpful when individual tilt images are so badly aligned that a local optimisation cannot converge to the globally optimal position . Note that the initially assumed angles are rarely as incorrect as the image shifts , since the angles can be controlled more eﬀectively through the experimental setup . There are two variants to this method . If the sample contains few particles per tomogram , then the best results are obtained by predicting an entire mi - crograph and computing its cross correlation with the original one . The maximum value in that large cross - correlation image then indicates the optimal image shift . This approach can in theory deal with arbitrarily large misalignments . If the sample is very dense , how - ever , then this whole - micrograph approach can fail . In that case , better results are obtained by instead adding up the small , per - particle cross correlation images de - ﬁned in Eq . 32 , and ﬁnding the maximum in that sum . This latter approach can only correct for misalignments smaller than half the box size of the particle , and it of - ten produces inferior results on samples with few par - ticles per tomogram . References [ 1 ] Alberto Bartesaghi , Federico Lecumberry , Guillermo Sapiro , and Sriram Subramaniam . Protein secondary structure determination by constrained single - particle cryo - electron tomogra - phy . Structure , 20 ( 12 ) : 2003 – 2013 , 2012 . [ 2 ] T Bepler , A Morin , M Rapp , J Brasch , L Shapiro , A . J . Noble , and B Berger . Positive - unlabeled convolutional neural networks for particle pick - ing in cryo - electron micrographs . Nature Methods , 16 ( 11 ) : 1548 – 7105 , 2019 . [ 3 ] Tanmay A M Bharat , Danguole Kureisaite - Ciziene , Gail G Hardy , Ellen W Yu , Jessica M Devant , Wim J H Hagen , Yves V Brun , John A G Briggs , and Jan L¨owe . Structure of the hexagonal surface layer on caulobacter crescentus cells . Nat Microbiol , 2 : 17059 , Apr 2017 . [ 4 ] Tanmay AM Bharat and Sjors HW Scheres . Re - solving macromolecular structures from electron cryo - tomography data using subtomogram averag - ing in relion . Nature protocols , 11 ( 11 ) : 2054 – 2065 , 2016 . [ 5 ] Daniel Casta˜no - D´ıez , Mikhail Kudryashev , Mar - cel Arheit , and Henning Stahlberg . Dynamo : a ﬂexible , user - friendly development tool for subtomogram averaging of cryo - em data in high - performance computing environments . Journal of structural biology , 178 ( 2 ) : 139 – 151 , 2012 . [ 6 ] Georges Chreiﬁ , Songye Chen , Lauren Ann Met - skas , Mohammed Kaplan , and Grant J Jensen . Rapid tilt - series acquisition for electron cry - otomography . Journal of structural biology , 205 ( 2 ) : 163 – 169 , 2019 . 10 [ 7 ] Arthur P Dempster , Nan M Laird , and Donald B Rubin . Maximum likelihood from incomplete data via the em algorithm . Journal of the Royal Statis - tical Society : Series B ( Methodological ) , 39 ( 1 ) : 1 – 22 , 1977 . [ 8 ] Rafael Fernandez - Leiro and Sjors HW Scheres . Unravelling biological macromolecules with cryo - electron microscopy . Nature , 537 ( 7620 ) : 339 – 346 , 2016 . [ 9 ] Friedrich F¨orster and Reiner Hegerl . Structure determination in situ by averaging of tomograms . Methods Cell Biol . , 79 : 741 – 767 , 2007 . [ 10 ] Timothy Grant and Nikolaus Grigorieﬀ . Measur - ing the optimal exposure for single particle cryo - EM using a 2 . 6 ˚a reconstruction of rotavirus vp6 . Elife , 4 , 2015 . [ 11 ] Matthew Herdman , Andriko von K¨ugelgen , Dan - guole Kureisaite - Ciziene , Ramona Duman , Kamel El Omari , Elspeth F Garman , Andreas Kjaer , Dimitrios Kolokouris , Jan L¨owe , Armin Wagner , Phillip J Stansfeld , and Tanmay A M Bharat . High - resolution mapping of metal ions reveals principles of surface layer assembly in caulobac - ter crescentus cells . Structure , Nov 2021 . [ 12 ] Joshua Hutchings , Viktoriya Stancheva , Eliza - beth A Miller , and Giulia Zanetti . Subtomogram averaging of copii assemblies reveals how coat or - ganization dictates membrane shape . Nature com - munications , 9 ( 1 ) : 1 – 8 , 2018 . [ 13 ] Joshua Hutchings , Viktoriya G Stancheva , Nick R Brown , Alan Cheung , Elizabeth A Miller , and Giulia Zanetti . Structure of the complete , membrane - assembled copii coat reveals a com - plex interaction network . Nature communications , 12 ( 1 ) : 1 – 13 , 2021 . [ 14 ] James R Kremer , David N Mastronarde , and J Richard McIntosh . Computer visualization of three - dimensional image data using imod . Jour - nal of structural biology , 116 ( 1 ) : 71 – 76 , 1996 . [ 15 ] Xueming Li , Paul Mooney , Shawn Zheng , Christo - pher R Booth , Michael B Braunfeld , Sander Gubbens , David A Agard , and Yifan Cheng . Elec - tron counting and beam - induced motion correc - tion enable near - atomic - resolution single - particle cryo - EM . Nature methods , 10 ( 6 ) : 584 , 2013 . [ 16 ] Dong C Liu and Jorge Nocedal . On the lim - ited memory bfgs method for large scale optimiza - tion . Mathematical programming , 45 ( 1 - 3 ) : 503 – 528 , 1989 . [ 17 ] A Punjani , JL Rubinstein , DJ Fleet , and MA Brubaker . cryosparc : algorithms for rapid un - supervised cryo - em structure determination . Na - ture Methods , 14 ( 3 ) : 290 – 296 , 2017 . [ 18 ] Alexis Rohou and Nikolaus Grigorieﬀ . CTFFIND4 : Fast and accurate defocus esti - mation from electron micrographs . Journal of Structural Biology , 192 ( 2 ) : 216 – 221 , nov 2015 . [ 19 ] SHW Scheres , H Gao , M Valle , GT Herman , PBB Eggermont , J Frank , and JM Carazo . Disentan - gling conformational states of macromolecules in 3d - em through likelihood optimization . Nature Methods , 4 ( 1 ) : 270 – 29 , 2007 . [ 20 ] Sjors HW Scheres . Beam - induced motion correc - tion for sub - megadalton cryo - EM particles . Elife , 3 , 2014 . [ 21 ] Florian KM Schur , Martin Obr , Wim JH Hagen , William Wan , Arjen J Jakobi , Joanna M Kirk - patrick , Carsten Sachse , Hans - Georg Kr¨ausslich , and John AG Briggs . An atomic model of hiv - 1 capsid - sp1 reveals structures regulating assem - bly and maturation . Science , 353 ( 6298 ) : 506 – 508 , 2016 . [ 22 ] J Smit , H Engelhardt , S Volker , S H Smith , and W Baumeister . The s - layer of caulobacter crescen - tus : three - dimensional image reconstruction and structure analysis by electron microscopy . J Bac - teriol , 174 ( 20 ) : 6527 – 38 , Oct 1992 . [ 23 ] Dimitry Tegunov and Patrick Cramer . Real - time cryo - electron microscopy data preprocessing with warp . Nature methods , 16 ( 11 ) : 1146 – 1152 , 2019 . [ 24 ] Dimitry Tegunov , Liang Xue , Christian Diene - mann , Patrick Cramer , and Julia Mahamid . Multi - particle cryo - em reﬁnement with m visual - izes ribosome - antibiotic complex at 3 . 5 ˚a in cells . Nature Methods , 18 ( 2 ) : 186 – 193 , 2021 . [ 25 ] Beata Turoˇnov´a , Florian KM Schur , William Wan , and John AG Briggs . Eﬃcient 3d - ctf cor - rection for cryo - electron tomography using novactf improves subtomogram averaging resolution to 3 . 4 ˚a . Journal of structural biology , 199 ( 3 ) : 187 – 195 , 2017 . [ 26 ] Andriko von K¨ugelgen , Haiping Tang , Gail G Hardy , Danguole Kureisaite - Ciziene , Yves V Brun , Phillip J Stansfeld , Carol V Robinson , and Tanmay A . M . Bharat . In situ structure of an intact lipopolysaccharide - bound bacterial surface layer . Cell , 180 ( 2 ) : 348 – 358 . e15 , 01 2020 . [ 27 ] T Wagner , F Merino , M Stabrin , T Moriya , C An - toni , A Apelbaum , P Hagel , O Sitsel , T Raisch , D Prumbaum , D Quentin , D Roderer , S Tacke , B Siebolds , E Schubert , TR Shaikh , P Lill , C Gat - sogiannis , and S Raunser . Sphire - cryolo is a fast and accurate fully automated particle picker for cryo - em . Commun Biol , 2 ( 1 ) : 2399 – 3642 , 2019 . [ 28 ] William Wan , Larissa Kolesnikova , Mairi Clarke , Alexander Koehler , Takeshi Noda , Stephan Becker , and John A G Briggs . Structure and as - sembly of the ebola virus nucleocapsid . Nature , 551 ( 7680 ) : 394 – 397 , 11 2017 . 11 [ 29 ] Shawn Q Zheng , Eugene Palovcak , Jean - Paul Armache , Kliment A Verba , Yifan Cheng , and David A Agard . Motioncor2 : anisotropic correc - tion of beam - induced motion for improved cryo - electron microscopy . Nature methods , 14 ( 4 ) : 331 , 2017 . [ 30 ] Jasenko Zivanov , Takanori Nakane , Bj¨orn O Fors - berg , Dari Kimanius , Wim JH Hagen , Erik Lin - dahl , and Sjors HW Scheres . New tools for auto - mated high - resolution cryo - em structure determi - nation in relion - 3 . elife , 7 : e42166 , 2018 . [ 31 ] Jasenko Zivanov , Takanori Nakane , and Sjors HW Scheres . A bayesian approach to beam - induced motion correction in cryo - em single - particle anal - ysis . IUCrJ , 6 ( 1 ) : 5 – 17 , 2019 . [ 32 ] Jasenko Zivanov , Takanori Nakane , and Sjors HW Scheres . Estimation of high - order aberrations and anisotropic magniﬁcation from cryo - em data sets in relion - 3 . 1 . IUCrJ , 7 ( 2 ) : 253 – 267 , 2020 . 12 a b c Figure 1 : Subtomogram averaging of the HIV immature capsid . ( a ) FSC for resolution estimation of iteratively improved reconstructions using the new RELION - 4 . 0 workﬂow . ( b ) Representative region of reconstructed density in the ﬁnal map . ( c ) The same density as in ( b ) , together with the atomic model . 13 c S - layer inner domain Final map only protein shown d Final map only LPS shown LPS1 LPS2 Cryo - ET density LPS Ca 2 + Per - Nac Man S - layer inner domain b Resolution ( 1 / Å ) Fou r i e r S h e ll C o rr e l a t i on 0 . 00 0 . 05 0 . 10 0 . 15 0 . 20 0 . 25 0 . 30 0 . 35 0 . 40 0 . 0 0 . 1 0 . 2 0 . 3 0 . 4 0 . 5 0 . 6 0 . 7 0 . 8 0 . 9 1 . 0 3 . 5 Å 3D - Classification 3 . 7 Å Focused refinement 4 . 0 Å Per - particle motion 4 . 4 Å Ctf - Refinement a Figure 2 : Subtomogram averaging of the C . crescentus S - layer from cell stalks . ( a ) FSC for resolution estimation of iteratively improved reconstructions using the new RELION - 4 . 0 workﬂow , tested on the S - layer inner domain . ( b ) Densities for the previously identiﬁed LPS ( cyan and orange ) and Ca 2 + ions ( green ) in prior cryo - EM single particle analyses are resolved . ( c , d ) The ﬁnal map shows two densities for bound LPS O - antigen chains . Panel ( c ) shows only the S - layer protein as blue ribbon and ( d ) shows LPS O - antigen as orange and cyan sugars corresponding to the N - acetyl - perosamine and mannose moeities respectively . 14 b c Resolution ( 1 / Å ) Fou r i e r s h e ll c o rr e l a t i on 0 . 40 0 . 35 0 . 30 0 . 25 0 . 20 0 . 15 0 . 10 0 . 05 0 0 0 . 1 0 . 2 0 . 3 0 . 4 0 . 5 0 . 6 0 . 7 0 . 8 0 . 9 1 a 4 . 4 Å Refine3D 4 . 2 Å Per - particle motion 4 . 0 Å CTF Refinement 3 . 8 Å Cycle 2 3 . 8 Å Cycle 3 Figure 3 : Subtomogram averaging of the COP - II inner layer . ( a ) FSC for resolution estimation of iteratively improved reconstructions using the new RELION - 4 . 0 workﬂow , tested on the COP - II inner layer . ( b ) Reconstructed density for the inner layer . ( c ) Zoomed - in region of the ﬁnal map ( in transparent grey ) with the reﬁned atomic model ( blue ) . 15