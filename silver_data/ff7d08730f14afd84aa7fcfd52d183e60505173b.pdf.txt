Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics Tobias Marschall and Sven Rahmann Bioinformatics for High - Throughput Technologies Chair of Algorithm Engineering TU Dortmund , Germany June 18th , 2008 Motivation Given an alphabet Σ a pattern , for example a ﬁnite set of strings over Σ a text model ( for now : an i . i . d . model ) Sought distribution of random variable X n ( = number of matches in random string of length n ) p - value for a given k , i . e . P ( X n ≥ k ) Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 2 Example Pattern : ACACAC Textlength : 10 , 000 Uniform distribution over Σ = { A , C , G , T } Related Work R´egnier , 2000 Reinert , Schbath , and Waterman , 2000 Nicod ` eme , Salvy , and Flajolet , 2002 Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 3 Example Pattern : ACACAC Textlength : 10 , 000 Uniform distribution over Σ = { A , C , G , T } Related Work R´egnier , 2000 Reinert , Schbath , and Waterman , 2000 Nicod ` eme , Salvy , and Flajolet , 2002 Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 3 Overview 1 Deﬁnition of probabilistic arithmetic automata ( PAA ) and generic algorithms on PAAs 2 Using PAAs for pattern matching statistics 3 Applicability in Computational Biology Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 4 Deﬁnition : Probabilistic Arithmetic Automaton A PAA is a tuple (cid:0) Q , T , q 0 , E , ( π q ) q ∈ Q , N , n 0 , ( θ q ) q ∈ Q (cid:1) : Q : ﬁnite set of states T : Q × Q → [ 0 , 1 ] : stochastic transition function , i . e . T ( q , q 0 ) is the probability of going from q to q 0 q 0 ∈ Q : start state E : ﬁnite set called emission set π q : E → [ 0 , 1 ] : a emission distribution associated with state q N : ﬁnite set called value set n 0 ∈ N : start value θ q : N × E → N : an operation associated with state q Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton A PAA is a tuple (cid:0) Q , T , q 0 , E , ( π q ) q ∈ Q , N , n 0 , ( θ q ) q ∈ Q (cid:1) : Q : ﬁnite set of states T : Q × Q → [ 0 , 1 ] : stochastic transition function , i . e . T ( q , q 0 ) is the probability of going from q to q 0 q 0 ∈ Q : start state E : ﬁnite set called emission set π q : E → [ 0 , 1 ] : a emission distribution associated with state q N : ﬁnite set called value set n 0 ∈ N : start value θ q : N × E → N : an operation associated with state q Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton A PAA is a tuple (cid:0) Q , T , q 0 , E , ( π q ) q ∈ Q , N , n 0 , ( θ q ) q ∈ Q (cid:1) : Q : ﬁnite set of states T : Q × Q → [ 0 , 1 ] : stochastic transition function , i . e . T ( q , q 0 ) is the probability of going from q to q 0 q 0 ∈ Q : start state E : ﬁnite set called emission set π q : E → [ 0 , 1 ] : a emission distribution associated with state q N : ﬁnite set called value set n 0 ∈ N : start value θ q : N × E → N : an operation associated with state q Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton A PAA is a tuple (cid:0) Q , T , q 0 , E , ( π q ) q ∈ Q , N , n 0 , ( θ q ) q ∈ Q (cid:1) : Q : ﬁnite set of states T : Q × Q → [ 0 , 1 ] : stochastic transition function , i . e . T ( q , q 0 ) is the probability of going from q to q 0 q 0 ∈ Q : start state E : ﬁnite set called emission set π q : E → [ 0 , 1 ] : a emission distribution associated with state q N : ﬁnite set called value set n 0 ∈ N : start value θ q : N × E → N : an operation associated with state q Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Deﬁnition : Probabilistic Arithmetic Automaton Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 5 Computing the Joint State - Value Distribution Basic recurrence p k + 1 ( q , v ) = X q 0 ∈ Q X ( v 0 , e ) ∈ θ − 1 q ( v ) p k ( q 0 , v 0 ) · T ( q 0 , q ) · π q ( e ) p k ( q , v ) : probability of being in state q and having computed a value of v after k steps θ q : operation associated with state q T : transition function π q : emission distribution associated with state q Q : set of all states Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 6 Runtime of Basic Algorithm Basic recurrence p k + 1 ( q , v ) = X q 0 ∈ Q X ( v 0 , e ) ∈ θ − 1 q ( v ) p k ( q 0 , v 0 ) · T ( q 0 , q ) · π q ( e ) Time O ( m · | Q | 2 · | N | 2 · | E | ) Space O ( | Q | · | N | ) m : number of steps Q : set of states N : value set E : emission set Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 7 Runtime of Basic Algorithm Basic recurrence p k + 1 ( q , v ) = X q 0 ∈ Q X ( v 0 , e ) ∈ θ − 1 q ( v ) p k ( q 0 , v 0 ) · T ( q 0 , q ) · π q ( e ) Time O ( m · | Q | 2 · | N | · | E | ) Space O ( | Q | · | N | ) m : number of steps Q : set of states N : value set E : emission set Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 7 Doubling Algorithm Consider U ( k ) ( q 1 , q 2 , v 1 , v 2 ) : probability of being in state q 2 with value v 2 after k steps , given to have started in state q 1 with value v 1 Recurrence U ( 1 ) ( q 1 , q 2 , v 1 , v 2 ) = T ( q 1 , q 2 ) · X e ∈ E : θ q 2 ( v 1 , e ) = v 2 π q 2 ( e ) U ( k 1 + k 2 ) ( q 1 , q 2 , v 1 , v 2 ) = X q 0 ∈ Q v 0 ∈ N U ( k 1 ) ( q 1 , q 0 , v 1 , v 0 ) U ( k 2 ) ( q 0 , q 2 , v 0 , v 2 ) Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 8 Runtime of Doubling Algorithm Recurrence U ( k 1 + k 2 ) ( q 1 , q 2 , v 1 , v 2 ) = X q 0 ∈ Q v 0 ∈ N U ( k 1 ) ( q 1 , q 0 , v 1 , v 0 ) U ( k 2 ) ( q 0 , q 2 , v 0 , v 2 ) Time O ( log m · | Q | 3 · | N | 3 ) Space O ( | Q | 2 · | N | 2 ) m : number of steps Q : set of states N : value set Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 9 Pattern Matching Statistics { AC , ACG , TACT , TTAC } DFA construction Step 1 : Build Aho - Corasick automaton Step 2 : Transform into DFA Step 3 : Annotate each state with num - ber of matches to be counted when entering this state Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 10 Pattern Matching Statistics { AC , ACG , TACT , TTAC } DFA construction Step 1 : Build Aho - Corasick automaton Step 2 : Transform into DFA Step 3 : Annotate each state with num - ber of matches to be counted when entering this state Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 10 Pattern Matching Statistics { AC , ACG , TACT , TTAC } Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 10 Pattern Matching Statistics { AC , ACG , TACT , TTAC } Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 10 Pattern Matching Statistics { AC , ACG , TACT , TTAC } Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 10 Runtimes for Pattern Matching Statistics Algorithms Generic Pattern Matching Statistics Basic O ( m · | Q | 2 · | N | · | E | ) O ( m · | Σ | · | Q | · | N | ) Doubling O ( log m · | Q | 3 · | N | 3 ) O ( log m · | Q | 3 · | N | 2 ) m : number of steps Q : set of states N : value set E : emission set Σ : alphabet Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 11 Application : Amino Acid Motifs PROSITE Database with 1303 biologically meaningful patterns , examples : [ LIV ] - [ STAG ] - V - [ DEQV ] - [ FLI ] - D - [ ST ] C - x ( 4 , 5 ) - C - C - S - x ( 2 ) - G - x - C - G - x ( 3 , 4 ) - [ FYW ] - C Experiment For each pattern from PROSITE : Pattern → NFA → DFA → PAA Result Despite exponential increase in the number of states in theory , automata ﬁt into main memory for 1261 of 1303 patterns ( 96 . 8 % ) . Average runtime : 2 seconds Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 12 PROSITE : Automata ( PAA ) Sizes Runtime : textlength : 1000 , matches : 50 , states : 500 ⇒ 1s Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 13 PROSITE : Automata ( PAA ) Sizes Runtime : textlength : 1000 , matches : 50 , states : 500 ⇒ 1s Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 13 Probabilistic String Sets String set string probability CAA 0 . 9 CAT 0 . 5 CAC 0 . 3 Text model character probability A 0 . 1 C 0 . 2 G 0 . 3 T 0 . 4 Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 14 Applications of Stochastic Emissions Transcription factor binding site statistics JASPAR : Database containing position weight matrices Step 1 : Enumerate the n best - scoring strings Step 2 : Based on a biophysical model ( Roider et al . , 2007 ) , calculate the probability that TF binds each string Step 3 : Use resulting probabilistic string set to build PAA Statistics of fragment masses in cleavage reactions States emit masses of amino acids ( Kaltenbach et al . , 2006 ) Emission distribution may take isotopic distribution into account Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 15 Other things possible with PAAs Markovian text models Inhomogeneous text models Diﬀerent counting schemes Advantages of PAAs Built on DFAs , allows reuse of algorithms Easy to implement Permit exact statistics for practical problems Flexible Thank you for your attention ! Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 16 Other things possible with PAAs Markovian text models Inhomogeneous text models Diﬀerent counting schemes Advantages of PAAs Built on DFAs , allows reuse of algorithms Easy to implement Permit exact statistics for practical problems Flexible Thank you for your attention ! Marschall , Rahmann | Probabilistic Arithmetic Automata and their Application to Pattern Matching Statistics 16